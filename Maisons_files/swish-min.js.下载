if(!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";function x(e){return null!=e&&e===e.window}var Vt=[],E=C.document,r=Object.getPrototypeOf,s=Vt.slice,g=Vt.concat,u=Vt.push,i=Vt.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var at="3.4.1",k=function(e,t){return new k.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function d(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}k.fn=k.prototype={jquery:at,constructor:k,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(t){t=k.merge(this.constructor(),t);return t.prevObject=this,t},each:function(e){return k.each(this,e)},map:function(n){return this.pushStack(k.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(n){var t=this.length,n=+n+(n<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:Vt.sort,splice:Vt.splice},k.extend=k.fn.extend=function(){var e,t,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(k.isPlainObject(r)||(i=Array.isArray(r)))?(o=a[t],o=i&&!Array.isArray(o)?[]:i||k.isPlainObject(o)?o:{},i=!1,a[t]=k.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},k.extend({expando:"jQuery"+(at+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(n){return!(!n||"[object Object]"!==o.call(n)||(n=r(n))&&("function"!=typeof(n=v.call(n,"constructor")&&n.constructor)||a.call(n)!==l))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t){b(e,{nonce:t&&t.nonce})},each:function(e,t){var n,r=0;if(d(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,n){n=n||[];return null!=e&&(d(Object(e))?k.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!=a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(d(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g.apply([],a)},guid:1,support:y}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=Vt[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var xe=function(n){function ne(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(65536+r):String.fromCharCode(r>>10|55296,1023&r|56320)}function oe(){T()}var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,k="sizzle"+ +new Date,m=n.document,S=0,r=0,p=ue(),x=ue(),N=ue(),A=ue(),D=function(e,t){return e===t&&(l=!0),0},j={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",$=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",F=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp($),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(m.childNodes),m.childNodes),t[m.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&((e?e.ownerDocument||e:m)!==C&&T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!A[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&U.test(t)){for((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=k),o=(l=h(t)).length;o--;)l[o]="#"+s+" "+xe(l[o]);c=l.join(","),f=ee.test(t)&&ye(e.parentNode)||e}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){A(t,!0)}finally{s===k&&e.removeAttribute("id")}}}return g(t.replace(B,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[k]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){for(var n=e.split("|"),r=n.length;r--;)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){for(var n,r=a([],e.length,o),i=r.length;i--;)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(n){var t=n.namespaceURI,n=(n.ownerDocument||n).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(r){var t,r=r?r.ownerDocument||r:m;return r!==C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),m!==C&&(t=C.defaultView)&&t.top!==t&&(t.addEventListener?t.addEventListener("unload",oe,!1):t.attachEvent&&t.attachEvent("onunload",oe)),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=k,!C.getElementsByName||!C.getElementsByName(k).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(n,t){if(void 0!==t.getElementById&&E){n=t.getElementById(n);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(t){t=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;n=o[i++];)1===n.nodeType&&r.push(n);return r},b.find.CLASS=d.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){a.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+k+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||v.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",$)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,r){var n=9===e.nodeType?e.documentElement:e,r=r&&r.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e===C||e.ownerDocument===m&&y(m,e)?-1:t===C||t.ownerDocument===m&&y(m,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===C?-1:t===C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]===m?-1:s[r]===m?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==C&&T(e),d.matchesSelector&&E&&!A[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){A(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==C&&T(e);var r=b.attrHandle[t.toLowerCase()],r=r&&j.call(b.attrHandle,t.toLowerCase())?r(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(D),l){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=p[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&p(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(t){t=se.attr(t,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(F," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!=m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){for(;l;){for(a=e;a=a[l];)if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){for(d=(s=(r=(i=(o=(a=c)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1])&&r[2],a=s&&c.childNodes[s];a=++s&&a&&a[l]||(d=s=0)||u.pop();)if(1===a.nodeType&&++d&&a===e){i[h]=[S,s,d];break}}else if(!1===(d=p?s=(r=(i=(o=(a=e)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1]:d))for(;(a=++s&&a&&a[l]||(d=s=0)||u.pop())&&((x?a.nodeName.toLowerCase()!==f:1!==a.nodeType)||!++d||(p&&((i=(o=a[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[S,d]),a!==e)););return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){for(var n,r=a(e,o),i=r.length;i--;)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(B,"$1"));return s[k]?le(function(e,t,n,r){for(var i,o=s(e,null,r,[]),a=e.length;a--;)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(t){return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(t=t.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){for(;e=e[u];)if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var i,r,a=[S,p];if(n){for(;e=e[u];)if((1===e.nodeType||f)&&s(e,t,n))return!0}else for(;e=e[u];)if(1===e.nodeType||f)if(i=(r=e[k]||(e[k]={}))[e.uniqueID]||(r[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===S&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){for(var r=i.length;r--;)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,r){r=!o&&(r||t!==w)||((i=t).nodeType?u:l)(e,t,r);return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[k]){for(n=++s;n<r&&!b.relative[e[n].type];n++);return function Ce(d,h,g,v,y,e){return v&&!v[k]&&(v=Ce(v)),y&&!y[k]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v)for(i=Te(p,u),v(i,[],n,r),o=i.length;o--;)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a));if(e){if(y||d){if(y){for(i=[],o=p.length;o--;)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}for(o=p.length;o--;)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(B,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);for(a=e,s=[],u=b.preFilter;a;){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(B," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=N[e+" "];if(!a){for(n=(t=t||h(e)).length;n--;)((a=Ee(t[n]))[k]?i:o).push(a);(a=N(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=S+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t===C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){for(a=0,t||o.ownerDocument===C||(T(o),n=!E);s=v[a++];)if(s(o,t||C,n)){r.push(o);break}i&&(S=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){for(a=0;s=y[a++];)s(c,f,t,n);if(e){if(0<u)for(;l--;)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(S=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=G.needsContext.test(e)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=k.split("").sort(D).join("")===k,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,r,n){if(!n)return!0===e[r]?r.toLowerCase():(r=e.getAttributeNode(r))&&r.specified?r.value:null}),se}(C);k.find=xe,k.expr=xe.selectors,k.expr[":"]=k.expr.pseudos,k.uniqueSort=k.unique=xe.uniqueSort,k.text=xe.getText,k.isXMLDoc=xe.isXML,k.contains=xe.contains,k.escapeSelector=xe.escape;function T(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&k(e).is(n))break;r.push(e)}return r}function S(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var N=k.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?k.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?k.grep(e,function(e){return e===n!==r}):"string"!=typeof n?k.grep(e,function(e){return-1<i.call(n,e)!==r}):k.filter(n,e,r)}k.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?k.find.matchesSelector(r,e)?[r]:[]:k.find.matches(e,k.grep(t,function(e){return 1===e.nodeType}))},k.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(k(e).filter(function(){for(t=0;t<r;t++)if(k.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)k.find(e,i[t],n);return 1<r?k.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&N.test(e)?k(e):e||[],!1).length}});var L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(k.fn.init=function(i,t,n){if(!i)return this;if(n=n||q,"string"!=typeof i)return i.nodeType?(this[0]=i,this.length=1,this):m(i)?void 0!==n.ready?n.ready(i):i(k):k.makeArray(i,this);if(!(r="<"===i[0]&&">"===i[i.length-1]&&3<=i.length?[null,i,null]:L.exec(i))||!r[1]&&t)return(!t||t.jquery?t||n:this.constructor(t)).find(i);if(r[1]){if(t=t instanceof k?t[0]:t,k.merge(this,k.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),D.test(r[1])&&k.isPlainObject(t))for(var r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}).prototype=k.fn;var q=k(E),H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}k.fn.extend({has:function(e){var t=k(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(k.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&k(e);if(!N.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&k.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?k.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(k(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),k.each({parent:function(t){t=t.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return T(e,"parentNode")},parentsUntil:function(e,t,n){return T(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return T(e,"nextSibling")},prevAll:function(e){return T(e,"previousSibling")},nextUntil:function(e,t,n){return T(e,"nextSibling",n)},prevUntil:function(e,t,n){return T(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return void 0!==e.contentDocument?e.contentDocument:(A(e,"template")&&(e=e.content||e),k.merge([],e.childNodes))}},function(r,i){k.fn[r]=function(e,t){var n=k.map(this,i,e);return(t="Until"!==r.slice(-5)?e:t)&&"string"==typeof t&&(n=k.filter(t,n)),1<this.length&&(O[r]||k.uniqueSort(n),H.test(r)&&n.reverse()),this.pushStack(n)}});var R=/[^\x20\t\r\n\f]+/g;function M(e){return e}function I(e){throw e}function W(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}k.Callbacks=function(r){var n;r="string"==typeof r?(n={},k.each(r.match(R)||[],function(e,t){n[t]=!0}),n):k.extend({},r);function c(){for(a=a||r.once,o=i=!0;u.length;l=-1)for(t=u.shift();++l<s.length;)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1);r.memory||(t=!1),i=!1,a&&(s=t?[]:"")}var i,t,o,a,s=[],u=[],l=-1,f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){k.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return k.each(arguments,function(e,t){for(var n;-1<(n=k.inArray(t,s,n));)s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<k.inArray(e,s):0<s.length},empty:function(){return s=s&&[],this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},k.extend({Deferred:function(e){var o=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return k.Deferred(function(r){k.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,M,s),l(u,o,I,s)):(u++,t.call(e,l(u,o,M,s),l(u,o,I,s),l(u,o,M,o.notifyWith))):(a!==M&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==I&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(k.Deferred.getStackHook&&(t.stackTrace=k.Deferred.getStackHook()),C.setTimeout(t))}}return k.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:M,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:M)),o[2][3].add(l(0,e,m(n)?n:I))}).promise()},promise:function(e){return null!=e?k.extend(e,a):a}},s={};return k.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){function a(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}}var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=k.Deferred();if(n<=1&&(W(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();for(;t--;)W(i[t],a(t),o.reject);return o.promise()}});var $=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&$.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},k.readyException=function(e){C.setTimeout(function(){throw e})};var F=k.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),k.ready()}k.fn.ready=function(e){return F.then(e).catch(function(e){k.readyException(e)}),this},k.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--k.readyWait:k.isReady)||(k.isReady=!0)!==e&&0<--k.readyWait||F.resolveWith(E,[k])}}),k.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(k.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var _=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)_(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),t=l?a?(t.call(e,r),null):(l=t,function(e,t,n){return l.call(k(e),n)}):t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},z=/^-ms-/,U=/-([a-z])/g;function X(e,t){return t.toUpperCase()}function V(e){return e.replace(z,"ms-").replace(U,X)}function G(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function Y(){this.expando=k.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},G(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[V(t)]=n;else for(r in t)i[V(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][V(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(V):(t=V(t))in r?[t]:t.match(R)||[]).length;for(;n--;)delete r[t[n]]}void 0!==t&&!k.isEmptyObject(r)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(t){t=t[this.expando];return void 0!==t&&!k.isEmptyObject(t)}};var Q=new Y,J=new Y,K=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function ee(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:K.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,n)}else n=void 0;return n}k.extend({hasData:function(e){return J.hasData(e)||Q.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return Q.access(e,t,n)},_removeData:function(e,t){Q.remove(e,t)}}),k.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){J.set(this,n)}):_(this,function(e){var t;return o&&void 0===e?void 0!==(t=J.get(o,n))||void 0!==(t=ee(o,n))?t:void 0:void this.each(function(){J.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(i=J.get(o),1===o.nodeType&&!Q.get(o,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=V(r.slice(5)),ee(o,r,i[r]));Q.set(o,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),k.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Q.get(e,t),n&&(!r||Array.isArray(n)?r=Q.access(e,t,k.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=k.queue(e,t),r=n.length,i=n.shift(),o=k._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){k.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Q.get(e,n)||Q.access(e,n,{empty:k.Callbacks("once memory").add(function(){Q.remove(e,[t+"queue",n])})})}}),k.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?k.queue(this[0],t):void 0===n?this:this.each(function(){var e=k.queue(this,t,n);k._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&k.dequeue(this,t)})},dequeue:function(e){return this.each(function(){k.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function s(){--r||i.resolveWith(o,[o])}var n,r=1,i=k.Deferred(),o=this,a=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=Q.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var at=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+at+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ie=E.documentElement,oe=function(e){return k.contains(e.ownerDocument,e)},ae={composed:!0};ie.getRootNode&&(oe=function(e){return k.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});function se(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===k.css(e,"display")}function ue(e,t,n,i){var o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,i||[]),t)e.style[o]=a[o];return i}function le(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return k.css(e,t,"")},u=s(),l=n&&n[3]||(k.cssNumber[t]?"":"px"),c=e.nodeType&&(k.cssNumber[t]||"px"!==l&&+u)&&ne.exec(k.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)k.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,k.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ce={};function fe(e,t){for(var n,r,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Q.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&se(r)&&(l[c]=(u=a=o=void 0,a=r.ownerDocument,s=r.nodeName,(u=ce[s])||(o=a.body.appendChild(a.createElement(s)),u=k.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ce[s]=u)))):"none"!==n&&(l[c]="none",Q.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}k.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){se(this)?k(this).show():k(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&A(e,t)?k.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Q.set(e[n],"globalEval",!t||Q.get(t[n],"globalEval"))}ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;var be=/<|&#?\w+;/;function we(e,t,n,r,i){for(var o,a,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))k.merge(p,o.nodeType?[o]:o);else if(be.test(o)){for(a=a||f.appendChild(t.createElement("div")),u=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[u]||ge._default,a.innerHTML=u[1]+k.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;k.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&-1<k.inArray(o,r))i&&i.push(o);else if(l=oe(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n)for(c=0;o=a[c++];)he.test(o.type||"")&&n.push(o);return f}Vt=E.createDocumentFragment().appendChild(E.createElement("div")),(xe=E.createElement("input")).setAttribute("type","radio"),xe.setAttribute("checked","checked"),xe.setAttribute("name","t"),Vt.appendChild(xe),y.checkClone=Vt.cloneNode(!0).cloneNode(!0).lastChild.checked,Vt.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!Vt.cloneNode(!0).lastChild.defaultValue;var Te=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ee=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function Se(){return!1}function Ne(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ae(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ae(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Se;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return k().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=k.guid++)),e.each(function(){k.event.add(this,t,i,r,n)})}function De(e,i,o){o?(Q.set(e,i,!1),k.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Q.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(k.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Q.set(this,i,r),t=o(this,i),this[i](),r!==(n=Q.get(this,i))||t?Q.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(Q.set(this,i,{value:k.event.trigger(k.extend(r[0],k.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,i)&&k.event.add(e,i,ke)}k.event={global:{},add:function(t,e,n,r,i){var o,a,u,l,c,f,d,h,p,v=Q.get(t);if(v)for(n.handler&&(n=(o=n).handler,i=o.selector),i&&k.find.matchesSelector(ie,i),n.guid||(n.guid=k.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(e){return void 0!==k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(R)||[""]).length;l--;)d=p=(c=Ee.exec(e[l])||[])[1],h=(c[2]||"").split(".").sort(),d&&(f=k.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=k.event.special[d]||{},c=k.extend({type:d,origType:p,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&k.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),k.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.hasData(e)&&Q.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(R)||[""]).length;l--;)if(d=g=(s=Ee.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=k.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||k.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)k.event.remove(e,d+t[l],n,r,!0);k.isEmptyObject(u)&&Q.remove(e,"handle events")}},dispatch:function(c){var t,n,i,r,a,s=k.event.fix(c),u=new Array(arguments.length),l=(Q.get(this,"events")||{})[s.type]||[],c=k.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){for(a=k.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!1!==r.namespace&&!s.rnamespace.test(r.namespace)||(s.handleObj=r,s.data=r.data,void 0!==(r=((k.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<k(i,this).index(l):k.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[k.expando]?e:new k.Event(e)},special:{load:{noBubble:!0},click:{setup:function(t){t=this||t;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click",ke),!1},trigger:function(t){t=this||t;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click"),!0},_default:function(t){t=t.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Q.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},k.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},k.Event=function(e,t){if(!(this instanceof k.Event))return new k.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&k.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},function(e,t){k.event.special[e]={setup:function(){return De(this,e,Ne),!1},trigger:function(){return De(this,e),!0},delegateType:t}}),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){k.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||k.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),k.fn.extend({on:function(e,t,n,r){return Ae(this,e,t,n,r)},one:function(e,t,n,r){return Ae(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,k(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Se),this.each(function(){k.event.remove(this,e,n,t)});for(i in e)this.off(i,t,e[i]);return this}});var je=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,qe=/<script|<style|<link/i,Le=/checked\s*(?:[^=]|=\s*.checked.)/i,He=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&k(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Re(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(u,t){var n,r,i,o,a,l;if(1===t.nodeType){if(Q.hasData(u)&&(o=Q.access(u),a=Q.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)k.event.add(t,i,l[i][n]);J.hasData(u)&&(u=J.access(u),u=k.extend({},u),J.set(t,u))}}function Ie(n,r,i,o){r=g.apply([],r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Le.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),Ie(t,r,i,o)});if(f&&(t=(e=we(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=k.map(ve(e,"script"),Pe)).length;c<f;c++)u=e,c!==p&&(u=k.clone(u,!0,!0),s&&k.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,k.map(a,Re),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Q.access(u,"globalEval")&&k.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?k._evalUrl&&!u.noModule&&k._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):b(u.textContent.replace(He,""),u,l))}return n}function We(e,t,n){for(var r,i=t?k.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||k.cleanData(ve(r)),r.parentNode&&(n&&oe(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}k.extend({htmlPrefilter:function(e){return e.replace(je,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=oe(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||k.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],"input"===(l=(u=a[r]).nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Me(o[r],a[r]);else Me(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=k.event.special,o=0;void 0!==(n=e[o]);o++)if(G(n)){if(t=n[Q.expando]){if(t.events)for(r in t.events)i[r]?k.event.remove(n,r):k.removeEvent(n,r,t.handle);n[Q.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),k.fn.extend({detach:function(e){return We(this,e,!0)},remove:function(e){return We(this,e)},text:function(e){return _(this,function(e){return void 0===e?k.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ie(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return Ie(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Oe(this,e)).insertBefore(e,t.firstChild)})},before:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(k.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return k.clone(this,e,t)})},html:function(e){return _(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!qe.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=k.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(k.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Ie(this,arguments,function(e){var t=this.parentNode;k.inArray(this,n)<0&&(k.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){k.fn[e]=function(e){for(var t,n=[],r=k(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),k(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var $e=new RegExp("^("+at+")(?!px)[a-z%]+$","i"),Fe=function(e){var t=e.ownerDocument.defaultView;return(t=!t||!t.opener?C:t).getComputedStyle(e)},Be=new RegExp(re.join("|"),"i");function _e(i,o,n){var r,a,s=i.style;return(n=n||Fe(i))&&(""!==(a=n.getPropertyValue(o)||n[o])||oe(i)||(a=k.style(i,o)),!y.pixelBoxStyles()&&$e.test(a)&&Be.test(o)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){var e;u&&(s.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(s).appendChild(u),e=C.getComputedStyle(u),n="1%"!==e.top,a=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),r=36===t(e.width),u.style.position="absolute",i=12===t(u.offsetWidth/3),ie.removeChild(s),u=null)}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s=E.createElement("div"),u=E.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===u.style.backgroundClip,k.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),a},scrollboxSize:function(){return e(),i}}))}();var Ue=["Webkit","Moz","ms"],Xe=E.createElement("div").style,Ve={};function Ge(e){return k.cssProps[e]||Ve[e]||(e in Xe?e:Ve[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ue.length;n--;)if((e=Ue[n]+t)in Xe)return e}(e)||e)}var Ye=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},Ke={letterSpacing:"0",fontWeight:"400"};function Ze(e,t,n){var r=ne.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function et(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=k.css(e,n+re[a],!0,i)),r?("content"===n&&(u-=k.css(e,"padding"+re[a],!0,i)),"margin"!==n&&(u-=k.css(e,"border"+re[a]+"Width",!0,i))):(u+=k.css(e,"padding"+re[a],!0,i),"padding"!==n?u+=k.css(e,"border"+re[a]+"Width",!0,i):s+=k.css(e,"border"+re[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function tt(e,t,n){var r=Fe(e),i=(!y.boxSizingReliable()||n)&&"border-box"===k.css(e,"boxSizing",!1,r),o=i,a=_e(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if($e.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===k.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===k.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+et(e,t,n||(i?"border":"content"),o,r,a)+"px"}function nt(e,t,n,r,i){return new nt.prototype.init(e,t,n,r,i)}k.extend({cssHooks:{opacity:{get:function(n,t){if(t){n=_e(n,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=V(t),u=Qe.test(t),l=e.style;if(u||(t=Ge(s)),a=k.cssHooks[t]||k.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"==(o=typeof n)&&(i=ne.exec(n))&&i[1]&&(n=le(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(k.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,o,n,r){var i,a=V(o);return Qe.test(o)||(o=Ge(a)),"normal"===(i=void 0===(i=(a=k.cssHooks[o]||k.cssHooks[a])&&"get"in a?a.get(e,!0,n):i)?_e(e,o,r):i)&&o in Ke&&(i=Ke[o]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),k.each(["height","width"],function(e,u){k.cssHooks[u]={get:function(e,t,n){if(t)return!Ye.test(k.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?tt(e,u,n):ue(e,Je,function(){return tt(e,u,n)})},set:function(e,t,s){var r,i=Fe(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||s)&&"border-box"===k.css(e,"boxSizing",!1,i),s=s?et(e,u,s,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-et(e,u,"border",!1,i)-.5)),s&&(r=ne.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=k.css(e,u)),Ze(0,t,s)}}}),k.cssHooks.marginLeft=ze(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(_e(e,"marginLeft"))||e.getBoundingClientRect().left-ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),k.each({margin:"",padding:"",border:"Width"},function(i,o){k.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+re[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(k.cssHooks[i+o].set=Ze)}),k.fn.extend({css:function(e,t){return _(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Fe(e),i=t.length;a<i;a++)o[t[a]]=k.css(e,t[a],!1,r);return o}return void 0!==n?k.style(e,t,n):k.css(e,t)},e,t,1<arguments.length)}}),((k.Tween=nt).prototype={constructor:nt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||k.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(k.cssNumber[n]?"":"px")},cur:function(){var e=nt.propHooks[this.prop];return(e&&e.get?e:nt.propHooks._default).get(this)},run:function(e){var t,n=nt.propHooks[this.prop];return this.options.duration?this.pos=t=k.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:nt.propHooks._default).set(this),this}}).init.prototype=nt.prototype,(nt.propHooks={_default:{get:function(t){return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(t=k.css(t.elem,t.prop,""))&&"auto"!==t?t:0},set:function(e){k.fx.step[e.prop]?k.fx.step[e.prop](e):1!==e.elem.nodeType||!k.cssHooks[e.prop]&&null==e.elem.style[Ge(e.prop)]?e.elem[e.prop]=e.now:k.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=nt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},k.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},k.fx=nt.prototype.init,k.fx.step={};var rt,it,st=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function lt(){it&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(lt):C.setTimeout(lt,k.fx.interval),k.fx.tick())}function ct(){return C.setTimeout(function(){rt=void 0}),rt=Date.now()}function ft(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=re[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function pt(e,t,n){for(var r,i=(dt.tweeners[t]||[]).concat(dt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function dt(o,e,t){var n,a,r=0,i=dt.prefilters.length,s=k.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var t=rt||ct(),t=Math.max(0,l.startTime+l.duration-t),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},t),originalProperties:e,originalOptions:t,startTime:rt||ct(),duration:t.duration,tweens:[],createTween:function(n,t){n=k.Tween(o,l.opts,n,t,l.opts.specialEasing[n]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=V(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=k.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=dt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(k._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return k.map(c,pt,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),k.fx.timer(k.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}k.Animation=k.extend(dt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return le(n.elem,e,ne.exec(t),n),n}]},tweener:function(e,t){for(var n,r=0,i=(e=m(e)?(t=e,["*"]):e.match(R)).length;r<i;r++)n=e[r],dt.tweeners[n]=dt.tweeners[n]||[],dt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&se(e),v=Q.get(e,"fxshow");for(r in n.queue||(null==(a=k._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,k.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],st.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||k.style(e,r)}if((u=!k.isEmptyObject(t))||!k.isEmptyObject(d))for(r in c&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Q.get(e,"display")),"none"===(c=k.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=k.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===k.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Q.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&fe([e],!0),p.done(function(){for(r in g||fe([e]),Q.remove(e,"fxshow"),d)k.style(e,r,d[r])})),u=pt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?dt.prefilters.unshift(e):dt.prefilters.push(e)}}),k.speed=function(e,t,n){var r=e&&"object"==typeof e?k.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return k.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in k.fx.speeds?r.duration=k.fx.speeds[r.duration]:r.duration=k.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&k.dequeue(this,r.queue)},r},k.fn.extend({fadeTo:function(e,t,n,r){return this.filter(se).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,a){var i=k.isEmptyObject(t),o=k.speed(e,n,a),a=function(){var e=dt(this,k.extend({},t),o);(i||Q.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){function a(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=k.timers,r=Q.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&ut.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||k.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Q.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=k.timers,o=n?n.length:0;for(t.finish=!0,k.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),k.each(["toggle","show","hide"],function(e,r){var i=k.fn[r];k.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(ft(r,!0),e,t,n)}}),k.each({slideDown:ft("show"),slideUp:ft("hide"),slideToggle:ft("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){k.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),k.timers=[],k.fx.tick=function(){var e,t=0,n=k.timers;for(rt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||k.fx.stop(),rt=void 0},k.fx.timer=function(e){k.timers.push(e),k.fx.start()},k.fx.interval=13,k.fx.start=function(){it||(it=!0,lt())},k.fx.stop=function(){it=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(r,e){return r=k.fx&&k.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},Vt=E.createElement("input"),at=E.createElement("select").appendChild(E.createElement("option")),Vt.type="checkbox",y.checkOn=""!==Vt.value,y.optSelected=at.selected,(Vt=E.createElement("input")).value="t",Vt.type="radio",y.radioValue="t"===Vt.value;var ht,gt=k.expr.attrHandle;k.fn.extend({attr:function(e,t){return _(this,k.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){k.removeAttr(this,e)})}}),k.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?k.prop(e,t,n):(1===o&&k.isXMLDoc(e)||(i=k.attrHooks[t.toLowerCase()]||(k.expr.match.bool.test(t)?ht:void 0)),void 0!==n?null===n?void k.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):!(i&&"get"in i&&null!==(r=i.get(e,t)))&&null==(r=k.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(R);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),ht={set:function(e,t,n){return!1===t?k.removeAttr(e,n):e.setAttribute(n,n),n}},k.each(k.expr.match.bool.source.match(/\w+/g),function(e,t){var a=gt[t]||k.find.attr;gt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=gt[o],gt[o]=r,r=null!=a(e,t,n)?o:null,gt[o]=i),r}});var vt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;function mt(e){return(e.match(R)||[]).join(" ")}function xt(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(R)||[]}k.fn.extend({prop:function(e,t){return _(this,k.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[k.propFix[e]||e]})}}),k.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&k.isXMLDoc(e)||(t=k.propFix[t]||t,i=k.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=k.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),y.optSelected||(k.propHooks.selected={get:function(t){t=t.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(t){t=t.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){k.propFix[this.toLowerCase()]=this}),k.fn.extend({addClass:function(t){var e,n,r,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).addClass(t.call(this,e,xt(this)))});if((e=bt(t)).length)for(;n=this[u++];)if(s=xt(n),r=1===n.nodeType&&" "+mt(s)+" "){for(a=0;o=e[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");s!==(s=mt(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).removeClass(t.call(this,e,xt(this)))});if(!arguments.length)return this.attr("class","");if((e=bt(t)).length)for(;n=this[u++];)if(s=xt(n),r=1===n.nodeType&&" "+mt(s)+" "){for(a=0;o=e[a++];)for(;-1<r.indexOf(" "+o+" ");)r=r.replace(" "+o+" "," ");s!==(s=mt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"==o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){k(this).toggleClass(i.call(this,e,xt(this),t),t)}):this.each(function(){var e,t,n,r;if(a)for(t=0,n=k(this),r=bt(i);e=r[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==i&&"boolean"!=o||((e=xt(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==i&&Q.get(this,"__className__")||""))})},hasClass:function(e){for(var n,r=0,t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&-1<(" "+mt(xt(n))+" ").indexOf(t))return!0;return!1}});var wt=/\r/g;k.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(t){1===this.nodeType&&(null==(t=i?n.call(this,t,k(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=k.map(t,function(e){return null==e?"":e+""})),(r=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=k.valHooks[t.type]||k.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(wt,""):null==e?"":e:void 0}}),k.extend({valHooks:{option:{get:function(e){var t=k.find.attr(e,"value");return null!=t?t:mt(k.text(e))}},select:{get:function(e){for(var t,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length,r=o<0?u:a?o:0;r<u;r++)if(((t=i[r]).selected||r===o)&&!t.disabled&&(!t.parentNode.disabled||!A(t.parentNode,"optgroup"))){if(t=k(t).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=k.makeArray(t),a=i.length;a--;)((r=i[a]).selected=-1<k.inArray(k.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),k.each(["radio","checkbox"],function(){k.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<k.inArray(k(e).val(),t)}},y.checkOn||(k.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;function Ct(e){e.stopPropagation()}var Tt=/^(?:focusinfocus|focusoutblur)$/;k.extend(k.event,{trigger:function(e,t,n,r){var i,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[],o=f=a=n=n||E;if(3!==n.nodeType&&8!==n.nodeType&&!Tt.test(d+k.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[k.expando]?e:new k.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:k.makeArray(t,[e]),c=k.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,Tt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}for(i=0;(o=p[i++])&&!e.isPropagationStopped();)f=o,e.type=1<i?s:c.bindType||d,(l=(Q.get(o,"events")||{})[e.type]&&Q.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&G(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!G(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),k.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Ct),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Ct),k.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(r,t,n){r=k.extend(new k.Event,n,{type:r,isSimulated:!0});k.event.trigger(r,null,t)}}),k.fn.extend({trigger:function(e,t){return this.each(function(){k.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return k.event.trigger(e,t,n,!0)}}),y.focusin||k.each({focus:"focusin",blur:"focusout"},function(n,r){function i(e){k.event.simulate(r,e.target,k.event.fix(e))}k.event.special[r]={setup:function(){var e=this.ownerDocument||this,t=Q.access(e,r);t||e.addEventListener(n,i,!0),Q.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=Q.access(e,r)-1;t?Q.access(e,r,t):(e.removeEventListener(n,i,!0),Q.remove(e,r))}}});var Et=C.location,kt=Date.now(),St=/\?/;k.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||k.error("Invalid XML: "+e),t};var Nt=/\[\]$/,At=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;k.param=function(e,t){function i(e,n){n=m(n)?n():n,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)}var n,r=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!k.isPlainObject(e))k.each(e,function(){i(this.name,this.value)});else for(n in e)!function qt(n,e,r,i){if(Array.isArray(e))k.each(e,function(e,t){r||Nt.test(n)?i(n,t):qt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(var t in e)qt(n+"["+t+"]",e[t],r,i)}(n,e[n],t,i);return r.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=k.prop(this,"elements");return e?k.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!k(this).is(":disabled")&&jt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=k(this).val();return null==n?null:Array.isArray(n)?k.map(n,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:n.replace(At,"\r\n")}}).get()}});var Lt=/%20/g,Ht=/#.*$/,Ot=/([?&])_=[^&]*/,Pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Rt=/^(?:GET|HEAD)$/,Mt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Ft=E.createElement("a");function Bt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(R)||[];if(m(t))for(;n=i[r++];)"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function _t(t,i,o,a){var s={},u=t===Wt;function l(e){var r;return s[e]=!0,k.each(t[e]||[],function(e,n){n=n(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function zt(e,t){var n,r,i=k.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r=r||{})[n]=t[n]);return r&&k.extend(!0,e,r),e}Ft.href=Et.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,k.ajaxSettings),t):zt(k.ajaxSettings,e)},ajaxPrefilter:Bt(It),ajaxTransport:Bt(Wt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=k.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?k(y):k.event,x=k.Deferred(),b=k.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n)for(n={};t=Pt.exec(p);)n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){if(e)if(h)T.always(e[T.status]);else for(var t in e)w[t]=[w[t],e[t]];return this},abort:function(t){t=t||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace(Mt,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(R)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Ft.protocol+"//"+Ft.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=k.param(v.data,v.traditional)),_t(It,v,t,T),h)return T;for(i in(g=k.event&&v.global)&&0==k.active++&&k.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Rt.test(v.type),f=v.url.replace(Ht,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Lt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(St.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Ot,"$1"),o=(St.test(f)?"&":"?")+"_="+kt+++o),v.url=f+o),v.ifModified&&(k.lastModified[f]&&T.setRequestHeader("If-Modified-Since",k.lastModified[f]),k.etag[f]&&T.setRequestHeader("If-None-Match",k.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+$t+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=_t(Wt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,u,i){var o,a,s,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=i||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,u&&(s=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a=a||i}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,u)),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(k.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(k.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--k.active||k.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return k.get(e,t,n,"json")},getScript:function(e,t){return k.get(e,void 0,t,"script")}}),k.each(["get","post"],function(e,i){k[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),k.ajax(k.extend({url:e,type:i,dataType:r,data:t,success:n},k.isPlainObject(e)&&e))}}),k._evalUrl=function(e,t){return k.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){k.globalEval(e,t)}})},k.fn.extend({wrapAll:function(t){return this[0]&&(m(t)&&(t=t.call(this[0])),t=k(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){k(this).wrapInner(n.call(this,e))}):this.each(function(){var e=k(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){k(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){k(this).replaceWith(this.childNodes)}),this}}),k.expr.pseudos.hidden=function(e){return!k.expr.pseudos.visible(e)},k.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Ut={0:200,1223:204},Xt=k.ajaxSettings.xhr();y.cors=!!Xt&&"withCredentials"in Xt,y.ajax=Xt=!!Xt,k.ajaxTransport(function(i){var o,a;if(y.cors||Xt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Ut[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),k.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return k.globalEval(e),e}}}),k.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),k.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=k("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var Gt=[],Yt=/(=)\?(?=&|$)|\?\?/;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gt.pop()||k.expando+"_"+kt++;return this[e]=!0,e}}),k.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Yt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Yt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||k.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?k(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Gt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((Vt=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Vt.childNodes.length),k.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(y.createHTMLDocument?((o=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(o)):t=E),o=!i&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=we([e],t,o),o&&o.length&&k(o).remove(),k.merge([],i.childNodes)));var o},k.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=mt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&k.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?k("<div>").append(k.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){k.fn[t]=function(e){return this.on(t,e)}}),k.expr.pseudos.animated=function(t){return k.grep(k.timers,function(e){return t===e.elem}).length},k.offset={setOffset:function(e,t,n){var o,a,s,i,r=k.css(e,"position"),c=k(e),f={};"static"===r&&(e.style.position="relative"),s=c.offset(),o=k.css(e,"top"),i=k.css(e,"left"),i=("absolute"===r||"fixed"===r)&&-1<(o+i).indexOf("auto")?(a=(r=c.position()).top,r.left):(a=parseFloat(o)||0,parseFloat(i)||0),null!=(t=m(t)?t.call(e,n,k.extend({},s)):t).top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){k.offset.setOffset(this,t,e)});var e,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===k.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===k.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=k(e).offset()).top+=k.css(e,"borderTopWidth",!0),i.left+=k.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-k.css(r,"marginTop",!0),left:t.left-i.left-k.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===k.css(e,"position");)e=e.offsetParent;return e||ie})}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;k.fn[t]=function(e){return _(this,function(e,t,n){var r;return x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n?r?r[i]:e[t]:void(r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n)},t,e,arguments.length)}}),k.each(["top","left"],function(e,n){k.cssHooks[n]=ze(y.pixelPosition,function(e,t){if(t)return t=_e(e,n),$e.test(t)?k(e).position()[n]+"px":t})}),k.each({Height:"height",Width:"width"},function(a,s){k.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){k.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return _(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?k.css(e,t,i):k.style(e,t,n,i)},s,n?e:void 0,n)}})}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){k.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),k.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),k.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),k.proxy=function(e,t){var r,i;if("string"==typeof t&&(i=e[t],t=e,e=i),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||k.guid++,i},k.holdReady=function(e){e?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=A,k.isFunction=m,k.isWindow=x,k.camelCase=V,k.type=w,k.now=Date.now,k.isNumeric=function(e){var t=k.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return k});var Qt=C.jQuery,Jt=C.$;return k.noConflict=function(e){return C.$===k&&(C.$=Jt),e&&C.jQuery===k&&(C.jQuery=Qt),k},e||(C.jQuery=C.$=k),k}),define("config",["jquery"],function($){var config,KEY="SWISHCONFIG";return(config=config||function getCachedConfig(){var str;if("undefined"!=typeof Storage&&window.swish.config_hash&&(str=localStorage.getItem(KEY))&&(value=JSON.parse(str),value.hash==window.swish.config_hash))return value.config}())||$.ajax({url:"swish_config.json",dataType:"json",async:!1,success:function(data){!function setCachedConfig(config){"undefined"!=typeof Storage&&window.swish.config_hash&&localStorage.setItem(KEY,JSON.stringify({hash:window.swish.config_hash,config:config}))}(config=data)},error:function(){alert("Failed to fetch configuration from server")}}),config}),define("preferences",["jquery"],function($){var hasLocalStore="undefined"!=typeof Storage,defaults={},inform={},preferences={persistent:function(){return hasLocalStore},setNotAgain:function(id){var data;!hasLocalStore||(data=readNotAgain()).indexOf(id)<0&&(data.push(id),localStorage.setItem("notagain",JSON.stringify(data)))},notagain:function(id){return hasLocalStore&&0<=readNotAgain().indexOf(id)},broadcast:function(name,value){var sel;if(null==inform.name)sel=".swish-event-receiver";else{if(null==inform.name)return;sel=inform.name}$(sel).trigger("preference",{name:name,value:value})},setVal:function(name,value){hasLocalStore&&localStorage.setItem(name,JSON.stringify(value)),this.broadcast(name,value)},setDefault:function(name,value){defaults[name]=value},setInform:function(name,value){inform[name]=value},getVal:function(name){var str;if(hasLocalStore&&(str=localStorage.getItem(name)))return value=JSON.parse(str),value;return defaults[name]},setDocVal:function(docid,name,value){var prefs=preferences.getVal(docid)||{};prefs[name]=value,preferences.setVal(docid,prefs)},getDocVal:function(prefs,name,def){prefs=preferences.getVal(prefs)||{};return void 0===prefs[name]?def:prefs[name]}};function readNotAgain(){var str=localStorage.getItem("notagain")||"[]";try{data=JSON.parse(str),"object"!=typeof data&&(data=[])}catch(err){data=[]}return data}return preferences}),define("links",["jquery","config","modal"],function($,config,modal){var functions={PlDoc:function(pred,ev){if(pred){pred=function parsePred(s){var i,pred={};if(0<(i=s.indexOf(":"))&&(pred.module=s.substring(0,i),s=s.slice(i+1)),0<(i=s.indexOf("/"))&&(pred.name=s.substring(0,i),"/"==s.charAt(i+1)?pred.arity=parseInt(s.slice(i+2))+2:pred.arity=parseInt(s.slice(i+1)),!isNaN(pred.arity)))return pred}(decodeURIComponent(pred));if(pred)return $(ev.target).closest("#ajaxModal").modal("hide"),$(".swish-event-receiver").trigger("pldoc",pred),ev.preventDefault(),!0}return!1},runQueryLink:function(a,ev){var vars,bindings,options,novars,nb=a.closest(".notebook"),qname=a.data("query"),cell=nb.find('.nb-cell[name="'+qname+'"]');cell&&(vars=$().prologEditor("variables",cell.nbCell("text"),{anon:!0}),bindings="",options={},novars=[],$.each(a.data(),function(k,v){var vr;"query"!==k&&(vr=function isVar(k){for(var i=0;i<vars.length;i++)if(vars[i].toLowerCase()==k.toLowerCase())return vars[i];novars.push(k)}(k))&&(""!=bindings&&(bindings+=", "),bindings+=vr+" = ("+v+")")}),0<novars.length&&modal.feedback({owner:nb,type:"warning",duration:3e3,html:"The variables <b>"+novars.join(", ")+"</b> do not appear in query <b>"+qname+"</b>"}),""!=bindings&&(options.bindings=bindings),cell.nbCell("run",options))},followLink:function(ev){var swishStore,href,modal,target,a=$(ev.target).closest("a"),done=!1;function accept(){done=!0,ev.preventDefault(),$(ev.target).closest("#ajaxModal").modal("hide")}a.attr("href")?(swishStore=config.http.locations.swish+"p/",target=config.http.locations.swish+"example/",(href=a.attr("href")).startsWith(swishStore)&&!href.match(/#/)?(accept(),file=href.slice(swishStore.length),$(ev.target).closest(".swish").swish("playFile",file)):a.hasClass("store")?(accept(),modal.alert("File does not appear to come from gitty store?")):a.hasClass("file")||href.startsWith(target)&&!href.match(/#/)?(accept(),$(ev.target).closest(".swish").swish("playURL",{url:href})):a.hasClass("builtin")&&href.match(/predicate=/)?done=functions.PlDoc(href.split("predicate=").pop(),ev):href.match(/object=/)?done=functions.PlDoc(href.split("object=").pop(),ev):1==(modal=$(ev.target).closest("#ajaxModal")).length&&href.match(/#/)&&(target=href.split("#").pop(),1==(target=modal.find("#"+target)).length&&(done=!0,ev.preventDefault(),modal.animate({scrollTop:target.position().top},2e3))),done||(ev.preventDefault(),window.open(href,"_blank"))):a.data("query")&&functions.runQueryLink(a,ev)}};return functions}),function(context){var attributeMap={acceptcharset:"acceptCharset",accesskey:"accessKey",allowtransparency:"allowTransparency",bgcolor:"bgColor",cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",classname:"className",colspan:"colSpan",csstext:"style",defaultchecked:"defaultChecked",defaultselected:"defaultSelected",defaultvalue:"defaultValue",for:"htmlFor",frameborder:"frameBorder",hspace:"hSpace",htmlfor:"htmlFor",longdesc:"longDesc",maxlength:"maxLength",marginwidth:"marginWidth",marginheight:"marginHeight",noresize:"noResize",noshade:"noShade",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",valign:"vAlign",vspace:"vSpace"};function laconic(){for(var el=document.createElement(arguments[0]),i=1;i<arguments.length;i++){var value,arg=arguments[i];if(null!=arg)if(1===arg.nodeType)el.appendChild(arg);else if(""===arg||arg&&arg.charCodeAt&&arg.substr||0===arg||arg&&arg.toExponential&&arg.toFixed)el.appendChild(document.createTextNode(arg));else if(1===i&&"object"==typeof arg)for(var key in arg)!arg.hasOwnProperty(key)||null!=(value=arg[key])&&(key=key.toLowerCase(),"o"===(key=attributeMap[key]||key).charAt(0)&&"n"===key.charAt(1)?(void 0===arg.href&&"onclick"===key&&el.setAttribute("href","#"),el[key]=value):"style"===key&&el.style.setAttribute?el.style.setAttribute("cssText",value):"className"===key||"htmlFor"===key?el[key]=value:el.setAttribute(key,value));else if("[object Array]"===Object.prototype.toString.call(arg))for(var j=0;j<arg.length;j++){var child=arg[j];1===child.nodeType&&el.appendChild(child)}}return el.appendTo=function(parentNode){return 1===parentNode.nodeType&&1===this.nodeType&&parentNode.appendChild(this),this},el}laconic.registerElement=function(name,renderer){laconic[name]||(laconic[name]=function(){var el=laconic("div",{class:name});return renderer.apply(el,Array.prototype.slice.call(arguments)),el})};for(var dollar,tags=["a","abbr","address","area","article","aside","audio","b","base","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","keygen","kbd","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","ul","var","video","wbr"].concat(["acronym","applet","basefont","big","center","dir","font","frame","frameset","noframes","strike","tt","u","xmp"]),i=0;i<tags.length;i++)laconic[tags[i]]=function(tagName){return function(){return laconic.apply(this,[tagName].concat(Array.prototype.slice.call(arguments)))}}(tags[i]);"undefined"!=typeof module&&module.exports?module.exports=laconic:((dollar=context.$||{}).el=laconic,context.$=dollar)}(this),define("laconic",["jquery"],function(){}),define("backend",["jquery","config","form","modal","laconic"],function($,config,form,modal){var backend={backend:config.swish.redis_consumer,url:"",ajax:function(options){return options.url=backend.url+options.url,$.ajax(options)},selectBackend:function(){let body;form=form||require("form"),modal=modal||require("modal"),form.showDialog({title:"SWISH backends",body:function backendBody(){let div;this.append(div=$.el.div($.el.table({class:"table table-striped table-condensed","data-click-to-select":!0,"data-single-select":!0},$.el.tr($.el.th("Backend"),$.el.th("URL"),$.el.th("Users"),$.el.th("Alive")),body=$.el.tbody())));let btn;$(body).on("click","tr",function(tr){tr=$(tr.target).parents("tr");$(body).find("tr.success").removeClass("success"),tr.addClass("success"),btn&&(tr.data("backend")!=backend.backend?$(btn).removeClass("disabled"):$(btn).addClass("disabled"))}),backend.ajax({url:config.http.locations.backends,success:function(data){for(var consumer in data){var stats=data[consumer];let row;body.append(row=$.el.tr($.el.td(consumer),$.el.td(stats.url?$.el.a({href:stats.url},stats.url):"?"),$.el.td(stats.local_visitors),$.el.td(function alive(ago){return(ago=(new Date).getTime()/1e3-ago.time)<30?"â":ago<60?"â­":"â"}(stats)))),consumer==backend&&$(row).addClass("success"),$(row).data("backend",consumer),$(row).data("url",stats.url)}},error:function(jqXHDR){modal.ajaxError(jqXHR)}})}})}};return backend}),define("utils",["jquery"],function($){var styles_loaded=[],utils={htmlEncode:function(text){return text?document.createElement("a").appendChild(document.createTextNode(text)).parentNode.innerHTML:""},loadCSS:function(url){var styles;-1==styles_loaded.indexOf(url)&&((styles=document.createElement("link")).rel="stylesheet",styles.type="text/css",styles.media="screen",styles.href=url,document.getElementsByTagName("head")[0].appendChild(styles),styles_loaded.push(url))},generateUUID:function(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:7&r|8).toString(16)})},flash:function(obj){obj.addClass("flash"),setTimeout(function(){obj.removeClass("flash")},1500)},ago:function(ago){ago=(new Date).getTime()/1e3-ago;return ago<20?"just now":ago<60?"less then a minute ago":(ago=Math.round(ago/60))<120?ago+" minutes ago":(ago=Math.round(ago/60))<48?ago+" hours ago":(ago=Math.round(ago/24))<360?ago+" days ago":(ago=Math.round(ago/365))+" years ago"},basename:function(path){return path?path.split("/").pop():null}};return"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return 0===this.lastIndexOf(str,0)}),utils}),define("version",["jquery","config","utils","backend","laconic"],function($,config,utils,backend){!function($){var methods={_init:function(options){return options=options||{},this.each(function(){var elem=$(this);config.http.locations.versions&&(elem.append($.el.div({class:"version"},$.el.div({class:"v-swish"}),$.el.div({class:"v-changelog"},$.el.table()),$.el.div({class:"v-prolog"}))),elem.version("update"),options.commit&&elem.version("changelog",options)),elem.data("version",{})})},update:function(){config.http.locations.versions&&(elem=this,backend.ajax({url:config.http.locations.versions,success:function(data){var swishversion;data.swish&&data.prolog?(swishversion=elem.hasClass("v-compact")?$.el.a({title:"View recent changes"},data.swish.version):$.el.span(data.swish.version),elem.find(".v-swish").append($.el.span($.el.a({class:"v-product",href:"https://swish.swi-prolog.org"},"SWISH")," version ",swishversion)),elem.find(".v-prolog").append($.el.span("Running on ",$.el.a({class:"v-product",href:"http://www.swi-prolog.org/"},data.prolog.brand)," version "+data.prolog.version)),elem.hasClass("v-compact")&&$(swishversion).on("click",function(ev){if(elem.hasClass("v-compact"))return elem.version("versionDetails"),ev.preventDefault(),!1})):console.log(data)},error:function(jqXHR){modal.ajaxError(jqXHR)}}))},versionDetails:function(){var body=this.closest(".modal-body");body&&(this.closest(".modal-content").find("h2").html("SWISH ChangeLog"),this.detach(),body.empty(),body.append(this),this.removeClass("v-compact"),this.version("changelog"))},changelog:function(options){var that=this;options=options||{};var params={};params.show=options.show||"all",options.commit?params.commit=options.commit:params.last=options.last||20,this.find(".v-changelog > table").html(""),backend.ajax({url:config.http.locations.changelog,data:params,success:function(data){for(var i=0;i<data.changelog.length;i++)that.version("addChange",data.changelog[i],i)},error:function(jqXHR){modal.ajaxError(jqXHR)}})},addChange:function(ch,cls){var desc=$.el.td({class:"v-description",colspan:3});$(desc).html(ch.message);cls=cls%2==0?"even":"odd";this.find(".v-changelog > table").append($.el.tr({class:"v-change-header "+cls},$.el.td({class:"v-author"},ch.author),$.el.td({class:"v-commit"},ch.commit.slice(0,7)),$.el.td({class:"v-date"},ch.committer_date_relative)),$.el.tr({class:"v-change-body "+cls},desc))},checkForUpdates:function(){var str,title;function saveCheckpoint(last){last={commit:last.commit,date:last.date};localStorage.setItem("last-version",JSON.stringify(last))}config.http.locations.versions&&((str=localStorage.getItem("last-version"))&&(last=JSON.parse(str))&&last.commit?(title="SWISH updates since "+utils.ago(last.date||0),backend.ajax({url:config.http.locations.changes,data:{commit:last.commit},success:function(data){data.changes&&$("#swish-updates").css("display","inline-block").attr("title","SWISH has received "+data.changes+" updates\nClick for details").on("click",function(ev){$(ev.target).closest(".swish").swish("showUpdates",{title:title,commit:last.commit,show:"tagged"}),saveCheckpoint(data),$("#swish-updates").hide()})},error:function(jqXHR){modal.ajaxError(jqXHR)}})):backend.ajax({url:config.http.locations.changes,success:function(data){saveCheckpoint(data)},error:function(jqXHR){modal.ajaxError(jqXHR)}}))}};$.fn.version=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.version"):methods._init.apply(this,arguments)}}(jQuery)}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||3<e[0])throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(n){"use strict";n.fn.emulateTransitionEnd=function(t){var e=!1,i=this;return n(this).one("bsTransitionEnd",function(){e=!0}),setTimeout(function(){e||n(i).trigger(n.support.transition.end)},t),this},n(function(){n.support.transition=function o(){var i,t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}(),n.support.transition&&(n.event.special.bsTransitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end,handle:function(t){if(n(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(s){"use strict";function a(t){s(t).on("click",e,this.close)}var e='[data-dismiss="alert"]';a.VERSION="3.4.1",a.TRANSITION_DURATION=150,a.prototype.close=function(t){var e=s(this),i=e.attr("data-target");i="#"===(i=i||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,""))?[]:i;var o=s(document).find(i);function n(){o.detach().trigger("closed.bs.alert").remove()}t&&t.preventDefault(),(o=!o.length?e.closest(".alert"):o).trigger(t=s.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),s.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(a.TRANSITION_DURATION):n())};var t=s.fn.alert;s.fn.alert=function o(i){return this.each(function(){var t=s(this),e=t.data("bs.alert");e||t.data("bs.alert",e=new a(this)),"string"==typeof i&&e[i].call(t)})},s.fn.alert.Constructor=a,s.fn.alert.noConflict=function(){return s.fn.alert=t,this},s(document).on("click.bs.alert.data-api",e,a.prototype.close)}(jQuery),function(s){"use strict";var n=function(t,e){this.$element=s(t),this.options=s.extend({},n.DEFAULTS,e),this.isLoading=!1};function i(o){return this.each(function(){var t=s(this),e=t.data("bs.button"),i="object"==typeof o&&o;e||t.data("bs.button",e=new n(this,i)),"toggle"==o?e.toggle():o&&e.setState(o)})}n.VERSION="3.4.1",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var e="disabled",i=this.$element,o=i.is("input")?"val":"html",n=i.data();t+="Text",null==n.resetText&&i.data("resetText",i[o]()),setTimeout(s.proxy(function(){i[o]((null==n[t]?this.options:n)[t]),"loadingText"==t?(this.isLoading=!0,i.addClass(e).attr(e,e).prop(e,!0)):this.isLoading&&(this.isLoading=!1,i.removeClass(e).removeAttr(e).prop(e,!1))},this),0)},n.prototype.toggle=function(){var i,t=!0,e=this.$element.closest('[data-toggle="buttons"]');e.length?("radio"==(i=this.$element.find("input")).prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")):(this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active"))};var t=s.fn.button;s.fn.button=i,s.fn.button.Constructor=n,s.fn.button.noConflict=function(){return s.fn.button=t,this},s(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(t){var e=s(t.target).closest(".btn");i.call(e,"toggle"),s(t.target).is('input[type="radio"], input[type="checkbox"]')||(t.preventDefault(),(e.is("input,button")?e:e.find("input:visible,button:visible").first()).trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){s(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),function(p){"use strict";function c(t,e){this.$element=p(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=e,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",p.proxy(this.keydown,this)),"hover"!=this.options.pause||"ontouchstart"in document.documentElement||this.$element.on("mouseenter.bs.carousel",p.proxy(this.pause,this)).on("mouseleave.bs.carousel",p.proxy(this.cycle,this))}function r(n){return this.each(function(){var t=p(this),e=t.data("bs.carousel"),i=p.extend({},c.DEFAULTS,t.data(),"object"==typeof n&&n),o="string"==typeof n?n:i.slide;e||t.data("bs.carousel",e=new c(this,i)),"number"==typeof n?e.to(n):o?e[o]():i.interval&&e.pause().cycle()})}c.VERSION="3.4.1",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},c.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(p.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},c.prototype.getItemForDirection=function(o,e){var i=this.getItemIndex(e);if(("prev"==o&&0===i||"next"==o&&i==this.$items.length-1)&&!this.options.wrap)return e;o=(i+("prev"==o?-1:1))%this.$items.length;return this.$items.eq(o)},c.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(i<t?"next":"prev",this.$items.eq(t))},c.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&p.support.transition&&(this.$element.trigger(p.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(t,h){var i=this.$element.find(".item.active"),o=h||this.getItemForDirection(t,i),n=this.interval,s="next"==t?"left":"right",a=this;if(o.hasClass("active"))return this.sliding=!1;var r=o[0],h=p.Event("slide.bs.carousel",{relatedTarget:r,direction:s});if(this.$element.trigger(h),!h.isDefaultPrevented()){this.sliding=!0,n&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),(h=p(this.$indicators.children()[this.getItemIndex(o)]))&&h.addClass("active"));var d=p.Event("slid.bs.carousel",{relatedTarget:r,direction:s});return p.support.transition&&this.$element.hasClass("slide")?(o.addClass(t),"object"==typeof o&&o.length&&o[0].offsetWidth,i.addClass(s),o.addClass(s),i.one("bsTransitionEnd",function(){o.removeClass([t,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger(d)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(i.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(d)),n&&this.cycle(),this}};var t=p.fn.carousel;p.fn.carousel=r,p.fn.carousel.Constructor=c,p.fn.carousel.noConflict=function(){return p.fn.carousel=t,this};var e=function(t){var a=p(this),n=(n=a.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),s=a.attr("data-target")||n,n=p(document).find(s);n.hasClass("carousel")&&(s=p.extend({},n.data(),a.data()),(a=a.attr("data-slide-to"))&&(s.interval=!1),r.call(n,s),a&&n.data("bs.carousel").to(a),t.preventDefault())};p(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),p(window).on("load",function(){p('[data-ride="carousel"]').each(function(){var t=p(this);r.call(t,t.data())})})}(jQuery),function(a){"use strict";var r=function(t,e){this.$element=a(t),this.options=a.extend({},r.DEFAULTS,e),this.$trigger=a('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function n(t){var i=t.attr("data-target")||(i=t.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return a(document).find(i)}function l(o){return this.each(function(){var t=a(this),e=t.data("bs.collapse"),i=a.extend({},r.DEFAULTS,t.data(),"object"==typeof o&&o);!e&&i.toggle&&/show|hide/.test(o)&&(i.toggle=!1),e||t.data("bs.collapse",e=new r(this,i)),"string"==typeof o&&e[o]()})}r.VERSION="3.4.1",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var s=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(s&&s.length&&(n=s.data("bs.collapse"))&&n.transitioning)){var i=a.Event("show.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){s&&s.length&&(l.call(s,"hide"),n||s.data("bs.collapse",null));var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var n=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return n.call(this);s=a.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",a.proxy(n,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[o](this.$element[0][s])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var i=a.Event("hide.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){var e=this.dimension();this.$element[e](this.$element[e]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!a.support.transition)return i.call(this);this.$element[e](0).one("bsTransitionEnd",a.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return a(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(t,i){i=a(i);this.addAriaAndCollapsedClass(n(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var t=a.fn.collapse;a.fn.collapse=l,a.fn.collapse.Constructor=r,a.fn.collapse.noConflict=function(){return a.fn.collapse=t,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(i){var o=a(this);o.attr("data-target")||i.preventDefault();i=n(o),o=i.data("bs.collapse")?"toggle":o.data();l.call(i,o)})}(jQuery),function(a){"use strict";function o(t){a(t).on("click.bs.dropdown",this.toggle)}var r='[data-toggle="dropdown"]';function l(t){var i=t.attr("data-target"),i="#"!==(i=i||(i=t.attr("href"))&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""))?a(document).find(i):null;return i&&i.length?i:t.parent()}function s(o){o&&3===o.which||(a(".dropdown-backdrop").remove(),a(r).each(function(){var t=a(this),e=l(t),i={relatedTarget:this};e.hasClass("open")&&(o&&"click"==o.type&&/input|textarea/i.test(o.target.tagName)&&a.contains(e[0],o.target)||(e.trigger(o=a.Event("hide.bs.dropdown",i)),o.isDefaultPrevented()||(t.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",i)))))}))}o.VERSION="3.4.1",o.prototype.toggle=function(t){var e=a(this);if(!e.is(".disabled, :disabled")){var i=l(e),n=i.hasClass("open");if(s(),!n){"ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",s);n={relatedTarget:this};if(i.trigger(t=a.Event("show.bs.dropdown",n)),t.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),i.toggleClass("open").trigger(a.Event("shown.bs.dropdown",n))}return!1}},o.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var n=a(this);if(t.preventDefault(),t.stopPropagation(),!n.is(".disabled, :disabled")){var s=l(n),o=s.hasClass("open");if(!o&&27!=t.which||o&&27==t.which)return 27==t.which&&s.find(r).trigger("focus"),n.trigger("click");n=s.find(".dropdown-menu li:not(.disabled):visible a");n.length&&(s=n.index(t.target),38==t.which&&0<s&&s--,40==t.which&&s<n.length-1&&s++,~s||(s=0),n.eq(s).trigger("focus"))}}};var t=a.fn.dropdown;a.fn.dropdown=function e(i){return this.each(function(){var t=a(this),e=t.data("bs.dropdown");e||t.data("bs.dropdown",e=new o(this)),"string"==typeof i&&e[i].call(t)})},a.fn.dropdown.Constructor=o,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=t,this},a(document).on("click.bs.dropdown.data-api",s).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,o.prototype.toggle).on("keydown.bs.dropdown.data-api",r,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),function(a){"use strict";function s(t,e){this.options=e,this.$body=a(document.body),this.$element=a(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}function r(o,n){return this.each(function(){var t=a(this),e=t.data("bs.modal"),i=a.extend({},s.DEFAULTS,t.data(),"object"==typeof o&&o);e||t.data("bs.modal",e=new s(this,i)),"string"==typeof o?e[o](n):i.show&&e.show(n)})}s.VERSION="3.4.1",s.TRANSITION_DURATION=300,s.BACKDROP_TRANSITION_DURATION=150,s.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},s.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},s.prototype.show=function(i){var o=this,t=a.Event("show.bs.modal",{relatedTarget:i});this.$element.trigger(t),this.isShown||t.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(t){a(t.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var t=a.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),t&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:i});t?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(s.TRANSITION_DURATION):o.$element.trigger("focus").trigger(e)}))},s.prototype.hide=function(t){t&&t.preventDefault(),t=a.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(s.TRANSITION_DURATION):this.hideModal())},s.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},s.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},s.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},s.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},s.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},s.prototype.backdrop=function(t){var n,e=this,i=this.$element.hasClass("fade")?"fade":"";this.isShown&&this.options.backdrop?(n=a.support.transition&&i,this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+i).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(t){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),t&&(n?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION):t())):!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),n=function(){e.removeBackdrop(),t&&t()},a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",n).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION):n()):t&&t()},s.prototype.handleUpdate=function(){this.adjustDialog()},s.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},s.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},s.prototype.checkScrollbar=function(){var e,t=window.innerWidth;t||(t=(e=document.documentElement.getBoundingClientRect()).right-Math.abs(e.left)),this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},s.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var n=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",t+n),a(this.fixedContent).each(function(t,e){var i=e.style.paddingRight,o=a(e).css("padding-right");a(e).data("padding-right",i).css("padding-right",parseFloat(o)+n+"px")}))},s.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),a(this.fixedContent).each(function(t,e){var i=a(e).data("padding-right");a(e).removeData("padding-right"),e.style.paddingRight=i||""})},s.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var t=a.fn.modal;a.fn.modal=r,a.fn.modal.Constructor=s,a.fn.modal.noConflict=function(){return a.fn.modal=t,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var e=a(this),s=e.attr("href"),o=e.attr("data-target")||s&&s.replace(/.*(?=#[^\s]+$)/,""),n=a(document).find(o),s=n.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(s)&&s},n.data(),e.data());e.is("a")&&t.preventDefault(),n.one("show.bs.modal",function(t){t.isDefaultPrevented()||n.one("hidden.bs.modal",function(){e.is(":visible")&&e.trigger("focus")})}),r.call(n,s,this)})}(jQuery),function(g){"use strict";var o=["sanitize","whiteList","sanitizeFn"],a=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],r=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,l=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function u(t,e){var i=t.nodeName.toLowerCase();if(-1!==g.inArray(i,e))return-1===g.inArray(i,a)||Boolean(t.nodeValue.match(r)||t.nodeValue.match(l));for(var o=g(e).filter(function(t,e){return e instanceof RegExp}),n=0,s=o.length;n<s;n++)if(i.match(o[n]))return 1}function n(t,e,o){if(0===t.length)return t;if(o&&"function"==typeof o)return o(t);if(!document.implementation||!document.implementation.createHTMLDocument)return t;o=document.implementation.createHTMLDocument("sanitization");o.body.innerHTML=t;for(var n=g.map(e,function(t,e){return e}),s=g(o.body).find("*"),a=0,r=s.length;a<r;a++){var l=s[a],h=l.nodeName.toLowerCase();if(-1!==g.inArray(h,n))for(var d=g.map(l.attributes,function(t){return t}),p=[].concat(e["*"]||[],e[h]||[]),c=0,f=d.length;c<f;c++)u(d[c],p)||l.removeAttribute(d[c].nodeName);else l.parentNode.removeChild(l)}return o.body.innerHTML}function m(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)}m.VERSION="3.4.1",m.TRANSITION_DURATION=150,m.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]}},m.prototype.init=function(t,e,i){if(this.enabled=!0,this.type=t,this.$element=g(e),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&g(document).find(g.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var o=this.options.trigger.split(" "),n=o.length;n--;){var a,r=o[n];"click"==r?this.$element.on("click."+this.type,this.options.selector,g.proxy(this.toggle,this)):"manual"!=r&&(a="hover"==r?"mouseenter":"focusin",r="hover"==r?"mouseleave":"focusout",this.$element.on(a+"."+this.type,this.options.selector,g.proxy(this.enter,this)),this.$element.on(r+"."+this.type,this.options.selector,g.proxy(this.leave,this)))}this.options.selector?this._options=g.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},m.prototype.getDefaults=function(){return m.DEFAULTS},m.prototype.getOptions=function(t){var i,e=this.$element.data();for(i in e)e.hasOwnProperty(i)&&-1!==g.inArray(i,o)&&delete e[i];return(t=g.extend({},this.getDefaults(),e,t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t.sanitize&&(t.template=n(t.template,t.whiteList,t.sanitizeFn)),t},m.prototype.getDelegateOptions=function(){var i={},o=this.getDefaults();return this._options&&g.each(this._options,function(t,e){o[t]!=e&&(i[t]=e)}),i},m.prototype.enter=function(t){var e=t instanceof this.constructor?t:g(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e)),t instanceof g.Event&&(e.inState["focusin"==t.type?"focus":"hover"]=!0),e.tip().hasClass("in")||"in"==e.hoverState)e.hoverState="in";else{if(clearTimeout(e.timeout),e.hoverState="in",!e.options.delay||!e.options.delay.show)return e.show();e.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)}},m.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},m.prototype.leave=function(t){var e=t instanceof this.constructor?t:g(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e)),t instanceof g.Event&&(e.inState["focusout"==t.type?"focus":"hover"]=!1),!e.isInStateTrue()){if(clearTimeout(e.timeout),e.hoverState="out",!e.options.delay||!e.options.delay.hide)return e.hide();e.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)}},m.prototype.show=function(){var i,o,h,p,c,f,u,l=g.Event("show.bs."+this.type);this.hasContent()&&this.enabled&&(this.$element.trigger(l),h=g.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]),!l.isDefaultPrevented()&&h&&(o=(i=this).tip(),f=this.getUID(this.type),this.setContent(),o.attr("id",f),this.$element.attr("aria-describedby",f),this.options.animation&&o.addClass("fade"),u="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,(c=(p=/\s?auto?\s?/i).test(u))&&(u=u.replace(p,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(u).data("bs."+this.type,this),this.options.container?o.appendTo(g(document).find(this.options.container)):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type),l=this.getPosition(),h=o[0].offsetWidth,f=o[0].offsetHeight,c&&(p=u,c=this.getPosition(this.$viewport),u="bottom"==u&&l.bottom+f>c.bottom?"top":"top"==u&&l.top-f<c.top?"bottom":"right"==u&&l.right+h>c.width?"left":"left"==u&&l.left-h<c.left?"right":u,o.removeClass(p).addClass(u)),f=this.getCalculatedOffset(u,l,h,f),this.applyPlacement(f,u),u=function(){var t=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==t&&i.leave(i)},g.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",u).emulateTransitionEnd(m.TRANSITION_DURATION):u()))},m.prototype.applyPlacement=function(t,d){var i=this.tip(),o=i[0].offsetWidth,p=i[0].offsetHeight,c=parseInt(i.css("margin-top"),10),h=parseInt(i.css("margin-left"),10);isNaN(c)&&(c=0),isNaN(h)&&(h=0),t.top+=c,t.left+=h,g.offset.setOffset(i[0],g.extend({using:function(t){i.css({top:Math.round(t.top),left:Math.round(t.left)})}},t),0),i.addClass("in");var r=i[0].offsetWidth,c=i[0].offsetHeight;"top"==d&&c!=p&&(t.top=t.top+p-c);h=this.getViewportAdjustedDelta(d,t,r,c);h.left?t.left+=h.left:t.top+=h.top;d=/top|bottom/.test(d),p=d?2*h.left-o+r:2*h.top-p+c,c=d?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(p,i[0][c],d)},m.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},m.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();this.options.html?(this.options.sanitize&&(e=n(e,this.options.whiteList,this.options.sanitizeFn)),t.find(".tooltip-inner").html(e)):t.find(".tooltip-inner").text(e),t.removeClass("fade in top bottom left right")},m.prototype.hide=function(t){var e=this,i=g(this.$tip),o=g.Event("hide.bs."+this.type);function n(){"in"!=e.hoverState&&i.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),t&&t()}if(this.$element.trigger(o),!o.isDefaultPrevented())return i.removeClass("in"),g.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",n).emulateTransitionEnd(m.TRANSITION_DURATION):n(),this.hoverState=null,this},m.prototype.fixTitle=function(){var t=this.$element;!t.attr("title")&&"string"==typeof t.attr("data-original-title")||t.attr("data-original-title",t.attr("title")||"").attr("title","")},m.prototype.hasContent=function(){return this.getTitle()},m.prototype.getPosition=function(a){var s=(a=a||this.$element)[0],r="BODY"==s.tagName,o=s.getBoundingClientRect();null==o.width&&(o=g.extend({},o,{width:o.right-o.left,height:o.bottom-o.top}));s=window.SVGElement&&s instanceof window.SVGElement,s=r?{top:0,left:0}:s?null:a.offset(),a={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:a.scrollTop()},r=r?{width:g(window).width(),height:g(window).height()}:null;return g.extend({},o,a,r,s)},m.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},m.prototype.getViewportAdjustedDelta=function(r,e,d,o){var n={top:0,left:0};if(!this.$viewport)return n;var h,s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);return/right|left/.test(r)?(r=e.top-s-a.scroll,h=e.top+s-a.scroll+o,r<a.top?n.top=a.top-r:h>a.top+a.height&&(n.top=a.top+a.height-h)):(h=e.left-s,d=e.left+s+d,h<a.left?n.left=a.left-h:d>a.right&&(n.left=a.left+a.width-d)),n},m.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},m.prototype.getUID=function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},m.prototype.tip=function(){if(!this.$tip&&(this.$tip=g(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},m.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},m.prototype.enable=function(){this.enabled=!0},m.prototype.disable=function(){this.enabled=!1},m.prototype.toggleEnabled=function(){this.enabled=!this.enabled},m.prototype.toggle=function(t){var e=this;t&&((e=g(t.currentTarget).data("bs."+this.type))||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e))),t?(e.inState.click=!e.inState.click,e.isInStateTrue()?e.enter(e):e.leave(e)):e.tip().hasClass("in")?e.leave(e):e.enter(e)},m.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})},m.prototype.sanitizeHtml=function(t){return n(t,this.options.whiteList,this.options.sanitizeFn)};var e=g.fn.tooltip;g.fn.tooltip=function i(o){return this.each(function(){var t=g(this),e=t.data("bs.tooltip"),i="object"==typeof o&&o;!e&&/destroy|hide/.test(o)||(e||t.data("bs.tooltip",e=new m(this,i)),"string"==typeof o&&e[o]())})},g.fn.tooltip.Constructor=m,g.fn.tooltip.noConflict=function(){return g.fn.tooltip=e,this}}(jQuery),function(n){"use strict";function s(t,e){this.init("popover",t,e)}if(!n.fn.tooltip)throw new Error("Popover requires tooltip.js");s.VERSION="3.4.1",s.DEFAULTS=n.extend({},n.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((s.prototype=n.extend({},n.fn.tooltip.Constructor.prototype)).constructor=s).prototype.getDefaults=function(){return s.DEFAULTS},s.prototype.setContent=function(){var o,t=this.tip(),e=this.getTitle(),i=this.getContent();this.options.html?(o=typeof i,this.options.sanitize&&(e=this.sanitizeHtml(e),"string"==o&&(i=this.sanitizeHtml(i))),t.find(".popover-title").html(e),t.find(".popover-content").children().detach().end()["string"==o?"html":"append"](i)):(t.find(".popover-title").text(e),t.find(".popover-content").children().detach().end().text(i)),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},s.prototype.hasContent=function(){return this.getTitle()||this.getContent()},s.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},s.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var t=n.fn.popover;n.fn.popover=function e(o){return this.each(function(){var t=n(this),e=t.data("bs.popover"),i="object"==typeof o&&o;!e&&/destroy|hide/.test(o)||(e||t.data("bs.popover",e=new s(this,i)),"string"==typeof o&&e[o]())})},n.fn.popover.Constructor=s,n.fn.popover.noConflict=function(){return n.fn.popover=t,this}}(jQuery),function(s){"use strict";function n(t,e){this.$body=s(document.body),this.$scrollElement=s(t).is(document.body)?s(window):s(t),this.options=s.extend({},n.DEFAULTS,e),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",s.proxy(this.process,this)),this.refresh(),this.process()}function e(o){return this.each(function(){var t=s(this),e=t.data("bs.scrollspy"),i="object"==typeof o&&o;e||t.data("bs.scrollspy",e=new n(this,i)),"string"==typeof o&&e[o]()})}n.VERSION="3.4.1",n.DEFAULTS={offset:10},n.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},n.prototype.refresh=function(){var t=this,o="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),s.isWindow(this.$scrollElement[0])||(o="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var i=s(this),e=i.data("target")||i.attr("href"),i=/^#./.test(e)&&s(e);return i&&i.length&&i.is(":visible")?[[i[o]().top+n,e]]:null}).sort(function(t,e){return t[0]-e[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},n.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,s=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),o<=e)return a!=(t=s[s.length-1])&&this.activate(t);if(a&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)a!=s[t]&&e>=n[t]&&(void 0===n[t+1]||e<n[t+1])&&this.activate(s[t])},n.prototype.activate=function(i){this.activeTarget=i,this.clear();i=this.selector+'[data-target="'+i+'"],'+this.selector+'[href="'+i+'"]',i=s(i).parents("li").addClass("active");(i=i.parent(".dropdown-menu").length?i.closest("li.dropdown").addClass("active"):i).trigger("activate.bs.scrollspy")},n.prototype.clear=function(){s(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var t=s.fn.scrollspy;s.fn.scrollspy=e,s.fn.scrollspy.Constructor=n,s.fn.scrollspy.noConflict=function(){return s.fn.scrollspy=t,this},s(window).on("load.bs.scrollspy.data-api",function(){s('[data-spy="scroll"]').each(function(){var t=s(this);e.call(t,t.data())})})}(jQuery),function(r){"use strict";function a(t){this.element=r(t)}function e(i){return this.each(function(){var t=r(this),e=t.data("bs.tab");e||t.data("bs.tab",e=new a(this)),"string"==typeof i&&e[i]()})}a.VERSION="3.4.1",a.TRANSITION_DURATION=150,a.prototype.show=function(){var o,n,s,t=this.element,e=t.closest("ul:not(.dropdown-menu)"),a=(a=t.data("target"))||(a=t.attr("href"))&&a.replace(/.*(?=#[^\s]*$)/,"");t.parent("li").hasClass("active")||(o=e.find(".active:last a"),n=r.Event("hide.bs.tab",{relatedTarget:t[0]}),s=r.Event("show.bs.tab",{relatedTarget:o[0]}),o.trigger(n),t.trigger(s),s.isDefaultPrevented()||n.isDefaultPrevented()||(a=r(document).find(a),this.activate(t.closest("li"),e),this.activate(a,a.parent(),function(){o.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:o[0]})})))},a.prototype.activate=function(t,e,i){var o=e.find("> .active"),n=i&&r.support.transition&&(o.length&&o.hasClass("fade")||!!e.find("> .fade").length);function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),n?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}o.length&&n?o.one("bsTransitionEnd",s).emulateTransitionEnd(a.TRANSITION_DURATION):s(),o.removeClass("in")};var t=r.fn.tab;function i(t){t.preventDefault(),e.call(r(this),"show")}r.fn.tab=e,r.fn.tab.Constructor=a,r.fn.tab.noConflict=function(){return r.fn.tab=t,this},r(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),function(l){"use strict";var h=function(t,i){this.options=l.extend({},h.DEFAULTS,i);i=this.options.target===h.DEFAULTS.target?l(this.options.target):l(document).find(this.options.target);this.$target=i.on("scroll.bs.affix.data-api",l.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",l.proxy(this.checkPositionWithEventLoop,this)),this.$element=l(t),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};function i(o){return this.each(function(){var t=l(this),e=t.data("bs.affix"),i="object"==typeof o&&o;e||t.data("bs.affix",e=new h(this,i)),"string"==typeof o&&e[o]()})}h.VERSION="3.4.1",h.RESET="affix affix-top affix-bottom",h.DEFAULTS={offset:0,target:window},h.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),l=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return n<i&&"top";if("bottom"==this.affixed)return null!=i?!(n+this.unpin<=l.top)&&"bottom":!(n+a<=t-o)&&"bottom";var r=null==this.affixed,l=r?n:l.top;return null!=i&&n<=i?"top":null!=o&&t-o<=l+(r?a:e)&&"bottom"},h.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(h.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},h.prototype.checkPositionWithEventLoop=function(){setTimeout(l.proxy(this.checkPosition,this),1)},h.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),a=this.options.offset,r=a.top,o=a.bottom,n=Math.max(l(document).height(),l(document.body).height());"object"!=typeof a&&(o=r=a),"function"==typeof r&&(r=a.top(this.$element)),"function"==typeof o&&(o=a.bottom(this.$element));var s=this.getState(n,t,r,o);if(this.affixed!=s){null!=this.unpin&&this.$element.css("top","");a="affix"+(s?"-"+s:""),r=l.Event(a+".bs.affix");if(this.$element.trigger(r),r.isDefaultPrevented())return;this.affixed=s,this.unpin="bottom"==s?this.getPinnedOffset():null,this.$element.removeClass(h.RESET).addClass(a).trigger(a.replace("affix","affixed")+".bs.affix")}"bottom"==s&&this.$element.offset({top:n-t-o})}};var t=l.fn.affix;l.fn.affix=i,l.fn.affix.Constructor=h,l.fn.affix.noConflict=function(){return l.fn.affix=t,this},l(window).on("load",function(){l('[data-spy="affix"]').each(function(){var t=l(this),e=t.data();e.offset=e.offset||{},null!=e.offsetBottom&&(e.offset.bottom=e.offsetBottom),null!=e.offsetTop&&(e.offset.top=e.offsetTop),i.call(t,e)})})}(jQuery),define("bootstrap",["jquery"],function(){}),define("modal",["jquery","config","preferences","links","form","backend","version","laconic","bootstrap"],function($,config,preferences,links,form,backend){!function($){var methods={_init:function(options){return this.each(function(){var elem=$(this);elem.addClass("swish-event-receiver"),elem.on("help",function(ev,data){elem.swishModal("showHelp",data)}),elem.on("pldoc",function(ev,data){elem.swishModal("showPlDoc",data)}),elem.on("form",function(ev,data){elem.swishModal("showForm",data)}),elem.on("dialog",function(ev,data){elem.swishModal("show",data)}),elem.on("error",function(ev,data){elem.swishModal("show",data)}),elem.on("alert",function(ev,str){elem.swishModal("show",{title:"<span class='glyphicon glyphicon-warning-sign'></span>",body:str})}),elem.on("ajaxError",function(ev,jqXHR){elem.swishModal("showAjaxError",jqXHR)}),elem.on("feedback",function(ev,options){elem.swishModal("feedback",options)}),elem.on("show",function(ev,options){elem.swishModal("show",options)}),elem.on("server_form",function(ev,options){elem.swishModal("server_form",options)})})},showHelp:function(options){var that=this;options.notagain&&preferences.notagain(options.notagain)||backend.ajax({url:config.http.locations.help+"/"+options.file,dataType:"html",success:function(data){var container=$("<div>");container.html(data),that.swishModal("show",$.extend({title:container.find("title").text(),body:container},options))}})},showForm:function(options){var that=this;backend.ajax({url:config.http.locations.form+"/"+options.file,dataType:"html",success:function(data){var container=$("<div>");container.html(data),that.swishModal("show",$.extend({title:container.find("legend").text(),body:container},options))}})},showPlDoc:function(options){var data={title:"SWI-Prolog manual",body:function(){return function docBody(content,url){return content.parents("div.modal-dialog").addClass("swish-embedded-manual"),"<iframe class='swish-embedded-manual' onload='javascript:resizeIframe(this);' src='"+url+"'></iframe>"}(this,function docURL(options){var term="("+options.name+")/"+options.arity;return options.module&&(term=options.module+":"+term),config.http.locations.pldoc_doc_for+"?header=false&object="+encodeURIComponent(term)}(options))}};return this.swishModal("show",data)},show:function(options){var content=$.el.div({class:"modal-body"}),title=$.el.h2(),c=$.el.div({class:"modal-content"},$.el.div({class:"modal-header"},notAgain(options),function closeButton(){var button=$.el.button({type:"button",class:"close","data-dismiss":"modal"});return $(button).html("&times;").on("click",function(ev){ev.preventDefault(),saveNotagain($(ev.target))}),button}(),title),content),modalel=$.el.div({class:"modal fade",id:"ajaxModal",tabindex:-1,role:"dialog"},$.el.div({class:"modal-dialog"},c));return options.notagain&&preferences.persistent()&&$(c).append($.el.div({class:"modal-footer"},notAgain(options))),content=$(content),"function"==typeof options.body?(c=options.body.call(content))&&content.append(c):content.html(options.body),$(title).html(options.title),$(modalel).modal({show:!0}).on("click","a",links.followLink).on("shown.bs.modal",function(){!function initTagsManagers(){$(this).find(".tm-input").each(function(){var elem=$(this),tags=elem.data("prefilled"),options={};tags&&(options.prefilled=tags),elem.tagsManager(options)})}(),$(this).find(".swish-versions").version()}).on("hidden.bs.modal",function(){options.onclose&&options.onclose(),saveNotagain($(this)),$(this).remove()}),this},server_form:function(options){var modalel=$(this);return void 0===form&&(form=require("form")),this.swishModal("show",{title:options.title,body:function(){elem=$(this),backend.ajax({url:options.url,data:options.data,success:function(data){elem.append(data)},error:function(jqXHDR){modalel.swishModal("showAjaxError",jqXHDR)}}),elem.on("click","button[data-action]",function(ev){var formel=$(ev.target).closest("form"),data=form.serializeAsObject(formel,!0),button=$(ev.target).closest("button");return 0==button.data("form_data")?backend.ajax({url:button.data("action"),success:function(obj){return button.closest(".modal").modal("hide"),options.onreply&&options.onreply.call(button[0],obj),ev.preventDefault(),!1},error:function(jqXHDR){modalel.swishModal("showAjaxError",jqXHDR)}}):backend.ajax({url:button.data("action"),data:JSON.stringify(data),dataType:"json",contentType:"application/json",type:"POST",success:function(obj){if("success"==obj.status)return button.closest(".modal").modal("hide"),options.onreply&&options.onreply.call(button[0],obj),ev.preventDefault(),!1;"error"==obj.status?form.formError(formel,obj.error):alert("Updated failed: "+JSON.serializeAsObject(obj))},error:function(jqXHDR){modalel.swishModal("showAjaxError",jqXHDR)}}),ev.preventDefault(),!1})}})},showAjaxError:function(title){var data=$.el.div();$(data).html(title.responseText);var h1=$(data).find("h1"),title=h1.text()||"Server error";h1.remove();data={title:title,body:data};this.swishModal("show",data)},feedback:function(options){var win=$.el.div({class:"feedback "+options.type||""});return $(win).html(options.html),$(options.owner||"body").append(win),setTimeout(function(){$(win).hide(400,function(){$(win).remove()})},options.duration||1500),this}};function saveNotagain(elem){(elem=!elem.hasClass("modal")?elem.closest(".modal"):elem).find("[data-notagain]").each(function(){if($(this).prop("checked"))return preferences.setNotAgain($(this).attr("data-notagain")),!1})}function notAgain(options){return options.notagain&&preferences.persistent()?$.el.label($.el.input({type:"checkbox","data-notagain":options.notagain,name:"dismiss"})," Don't show again!"):""}window.resizeIframe=function(iframe){iframe.style.height=0,iframe.style.height=iframe.contentWindow.document.body.scrollHeight+20+"px"},$.fn.swishModal=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.swishModal"):methods._init.apply(this,arguments)}}(jQuery);var ntfid=1;return{ajaxError:function(jqXHR){$(".swish-event-receiver").trigger("ajaxError",jqXHR)},feedback:function(options){$(".swish-event-receiver").trigger("feedback",options)},alert:function(options){$(".swish-event-receiver").trigger("alert",options)},help:function(options){$(".swish-event-receiver").trigger("help",options)},show:function(options){$(".swish-event-receiver").trigger("show",options)},server_form:function(options){$(".swish-event-receiver").trigger("server_form",options)},notify:function(elem,options){var id="ntf-"+(options.wsid||ntfid++),div=$.el.div({class:"notification notify-arrow",id:id}),time=elem.offset();$("body").append(div),options.html?$(div).html(options.html):options.dom&&$(div).append(options.dom),$(div).css({left:time.left+elem.width()-$(div).outerWidth()+15,top:time.top+elem.height()+12}).on("click",function(){$(div).remove()}).show(options.fadeIn||400),0!==options.time&&(time=(time=options.time)||(elem.hasClass("myself")?1e3:5e3),setTimeout(function(){$(div).hide(options.fadeOut||400,function(){$("#"+id).remove(),options.onremove&&options.onremove(options),elem.chat("unnotify",options.wsid)})},time))}}}),function($){"use strict";var defaults={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,externalTagId:!1,prefillIdFieldName:"Id",prefillValueFieldName:"Value",AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null,fillInputOnTagRemove:!1},publicMethods={pushTag:function(tag,ignoreEvents,$el){var tlisLowerCase,tagId,idx,newTagRemoveId,$self=$(this),opts=$self.data("opts"),escaped=$self.data("tlis"),tlid=$self.data("tlid");if((tag=privateMethods.trimTag(tag,opts.delimiterChars))&&!(tag.length<=0)){if(opts.onlyTagList&&void 0!==opts.tagList&&opts.tagList){var $tagList=opts.tagList;if($.each($tagList,function(index,item){$tagList[index]=item.toLowerCase()}),-1===$.inArray(tag.toLowerCase(),$tagList))return}if(opts.CapitalizeFirstLetter&&1<tag.length&&(tag=tag.charAt(0).toUpperCase()+tag.slice(1).toLowerCase()),!opts.validator||opts.validator(tag)){if(!(0<opts.maxTags&&escaped.length>=opts.maxTags)){if(tagId=!1,tlisLowerCase=jQuery.map(escaped,function(elem){return elem.toLowerCase()}),tagId=-1!==(idx=$.inArray(tag.toLowerCase(),tlisLowerCase))?!0:tagId)if($self.trigger("tm:duplicated",tag),opts.blinkClass)for(var i=0;i<6;++i)$("#"+$self.data("tm_rndid")+"_"+tlid[idx]).queue(function(next){$(this).toggleClass(opts.blinkClass),next()}).delay(100);else $("#"+$self.data("tm_rndid")+"_"+tlid[idx]).stop().animate({backgroundColor:opts.blinkBGColor_1},100).animate({backgroundColor:opts.blinkBGColor_2},100).animate({backgroundColor:opts.blinkBGColor_1},100).animate({backgroundColor:opts.blinkBGColor_2},100).animate({backgroundColor:opts.blinkBGColor_1},100).animate({backgroundColor:opts.blinkBGColor_2},100);else tagId=!0===opts.externalTagId?(void 0===$el&&$.error("externalTagId is not passed for tag -"+tag),$el):(newTagRemoveId=(newTagRemoveId=Math.max.apply(null,tlid))===-1/0?0:newTagRemoveId,++newTagRemoveId),ignoreEvents||$self.trigger("tm:pushing",[tag,tagId]),escaped.push(tag),tlid.push(tagId),ignoreEvents||null!==opts.AjaxPush&&null==opts.AjaxPushAllTags&&-1===$.inArray(tag,opts.prefilled)&&$.post(opts.AjaxPush,$.extend({tag:tag},opts.AjaxPushParameters)),$el=$self.data("tm_rndid")+"_"+tagId,newTagRemoveId=$self.data("tm_rndid")+"_Remover_"+tagId,escaped=$("<span/>").text(tag).html(),$el='<span class="'+privateMethods.tagClasses.call($self)+'" id="'+$el+'">',$el+="<span>"+escaped+"</span>",$el+='<a href="#" class="tm-tag-remove" id="'+newTagRemoveId+'" TagIdToRemove="'+tagId+'">',$el+=opts.tagCloseIcon+"</a></span> ",$el=$($el),null!==opts.tagsContainer?$(opts.tagsContainer).append($el):1<tlid.length?$self.siblings("#"+$self.data("tm_rndid")+"_"+tlid[tlid.length-2]).after($el):$self.before($el),$el.find("#"+newTagRemoveId).on("click",$self,function(e){e.preventDefault();var TagIdToRemove=parseInt($(this).attr("TagIdToRemove"));privateMethods.spliceTag.call($self,TagIdToRemove,e.data)}),privateMethods.refreshHiddenTagList.call($self),ignoreEvents||$self.trigger("tm:pushed",[tag,tagId]),privateMethods.showOrHide.call($self);$self.val("")}}else $self.trigger("tm:invalid",tag)}},popTag:function(){var tagId,$self=$(this),tlis=$self.data("tlis"),tagBeingRemoved=$self.data("tlid");0<tagBeingRemoved.length&&(tagId=tagBeingRemoved.pop(),tagBeingRemoved=tlis[tlis.length-1],$self.trigger("tm:popping",[tagBeingRemoved,tagId]),tlis.pop(),$("#"+$self.data("tm_rndid")+"_"+tagId).remove(),privateMethods.refreshHiddenTagList.call($self),$self.trigger("tm:popped",[tagBeingRemoved,tagId]))},empty:function(){for(var tagId,$self=$(this),tlis=$self.data("tlis"),tlid=$self.data("tlid");0<tlid.length;)tagId=tlid.pop(),tlis.pop(),$("#"+$self.data("tm_rndid")+"_"+tagId).remove(),privateMethods.refreshHiddenTagList.call($self);$self.trigger("tm:emptied",null),privateMethods.showOrHide.call($self)},tags:function(){return this.data("tlis")}},privateMethods={showOrHide:function(){var opts=this.data("opts"),tlis=this.data("tlis");0<opts.maxTags&&tlis.length<opts.maxTags&&(this.show(),this.trigger("tm:show")),0<opts.maxTags&&tlis.length>=opts.maxTags&&(this.hide(),this.trigger("tm:hide"))},tagClasses:function(){var $self=$(this),opts=$self.data("opts"),tagBaseClass=opts.tagBaseClass,inputBaseClass=opts.inputBaseClass,cl=tagBaseClass;return $self.attr("class")&&$.each($self.attr("class").split(" "),function(index,value){-1!==value.indexOf(inputBaseClass+"-")&&(cl+=" "+tagBaseClass+value.substring(inputBaseClass.length))}),cl+=opts.tagClass?" "+opts.tagClass:""},trimTag:function(tag,delimiterChars){var i;for(tag=$.trim(tag),i=0;i<tag.length&&-1===$.inArray(tag.charCodeAt(i),delimiterChars);i++);return tag.substring(0,i)},refreshHiddenTagList:function(){var $self=$(this),tlis=$self.data("tlis"),lhiddenTagList=$self.data("lhiddenTagList");lhiddenTagList&&$(lhiddenTagList).val(tlis.join($self.data("opts").baseDelimiter)).change(),$self.trigger("tm:refresh",tlis.join($self.data("opts").baseDelimiter))},killEvent:function(e){e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation(),e.preventDefault()},keyInArray:function(e,ary){return-1!==$.inArray(e.which,ary)},applyDelimiter:function(e){var $self=$(this);publicMethods.pushTag.call($self,$(this).val()),e.preventDefault()},prefill:function(pta){var $self=$(this),opts=$self.data("opts");$.each(pta,function(key,val){!0===opts.externalTagId?publicMethods.pushTag.call($self,val[opts.prefillValueFieldName],!0,val[opts.prefillIdFieldName]):publicMethods.pushTag.call($self,val,!0)})},pushAllTags:function(e,tag){var tlis=$(this),opts=tlis.data("opts"),tlis=tlis.data("tlis");opts.AjaxPushAllTags&&("tm:pushed"===e.type&&-1!==$.inArray(tag,opts.prefilled)||$.post(opts.AjaxPush,$.extend({tags:tlis.join(opts.baseDelimiter)},opts.AjaxPushParameters)))},spliceTag:function(tagId){var tagBeingRemoved,tlis=this.data("tlis"),tlid=this.data("tlid"),idx=$.inArray(tagId,tlid);-1!==idx&&(tagBeingRemoved=tlis[idx],this.trigger("tm:splicing",[tagBeingRemoved,tagId]),$("#"+this.data("tm_rndid")+"_"+tagId).remove(),tlis.splice(idx,1),tlid.splice(idx,1),privateMethods.refreshHiddenTagList.call(this),this.trigger("tm:spliced",[tagBeingRemoved,tagId])),privateMethods.showOrHide.call(this)},init:function(delimiters){var keyNums,opts=$.extend({},defaults,delimiters);return opts.hiddenTagListName=null===opts.hiddenTagListName?"hidden-"+this.attr("name"):opts.hiddenTagListName,delimiters=opts.delimeters||opts.delimiters,keyNums=[9,13,17,18,19,37,38,39,40],opts.delimiterChars=[],opts.delimiterKeys=[],$.each(delimiters,function(i,v){(-1!==$.inArray(v,keyNums)?opts.delimiterKeys:opts.delimiterChars).push(v)}),opts.baseDelimiter=String.fromCharCode(opts.delimiterChars[0]||44),opts.tagBaseClass="tm-tag",opts.inputBaseClass="tm-input",$.isFunction(opts.validator)||(opts.validator=null),this.each(function(){var hiddenObj,$self=$(this),rndid="",albet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if($self.data("tagManager"))return!1;$self.data("tagManager",!0);for(var i=0;i<5;i++)rndid+=albet.charAt(Math.floor(Math.random()*albet.length));$self.data("tm_rndid",rndid),$self.data("opts",opts).data("tlis",[]).data("tlid",[]),null===opts.output?(hiddenObj=$("<input/>",{type:"hidden",name:opts.hiddenTagListName}),$self.after(hiddenObj),$self.data("lhiddenTagList",hiddenObj)):$self.data("lhiddenTagList",$(opts.output)),opts.AjaxPushAllTags&&($self.on("tm:spliced",privateMethods.pushAllTags),$self.on("tm:popped",privateMethods.pushAllTags),$self.on("tm:pushed",privateMethods.pushAllTags)),$self.on("focus keypress",function(e){$(this).popover&&$(this).popover("hide")}),opts.isClearInputOnEsc&&$self.on("keyup",function(e){27===e.which&&($(this).val(""),privateMethods.killEvent(e))}),$self.on("keypress",function(e){privateMethods.keyInArray(e,opts.delimiterChars)&&privateMethods.applyDelimiter.call($self,e)}),$self.on("keydown",function(e){13===e.which&&opts.preventSubmitOnEnter&&privateMethods.killEvent(e),privateMethods.keyInArray(e,opts.delimiterKeys)&&privateMethods.applyDelimiter.call($self,e)}),opts.deleteTagsOnBackspace&&$self.on("keydown",function(e){privateMethods.keyInArray(e,opts.backspace)&&$(this).val().length<=0&&(publicMethods.popTag.call($self),privateMethods.killEvent(e))}),opts.fillInputOnTagRemove&&$self.on("tm:popped",function(e,tag){$(this).val(tag)}),$self.change(function(e){/webkit/.test(navigator.userAgent.toLowerCase())||$self.focus(),privateMethods.killEvent(e)}),null!==opts.prefilled?"object"==typeof opts.prefilled?privateMethods.prefill.call($self,opts.prefilled):"string"==typeof opts.prefilled?privateMethods.prefill.call($self,opts.prefilled.split(opts.baseDelimiter)):"function"==typeof opts.prefilled&&privateMethods.prefill.call($self,opts.prefilled()):null!==opts.output&&($(opts.output)&&$(opts.output).val()&&$(opts.output),privateMethods.prefill.call($self,$(opts.output).val().split(opts.baseDelimiter)))}),this}};$.fn.tagsManager=function(method){var $self=$(this);return 0 in this?publicMethods[method]?publicMethods[method].apply($self,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?($.error("Method "+method+" does not exist."),!1):privateMethods.init.apply(this,arguments):this}}(jQuery),define("tagmanager",["jquery"],function(){}),define("form",["jquery","config","modal","laconic","tagmanager"],function($,config,modal){var LABELWIDTH=3,form={serializeAsObject:function(form,ignore_empty){var arr=form.serializeArray(),inset=[],obj={};form.find("div.checkboxes.array").each(function(){var elem=$(this),set=[];elem.find("input:checked").each(function(){var name=$(this).attr("name");set.push(name)}),elem.find("input").each(function(){var name=$(this).attr("name");inset.push(name)}),obj[elem.attr("name")]=set});for(var i=0;i<arr.length;i++){var jvalue,name=arr[i].name,value=arr[i].value,input=form.find('[name="'+name+'"]'),type=input.prop("type");(jvalue=input.data("json-value"))?obj[name]=jvalue:""==value&&1!=ignore_empty||("hidden"==type&&0==name.indexOf("hidden-")?(name=name.slice("hidden-".length),null==obj[name]?obj[name]=value.split(","):obj[name]=value.split(",").concat(obj[name])):"text"==type&&input.hasClass("tag-list")?""!=value&&(void 0!==obj[name]?obj[name].push(value):obj[name]=[value]):"number"==type?obj[name]=parseInt(value):"checkbox"==type?-1==inset.indexOf(name)&&(obj[name]="on"==value):obj[name]=value)}return form.find("[type=checkbox]").each(function(){var checkbox=$(this),name=checkbox.prop("name");1!=checkbox.prop("disabled")&&void 0===obj[name]&&-1==inset.indexOf(name)&&(obj[name]=!1)}),obj},formError:function(formel,error){if(formel.find(".has-error").removeClass("has-error"),formel.find(".help-block.with-errors").remove(),error)if("form_error"==error.code||"input_error"==error.code){errors=error.data.split("\n");for(var i=0;i<errors.length;i++){var el=errors[i].split(/:\s*(.*)?/);form.fieldError(formel,el[0],el[1])}}else modal.alert(error.data)},fieldError:function(group,field,msg){var input=group.find("input[name="+field+"]");0<input.length?(group=input.closest(".form-group"),input.parent().hasClass("input-group")&&(input=input.parent()),group.addClass("has-error"),input.after($.el.p({class:"help-block with-errors"},msg))):alert("Missing value for "+field)},showDialog:function(data){$(".swish-event-receiver").trigger("dialog",data)},formBroadcast:function(event,data){$(".swish-event-receiver").trigger(event,data)},dyn_clear:function(form,onclear){form.find('.has-clear input[type="text"]').on("input propertychange",function(){var $this=$(this),visible=Boolean($this.val());$this.siblings(".form-control-clear").toggleClass("hidden",!visible)}).trigger("propertychange"),form.find(".form-control-clear").click(function(){var input=$(this).siblings('input[type="text"]');input.val("").trigger("propertychange").focus(),onclear&&onclear.call(input)})},fields:{fileName:function(elem,public,example,disabled){var fork,input,empty="(leave empty for generated random name)",community_examples=config.swish.community_examples&&null!=example,labeltext=community_examples?"Public | Example | name":"Public | name",elem=$.el.div({class:"form-group"},label("name",labeltext),$.el.div({class:valgridw()},$.el.div({class:"input-group"},$.el.span({class:"input-group-addon",title:"If checked, other users can find this program"},checkbox("public",{checked:public})),community_examples?$.el.span({class:"input-group-addon",title:"If checked, add to examples menu"},checkbox("example",{checked:example})):void 0,input=textInput("name",{placeholder:"Name "+empty,title:"Public name of your program",value:elem,disabled:disabled}),elem?fork=$.el.span({class:"input-group-btn"},$.el.button({class:"btn btn-success",type:"button"},"Fork")):void 0)));return fork&&$(fork).on("click",function(){var btn=$(input).closest("form").find(".btn.btn-primary");$(input).attr("placeholder","Fork as "+empty),$(input).val(""),btn.text(btn.text().replace("Update","Fork"))}),elem},title:function(title){return $.el.div({class:"form-group"},label("title","Title"),$.el.div({class:valgridw()},textInput("title",{placeholder:"Descriptive title",value:title})))},author:function(author,identity){var options={placeholder:"Your name",value:author};return author&&identity&&(options.readonly=!0,options.title="Verified author name"),$.el.div({class:"form-group"},label("author","Author"),$.el.div({class:valgridw()},textInput("author",options)))},link:function(options){options={readonly:!0,title:"Permalink",value:options};return $.el.div({class:"form-group"},label("link","Link"),$.el.div({class:valgridw()},textInput("link",options)))},date:function(stamp,labels,name){return name=name||label,$.el.div({class:"form-group"},label(name,labels),$.el.div({class:valgridw()},textInput(name,{disabled:!0,value:new Date(1e3*stamp).toLocaleString()})))},description:function(msg){return $.el.div({class:"form-group"},label("description","Description"),$.el.div({class:valgridw()},textarea("description",{value:msg,placeholder:"Description"})))},commit_message:function(msg){return $.el.div({class:"form-group"},label("commit_message","Changes"),$.el.div({class:valgridw()},textarea("commit_message",{value:msg,placeholder:"Describe your changes here"})))},tags:function(tags){return $.el.div({class:"form-group"},label("tags","Tags"),$.el.div({class:valgridw()},function tagInput(elem,placeholder,tags){elem={name:elem,type:"text",class:"tm-input tag-list"};placeholder&&(elem.placeholder=placeholder);elem=$.el.input(elem);tags&&$(elem).data("prefilled",tags);return elem}("tags","Tags help finding this code",tags)))},modify:function(who,canmodify){var fields=[],opts={name:"modify",label:"Can save new version",type:"array"};function add(key,label){fields.push({name:key,label:label,value:-1!=who.indexOf(key),readonly:!canmodify})}return add("any","Anyone"),add("login","Logged in users"),add("owner","Only me"),opts.title=canmodify?"Specify who can save an updated version of this file":"Only logged in users and owners can set permissions",form.fields.checkboxes(fields,opts)},follow:function(email){return form.fields.checkboxes([{name:"follow",label:"Follow this document",value:!!email,readonly:!email}],{name:"options",label:"",title:"Notify about activity (updates, chat)\nRequires being logged in with valid email"})},projection:function(projection){return $.el.div({class:"form-group"},label("projection","Projection"),$.el.div({class:valgridw()},textInput("projection",{placeholder:"Columns",value:projection})))},csvFormat:function(list,format){return list=list||["prolog"],format=format||list[0],1==list.length?$.el.input({type:"hidden",name:"format",value:list[0]}):$.el.div({class:"form-group"},label("format","Format"),$.el.div({class:valgridw()},function select(name,from,options){var select=$($.el.select({class:"form-control",name:name}));options=options||{};for(var i=0;i<from.length;i++)!function addSelect(e){var opts;"string"==typeof e?e==options.value?select.append($.el.option({selected:"selected"},e)):select.append($.el.option(e)):(opts={value:e.value},e.value==options.value&&(opts.selected="selected"),select.append($.el.option(opts,e.label)))}(from[i]);return select[0]}("format",list,{value:format})))},limit:function(limit,distinct){return $.el.div({class:"form-group"},label("name","Distinct | limit"),$.el.div({class:valgridw()},$.el.div({class:"input-group"},$.el.span({class:"input-group-addon",title:"If checked only return distinct results"},checkbox("distinct",{checked:distinct})),textInput("limit",{placeholder:"Maximum result count (blank for unlimited)",title:"Limit results",value:limit}))))},checkboxes:function(boxes,options){var boxel,elem={class:"checkboxes col-xs-"+(12-(options=$.extend({name:"options",label:"Options",col:LABELWIDTH},options||{})).col),name:options.name};options.title&&(elem.title=options.title),options.type&&(elem.class+=" "+options.type);for(var elem=$.el.div({class:"form-group"},label(options.name,options.label,options.col),boxel=$.el.div(elem)),k=0;k<boxes.length;k++){var box=boxes[k],opts={type:"checkbox",name:box.name,autocomplete:"false"};box.value&&(opts.checked="checked"),box.readonly&&(opts.disabled="disabled"),$(boxel).append($.el.label({class:"checkbox-inline"},$.el.input(opts),box.label))}return elem},chunk:function(value){return $.el.div({class:"form-group"},label("count","Initial solutions",3),$.el.div({class:"col-xs-9"},$.el.div({class:"input-group"},textInput("chunk",{title:"Initial number of solutions",type:"number",value:value}))))},name:function(name,col){return col=col||3,$.el.div({class:"form-group"},label("name","Name",col),$.el.div({class:"col-xs-"+(12-col)},textInput("name",{placeholder:"Name",value:name})))},filename:function(name,col){return col=col||3,$.el.div({class:"form-group"},label("filename","File name",col),$.el.div({class:"col-xs-"+(12-col)},textInput("filename",{placeholder:"File name",value:name})))},hidden:function(name,value){if(void 0!==value)return $.el.input({type:"hidden",name:name,value:value})},buttons:function(options){var button=(options=options||{}).label||"Save program",offset=options.offset||LABELWIDTH,button=$.el.button({name:"save",class:"btn btn-primary"},button);return $(button).on("click",function(ev){var data=$(ev.target).parents("form")[0],data=form.serializeAsObject($(data));return options.action(ev,data),$(ev.target).parents(".modal").modal("hide"),ev.preventDefault(),!1}),$.el.div({class:"form-group"},$.el.div({class:"col-xs-offset-"+offset+" col-xs-"+(12-offset)},button,$.el.button({name:"cancel",class:"btn btn-danger","data-dismiss":"modal"},"Cancel")))},radio:function(name,buttons,type){var elem=$.el.div({class:"btn-group","data-toggle":"buttons"});type=type||"radio";for(var i=0;i<buttons.length;i++){var lblopts="btn btn-default btn-xs";buttons[i].active&&(lblopts+=" active");var opts={type:type,name:name,autocomplete:"off",value:buttons[i].value},lblopts={class:lblopts};buttons[i].title&&(lblopts.title=buttons[i].title),$(elem).append($.el.label(lblopts,$.el.input(opts),buttons[i].label))}return elem}},widgets:{glyphIcon:function(glyph){return $.el.span({class:"glyphicon glyphicon-"+glyph})},typeIcon:function(type){return $.el.span({class:"dropdown-icon type-icon "+type})},glyphIconButton:function(glyph,options){var attrs={class:"btn",type:"button"};return options.action&&(attrs["data-action"]=options.action),options.title&&(attrs.title=options.title),options.class&&(attrs.class+=" "+options.class),$.el.button(attrs,form.widgets.glyphIcon(glyph))},dropdownButton:function(icon,options){var cls=(options=options||{}).divClass,dropdown=options.ulClass,dropdown=$.el.div({class:"btn-group dropdown"+(cls?" "+cls:"")},$.el.button({class:"dropdown-toggle","data-toggle":"dropdown"},icon),$.el.ul({class:"dropdown-menu"+(dropdown?" "+dropdown:"")}));return options.actions&&form.widgets.populateMenu($(dropdown),options.client,options.actions),dropdown},populateMenu:function(menu,client,actions){var a,ul=menu.find(".dropdown-menu"),data=ul.data("menu")||{};for(a in actions)actions.hasOwnProperty(a)&&function addMenuItem(a,onclick){void 0!==onclick&&(0==a.indexOf("--")?ul.append($.el.li({class:"divider"})):(a=$.el.a(a),$(a).data("action",onclick),ul.append($.el.li(a))))}(a,actions[a]);return data.bound||(data.bound=!0,ul.on("click","a",function(ev){!function runMenu(ev,a){var action=$(a).data("action");action&&action.call(client,a)}(0,this)})),ul.data("menu",data),menu}}};function valgridw(n){return"col-xs-"+(12-(n=void 0===n?LABELWIDTH:n))}function label(elemName,text,width){return width=width||LABELWIDTH,$.el.label({class:"control-label col-xs-"+width,for:elemName},text)}function checkbox(attrs,options){attrs={name:attrs,type:"checkbox"};return(options=options||{}).checked&&(attrs.checked="checked"),options.title&&(attrs.title=options.title),$.el.input(attrs)}function textInput(attrs,options){attrs={name:attrs,type:"text",class:"form-control"};return(options=options||{}).placeholder&&(attrs.placeholder=options.placeholder),options.title&&(attrs.title=options.title),options.value&&(attrs.value=options.value),options.disabled&&(attrs.disabled=options.disabled),options.readonly&&(attrs.readonly=options.readonly),options.type&&(attrs.type=options.type),$.el.input(attrs)}function textarea(attrs,options){attrs={name:attrs,class:"form-control"};return(options=options||{}).placeholder&&(attrs.placeholder=options.placeholder),$.el.textarea(attrs,options.value||"")}return form}),define("history",["jquery","preferences","form","utils"],function($,preferences,form,utils){var history={push:function(options){var state;window.location.pathname!=options.url&&(state={location:options.url,reason:options.reason},window.history.pushState(state,"",options.url),document.title="SWISH -- "+(options.url?utils.basename(options.url):"SWI-Prolog for SHaring"))},pop:function(e){},recentMaxLength:10,addRecent:function(doc){var recent=preferences.getVal("recentDocuments")||[];for(var i=0;i<recent.length;i++)if(function equalDocument(d1,d2){return d1.type==d2.type&&d1.id==d2.id}(doc,recent[i])){recent.splice(i,1);break}for(;recent.length+1>history.recentMaxLength;)recent.pop();recent.splice(0,0,doc),preferences.setVal("recentDocuments",recent)},openRecent:function(ev,doc){return history.openRecent[doc.st_type](ev,doc)},updateRecentUL:function(){var ul=$(this),recent=preferences.getVal("recentDocuments")||[];ul.html("");for(var i=0;i<recent.length;i++){var a,e=recent[i];e.id&&(a=$.el.a(form.widgets.typeIcon(e.id.split(".").pop()),e.label||e.id),$(a).data("document",e),ul.append($.el.li(a)))}}};return history.openRecent.gitty=function(ev,doc){$(ev.target).parents(".swish").swish("playFile",doc.id)},window.onpopstate=history.pop,history}),define("svgavatar",["jquery","laconic"],function(){var $,methods;$=jQuery,methods={_init:function(options){return this.each(function(){$(this).data("svgavatar",{})})},setAVappearanceByUserID:function(ID){return $(this).each(function(){var _this=$(this),h=2097151&ID;_this.svgavatar("selectAppearance","hair",7&h),_this.svgavatar("setFill","hair",["#000000","#CC4400","#FFFF22","#9f220B"][h>>3&3]),_this.svgavatar("selectAppearance","body",h>>5&3),_this.svgavatar("setFill","body",["#95D155","#19A6BA","#F03C9B","#0B061F"][h>>7&3]),_this.svgavatar("selectAppearance","eyes",h>>9&7),_this.svgavatar("selectAppearance","nose",h>>11&3),_this.svgavatar("selectAppearance","mouth",h>>13&7)})},selectAppearance:function(section,index){$(this).find("#"+section+" g").css("display","none"),$(this).find("#"+section+" g:nth-child("+index+")").css("display","inherit")},setFill:function(section,color){return $(this).each(function(){$(this).find("#"+section+" [fill]").attr("fill",color)})}},$.fn.svgavatar=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.svgavatar"):methods._init.apply(this,arguments)}}),define("chat",["jquery","config","preferences","form","modal","utils","backend","svgavatar"],function($,config,preferences,form,modal,utils,backend){!function($){var reconnect_delay=1e4,last_open=null,methods={_init:function(options){return this.each(function(){var elem=$(this);elem.data("chat",{status:"new"}),elem.on("click",function(li){li=$(li.target).closest("li.user");1==li.length&&elem.chat("unnotify",li.attr("id"))}),elem.on("send",function(ev,msg){elem.chat("send",msg)}),$(window).bind("beforeunload",function(){elem.chat("disconnect")}),config.swish.chat&&elem.chat("connect")})},connect:function(){var elem=this,data=this.data("chat"),url=window.location.host+config.http.locations.swish_chat,lead="?",ws=window.location.protocol.replace("http","ws");if(data.connection&&3!=data.connection.readyState)return this;function add_pref_param(name,pname){var value=preferences.getVal(pname);value&&("anon-avatar"==pname&&(value=-1==value.indexOf("#")?config.http.locations.avatar+value.split("/").pop():config.http.locations.swish+"icons/"+value.split("/").pop()),url+=lead+name+"="+encodeURIComponent(value),lead="&")}add_pref_param("avatar","anon-avatar"),add_pref_param("nickname","nick-name"),data.reconnect?(url+=lead+"reconnect="+encodeURIComponent(data.reconnect),lead="&"):add_pref_param("wsid-token","reconnect");try{data.connection=new WebSocket(ws+"//"+url,["v1.chat.swish.swi-prolog.org"])}catch(err){return elem.chat("userCount",void 0),void(data.status="error")}data.connection.onerror=function(error){elem.chat("userCount",void 0),data.status="error"},data.connection.onclose=function(ev){data.status="closed",null!=last_open&&3e5<getTime()-last_open?reconnect_delay=1e4:3e5<(reconnect_delay*=2)&&(reconnect_delay=3e5),setTimeout(function(){elem.chat("connect")},reconnect_delay)},data.connection.onmessage=function(e){var msg=JSON.parse(e.data);msg.origin=e.origin,msg.type?elem.chat(msg.type,msg):console.log(e)},data.connection.onopen=function(){data.status="open"}},send_queued:function(){for(var data=this.data("chat");data.queue&&0<data.queue.length&&1==data.connection.readyState;){var str=data.queue.shift();data.connection.send(str)}},disconnect:function(){var data=this.data("chat");return data.connection&&(this.chat("send",{type:"unload"}),data.connection.onclose=function(){},data.connection.close(),data.connection=void 0,preferences.setVal("wsid-token",data.reconnect)),this},send:function(str){var data=this.data("chat");return data&&data.connection&&(str=JSON.stringify(str),"ready"==data.status?data.connection.send(str):(data.queue?data.queue.includes(str)||data.queue.push(str):data.queue=[str],this.chat("connect"))),this},subscribe:function(msg,sub_channel){msg={type:"subscribe",channel:msg};sub_channel&&(msg.sub_channel=sub_channel),this.chat("send",msg)},unsubscribe:function(msg,subchannel){msg={type:"unsubscribe",channel:msg};sub_channel&&(msg.sub_channel=sub_channel),this.chat("send",msg)},welcome:function(e){var data=this.data("chat");data.wsid&&data.wsid!=e.wsid&&this.html(""),data.wsid=e.wsid,data.reconnect=e.reconnect,preferences.setVal("wsid-token",void 0),e.avatar&&"generated"==e.avatar_source&&preferences.setVal("anon-avatar",e.avatar),e.role="self";var li=this.chat("addUser",e);$(li).addClass("myself"),this.chat("userCount",e.visitors),last_open=getTime(),e.check_login?$("#login").login("update","check"):$(".sourcelist").trigger("login"),$(".storage").storage("chat_status"),data.status="ready",this.chat("send_queued")},userCount:function(cnt){var elem=$("#user-count");null==cnt?elem.parent().hide():(elem.parent().show(),elem.text(cnt))},gazers:function(e){if(e.gazers)for(var i=0;i<e.gazers.length;i++){var gazer=e.gazers[i];this.chat("addUser",gazer),gazer.file&&this.chat("addUserFile",gazer.wsid,gazer.file)}},profile:function(e){var data=this.data("chat"),li=$("#"+e.wsid);li.children("a").html("").append(avatar(e)),e.avatar&&($("*[data-userid="+e.wsid+"] img.avatar").attr("src",e.avatar),"generated"==e.avatar_source&&preferences.setVal("anon-avatar",e.avatar)),e.name&&(li.prop("title",e.name),"set-nick-name"==e.reason&&(e.html="Named <i>"+utils.htmlEncode(e.name)+"</i>",this.chat("notifyUser",e))),data.wsid==e.wsid&&$(".sourcelist").trigger("login")},rejoined:function(e){var avatars=$("#"+e.wsid);this.chat("lost",avatars,!1),e.visitors&&this.chat("userCount",e.visitors)},joined:function(e){e.visitors&&this.chat("userCount",e.visitors)},session_closed:function(){$("#login").login("update","session-closed")},notify:function(e){this.chat("notifyUser",e)},"chat-message":function(e){var rooms=$("div.chatroom").chatroom("rooms",e.docid);$(".storage").storage("chat_message",e),e.docid=="gitty:"+config.swish.hangout&&$("#broadcast-bell").chatbell("chat-message",e),0<rooms.length?(rooms.chatroom("add",e),e.displayed=!0):0<$("#"+e.user.id).length&&(msg=$.extend({},e),msg.wsid=e.user.id,msg.html="Wants to chat",this.chat("notifyUser",msg))},forbidden:function(e){modal.alert(e.message||"Action is forbidden")},read_until:function(docid,time){preferences.setDocVal(docid,"chatBar",time)},broadcast_room:function(){return this.closest(".swish").find(".storage").storage("match",{file:config.swish.hangout})},notifyUser:function(options){var elem=this;!function isBroadcast(options){return("opened"==options.event||"closed"==options.event)&&options.event_argv&&options.event_argv[0]==config.swish.hangout}(options)||this.chat("broadcast_room")||(options.create_user=!1);var user_li=this.chat("addUser",options);user_li&&0<user_li.length&&(options.onremove=function(){elem.chat("unnotify",options.wsid)},modal.notify(user_li,options),this.chat("updateFiles",options))},unnotify:function(wsid){return $("#"+wsid).hasClass("removed")&&this.chat("removeUser",wsid),this},updateFiles:function(options){var wsid=$(this).data("chat");function file(){return options.event_argv[0]}"opened"==options.event?this.chat("addUserFile",options.wsid,file()):"closed"==options.event&&(wsid=options.wsid==wsid.wsid?void 0:options.wsid,this.chat("removeUserFile",wsid,file(),!0))},addUser:function(options){var li=$("#"+options.wsid);if(0==li.length){if(0==options.create_user)return null;li=$(function li_user(ul,options){var a,li=(options=options||{}).name;li||"self"!=options.role||(li="Me");li=li||ul;li=$.el.li({class:"dropdown user",id:ul,title:li},a=$.el.a({class:"dropdown-toggle avatar","data-toggle":"dropdown"},avatar(options)),ul=$.el.ul({class:"dropdown-menu pull-right",title:""}));{var input;"self"==options.role&&($(a).append($.el.b({class:"caret"})),input=$.el.input({type:"text",placeholder:"Nick name",value:options.name||"",title:"Nick name"}),ul.append($.el.li(input)),$(input).keypress(function(name){13==name.which&&(""!=(name=$(input).val().trim())&&($("#chat").trigger("send",{type:"set-nick-name",name:name}),preferences.setVal("nick-name",name)),$(input).closest(".dropdown.open").removeClass("open"))}),form.widgets.populateMenu($(li),$("#chat"),{}),ul.append($.el.li({class:"divider"})))}return li}(options.wsid,options)),this.prepend(li)}else this.chat("lost",li,!1);return li},removeUser:function(wsid){void 0!==(wsid="string"==typeof wsid?{wsid:wsid}:wsid).visitors&&this.chat("userCount",wsid.visitors);var li=$("#"+wsid.wsid);return 0==li.length||("close"!=wsid.reason?0<$("#ntf-"+wsid.wsid).length?li.addClass("removed"):li.hide(400,function(){this.remove()}):this.chat("lost",li,!0)),this},lost:function(li,lost){lost?li.addClass("lost"):li.removeClass("lost"),li.each(function(){var tmo,elem=$(this);lost?elem.data("lost-timer",setTimeout(function(){li.hasClass("lost")&&li.remove()},6e4)):(tmo=elem.data("lost-timer"))&&(clearTimeout(tmo),elem.data("lost-timer",void 0))})},user_info:function(fields){var name,li=$(this),user={};return(!fields||0<=fields.indexOf("id"))&&(user.id=li.attr("id")),fields&&!(0<=fields.indexOf("name"))||(name=li.prop("title"))&&"Me"!==name&&(user.name=name),(!fields||0<=fields.indexOf("avatar"))&&(user.avatar=li.find("img.avatar").attr("src")||li.find("span.avatar.svg").data("avatar")),user},users:function(fields){var users=[],rc={users:users};return this.find("li.user[id]").each(function(){var user=$(this),self=user.hasClass("myself"),user=user.chat("user_info",self?void 0:fields);self&&(rc.self=$.extend({},user),user.is_self=!0),users.push(user)}),rc},self:function(fields){const li=this.find("li.user.myself[id]");return li.chat("user_info",fields)},addUserFile:function(type,file){var fli,ul=$("#"+type).find("ul.dropdown-menu");return ul.find("li.file").each(function(){if($(this).data("file")==file)return fli=this,!1}),null==fli&&(type=file.split(".").pop(),ul.append($.el.li({class:"file","data-file":file,title:"Shared file"},$.el.a($.el.span({class:"dropdown-icon type-icon "+type}),file)))),this},removeUserFile:function(wsid,file,user_too){var elem=this;function removeFile(user_li){var ul=user_li.children("ul.dropdown-menu");ul.find("li.file").each(function(){if($(this).data("file")==file)return $(this).remove(),user_too&&!user_li.hasClass("myself")&&0==ul.find("li.file").length&&elem.chat("removeUser",user_li.attr("id")),!1})}wsid?removeFile($("#"+wsid)):this.children().each(function(){removeFile($(this))})}};function getTime(){return(new Date).getTime()}$.fn.chat=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.chat"):methods._init.apply(this,arguments)}}(jQuery);var svg_images={};function avatar(options){var m,id,url,img;return options.avatar?(m=/(.*\.svg)#(\d+)$/.exec(options.avatar))&&m[2]?(id=parseInt(m[2],10),url=m[1],img=$.el.span({class:"avatar svg"}),svg_images[url]?$(img).html(svg_images[url]).svgavatar("setAVappearanceByUserID",id):backend.ajax({url:options.avatar,type:"GET",dataType:"text",success:function(reply){svg_images[url]=reply,$(img).html(reply).svgavatar("setAVappearanceByUserID",id)},error:function(jqXHR){modal.ajaxError(jqXHR)}}),$(img).data("avatar",options.avatar)):img=$.el.img({class:"avatar",src:options.avatar}):img=$.el.span({class:"avatar glyphicon glyphicon-user"}),$.el.div({class:"avatar-container"},img)}return{avatar:avatar}}),function($){var count=0,splitter_id=null,splitters=[],current_splitter=null;$.fn.split=function(children){var panel_1,panel_2,data=this.data("splitter");if(data)return data;var cls,settings=$.extend({limit:100,orientation:"horizontal",position:"50%",invisible:!1,onDragStart:$.noop,onDragEnd:$.noop,onDrag:$.noop},children||{});this.settings=settings;children=this.children();"vertical"==settings.orientation?(panel_1=children.first().addClass("left_panel"),panel_2=panel_1.next().addClass("right_panel"),cls="vsplitter"):"horizontal"==settings.orientation&&(panel_1=children.first().addClass("top_panel"),panel_2=panel_1.next().addClass("bottom_panel"),cls="hsplitter"),settings.invisible&&(cls+=" splitter-invisible");var width=this.width(),height=this.height(),id=count++;this.addClass("splitter_panel");var position,splitter=$("<div/>").addClass(cls).bind("mouseenter touchstart",function(){splitter_id=id}).bind("mouseleave touchend",function(){splitter_id=null}).insertAfter(panel_1);function get_position(match){if("number"==typeof match)return match;if("string"==typeof match){match=match.match(/^([0-9\.]+)(px|%)$/);if(match)return"px"==match[2]?+match[1]:"vertical"==settings.orientation?width*+match[1]/100:"horizontal"==settings.orientation?height*+match[1]/100:void 0}}var pos,self=$.extend(this,{refresh:function(){var new_width=this.width(),new_height=this.height();width==new_width&&height==new_height||(width=this.width(),height=this.height(),self.position(position))},position:"vertical"==settings.orientation?function(sw2,silent){if(void 0===sw2)return position;position=get_position(sw2);var pw,sw=splitter.width(),sw2=sw/2;return settings.invisible?(pw=panel_1.width(position).outerWidth(),panel_2.width(self.width()-pw),splitter.css("left",pw-sw2)):(pw=panel_1.width(position-sw2).outerWidth(),panel_2.width(self.width()-pw-sw),splitter.css("left",pw)),silent||self.find(".splitter_panel").trigger("splitter.resize"),self}:"horizontal"==settings.orientation?function(sw2,silent){if(void 0===sw2)return position;position=get_position(sw2);var pw,sw=splitter.height(),sw2=sw/2;return settings.invisible?(pw=panel_1.height(position).outerHeight(),panel_2.height(self.height()-pw),splitter.css("top",pw-sw2)):(pw=panel_1.height(position-sw2).outerHeight(),panel_2.height(self.height()-pw-sw),splitter.css("top",pw)),silent||self.find(".splitter_panel").trigger("splitter.resize"),self}:$.noop,orientation:settings.orientation,limit:settings.limit,isActive:function(){return splitter_id===id},destroy:function(){self.removeClass("splitter_panel"),splitter.unbind("mouseenter"),splitter.unbind("mouseleave"),splitter.unbind("touchstart"),splitter.unbind("touchmove"),splitter.unbind("touchend"),splitter.unbind("touchleave"),splitter.unbind("touchcancel"),"vertical"==settings.orientation?(panel_1.removeClass("left_panel"),panel_2.removeClass("right_panel")):"horizontal"==settings.orientation&&(panel_1.removeClass("top_panel"),panel_2.removeClass("bottom_panel")),self.unbind("splitter.resize"),self.find(".splitter_panel").trigger("splitter.resize"),splitters[id]=null,splitter.remove();for(var not_null=!1,i=splitters.length;i--;)if(null!==splitters[i]){not_null=!0;break}not_null||($(document.documentElement).unbind(".splitter"),$(window).unbind("resize.splitter"),self.data("splitter",null),splitters=[],count=0)}});return self.bind("splitter.resize",function(e){var pos=self.position();"vertical"==self.orientation&&pos>self.width()?pos=self.width()-self.limit-1:"horizontal"==self.orientation&&pos>self.height()&&(pos=self.height()-self.limit-1),pos<self.limit&&(pos=self.limit+1),self.position(pos,!0)}),"vertical"==settings.orientation?pos=pos>width-settings.limit?width-settings.limit:get_position(settings.position):"horizontal"==settings.orientation&&(pos=pos>height-settings.limit?height-settings.limit:get_position(settings.position)),pos<settings.limit&&(pos=settings.limit),self.position(pos,!0),0==splitters.length&&($(window).bind("resize.splitter",function(){$.each(splitters,function(i,splitter){splitter&&splitter.refresh()})}),$(document.documentElement).bind("mousedown.splitter touchstart.splitter",function(e){if(null!==splitter_id)return current_splitter=splitters[splitter_id],$('<div class="splitterMask"></div>').css("cursor",current_splitter.children().eq(1).css("cursor")).insertAfter(current_splitter),current_splitter.settings.onDragStart(e),!1}).bind("mouseup.splitter touchend.splitter touchleave.splitter touchcancel.splitter",function(e){current_splitter&&($(".splitterMask").remove(),current_splitter.settings.onDragEnd(e),current_splitter=null)}).bind("mousemove.splitter touchmove.splitter",function(e){var limit,pageY,y;null!==current_splitter&&(limit=current_splitter.limit,y=current_splitter.offset(),"vertical"==current_splitter.orientation?(pageY=e.pageX,(pageY=(pageY=e.originalEvent&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageX:pageY)-y.left)<=current_splitter.limit?pageY=current_splitter.limit+1:pageY>=current_splitter.width()-limit&&(pageY=current_splitter.width()-limit-1),pageY>current_splitter.limit&&pageY<current_splitter.width()-limit&&(current_splitter.position(pageY,!0),current_splitter.find(".splitter_panel").trigger("splitter.resize"),e.preventDefault())):"horizontal"==current_splitter.orientation&&(pageY=e.pageY,(y=(pageY=e.originalEvent&&e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageY:pageY)-y.top)<=current_splitter.limit?y=current_splitter.limit+1:y>=current_splitter.height()-limit&&(y=current_splitter.height()-limit-1),y>current_splitter.limit&&y<current_splitter.height()-limit&&(current_splitter.position(y,!0),current_splitter.find(".splitter_panel").trigger("splitter.resize"),e.preventDefault())),current_splitter.settings.onDrag(e))})),splitters.push(self),self.data("splitter",self),self}}(jQuery),define("splitter",["jquery"],function(){}),define("pane",["jquery","splitter"],function(){function paneInfo(pane){var panes=pane.children();return{splitter:pane.split(),first:$(panes[0]).children()[0],second:$(panes[2]).children()[0]}}var $,methods;$=jQuery,methods={_init:function(options){return this.each(function(){var elem=$(this),dir=elem.hasClass("horizontal")?"vertical":"horizontal",pos=elem.attr("data-split"),panes=elem.children(),pos=pos||"50%";panes.each(function(){$(this).wrap('<div class="pane-wrapper"></div>')}),elem.addClass("pane-container"),elem.split({orientation:dir,position:pos,limit:10,onDragStart:function(){elem.tile("resize_start")},onDrag:function(ev){panes.trigger("pane.resize")},onDragEnd:function(){elem.tile("resize_save")}}),elem.tile("resize_save"),elem.on("fullscreen",function(ev,val){elem.tile("resize")})})},resize_start:function(){return this.each(function(){var elem=$(this),info=paneInfo(elem);elem.find(".reactive-size").trigger("reactive-resize-start",info.splitter.orientation)})},resize_save:function(){return this.each(function(){var pos=$(this),info=paneInfo(pos),pos="horizontal"==info.splitter.orientation?(percent=pos.height(),$(info.first).height()):(percent=pos.width(),$(info.first).width()),percent=Math.round(100*pos/percent)+"%";info.splitter.resizestart=percent}),this.find(".reactive-size").trigger("reactive-resize"),this},resize:function(){return this.each(function(){var elem=$(this),splitter=elem.split();splitter.resizestart&&(splitter.position(splitter.resizestart),splitter.settings.onDrag(elem))})},split:function(pane,rel,pos,minheight){var hidden,sumh,dir="above"==(rel=rel||"below")||"below"==rel?"horizontal":"vertical",parent=this.wrap('<div class="pane-container tile "'+function flipdir(dir){return"horizontal"==dir?"vertical":"horizontal"}(dir)+"></div>").parent();parent.is(":visible")||(hidden=parent.closest(".tab-pane")).addClass("active"),null==pos?pos=50:pos<10?pos=10:90<pos&&(pos=90),!minheight||"horizontal"!=dir||(sumh=this.height())*pos/100<minheight&&minheight<.9*sumh&&(pos=100*minheight/sumh),"above"==rel||"left"==rel?parent.prepend(pane):(pos=100-pos,parent.append(pane));var panes=$(this).add(pane);return panes.wrap('<div class="pane-wrapper"></div>'),parent.split({orientation:dir,position:pos+"%",limit:10,onDragStart:function(){parent.tile("resize_start")},onDrag:function(){panes.trigger("pane.resize")},onDragEnd:function(){parent.tile("resize_save")}}),parent.tile("resize_save"),panes.trigger("pane.resize"),hidden&&hidden.removeClass("active"),parent},close:function(){var splitContainer=this.closest(".pane-container");splitContainer.split().destroy(),this.parent().remove(),splitContainer.children().first().children().first().unwrap().unwrap()}},$.fn.tile=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.tile"):methods._init.apply(this,arguments)}}),function(root,factory){"function"==typeof define&&define.amd?define("bloodhound",["jquery"],function(a0){return root.Bloodhound=factory(a0)}):"object"==typeof exports?module.exports=factory(require("jquery")):root.Bloodhound=factory(jQuery)}(this,function($){var _=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return"string"==typeof obj},isNumber:function(obj){return"number"==typeof obj},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return void 0===obj},isElement:function(obj){return!(!obj||1!==obj.nodeType)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||null===s?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,function reverseArgs(index,value){return cb(value,index)})},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;return obj?($.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj)))return!1}),!!result):result},some:function(obj,test){var result=!1;return obj?($.each(obj,function(key,val){if(result=test.call(null,val,key,obj))return!1}),!!result):result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(!0,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),result=callNow?func.apply(context,args):result}},throttle:function(func,wait){var context,args,timeout,result,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout=timeout||setTimeout(later,remaining),result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}(),tokenizers=function(){"use strict";return{nonword:nonword,whitespace:whitespace,obj:{nonword:getObjTokenizer(nonword),whitespace:getObjTokenizer(whitespace)}};function whitespace(str){return(str=_.toStr(str))?str.split(/\s+/):[]}function nonword(str){return(str=_.toStr(str))?str.split(/\W+/):[]}function getObjTokenizer(tokenizer){return function setKey(keys){return keys=_.isArray(keys)?keys:[].slice.call(arguments,0),function tokenize(o){var tokens=[];return _.each(keys,function(k){tokens=tokens.concat(tokenizer(_.toStr(o[k])))}),tokens}}}}(),LruCache=function(){"use strict";function LruCache(maxSize){this.maxSize=_.isNumber(maxSize)?maxSize:100,this.reset(),this.maxSize<=0&&(this.set=this.get=$.noop)}function List(){this.head=this.tail=null}function Node(key,val){this.key=key,this.val=val,this.prev=this.next=null}return _.mixin(LruCache.prototype,{set:function set(key,val){var node=this.list.tail;this.size>=this.maxSize&&(this.list.remove(node),delete this.hash[node.key],this.size--),(node=this.hash[key])?(node.val=val,this.list.moveToFront(node)):(node=new Node(key,val),this.list.add(node),this.hash[key]=node,this.size++)},get:function get(node){node=this.hash[node];if(node)return this.list.moveToFront(node),node.val},reset:function reset(){this.size=0,this.hash={},this.list=new List}}),_.mixin(List.prototype,{add:function add(node){this.head&&(node.next=this.head,this.head.prev=node),this.head=node,this.tail=this.tail||node},remove:function remove(node){node.prev?node.prev.next=node.next:this.head=node.next,node.next?node.next.prev=node.prev:this.tail=node.prev},moveToFront:function(node){this.remove(node),this.add(node)}}),LruCache}(),PersistentStorage=function(){"use strict";var LOCAL_STORAGE;try{(LOCAL_STORAGE=window.localStorage).setItem("~~~","!"),LOCAL_STORAGE.removeItem("~~~")}catch(err){LOCAL_STORAGE=null}function PersistentStorage(namespace,override){this.prefix=["__",namespace,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+_.escapeRegExChars(this.prefix)),this.ls=override||LOCAL_STORAGE,this.ls||this._noop()}return _.mixin(PersistentStorage.prototype,{_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=_.noop},_safeSet:function(key,val){try{this.ls.setItem(key,val)}catch(err){"QuotaExceededError"===err.name&&(this.clear(),this._noop())}},get:function(key){return this.isExpired(key)&&this.remove(key),decode(this.ls.getItem(this._prefix(key)))},set:function(key,val,ttl){return _.isNumber(ttl)?this._safeSet(this._ttlKey(key),encode(now()+ttl)):this.ls.removeItem(this._ttlKey(key)),this._safeSet(this._prefix(key),encode(val))},remove:function(key){return this.ls.removeItem(this._ttlKey(key)),this.ls.removeItem(this._prefix(key)),this},clear:function(){for(var keys=function gatherMatchingKeys(keyMatcher){var i,key,keys=[],len=LOCAL_STORAGE.length;for(i=0;i<len;i++)(key=LOCAL_STORAGE.key(i)).match(keyMatcher)&&keys.push(key.replace(keyMatcher,""));return keys}(this.keyMatcher),i=keys.length;i--;)this.remove(keys[i]);return this},isExpired:function(ttl){ttl=decode(this.ls.getItem(this._ttlKey(ttl)));return!!(_.isNumber(ttl)&&now()>ttl)}}),PersistentStorage;function now(){return(new Date).getTime()}function encode(val){return JSON.stringify(_.isUndefined(val)?null:val)}function decode(val){return $.parseJSON(val)}}(),Transport=function(){"use strict";var pendingRequestsCount=0,pendingRequests={},maxPendingRequests=6,sharedCache=new LruCache(10);function Transport(o){o=o||{},this.cancelled=!1,this.lastReq=null,this._send=o.transport,this._get=o.limiter?o.limiter(this._get):this._get,this._cache=!1===o.cache?new LruCache(0):sharedCache}return Transport.setMaxPendingRequests=function setMaxPendingRequests(num){maxPendingRequests=num},Transport.resetCache=function resetCache(){sharedCache.reset()},_.mixin(Transport.prototype,{_fingerprint:function fingerprint(o){return(o=o||{}).url+o.type+$.param(o.data||{})},_get:function(o,cb){var fingerprint,jqXhr,that=this;function done(resp){cb(null,resp),that._cache.set(fingerprint,resp)}function fail(){cb(!0)}fingerprint=this._fingerprint(o),this.cancelled||fingerprint!==this.lastReq||((jqXhr=pendingRequests[fingerprint])?jqXhr.done(done).fail(fail):pendingRequestsCount<maxPendingRequests?(pendingRequestsCount++,pendingRequests[fingerprint]=this._send(o).done(done).fail(fail).always(function always(){pendingRequestsCount--,delete pendingRequests[fingerprint],that.onDeckRequestArgs&&(that._get.apply(that,that.onDeckRequestArgs),that.onDeckRequestArgs=null)})):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(o,cb){var resp;cb=cb||$.noop,o=_.isString(o)?{url:o}:o||{},resp=this._fingerprint(o),this.cancelled=!1,this.lastReq=resp,(resp=this._cache.get(resp))?cb(null,resp):this._get(o,cb)},cancel:function(){this.cancelled=!0}}),Transport}(),SearchIndex=window.SearchIndex=function(){"use strict";var CHILDREN="c",IDS="i";function SearchIndex(o){(o=o||{}).datumTokenizer&&o.queryTokenizer||$.error("datumTokenizer and queryTokenizer are both required"),this.identify=o.identify||_.stringify,this.datumTokenizer=o.datumTokenizer,this.queryTokenizer=o.queryTokenizer,this.reset()}return _.mixin(SearchIndex.prototype,{bootstrap:function bootstrap(o){this.datums=o.datums,this.trie=o.trie},add:function(data){var that=this;data=_.isArray(data)?data:[data],_.each(data,function(tokens){var id;that.datums[id=that.identify(tokens)]=tokens,tokens=normalizeTokens(that.datumTokenizer(tokens)),_.each(tokens,function(token){for(var ch,node=that.trie,chars=token.split("");ch=chars.shift();)(node=node[CHILDREN][ch]||(node[CHILDREN][ch]=newNode()))[IDS].push(id)})})},get:function get(ids){var that=this;return _.map(ids,function(id){return that.datums[id]})},search:function search(tokens){var matches,that=this,tokens=normalizeTokens(this.queryTokenizer(tokens));return _.each(tokens,function(ids){var node,chars,ch;if(matches&&0===matches.length)return!1;for(node=that.trie,chars=ids.split("");node&&(ch=chars.shift());)node=node[CHILDREN][ch];if(!node||0!==chars.length)return!(matches=[]);ids=node[IDS].slice(0),matches=matches?function getIntersection(arrayA,arrayB){var ai=0,bi=0,intersection=[];arrayA=arrayA.sort(),arrayB=arrayB.sort();var lenArrayA=arrayA.length,lenArrayB=arrayB.length;for(;ai<lenArrayA&&bi<lenArrayB;)arrayA[ai]<arrayB[bi]?ai++:(arrayA[ai]>arrayB[bi]||(intersection.push(arrayA[ai]),ai++),bi++);return intersection}(matches,ids):ids}),matches?_.map(function unique(array){for(var seen={},uniques=[],i=0,len=array.length;i<len;i++)seen[array[i]]||(seen[array[i]]=!0,uniques.push(array[i]));return uniques}(matches),function(id){return that.datums[id]}):[]},all:function all(){var key,values=[];for(key in this.datums)values.push(this.datums[key]);return values},reset:function reset(){this.datums={},this.trie=newNode()},serialize:function serialize(){return{datums:this.datums,trie:this.trie}}}),SearchIndex;function normalizeTokens(tokens){return tokens=_.filter(tokens,function(token){return!!token}),tokens=_.map(tokens,function(token){return token.toLowerCase()})}function newNode(){var node={};return node[IDS]=[],node[CHILDREN]={},node}}(),Prefetch=function(){"use strict";var keys;function Prefetch(o){this.url=o.url,this.ttl=o.ttl,this.cache=o.cache,this.prepare=o.prepare,this.transform=o.transform,this.transport=o.transport,this.thumbprint=o.thumbprint,this.storage=new PersistentStorage(o.cacheKey)}return keys={data:"data",protocol:"protocol",thumbprint:"thumbprint"},_.mixin(Prefetch.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},store:function store(data){this.cache&&(this.storage.set(keys.data,data,this.ttl),this.storage.set(keys.protocol,location.protocol,this.ttl),this.storage.set(keys.thumbprint,this.thumbprint,this.ttl))},fromCache:function fromCache(){var isExpired,stored={};return this.cache?(stored.data=this.storage.get(keys.data),stored.protocol=this.storage.get(keys.protocol),stored.thumbprint=this.storage.get(keys.thumbprint),isExpired=stored.thumbprint!==this.thumbprint||stored.protocol!==location.protocol,stored.data&&!isExpired?stored.data:null):null},fromNetwork:function(cb){var settings,that=this;cb&&(settings=this.prepare(this._settings()),this.transport(settings).fail(function onError(){cb(!0)}).done(function onResponse(resp){cb(null,that.transform(resp))}))},clear:function clear(){return this.storage.clear(),this}}),Prefetch}(),Remote=function(){"use strict";function Remote(o){this.url=o.url,this.prepare=o.prepare,this.transform=o.transform,this.transport=new Transport({cache:o.cache,limiter:o.limiter,transport:o.transport})}return _.mixin(Remote.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},get:function get(settings,cb){var that=this;if(cb)return settings=settings||"",settings=this.prepare(settings,this._settings()),this.transport.get(settings,function onResponse(err,resp){cb(err?[]:that.transform(resp))})},cancelLastRequest:function cancelLastRequest(){this.transport.cancel()}}),Remote}(),oParser=function(){"use strict";return function parse(o){var sorter,defaults={initialize:!0,identify:_.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null};return(o=_.mixin(defaults,o||{})).datumTokenizer||$.error("datumTokenizer is required"),o.queryTokenizer||$.error("queryTokenizer is required"),sorter=o.sorter,o.sorter=sorter?function(x){return x.sort(sorter)}:_.identity,o.local=_.isFunction(o.local)?o.local():o.local,o.prefetch=function parsePrefetch(o){var defaults;return o?(defaults={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:_.identity,transform:_.identity,transport:null},o=_.isString(o)?{url:o}:o,(o=_.mixin(defaults,o)).url||$.error("prefetch requires url to be set"),o.transform=o.filter||o.transform,o.cacheKey=o.cacheKey||o.url,o.thumbprint="0.11.1"+o.thumbprint,o.transport=o.transport?callbackToDeferred(o.transport):$.ajax,o):null}(o.prefetch),o.remote=function parseRemote(o){var defaults;return o?(defaults={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:_.identity,transport:null},o=_.isString(o)?{url:o}:o,(o=_.mixin(defaults,o)).url||$.error("remote requires url to be set"),o.transform=o.filter||o.transform,o.prepare=function toRemotePrepare(o){var prepare,replace,wildcard;if(prepare=o.prepare,replace=o.replace,wildcard=o.wildcard,prepare)return prepare;prepare=replace?function prepareByReplace(query,settings){return settings.url=replace(settings.url,query),settings}:o.wildcard?function prepareByWildcard(query,settings){return settings.url=settings.url.replace(wildcard,encodeURIComponent(query)),settings}:function idenityPrepare(query,settings){return settings};return prepare}(o),o.limiter=function toLimiter(wait){var limiter,method;limiter=wait.limiter,method=wait.rateLimitBy,wait=wait.rateLimitWait,limiter=limiter||(/^throttle$/i.test(method)?function throttle(wait){return function throttle(fn){return _.throttle(fn,wait)}}:function debounce(wait){return function debounce(fn){return _.debounce(fn,wait)}})(wait);return limiter}(o),o.transport=o.transport?callbackToDeferred(o.transport):$.ajax,delete o.replace,delete o.wildcard,delete o.rateLimitBy,delete o.rateLimitWait,o):void 0}(o.remote),o};function callbackToDeferred(fn){return function wrapper(o){var deferred=$.Deferred();return fn(o,function onSuccess(resp){_.defer(function(){deferred.resolve(resp)})},function onError(err){_.defer(function(){deferred.reject(err)})}),deferred}}}();return function(){"use strict";var old;function Bloodhound(o){o=oParser(o),this.sorter=o.sorter,this.identify=o.identify,this.sufficient=o.sufficient,this.local=o.local,this.remote=o.remote?new Remote(o.remote):null,this.prefetch=o.prefetch?new Prefetch(o.prefetch):null,this.index=new SearchIndex({identify:this.identify,datumTokenizer:o.datumTokenizer,queryTokenizer:o.queryTokenizer}),!1!==o.initialize&&this.initialize()}return old=window&&window.Bloodhound,Bloodhound.noConflict=function noConflict(){return window&&(window.Bloodhound=old),Bloodhound},Bloodhound.tokenizers=tokenizers,_.mixin(Bloodhound.prototype,{__ttAdapter:function ttAdapter(){var that=this;return this.remote?function withAsync(query,sync,async){return that.search(query,sync,async)}:function withoutAsync(query,sync){return that.search(query,sync)}},_loadPrefetch:function loadPrefetch(){var serialized,that=this,deferred=$.Deferred();return this.prefetch?(serialized=this.prefetch.fromCache())?(this.index.bootstrap(serialized),deferred.resolve()):this.prefetch.fromNetwork(function done(err,data){if(err)return deferred.reject();that.add(data),that.prefetch.store(that.index.serialize()),deferred.resolve()}):deferred.resolve(),deferred.promise()},_initialize:function initialize(){var that=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(function addLocalToIndex(){that.add(that.local)}),this.initPromise},initialize:function initialize(force){return!this.initPromise||force?this._initialize():this.initPromise},add:function add(data){return this.index.add(data),this},get:function get(ids){return ids=_.isArray(ids)?ids:[].slice.call(arguments),this.index.get(ids)},search:function search(query,sync,async){var that=this,local=this.sorter(this.index.search(query));return sync(this.remote?local.slice():local),this.remote&&local.length<this.sufficient?this.remote.get(query,function processRemote(remote){var nonDuplicates=[];_.each(remote,function(r){_.some(local,function(l){return that.identify(r)===that.identify(l)})||nonDuplicates.push(r)}),async&&async(nonDuplicates)}):this.remote&&this.remote.cancelLastRequest(),this},all:function all(){return this.index.all()},clear:function clear(){return this.index.reset(),this},clearPrefetchCache:function clearPrefetchCache(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function clearRemoteCache(){return Transport.resetCache(),this},ttAdapter:function ttAdapter(){return this.__ttAdapter()}}),Bloodhound}()}),function(factory){"function"==typeof define&&define.amd?define("typeahead.js",["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):factory(jQuery)}(function($){var _=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return"string"==typeof obj},isNumber:function(obj){return"number"==typeof obj},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return void 0===obj},isElement:function(obj){return!(!obj||1!==obj.nodeType)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||null===s?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,function reverseArgs(index,value){return cb(value,index)})},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;return obj?($.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj)))return!1}),!!result):result},some:function(obj,test){var result=!1;return obj?($.each(obj,function(key,val){if(result=test.call(null,val,key,obj))return!1}),!!result):result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(!0,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),result=callNow?func.apply(context,args):result}},throttle:function(func,wait){var context,args,timeout,result,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout=timeout||setTimeout(later,remaining),result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}(),WWW=function(){"use strict";var defaultClassNames={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return function build(classes){var www;return classes=_.mixin({},defaultClassNames,classes),{css:(www={css:function buildCss(){var css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};_.isMsie()&&_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});return css}(),classes:classes,html:function buildHtml(c){return{wrapper:'<span class="'+c.wrapper+'"></span>',menu:'<div class="'+c.menu+'"></div>'}}(classes),selectors:function buildSelectors(classes){var selectors={};return _.each(classes,function(v,k){selectors[k]="."+v}),selectors}(classes)}).css,html:www.html,classes:www.classes,selectors:www.selectors,mixin:function(o){_.mixin(o,www)}}}}(),EventBus=function(){"use strict";var deprecationMap;function EventBus(o){o&&o.el||$.error("EventBus initialized without el"),this.$el=$(o.el)}return deprecationMap={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},_.mixin(EventBus.prototype,{_trigger:function($e,args){$e=$.Event("typeahead:"+$e);return(args=args||[]).unshift($e),this.$el.trigger.apply(this.$el,args),$e},before:function(type){var args=[].slice.call(arguments,1);return this._trigger("before"+type,args).isDefaultPrevented()},trigger:function(deprecatedType){this._trigger(deprecatedType,[].slice.call(arguments,1)),(deprecatedType=deprecationMap[deprecatedType])&&this._trigger(deprecatedType,[].slice.call(arguments,1))}}),EventBus}(),EventEmitter=function(){"use strict";var splitter=/\s+/,nextTick=function getNextTick(){var nextTickFn;nextTickFn=window.setImmediate?function nextTickSetImmediate(fn){setImmediate(function(){fn()})}:function nextTickSetTimeout(fn){setTimeout(function(){fn()},0)};return nextTickFn}();return{onSync:function onSync(types,cb,context){return on.call(this,"sync",types,cb,context)},onAsync:function onAsync(types,cb,context){return on.call(this,"async",types,cb,context)},off:function off(types){var type;if(!this._callbacks)return this;types=types.split(splitter);for(;type=types.shift();)delete this._callbacks[type];return this},trigger:function trigger(types){var callbacks,args,syncFlush,asyncFlush;if(!this._callbacks)return this;types=types.split(splitter),args=[].slice.call(arguments,1);for(;(asyncFlush=types.shift())&&(callbacks=this._callbacks[asyncFlush]);)syncFlush=getFlush(callbacks.sync,this,[asyncFlush].concat(args)),asyncFlush=getFlush(callbacks.async,this,[asyncFlush].concat(args)),syncFlush()&&nextTick(asyncFlush);return this}};function on(method,types,cb,context){var type;if(!cb)return this;for(types=types.split(splitter),cb=context?function bindContext(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}(cb,context):cb,this._callbacks=this._callbacks||{};type=types.shift();)this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]},this._callbacks[type][method].push(cb);return this}function getFlush(callbacks,context,args){return function flush(){for(var cancelled,i=0,len=callbacks.length;!cancelled&&i<len;i+=1)cancelled=!1===callbacks[i].apply(context,args);return!cancelled}}}(),highlight=function(doc){"use strict";var defaults={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function hightlight(o){var regex;(o=_.mixin({},defaults,o)).node&&o.pattern&&(o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern],regex=function getRegex(patterns,caseSensitive,regexStr){for(var escapedPatterns=[],i=0,len=patterns.length;i<len;i++)escapedPatterns.push(_.escapeRegExChars(patterns[i]));return regexStr=regexStr?"\\b("+escapedPatterns.join("|")+")\\b":"("+escapedPatterns.join("|")+")",caseSensitive?new RegExp(regexStr):new RegExp(regexStr,"i")}(o.pattern,o.caseSensitive,o.wordsOnly),function traverse(el,hightlightTextNode){var childNode;for(var i=0;i<el.childNodes.length;i++)3===(childNode=el.childNodes[i]).nodeType?i+=hightlightTextNode(childNode)?1:0:traverse(childNode,hightlightTextNode)}(o.node,function hightlightTextNode(textNode){var match,patternNode,wrapperNode;(match=regex.exec(textNode.data))&&(wrapperNode=doc.createElement(o.tagName),o.className&&(wrapperNode.className=o.className),(patternNode=textNode.splitText(match.index)).splitText(match[0].length),wrapperNode.appendChild(patternNode.cloneNode(!0)),textNode.parentNode.replaceChild(wrapperNode,patternNode));return!!match}))}}(window.document),Input=function(){"use strict";var specialKeyCodeMap;function Input(o,www){(o=o||{}).input||$.error("input is missing"),www.mixin(this),this.$hint=$(o.hint),this.$input=$(o.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=function buildOverflowHelper($input){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input)}(this.$input),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop)}return specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},Input.normalizeQuery=function(str){return _.toStr(str).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},_.mixin(Input.prototype,EventEmitter,{_onBlur:function onBlur(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function onFocus(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function onKeydown($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e),keyName&&this._shouldTrigger(keyName,$e)&&this.trigger(keyName+"Keyed",$e)},_onInput:function onInput(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function managePreventDefault(keyName,$e){var preventDefault;switch(keyName){case"up":case"down":preventDefault=!withModifier($e);break;default:preventDefault=!1}preventDefault&&$e.preventDefault()},_shouldTrigger:function shouldTrigger(keyName,trigger){trigger="tab"!==keyName||!withModifier(trigger);return trigger},_checkLanguageDirection:function checkLanguageDirection(){var dir=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==dir&&(this.dir=dir,this.$hint.attr("dir",dir),this.trigger("langDirChanged",dir))},_setQuery:function setQuery(val,silent){var areEquivalent=function areQueriesEquivalent(a,b){return Input.normalizeQuery(a)===Input.normalizeQuery(b)}(val,this.query),hasDifferentWhitespace=!!areEquivalent&&this.query.length!==val.length;this.query=val,silent||areEquivalent?!silent&&hasDifferentWhitespace&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var that=this,onBlur=_.bind(this._onBlur,this),onFocus=_.bind(this._onFocus,this),onKeydown=_.bind(this._onKeydown,this),onInput=_.bind(this._onInput,this);return this.$input.on("blur.tt",onBlur).on("focus.tt",onFocus).on("keydown.tt",onKeydown),!_.isMsie()||9<_.isMsie()?this.$input.on("input.tt",onInput):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){specialKeyCodeMap[$e.which||$e.keyCode]||_.defer(_.bind(that._onInput,that,$e))}),this},focus:function focus(){this.$input.focus()},blur:function blur(){this.$input.blur()},getLangDir:function getLangDir(){return this.dir},getQuery:function getQuery(){return this.query||""},setQuery:function setQuery(val,silent){this.setInputValue(val),this._setQuery(val,silent)},hasQueryChangedSinceLastFocus:function hasQueryChangedSinceLastFocus(){return this.query!==this.queryWhenFocused},getInputValue:function getInputValue(){return this.$input.val()},setInputValue:function setInputValue(value){this.$input.val(value),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function resetInputValue(){this.setInputValue(this.query)},getHint:function getHint(){return this.$hint.val()},setHint:function setHint(value){this.$hint.val(value)},clearHint:function clearHint(){this.setHint("")},clearHintIfInvalid:function clearHintIfInvalid(){var val=this.getInputValue(),valIsPrefixOfHint=this.getHint(),valIsPrefixOfHint=val!==valIsPrefixOfHint&&0===valIsPrefixOfHint.indexOf(val);""!==val&&valIsPrefixOfHint&&!this.hasOverflow()||this.clearHint()},hasFocus:function hasFocus(){return this.$input.is(":focus")},hasOverflow:function hasOverflow(){var constraint=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength=this.$input.val().length,range=this.$input[0].selectionStart;return _.isNumber(range)?range===valueLength:!document.selection||((range=document.selection.createRange()).moveStart("character",-valueLength),valueLength===range.text.length)},destroy:function destroy(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=$("<div>")}}),Input;function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}(),Dataset=function(){"use strict";var keys,nameGenerator;function Dataset(o,www){(o=o||{}).templates=o.templates||{},o.templates.notFound=o.templates.notFound||o.templates.empty,o.source||$.error("missing source"),o.node||$.error("missing node"),o.name&&!function isValidName(str){return/^[_a-zA-Z0-9-]+$/.test(str)}(o.name)&&$.error("invalid dataset name: "+o.name),www.mixin(this),this.highlight=!!o.highlight,this.name=o.name||nameGenerator(),this.limit=o.limit||5,this.displayFn=function getDisplayFn(display){return display=display||_.stringify,_.isFunction(display)?display:function displayFn(obj){return obj[display]}}(o.display||o.displayKey),this.templates=function getTemplates(templates,displayFn){return{notFound:templates.notFound&&_.templatify(templates.notFound),pending:templates.pending&&_.templatify(templates.pending),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||function suggestionTemplate(context){return $("<div>").text(displayFn(context))}}}(o.templates,this.displayFn),this.source=o.source.__ttAdapter?o.source.__ttAdapter():o.source,this.async=_.isUndefined(o.async)?2<this.source.length:!!o.async,this._resetLastSuggestion(),this.$el=$(o.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}return keys={val:"tt-selectable-display",obj:"tt-selectable-object"},nameGenerator=_.getIdGenerator(),Dataset.extractData=function extractData($el){$el=$($el);return $el.data(keys.obj)?{val:$el.data(keys.val)||"",obj:$el.data(keys.obj)||null}:null},_.mixin(Dataset.prototype,EventEmitter,{_overwrite:function overwrite(query,suggestions){(suggestions=suggestions||[]).length?this._renderSuggestions(query,suggestions):this.async&&this.templates.pending?this._renderPending(query):!this.async&&this.templates.notFound?this._renderNotFound(query):this._empty(),this.trigger("rendered",this.name,suggestions,!1)},_append:function append(query,suggestions){(suggestions=suggestions||[]).length&&this.$lastSuggestion.length?this._appendSuggestions(query,suggestions):suggestions.length?this._renderSuggestions(query,suggestions):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(query),this.trigger("rendered",this.name,suggestions,!0)},_renderSuggestions:function renderSuggestions(query,suggestions){var $fragment=this._getSuggestionsFragment(query,suggestions);this.$lastSuggestion=$fragment.children().last(),this.$el.html($fragment).prepend(this._getHeader(query,suggestions)).append(this._getFooter(query,suggestions))},_appendSuggestions:function appendSuggestions($fragment,$lastSuggestion){$fragment=this._getSuggestionsFragment($fragment,$lastSuggestion),$lastSuggestion=$fragment.children().last();this.$lastSuggestion.after($fragment),this.$lastSuggestion=$lastSuggestion},_renderPending:function renderPending(query){var template=this.templates.pending;this._resetLastSuggestion(),template&&this.$el.html(template({query:query,dataset:this.name}))},_renderNotFound:function renderNotFound(query){var template=this.templates.notFound;this._resetLastSuggestion(),template&&this.$el.html(template({query:query,dataset:this.name}))},_empty:function empty(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function getSuggestionsFragment(query,suggestions){var that=this,fragment=document.createDocumentFragment();return _.each(suggestions,function getSuggestionNode($el){var context=that._injectQuery(query,$el),$el=$(that.templates.suggestion(context)).data(keys.obj,$el).data(keys.val,that.displayFn($el)).addClass(that.classes.suggestion+" "+that.classes.selectable);fragment.appendChild($el[0])}),this.highlight&&highlight({className:this.classes.highlight,node:fragment,pattern:query}),$(fragment)},_getFooter:function getFooter(query,suggestions){return this.templates.footer?this.templates.footer({query:query,suggestions:suggestions,dataset:this.name}):null},_getHeader:function getHeader(query,suggestions){return this.templates.header?this.templates.header({query:query,suggestions:suggestions,dataset:this.name}):null},_resetLastSuggestion:function resetLastSuggestion(){this.$lastSuggestion=$()},_injectQuery:function injectQuery(query,obj){return _.isObject(obj)?_.mixin({_query:query},obj):obj},update:function update(query){var that=this,canceled=!1,syncCalled=!1,rendered=0;function sync(suggestions){syncCalled||(syncCalled=!0,suggestions=(suggestions||[]).slice(0,that.limit),rendered=suggestions.length,that._overwrite(query,suggestions),rendered<that.limit&&that.async&&that.trigger("asyncRequested",query))}this.cancel(),this.cancel=function cancel(){canceled=!0,that.cancel=$.noop,that.async&&that.trigger("asyncCanceled",query)},this.source(query,sync,function async(suggestions){suggestions=suggestions||[],!canceled&&rendered<that.limit&&(that.cancel=$.noop,rendered+=suggestions.length,that._append(query,suggestions.slice(0,that.limit-rendered)),that.async&&that.trigger("asyncReceived",query))}),syncCalled||sync([])},cancel:$.noop,clear:function clear(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function isEmpty(){return this.$el.is(":empty")},destroy:function destroy(){this.$el=$("<div>")}}),Dataset}(),Menu=function(){"use strict";function Menu(o,www){var that=this;(o=o||{}).node||$.error("node is required"),www.mixin(this),this.$node=$(o.node),this.query=null,this.datasets=_.map(o.datasets,function initializeDataset(oDataset){var node=that.$node.find(oDataset.node).first();return oDataset.node=node.length?node:$("<div>").appendTo(that.$node),new Dataset(oDataset,www)})}return _.mixin(Menu.prototype,EventEmitter,{_onSelectableClick:function onSelectableClick($e){this.trigger("selectableClicked",$($e.currentTarget))},_onRendered:function onRendered(type,dataset,suggestions,async){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",dataset,suggestions,async)},_onCleared:function onCleared(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function propagate(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function allDatasetsEmpty(){return _.every(this.datasets,function isDatasetEmpty(dataset){return dataset.isEmpty()})},_getSelectables:function getSelectables(){return this.$node.find(this.selectors.selectable)},_removeCursor:function _removeCursor(){var $selectable=this.getActiveSelectable();$selectable&&$selectable.removeClass(this.classes.cursor)},_ensureVisible:function ensureVisible(nodeHeight){var elTop=nodeHeight.position().top,elBottom=elTop+nodeHeight.outerHeight(!0),nodeScrollTop=this.$node.scrollTop(),nodeHeight=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10);elTop<0?this.$node.scrollTop(nodeScrollTop+elTop):nodeHeight<elBottom&&this.$node.scrollTop(nodeScrollTop+(elBottom-nodeHeight))},bind:function(){var that=this,onSelectableClick=_.bind(this._onSelectableClick,this);return this.$node.on("click.tt",this.selectors.selectable,onSelectableClick),_.each(this.datasets,function(dataset){dataset.onSync("asyncRequested",that._propagate,that).onSync("asyncCanceled",that._propagate,that).onSync("asyncReceived",that._propagate,that).onSync("rendered",that._onRendered,that).onSync("cleared",that._onCleared,that)}),this},isOpen:function isOpen(){return this.$node.hasClass(this.classes.open)},open:function open(){this.$node.addClass(this.classes.open)},close:function close(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function setLanguageDirection(dir){this.$node.attr("dir",dir)},selectableRelativeToCursor:function selectableRelativeToCursor(newIndex){var $oldCursor=this.getActiveSelectable(),$selectables=this._getSelectables(),newIndex=($oldCursor?$selectables.index($oldCursor):-1)+newIndex;return-1===(newIndex=(newIndex=(newIndex+1)%($selectables.length+1)-1)<-1?$selectables.length-1:newIndex)?null:$selectables.eq(newIndex)},setCursor:function setCursor($selectable){this._removeCursor(),($selectable=$selectable&&$selectable.first())&&($selectable.addClass(this.classes.cursor),this._ensureVisible($selectable))},getSelectableData:function getSelectableData($el){return $el&&$el.length?Dataset.extractData($el):null},getActiveSelectable:function getActiveSelectable(){var $selectable=this._getSelectables().filter(this.selectors.cursor).first();return $selectable.length?$selectable:null},getTopSelectable:function getTopSelectable(){var $selectable=this._getSelectables().first();return $selectable.length?$selectable:null},update:function update(query){var isValidUpdate=query!==this.query;return isValidUpdate&&(this.query=query,_.each(this.datasets,function updateDataset(dataset){dataset.update(query)})),isValidUpdate},empty:function empty(){_.each(this.datasets,function clearDataset(dataset){dataset.clear()}),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function destroy(){this.$node.off(".tt"),this.$node=$("<div>"),_.each(this.datasets,function destroyDataset(dataset){dataset.destroy()})}}),Menu}(),DefaultMenu=function(){"use strict";var s=Menu.prototype;function DefaultMenu(){Menu.apply(this,[].slice.call(arguments,0))}return _.mixin(DefaultMenu.prototype,Menu.prototype,{open:function open(){return this._allDatasetsEmpty()||this._show(),s.open.apply(this,[].slice.call(arguments,0))},close:function close(){return this._hide(),s.close.apply(this,[].slice.call(arguments,0))},_onRendered:function onRendered(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),s._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function onCleared(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),s._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function setLanguageDirection(dir){return this.$node.css("ltr"===dir?this.css.ltr:this.css.rtl),s.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function hide(){this.$node.hide()},_show:function show(){this.$node.css("display","block")}}),DefaultMenu}(),Typeahead=function(){"use strict";function Typeahead(onWhitespaceChanged,onQueryChanged){var onFocused,onBlurred,onEnterKeyed,onTabKeyed,onEscKeyed,onUpKeyed,onDownKeyed,onLeftKeyed,onRightKeyed;(onWhitespaceChanged=onWhitespaceChanged||{}).input||$.error("missing input"),onWhitespaceChanged.menu||$.error("missing menu"),onWhitespaceChanged.eventBus||$.error("missing event bus"),onQueryChanged.mixin(this),this.eventBus=onWhitespaceChanged.eventBus,this.minLength=_.isNumber(onWhitespaceChanged.minLength)?onWhitespaceChanged.minLength:1,this.input=onWhitespaceChanged.input,this.menu=onWhitespaceChanged.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),onFocused=c(this,"activate","open","_onFocused"),onBlurred=c(this,"deactivate","_onBlurred"),onEnterKeyed=c(this,"isActive","isOpen","_onEnterKeyed"),onTabKeyed=c(this,"isActive","isOpen","_onTabKeyed"),onEscKeyed=c(this,"isActive","_onEscKeyed"),onUpKeyed=c(this,"isActive","open","_onUpKeyed"),onDownKeyed=c(this,"isActive","open","_onDownKeyed"),onLeftKeyed=c(this,"isActive","isOpen","_onLeftKeyed"),onRightKeyed=c(this,"isActive","isOpen","_onRightKeyed"),onQueryChanged=c(this,"_openIfActive","_onQueryChanged"),onWhitespaceChanged=c(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",onFocused,this).onSync("blurred",onBlurred,this).onSync("enterKeyed",onEnterKeyed,this).onSync("tabKeyed",onTabKeyed,this).onSync("escKeyed",onEscKeyed,this).onSync("upKeyed",onUpKeyed,this).onSync("downKeyed",onDownKeyed,this).onSync("leftKeyed",onLeftKeyed,this).onSync("rightKeyed",onRightKeyed,this).onSync("queryChanged",onQueryChanged,this).onSync("whitespaceChanged",onWhitespaceChanged,this).onSync("langDirChanged",this._onLangDirChanged,this)}return _.mixin(Typeahead.prototype,{_hacks:function hacks(){var $input=this.input.$input||$("<div>"),$menu=this.menu.$node||$("<div>");$input.on("blur.tt",function($e){var hasActive=document.activeElement,isActive=$menu.is(hasActive),hasActive=0<$menu.has(hasActive).length;_.isMsie()&&(isActive||hasActive)&&($e.preventDefault(),$e.stopImmediatePropagation(),_.defer(function(){$input.focus()}))}),$menu.on("mousedown.tt",function($e){$e.preventDefault()})},_onSelectableClicked:function onSelectableClicked(type,$el){this.select($el)},_onDatasetCleared:function onDatasetCleared(){this._updateHint()},_onDatasetRendered:function onDatasetRendered(type,dataset,suggestions,async){this._updateHint(),this.eventBus.trigger("render",suggestions,async,dataset)},_onAsyncRequested:function onAsyncRequested(type,dataset,query){this.eventBus.trigger("asyncrequest",query,dataset)},_onAsyncCanceled:function onAsyncCanceled(type,dataset,query){this.eventBus.trigger("asynccancel",query,dataset)},_onAsyncReceived:function onAsyncReceived(type,dataset,query){this.eventBus.trigger("asyncreceive",query,dataset)},_onFocused:function onFocused(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function onBlurred(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function onEnterKeyed(type,$e){var $selectable;($selectable=this.menu.getActiveSelectable())&&this.select($selectable)&&$e.preventDefault()},_onTabKeyed:function onTabKeyed(type,$e){var $selectable;($selectable=this.menu.getActiveSelectable())?this.select($selectable)&&$e.preventDefault():($selectable=this.menu.getTopSelectable())&&this.autocomplete($selectable)&&$e.preventDefault()},_onEscKeyed:function onEscKeyed(){this.close()},_onUpKeyed:function onUpKeyed(){this.moveCursor(-1)},_onDownKeyed:function onDownKeyed(){this.moveCursor(1)},_onLeftKeyed:function onLeftKeyed(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function onRightKeyed(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function onQueryChanged(e,query){this._minLengthMet(query)?this.menu.update(query):this.menu.empty()},_onWhitespaceChanged:function onWhitespaceChanged(){this._updateHint()},_onLangDirChanged:function onLangDirChanged(e,dir){this.dir!==dir&&(this.dir=dir,this.menu.setLanguageDirection(dir))},_openIfActive:function openIfActive(){this.isActive()&&this.open()},_minLengthMet:function minLengthMet(query){return(query=_.isString(query)?query:this.input.getQuery()||"").length>=this.minLength},_updateHint:function updateHint(){var escapedQuery=this.menu.getTopSelectable(),match=this.menu.getSelectableData(escapedQuery),val=this.input.getInputValue();!match||_.isBlankString(val)||this.input.hasOverflow()?this.input.clearHint():(escapedQuery=Input.normalizeQuery(val),escapedQuery=_.escapeRegExChars(escapedQuery),(match=new RegExp("^(?:"+escapedQuery+")(.+$)","i").exec(match.val))&&this.input.setHint(val+match[1]))},isEnabled:function isEnabled(){return this.enabled},enable:function enable(){this.enabled=!0},disable:function disable(){this.enabled=!1},isActive:function isActive(){return this.active},activate:function activate(){return!!this.isActive()||!(!this.isEnabled()||this.eventBus.before("active"))&&(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function deactivate(){return!this.isActive()||!this.eventBus.before("idle")&&(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0)},isOpen:function isOpen(){return this.menu.isOpen()},open:function open(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function close(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function setVal(val){this.input.setQuery(_.toStr(val))},getVal:function getVal(){return this.input.getQuery()},select:function select(data){data=this.menu.getSelectableData(data);return!(!data||this.eventBus.before("select",data.obj))&&(this.input.setQuery(data.val,!0),this.eventBus.trigger("select",data.obj),this.close(),!0)},autocomplete:function autocomplete(data){var query=this.input.getQuery(),data=this.menu.getSelectableData(data);return!(!(data&&query!==data.val)||this.eventBus.before("autocomplete",data.obj))&&(this.input.setQuery(data.val),this.eventBus.trigger("autocomplete",data.obj),!0)},moveCursor:function moveCursor(payload){var query=this.input.getQuery(),$candidate=this.menu.selectableRelativeToCursor(payload),data=this.menu.getSelectableData($candidate),payload=data?data.obj:null;return!(this._minLengthMet()&&this.menu.update(query))&&!this.eventBus.before("cursorchange",payload)&&(this.menu.setCursor($candidate),data?this.input.setInputValue(data.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",payload),!0)},destroy:function destroy(){this.input.destroy(),this.menu.destroy()}}),Typeahead;function c(ctx){var methods=[].slice.call(arguments,1);return function(){var args=[].slice.call(arguments);_.each(methods,function(method){return ctx[method].apply(ctx,args)})}}}();!function(){"use strict";var old,keys,methods;function ttEach($els,fn){$els.each(function(){var typeahead,$input=$(this);(typeahead=$input.data(keys.typeahead))&&fn(typeahead,$input)})}function $elOrNull($el){$el=_.isJQuery($el)||_.isElement($el)?$($el).first():[];return $el.length?$el:null}old=$.fn.typeahead,keys={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},methods={initialize:function initialize(o,datasets){var www;return datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1),www=WWW((o=o||{}).classNames),this.each(function attach(){var $input,$wrapper,input,menu,typeahead,MenuConstructor;_.each(datasets,function(d){d.highlight=!!o.highlight}),$input=$(this),$wrapper=$(www.html.wrapper),input=$elOrNull(o.hint),menu=$elOrNull(o.menu),MenuConstructor=!1!==o.hint&&!input,typeahead=!1!==o.menu&&!menu,MenuConstructor&&(input=function buildHintFromInput($input,www){return $input.clone().addClass(www.classes.hint).removeData().css(www.css.hint).css(function getBackgroundStyles($el){return{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}}($input)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}($input,www)),typeahead&&(menu=$(www.html.menu).css(www.css.menu)),input&&input.val(""),$input=function prepInput($input,www){$input.data(keys.attrs,{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")}),$input.addClass(www.classes.input).attr({autocomplete:"off",spellcheck:!1});try{$input.attr("dir")||$input.attr("dir","auto")}catch(e){}return $input}($input,www),(MenuConstructor||typeahead)&&($wrapper.css(www.css.wrapper),$input.css(MenuConstructor?www.css.input:www.css.inputWithNoHint),$input.wrap($wrapper).parent().prepend(MenuConstructor?input:null).append(typeahead?menu:null));MenuConstructor=typeahead?DefaultMenu:Menu,typeahead=new EventBus({el:$input}),input=new Input({hint:input,input:$input},www),menu=new MenuConstructor({node:menu,datasets:datasets},www),typeahead=new Typeahead({input:input,menu:menu,eventBus:typeahead,minLength:o.minLength},www),$input.data(keys.www,www),$input.data(keys.typeahead,typeahead)})},isEnabled:function isEnabled(){var enabled;return ttEach(this.first(),function(t){enabled=t.isEnabled()}),enabled},enable:function enable(){return ttEach(this,function(t){t.enable()}),this},disable:function disable(){return ttEach(this,function(t){t.disable()}),this},isActive:function isActive(){var active;return ttEach(this.first(),function(t){active=t.isActive()}),active},activate:function activate(){return ttEach(this,function(t){t.activate()}),this},deactivate:function deactivate(){return ttEach(this,function(t){t.deactivate()}),this},isOpen:function isOpen(){var open;return ttEach(this.first(),function(t){open=t.isOpen()}),open},open:function open(){return ttEach(this,function(t){t.open()}),this},close:function close(){return ttEach(this,function(t){t.close()}),this},select:function select(el){var success=!1,$el=$(el);return ttEach(this.first(),function(t){success=t.select($el)}),success},autocomplete:function autocomplete(el){var success=!1,$el=$(el);return ttEach(this.first(),function(t){success=t.autocomplete($el)}),success},moveCursor:function moveCursoe(delta){var success=!1;return ttEach(this.first(),function(t){success=t.moveCursor(delta)}),success},val:function val(newVal){var query;return arguments.length?(ttEach(this,function(t){t.setVal(newVal)}),this):(ttEach(this.first(),function(t){query=t.getVal()}),query)},destroy:function destroy(){return ttEach(this,function(typeahead,$input){!function revert($input){var www,$wrapper;www=$input.data(keys.www),$wrapper=$input.parent().filter(www.selectors.wrapper),_.each($input.data(keys.attrs),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)}),$input.removeData(keys.typeahead).removeData(keys.www).removeData(keys.attr).removeClass(www.classes.input),$wrapper.length&&($input.detach().insertAfter($wrapper),$wrapper.remove())}($input),typeahead.destroy()}),this}},$.fn.typeahead=function(method){return methods[method]?methods[method].apply(this,[].slice.call(arguments,1)):methods.initialize.apply(this,arguments)},$.fn.typeahead.noConflict=function noConflict(){return $.fn.typeahead=old,this}}()}),define("typeahead",["jquery"],function(global){return function(){return function($){return require.s.contexts._.registry["typeahead.js"].factory($)}.apply(global,arguments)}}(this)),define("search",["jquery","config","utils","bloodhound","typeahead","chat"],function($,config,utils,Bloodhound,chat){!function($){var methods={_init:function(options){return options=options||{},this.each(function(){var elem=$(this),files=new Bloodhound({name:"files",remote:{url:config.http.locations.swish_typeahead+"?set=file&q=%QUERY",wildcard:"%QUERY"},datumTokenizer:function fileTokenizer(f){return(f.tags||[]).push(f.name)},queryTokenizer:Bloodhound.tokenizers.whitespace});files.initialize();var storeContent=new Bloodhound({name:"store_content",limit:20,cache:!1,remote:{url:config.http.locations.swish_typeahead+"?set=store_content&q=%QUERY",replace:bloodHoundURLAuth},datumTokenizer:sourceLineTokenizer,queryTokenizer:Bloodhound.tokenizers.whitespace});storeContent.initialize();var currentFile=null,currentAlias=null;var sourceRE,sources=new Bloodhound({name:"source",limit:15,cache:!1,query_cache_length:1,remote:{url:config.http.locations.swish_typeahead+"?set=sources&q=%QUERY",replace:bloodHoundURL},datumTokenizer:sourceLineTokenizer,queryTokenizer:Bloodhound.tokenizers.whitespace});function sourceLineTokenizer(hit){return Bloodhound.tokenizers.whitespace(hit.text)}function renderSourceMatch(hit){var i,text=hit.text;return 80<(text=20<(i=text.search(sourceRE))?"..."+text.slice(i-17):text).length&&(text=text.substring(0,80)),'<div class="tt-match source"><span class="tt-line"><span class="tt-lineno">'+hit.line+'</span><span class="tt-text">'+utils.htmlEncode(text)+"</span></span></div>"}sources.initialize();var users=new Bloodhound({name:"users",limit:20,cache:!1,remote:{url:config.http.locations.swish_typeahead+"?set=user&q=%QUERY",replace:bloodHoundURL},datumTokenizer:sourceLineTokenizer,queryTokenizer:Bloodhound.tokenizers.whitespace});users.initialize();var typeaheadProperties={source:{name:"source",display:"text",source:function sourceMatcher(q,cb){if(q.length<2)return[];var matches=[],re=new RegExp("\\b"+q,"g");sourceRE=re,$(".prolog-editor").each(function(){for(var m=$(this).prologEditor("search",re,{max:7}),i=0;i<m.length;i++)m[i].editor=this,m[i].regex=sourceRE,matches.push(m[i])}),cb(matches)},templates:{suggestion:renderSourceMatch}},sources:{name:"sources",display:"file",source:sources.ttAdapter(),templates:{suggestion:function renderSourceLine(hit){var str="";return hit.file==currentFile&&hit.alias==currentAlias||(currentFile=hit.file,currentAlias=hit.alias,str='<div class="tt-file-header type-icon '+hit.ext+'"><span class="tt-path-alias">'+utils.htmlEncode(hit.alias)+'</span>(<span class="tt-path-file">'+utils.htmlEncode(hit.file)+")</span></div>"),hit.text&&(str+=renderSourceMatch(hit)),str}},limit:15},files:{name:"files",display:"name",source:files.ttAdapter(),templates:{suggestion:function renderFile(f){var str='<div class="tt-match file type-icon '+function filetype(file){return file.split(".").pop()}(f.name)+'"><span class="tt-label">'+utils.htmlEncode(function filebase(file){return file.split(".").slice(0,-1).join(".")}(f.name));if(f.tags){str+='<span class="tt-tags">';for(var i=0;i<f.tags.length;i++){var tag=f.tags[i];str+='<span class="tt-tag">'+utils.htmlEncode(tag)+"</span>"}str+="</span>"}return f.title&&(str+='<div class="tt-title file">'+utils.htmlEncode(f.title)+"</div>"),str+="</div>"}}},store_content:{name:"store_content",display:"file",source:storeContent.ttAdapter(),templates:{suggestion:function renderStoreSourceLine(hit){var ext,str="";return hit.file==currentFile&&hit.alias==currentAlias||(ext=hit.file.split(".").pop(),currentFile=hit.file,currentAlias=hit.alias,str='<div class="tt-file-header type-icon '+ext+'"><span class="tt-path-file">'+utils.htmlEncode(hit.file)+"</span></div>"),str+renderSourceMatch(hit)}}},predicates:{name:"predicates",display:function(p){return p.name+"/"+p.arity},source:function predicateMatcher(q,cb){for(var templates=config.swish.templates,matches=[],ql=q.split(" "),pl=[],i=0;i<ql.length;i++)pl.push({prefix:ql[i],regex:new RegExp("_"+ql[i])});for(i=0;i<templates.length;i++){var templ=templates[i];if(void 0!==templ.arity){for(var j=0,match=!0;j<pl.length&&match;j++)templ.name.startsWith(pl[j].prefix)||templ.name.match(pl[j].regex)||(match=!1);match&&matches.push(templ)}}cb(matches)},templates:{suggestion:function renderPredicate(p){var str='<div class="tt-match predicate';return p.type&&(str+=" "+p.type),p.mode&&(str+='" title="'+p.mode),str+='"><span class="tt-label">'+utils.htmlEncode(p.name)+"/"+p.arity+"</span>",p.iso&&(str+='<span class="tt-tags">',p.iso&&(str+='<span class="tt-tag">ISO</span>'),str+="</span>"),p.summary&&(str+='<div class="tt-title file">'+utils.htmlEncode(p.summary)+"</div>"),str+="</div>",str+="</div>"}}},users:{name:"users",display:"name",source:users.ttAdapter(),templates:{suggestion:function renderUser(hit){return'<div class="tt-match user">'+function avatar(hit){return hit.avatar?'<img class="avatar" src="'+encodeURI(hit.avatar)+'">':""}(hit)+'<span class="tt-label">'+utils.htmlEncode(hit.name)+"</span></div>"}}}},of=typeaheadProperties.sources.source;typeaheadProperties.sources.source=function(q,cb){return currentAlias=currentFile=null,sourceRE=new RegExp(RegExp.escape(q)),of(q,cb)},elem.typeahead({minLength:2,highlight:!0},function ttSources(from){for(var sources=[],src=from.replace(/\s+/g," ").split(" "),i=0;i<src.length;i++)sources.push(typeaheadProperties[src[i]]);return sources}(elem.data("search-in"))).on("typeahead:selected typeahead:autocompleted",function(ev,datum){var play;0==options.search?elem.data("json-value",datum):"store"==datum.type?(datum.query&&(datum.regex=new RegExp(RegExp.escape(datum.query),"g"),datum.showAllMatches=!0),$(ev.target).closest(".swish").swish("playFile",datum)):void 0!==datum.arity?$(".swish-event-receiver").trigger("pldoc",datum):void 0!==datum.editor&&void 0!==datum.line?$(datum.editor).prologEditor("gotoLine",datum.line,{regex:datum.regex,showAllMatches:!0}):void 0!==datum.alias?(play={url:encodeURI("/"+datum.alias+"/"+datum.file+"."+datum.ext),line:datum.line},datum.query&&(play.regex=new RegExp(RegExp.escape(datum.query),"g"),play.showAllMatches=!0),$(ev.target).closest(".swish").swish("playURL",play)):(elem.data("json-value",datum),console.log(elem.data("json-value")))}),0!=options.search&&elem.closest("form").submit(function(ev){var data=elem.data("json-value"),str=elem.val();return data&&data.datum&&data.datum.label==str||(data=str),elem.val(""),elem.data("json-value",null),elem.search("search",data),!1})})},search:function(q){alert("Full search not yet implemented\nPlease select from auto completion list")}};function bloodHoundURL(url,match){url=url.replace("%QUERY",encodeURIComponent(match)),match=$("label.active > input[name=smatch]").val();return match&&(url+="&match="+match),url}function bloodHoundURLAuth(url,profile){url=url.replace("%QUERY",encodeURIComponent(profile)),profile=$("label.active > input[name=smatch]").val();profile&&(url+="&match="+profile);profile=$("#login").login("get_profile",["display_name","avatar"]);return profile.avatar&&(url+="&avatar="+encodeURIComponent(profile.avatar)),profile.display_name&&(url+="&display_name="+encodeURIComponent(profile.display_name)),url}$.fn.search=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.search"):methods._init.apply(this,arguments)}}(jQuery),RegExp.escape=function(string){return string.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("cm/lib/codemirror",factory):global.CodeMirror=factory()}(this,function(){"use strict";var ContentEditableInput=navigator.userAgent,platform=navigator.platform,gecko=/gecko\/\d/i.test(ContentEditableInput),ie_upto10=/MSIE \d/.test(ContentEditableInput),TextareaInput=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ContentEditableInput),edge=/Edge\/(\d+)/.exec(ContentEditableInput),ie=ie_upto10||TextareaInput||edge,ie_version=ie&&(ie_upto10?document.documentMode||6:+(edge||TextareaInput)[1]),webkit=!edge&&/WebKit\//.test(ContentEditableInput),TextareaInput=webkit&&/Qt\/\d+\.\d+/.test(ContentEditableInput),chrome=!edge&&/Chrome\//.test(ContentEditableInput),presto=/Opera\//.test(ContentEditableInput),safari=/Apple Computer/.test(navigator.vendor),mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ContentEditableInput),phantom=/PhantomJS/.test(ContentEditableInput),ios=!edge&&/AppleWebKit/.test(ContentEditableInput)&&/Mobile\/\w+/.test(ContentEditableInput),android=/Android/.test(ContentEditableInput),mobile=ios||android||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ContentEditableInput),mac=ios||/Mac/.test(platform),chromeOS=/\bCrOS\b/.test(ContentEditableInput),windows=/win/i.test(platform),ContentEditableInput=presto&&ContentEditableInput.match(/Version\/(\d*\.\d*)/);(ContentEditableInput=ContentEditableInput&&Number(ContentEditableInput[1]))&&15<=ContentEditableInput&&(webkit=!(presto=!1));var flipCtrlCmd=mac&&(TextareaInput||presto&&(null==ContentEditableInput||ContentEditableInput<12.11)),captureRightClick=gecko||ie&&9<=ie_version;function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*")}var rmClass=function(node,after){var current=node.className,match=classTest(after).exec(current);match&&(after=current.slice(match.index+match[0].length),node.className=current.slice(0,match.index)+(after?match[1]+after:""))};function removeChildren(e){for(var count=e.childNodes.length;0<count;--count)e.removeChild(e.firstChild);return e}function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}function elt(tag,content,className,style){var e=document.createElement(tag);if(className&&(e.className=className),style&&(e.style.cssText=style),"string"==typeof content)e.appendChild(document.createTextNode(content));else if(content)for(var i=0;i<content.length;++i)e.appendChild(content[i]);return e}function eltP(tag,content,className,e){e=elt(tag,content,className,e);return e.setAttribute("role","presentation"),e}function contains(parent,child){if(3==child.nodeType&&(child=child.parentNode),parent.contains)return parent.contains(child);do{if((child=11==child.nodeType?child.host:child)==parent)return!0}while(child=child.parentNode)}function activeElt(){var activeElement;try{activeElement=document.activeElement}catch(e){activeElement=document.body||null}for(;activeElement&&activeElement.shadowRoot&&activeElement.shadowRoot.activeElement;)activeElement=activeElement.shadowRoot.activeElement;return activeElement}function addClass(node,cls){var current=node.className;classTest(cls).test(current)||(node.className+=(current?" ":"")+cls)}function joinClasses(a,b){for(var as=a.split(" "),i=0;i<as.length;i++)as[i]&&!classTest(as[i]).test(b)&&(b+=" "+as[i]);return b}var range=document.createRange?function(node,start,end,endNode){var r=document.createRange();return r.setEnd(endNode||node,end),r.setStart(node,start),r}:function(node,start,end){var r=document.body.createTextRange();try{r.moveToElementText(node.parentNode)}catch(e){return r}return r.collapse(!0),r.moveEnd("character",end),r.moveStart("character",start),r},selectInput=function(node){node.select()};function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}function copyObj(obj,target,overwrite){for(var prop in target=target||{},obj)!obj.hasOwnProperty(prop)||!1===overwrite&&target.hasOwnProperty(prop)||(target[prop]=obj[prop]);return target}function countColumn(string,end,tabSize,startIndex,startValue){null==end&&-1==(end=string.search(/[^\s\u00a0]/))&&(end=string.length);for(var i=startIndex||0,n=startValue||0;;){var nextTab=string.indexOf("\t",i);if(nextTab<0||end<=nextTab)return n+(end-i);n+=nextTab-i,n+=tabSize-n%tabSize,i=nextTab+1}}ios?selectInput=function(node){node.selectionStart=0,node.selectionEnd=node.value.length}:ie&&(selectInput=function(node){try{node.select()}catch(_e){}});var Delayed=function(){this.id=null,this.f=null,this.time=0,this.handler=bind(this.onTimeout,this)};function indexOf(array,elt){for(var i=0;i<array.length;++i)if(array[i]==elt)return i;return-1}Delayed.prototype.onTimeout=function(self){self.id=0,self.time<=+new Date?self.f():setTimeout(self.handler,self.time-+new Date)},Delayed.prototype.set=function(ms,time){this.f=time;time=+new Date+ms;(!this.id||time<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,ms),this.time=time)};var scrollerGap=30,Pass={toString:function(){return"CodeMirror.Pass"}},sel_dontScroll={scroll:!1},sel_mouse={origin:"*mouse"},sel_move={origin:"+move"};function findColumn(string,goal,tabSize){for(var pos=0,col=0;;){var nextTab=string.indexOf("\t",pos),skipped=(nextTab=-1==nextTab?string.length:nextTab)-pos;if(nextTab==string.length||goal<=col+skipped)return pos+Math.min(skipped,goal-col);if(col+=nextTab-pos,pos=nextTab+1,goal<=(col+=tabSize-col%tabSize))return pos}}var spaceStrs=[""];function spaceStr(n){for(;spaceStrs.length<=n;)spaceStrs.push(lst(spaceStrs)+" ");return spaceStrs[n]}function lst(arr){return arr[arr.length-1]}function map(array,f){for(var out=[],i=0;i<array.length;i++)out[i]=f(array[i],i);return out}function nothing(){}function createObj(inst,props){inst=Object.create?Object.create(inst):(nothing.prototype=inst,new nothing);return props&&copyObj(props,inst),inst}var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(ch){return/\w/.test(ch)||"Â"<ch&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function isWordChar(ch,helper){return helper?!!(-1<helper.source.indexOf("\\w")&&isWordCharBasic(ch))||helper.test(ch):isWordCharBasic(ch)}function isEmpty(obj){for(var n in obj)if(obj.hasOwnProperty(n)&&obj[n])return;return 1}var extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(ch){return 768<=ch.charCodeAt(0)&&extendingChars.test(ch)}function skipExtendingChars(str,pos,dir){for(;(dir<0?0<pos:pos<str.length)&&isExtendingChar(str.charAt(pos));)pos+=dir;return pos}function findFirst(pred,from,to){for(var dir=to<from?-1:1;;){if(from==to)return from;var mid=(from+to)/2,mid=dir<0?Math.ceil(mid):Math.floor(mid);if(mid==from)return pred(mid)?from:to;pred(mid)?to=mid:from=mid+dir}}var bidiOther=null;function getBidiPartAt(order,ch,sticky){var found;bidiOther=null;for(var i=0;i<order.length;++i){var cur=order[i];if(cur.from<ch&&cur.to>ch)return i;cur.to==ch&&(cur.from!=cur.to&&"before"==sticky?found=i:bidiOther=i),cur.from==ch&&(cur.from!=cur.to&&"before"!=sticky?found=i:bidiOther=i)}return null!=found?found:bidiOther}var lowTypes,arabicTypes,bidiRE,isNeutral,isStrong,countsAsLeft,countsAsNum,bidiOrdering=(lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",arabicTypes="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/,function(str,direction){var outerType="ltr"==direction?"L":"R";if(0==str.length||"ltr"==direction&&!bidiRE.test(str))return!1;for(var len=str.length,types=[],i=0;i<len;++i)types.push(function charType(code){return code<=247?lowTypes.charAt(code):1424<=code&&code<=1524?"R":1536<=code&&code<=1785?arabicTypes.charAt(code-1536):1774<=code&&code<=2220?"r":8192<=code&&code<=8203?"w":8204==code?"b":"L"}(str.charCodeAt(i)));for(var i$1=0,prev=outerType;i$1<len;++i$1){var type=types[i$1];"m"==type?types[i$1]=prev:prev=type}for(var i$2=0,cur=outerType;i$2<len;++i$2){var type$1=types[i$2];"1"==type$1&&"r"==cur?types[i$2]="n":isStrong.test(type$1)&&"r"==(cur=type$1)&&(types[i$2]="R")}for(var i$3=1,prev$1=types[0];i$3<len-1;++i$3){var type$2=types[i$3];"+"==type$2&&"1"==prev$1&&"1"==types[i$3+1]?types[i$3]="1":","!=type$2||prev$1!=types[i$3+1]||"1"!=prev$1&&"n"!=prev$1||(types[i$3]=prev$1),prev$1=type$2}for(var i$4=0;i$4<len;++i$4){var type$3=types[i$4];if(","==type$3)types[i$4]="N";else if("%"==type$3){for(var end=void 0,end=i$4+1;end<len&&"%"==types[end];++end);for(var replace=i$4&&"!"==types[i$4-1]||end<len&&"1"==types[end]?"1":"N",j=i$4;j<end;++j)types[j]=replace;i$4=end-1}}for(var i$5=0,cur$1=outerType;i$5<len;++i$5){var type$4=types[i$5];"L"==cur$1&&"1"==type$4?types[i$5]="L":isStrong.test(type$4)&&(cur$1=type$4)}for(var i$6=0;i$6<len;++i$6)if(isNeutral.test(types[i$6])){for(var end$1=void 0,end$1=i$6+1;end$1<len&&isNeutral.test(types[end$1]);++end$1);for(var before="L"==(i$6?types[i$6-1]:outerType),replace$1=before==("L"==(end$1<len?types[end$1]:outerType))?before?"L":"R":outerType,j$1=i$6;j$1<end$1;++j$1)types[j$1]=replace$1;i$6=end$1-1}for(var m,order=[],i$7=0;i$7<len;)if(countsAsLeft.test(types[i$7])){var start=i$7;for(++i$7;i$7<len&&countsAsLeft.test(types[i$7]);++i$7);order.push(new BidiSpan(0,start,i$7))}else{var pos=i$7,at=order.length;for(++i$7;i$7<len&&"L"!=types[i$7];++i$7);for(var j$2=pos;j$2<i$7;)if(countsAsNum.test(types[j$2])){pos<j$2&&order.splice(at,0,new BidiSpan(1,pos,j$2));var nstart=j$2;for(++j$2;j$2<i$7&&countsAsNum.test(types[j$2]);++j$2);order.splice(at,0,new BidiSpan(2,nstart,j$2)),pos=j$2}else++j$2;pos<i$7&&order.splice(at,0,new BidiSpan(1,pos,i$7))}return"ltr"==direction&&(1==order[0].level&&(m=str.match(/^\s+/))&&(order[0].from=m[0].length,order.unshift(new BidiSpan(0,0,m[0].length))),1==lst(order).level&&(m=str.match(/\s+$/))&&(lst(order).to-=m[0].length,order.push(new BidiSpan(0,len-m[0].length,len)))),"rtl"==direction?order.reverse():order});function BidiSpan(level,from,to){this.level=level,this.from=from,this.to=to}function getOrder(line,direction){var order=line.order;return order=null==order?line.order=bidiOrdering(line.text,direction):order}var noHandlers=[],on=function(map$$1,type,f){map$$1.addEventListener?map$$1.addEventListener(type,f,!1):map$$1.attachEvent?map$$1.attachEvent("on"+type,f):(map$$1=map$$1._handlers||(map$$1._handlers={}))[type]=(map$$1[type]||noHandlers).concat(f)};function getHandlers(emitter,type){return emitter._handlers&&emitter._handlers[type]||noHandlers}function off(arr,type,index){var map$$1;arr.removeEventListener?arr.removeEventListener(type,index,!1):arr.detachEvent?arr.detachEvent("on"+type,index):!(arr=(map$$1=arr._handlers)&&map$$1[type])||-1<(index=indexOf(arr,index))&&(map$$1[type]=arr.slice(0,index).concat(arr.slice(index+1)))}function signal(emitter,type){var handlers=getHandlers(emitter,type);if(handlers.length)for(var args=Array.prototype.slice.call(arguments,2),i=0;i<handlers.length;++i)handlers[i].apply(null,args)}function signalDOMEvent(cm,e,override){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),signal(cm,override||e.type,cm,e),e_defaultPrevented(e)||e.codemirrorIgnore}function signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity;if(arr)for(var set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[]),i=0;i<arr.length;++i)-1==indexOf(set,arr[i])&&set.push(arr[i])}function hasHandler(emitter,type){return 0<getHandlers(emitter,type).length}function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f)},ctor.prototype.off=function(type,f){off(this,type,f)}}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_defaultPrevented(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){var b=e.which;return null==b&&(1&e.button?b=1:2&e.button?b=3:4&e.button&&(b=2)),b=mac&&e.ctrlKey&&1==b?3:b}var zwspSupported,badBidiRects,dragAndDrop=function(){if(ie&&ie_version<9)return!1;var div=elt("div");return"draggable"in div||"dragDrop"in div}();var splitLinesAuto=3!="\n\nb".split(/\n/).length?function(string){for(var pos=0,result=[],l=string.length;pos<=l;){var nl=string.indexOf("\n",pos);-1==nl&&(nl=string.length);var line=string.slice(pos,"\r"==string.charAt(nl-1)?nl-1:nl),rt=line.indexOf("\r");-1!=rt?(result.push(line.slice(0,rt)),pos+=rt+1):(result.push(line),pos=nl+1)}return result}:function(string){return string.split(/\r\n?|\n/)},hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}catch(e){return!1}}:function(te){var range$$1;try{range$$1=te.ownerDocument.selection.createRange()}catch(e){}return!(!range$$1||range$$1.parentElement()!=te)&&0!=range$$1.compareEndPoints("StartToEnd",range$$1)},hasCopyEvent="oncopy"in(TextareaInput=elt("div"))||(TextareaInput.setAttribute("oncopy","return;"),"function"==typeof TextareaInput.oncopy),badZoomedRects=null;var modes={},mimeModes={};function resolveMode(spec){if("string"==typeof spec&&mimeModes.hasOwnProperty(spec))spec=mimeModes[spec];else if(spec&&"string"==typeof spec.name&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];(spec=createObj(found="string"==typeof found?{name:found}:found,spec)).name=found.name}else{if("string"==typeof spec&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec))return resolveMode("application/xml");if("string"==typeof spec&&/^[\w\-]+\/[\w\-]+\+json$/.test(spec))return resolveMode("application/json")}return"string"==typeof spec?{name:spec}:spec||{name:"null"}}function getMode(options,spec){spec=resolveMode(spec);var mfactory=modes[spec.name];if(!mfactory)return getMode(options,"text/plain");var modeObj=mfactory(options,spec);if(modeExtensions.hasOwnProperty(spec.name)){var prop,exts=modeExtensions[spec.name];for(prop in exts)exts.hasOwnProperty(prop)&&(modeObj.hasOwnProperty(prop)&&(modeObj["_"+prop]=modeObj[prop]),modeObj[prop]=exts[prop])}if(modeObj.name=spec.name,spec.helperType&&(modeObj.helperType=spec.helperType),spec.modeProps)for(var prop$1 in spec.modeProps)modeObj[prop$1]=spec.modeProps[prop$1];return modeObj}var modeExtensions={};function extendMode(mode,properties){copyObj(properties,modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:modeExtensions[mode]={})}function copyState(mode,state){if(!0===state)return state;if(mode.copyState)return mode.copyState(state);var n,nstate={};for(n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}function innerMode(mode,state){for(var info;mode.innerMode&&(info=mode.innerMode(state))&&info.mode!=mode;)state=info.state,mode=info.mode;return info||{mode:mode,state:state}}function startState(mode,a1,a2){return!mode.startState||mode.startState(a1,a2)}var StringStream=function(string,tabSize,lineOracle){this.pos=this.start=0,this.string=string,this.tabSize=tabSize||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=lineOracle};function getLine(doc,n){if((n-=doc.first)<0||n>=doc.size)throw new Error("There is no line "+(n+doc.first)+" in the document.");for(var chunk=doc;!chunk.lines;)for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}return chunk.lines[n]}function getBetween(doc,start,end){var out=[],n=start.line;return doc.iter(start.line,end.line+1,function(text){text=text.text;n==end.line&&(text=text.slice(0,end.ch)),n==start.line&&(text=text.slice(start.ch)),out.push(text),++n}),out}function getLines(doc,from,to){var out=[];return doc.iter(from,to,function(line){out.push(line.text)}),out}function updateLineHeight(line,height){var diff=height-line.height;if(diff)for(var n=line;n;n=n.parent)n.height+=diff}function lineNo(line){if(null==line.parent)return null;for(var cur=line.parent,no=indexOf(cur.lines,line),chunk=cur.parent;chunk;chunk=(cur=chunk).parent)for(var i=0;chunk.children[i]!=cur;++i)no+=chunk.children[i].chunkSize();return no+cur.first}function lineAtHeight(chunk,h){var n=chunk.first;outer:do{for(var i$1=0;i$1<chunk.children.length;++i$1){var child=chunk.children[i$1],ch=child.height;if(h<ch){chunk=child;continue outer}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0;i<chunk.lines.length;++i){var lh=chunk.lines[i].height;if(h<lh)break;h-=lh}return n+i}function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}function lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber))}function Pos(line,ch,sticky){if(void 0===sticky&&(sticky=null),!(this instanceof Pos))return new Pos(line,ch,sticky);this.line=line,this.ch=ch,this.sticky=sticky}function cmp(a,b){return a.line-b.line||a.ch-b.ch}function equalCursorPos(a,b){return a.sticky==b.sticky&&0==cmp(a,b)}function copyPos(x){return Pos(x.line,x.ch)}function maxPos(a,b){return cmp(a,b)<0?b:a}function minPos(a,b){return cmp(a,b)<0?a:b}function clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1))}function clipPos(doc,pos){if(pos.line<doc.first)return Pos(doc.first,0);var last=doc.first+doc.size-1;return pos.line>last?Pos(last,getLine(doc,last).text.length):function clipToLen(pos,linelen){var ch=pos.ch;return null==ch||linelen<ch?Pos(pos.line,linelen):ch<0?Pos(pos.line,0):pos}(pos,getLine(doc,pos.line).text.length)}function clipPosArray(doc,array){for(var out=[],i=0;i<array.length;i++)out[i]=clipPos(doc,array[i]);return out}StringStream.prototype.eol=function(){return this.pos>=this.string.length},StringStream.prototype.sol=function(){return this.pos==this.lineStart},StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},StringStream.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},StringStream.prototype.eat=function(ok){var ch=this.string.charAt(this.pos),ok="string"==typeof ok?ch==ok:ch&&(ok.test?ok.test(ch):ok(ch));if(ok)return++this.pos,ch},StringStream.prototype.eatWhile=function(match){for(var start=this.pos;this.eat(match););return this.pos>start},StringStream.prototype.eatSpace=function(){for(var start=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>start},StringStream.prototype.skipToEnd=function(){this.pos=this.string.length},StringStream.prototype.skipTo=function(found){found=this.string.indexOf(found,this.pos);if(-1<found)return this.pos=found,!0},StringStream.prototype.backUp=function(n){this.pos-=n},StringStream.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.match=function(pattern,consume,caseInsensitive){if("string"!=typeof pattern){var cased=this.string.slice(this.pos).match(pattern);return cased&&0<cased.index?null:(cased&&!1!==consume&&(this.pos+=cased[0].length),cased)}cased=function(str){return caseInsensitive?str.toLowerCase():str};if(cased(this.string.substr(this.pos,pattern.length))==cased(pattern))return!1!==consume&&(this.pos+=pattern.length),!0},StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)},StringStream.prototype.hideFirstChars=function(n,inner){this.lineStart+=n;try{return inner()}finally{this.lineStart-=n}},StringStream.prototype.lookAhead=function(n){var oracle=this.lineOracle;return oracle&&oracle.lookAhead(n)},StringStream.prototype.baseToken=function(){var oracle=this.lineOracle;return oracle&&oracle.baseToken(this.pos)};var SavedContext=function(state,lookAhead){this.state=state,this.lookAhead=lookAhead},Context=function(doc,state,line,lookAhead){this.state=state,this.doc=doc,this.line=line,this.maxLookAhead=lookAhead||0,this.baseTokens=null,this.baseTokenPos=1};function highlightLine(cm,line,context,forceToEnd){var st=[cm.state.modeGen],lineClasses={};runMode(cm,line.text,cm.doc.mode,context,function(end,style){return st.push(end,style)},lineClasses,forceToEnd);for(var state=context.state,o=0;o<cm.state.overlays.length;++o)!function(o){context.baseTokens=st;var overlay=cm.state.overlays[o],i=1,at=0;context.state=!0,runMode(cm,line.text,overlay.mode,context,function(end,style){for(var start=i;at<end;){var i_end=st[i];end<i_end&&st.splice(i,1,end,st[i+1],i_end),i+=2,at=Math.min(end,i_end)}if(style)if(overlay.opaque)st.splice(start,i-start,end,"overlay "+style),i=start+2;else for(;start<i;start+=2){var cur=st[start+1];st[start+1]=(cur?cur+" ":"")+"overlay "+style}},lineClasses),context.state=state,context.baseTokens=null,context.baseTokenPos=1}(o);return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null}}function getLineStyles(cm,line,updateFrontier){var context,resetState,result;return line.styles&&line.styles[0]==cm.state.modeGen||(context=getContextBefore(cm,lineNo(line)),resetState=line.text.length>cm.options.maxHighlightLength&&copyState(cm.doc.mode,context.state),result=highlightLine(cm,line,context),resetState&&(context.state=resetState),line.stateAfter=context.save(!resetState),line.styles=result.styles,result.classes?line.styleClasses=result.classes:line.styleClasses&&(line.styleClasses=null),updateFrontier===cm.doc.highlightFrontier&&(cm.doc.modeFrontier=Math.max(cm.doc.modeFrontier,++cm.doc.highlightFrontier))),line.styles}function getContextBefore(cm,n,precise){var doc=cm.doc,display=cm.display;if(!doc.mode.startState)return new Context(doc,!0,n);var start=function findStartLine(cm,n,precise){for(var minindent,minline,doc=cm.doc,lim=precise?-1:n-(cm.doc.mode.innerMode?1e3:100),search=n;lim<search;--search){if(search<=doc.first)return doc.first;var indented=getLine(doc,search-1),after=indented.stateAfter;if(after&&(!precise||search+(after instanceof SavedContext?after.lookAhead:0)<=doc.modeFrontier))return search;indented=countColumn(indented.text,null,cm.options.tabSize);(null==minline||indented<minindent)&&(minline=search-1,minindent=indented)}return minline}(cm,n,precise),saved=start>doc.first&&getLine(doc,start-1).stateAfter,context=saved?Context.fromSaved(doc,saved,start):new Context(doc,startState(doc.mode),start);return doc.iter(start,n,function(line){processLine(cm,line.text,context);var pos=context.line;line.stateAfter=pos==n-1||pos%5==0||pos>=display.viewFrom&&pos<display.viewTo?context.save():null,context.nextLine()}),precise&&(doc.modeFrontier=context.line),context}function processLine(cm,text,context,startAt){var mode=cm.doc.mode,stream=new StringStream(text,cm.options.tabSize,context);for(stream.start=stream.pos=startAt||0,""==text&&callBlankLine(mode,context.state);!stream.eol();)readToken(mode,stream,context.state),stream.start=stream.pos}function callBlankLine(mode,inner){if(mode.blankLine)return mode.blankLine(inner);if(mode.innerMode){inner=innerMode(mode,inner);return inner.mode.blankLine?inner.mode.blankLine(inner.state):void 0}}function readToken(mode,stream,state,inner){for(var i=0;i<10;i++){inner&&(inner[0]=innerMode(mode,state).mode);var style=mode.token(stream,state);if(stream.pos>stream.start)return style}throw new Error("Mode "+mode.name+" failed to advance stream.")}Context.prototype.lookAhead=function(n){var line=this.doc.getLine(this.line+n);return null!=line&&n>this.maxLookAhead&&(this.maxLookAhead=n),line},Context.prototype.baseToken=function(n){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=n;)this.baseTokenPos+=2;var type=this.baseTokens[this.baseTokenPos+1];return{type:type&&type.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}},Context.prototype.nextLine=function(){this.line++,0<this.maxLookAhead&&this.maxLookAhead--},Context.fromSaved=function(doc,saved,line){return saved instanceof SavedContext?new Context(doc,copyState(doc.mode,saved.state),line,saved.lookAhead):new Context(doc,copyState(doc.mode,saved),line)},Context.prototype.save=function(state){state=!1!==state?copyState(this.doc.mode,this.state):this.state;return 0<this.maxLookAhead?new SavedContext(state,this.maxLookAhead):state};var Token=function(stream,type,state){this.start=stream.start,this.end=stream.pos,this.string=stream.current(),this.type=type||null,this.state=state};function takeToken(cm,pos,precise,asArray){var style,tokens,doc=cm.doc,mode=doc.mode,line=getLine(doc,(pos=clipPos(doc,pos)).line),context=getContextBefore(cm,pos.line,precise),stream=new StringStream(line.text,cm.options.tabSize,context);for(asArray&&(tokens=[]);(asArray||stream.pos<pos.ch)&&!stream.eol();)stream.start=stream.pos,style=readToken(mode,stream,context.state),asArray&&tokens.push(new Token(stream,style,copyState(doc.mode,context.state)));return asArray?tokens:new Token(stream,style,context.state)}function extractLineClasses(type,output){if(type)for(;;){var lineClass=type.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!lineClass)break;type=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length);var prop=lineClass[1]?"bgClass":"textClass";null==output[prop]?output[prop]=lineClass[2]:new RegExp("(?:^|s)"+lineClass[2]+"(?:$|s)").test(output[prop])||(output[prop]+=" "+lineClass[2])}return type}function runMode(cm,text,mode,context,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans;null==flattenSpans&&(flattenSpans=cm.options.flattenSpans);var curStart=0,curStyle=null,stream=new StringStream(text,cm.options.tabSize,context),inner=cm.options.addModeClass&&[null];for(""==text&&extractLineClasses(callBlankLine(mode,context.state),lineClasses);!stream.eol();){var mName,style=stream.pos>cm.options.maxHighlightLength?(flattenSpans=!1,forceToEnd&&processLine(cm,text,context,stream.pos),stream.pos=text.length,null):extractLineClasses(readToken(mode,stream,context.state,inner),lineClasses);if(!inner||(mName=inner[0].name)&&(style="m-"+(style?mName+" "+style:mName)),!flattenSpans||curStyle!=style){for(;curStart<stream.start;)f(curStart=Math.min(stream.start,curStart+5e3),curStyle);curStyle=style}stream.start=stream.pos}for(;curStart<stream.pos;){var pos=Math.min(stream.pos,curStart+5e3);f(pos,curStyle),curStart=pos}}var sawReadOnlySpans=!1,sawCollapsedSpans=!1;function MarkedSpan(marker,from,to){this.marker=marker,this.from=from,this.to=to}function getMarkedSpanFor(spans,marker){if(spans)for(var i=0;i<spans.length;++i){var span=spans[i];if(span.marker==marker)return span}}function stretchSpansOverChange(isInsert,change){if(change.full)return null;var oldFirst=isLine(isInsert,change.from.line)&&getLine(isInsert,change.from.line).markedSpans,oldLast=isLine(isInsert,change.to.line)&&getLine(isInsert,change.to.line).markedSpans;if(!oldFirst&&!oldLast)return null;var startCh=change.from.ch,endCh=change.to.ch,isInsert=0==cmp(change.from,change.to),first=function markedSpansBefore(old,startCh,isInsert){var nw;if(old)for(var i=0;i<old.length;++i){var endsAfter,span=old[i],marker=span.marker;!(null==span.from||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh))&&(span.from!=startCh||"bookmark"!=marker.type||isInsert&&span.marker.insertLeft)||(endsAfter=null==span.to||(marker.inclusiveRight?span.to>=startCh:span.to>startCh),(nw=nw||[]).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to)))}return nw}(oldFirst,startCh,isInsert),last=function markedSpansAfter(old,endCh,isInsert){var nw;if(old)for(var i=0;i<old.length;++i){var startsBefore,span=old[i],marker=span.marker;!(null==span.to||(marker.inclusiveRight?span.to>=endCh:span.to>endCh))&&(span.from!=endCh||"bookmark"!=marker.type||isInsert&&!span.marker.insertLeft)||(startsBefore=null==span.from||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh),(nw=nw||[]).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,null==span.to?null:span.to-endCh)))}return nw}(oldLast,endCh,isInsert),sameLine=1==change.text.length,offset=lst(change.text).length+(sameLine?startCh:0);if(first)for(var i=0;i<first.length;++i){var found,span=first[i];null==span.to&&((found=getMarkedSpanFor(last,span.marker))?sameLine&&(span.to=null==found.to?null:found.to+offset):span.to=startCh)}if(last)for(var i$1=0;i$1<last.length;++i$1){var span$1=last[i$1];null!=span$1.to&&(span$1.to+=offset),null==span$1.from?getMarkedSpanFor(first,span$1.marker)||(span$1.from=offset,sameLine&&(first=first||[]).push(span$1)):(span$1.from+=offset,sameLine&&(first=first||[]).push(span$1))}first=first&&clearEmptySpans(first),last&&last!=first&&(last=clearEmptySpans(last));var newMarkers=[first];if(!sameLine){var gapMarkers,gap=change.text.length-2;if(0<gap&&first)for(var i$2=0;i$2<first.length;++i$2)null==first[i$2].to&&(gapMarkers=gapMarkers||[]).push(new MarkedSpan(first[i$2].marker,null,null));for(var i$3=0;i$3<gap;++i$3)newMarkers.push(gapMarkers);newMarkers.push(last)}return newMarkers}function clearEmptySpans(spans){for(var i=0;i<spans.length;++i){var span=spans[i];null!=span.from&&span.from==span.to&&!1!==span.marker.clearWhenEmpty&&spans.splice(i--,1)}return spans.length?spans:null}function detachMarkedSpans(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.detachLine(line);line.markedSpans=null}}function attachMarkedSpans(line,spans){if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.attachLine(line);line.markedSpans=spans}}function extraLeft(marker){return marker.inclusiveLeft?-1:0}function extraRight(marker){return marker.inclusiveRight?1:0}function compareCollapsedMarkers(a,b){var fromCmp=a.lines.length-b.lines.length;if(0!=fromCmp)return fromCmp;var aPos=a.find(),toCmp=b.find(),fromCmp=cmp(aPos.from,toCmp.from)||extraLeft(a)-extraLeft(b);if(fromCmp)return-fromCmp;toCmp=cmp(aPos.to,toCmp.to)||extraRight(a)-extraRight(b);return toCmp||b.id-a.id}function collapsedSpanAtSide(line,start){var found,sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var sp,i=0;i<sps.length;++i)(sp=sps[i]).marker.collapsed&&null==(start?sp.from:sp.to)&&(!found||compareCollapsedMarkers(found,sp.marker)<0)&&(found=sp.marker);return found}function collapsedSpanAtStart(line){return collapsedSpanAtSide(line,!0)}function collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,!1)}function conflictingCollapsedRange(doc,line,from,to,marker){var line=getLine(doc,line),sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var i=0;i<sps.length;++i){var sp=sps[i];if(sp.marker.collapsed){var found=sp.marker.find(0),fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker),toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker);if(!(0<=fromCmp&&toCmp<=0||fromCmp<=0&&0<=toCmp)&&(fromCmp<=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?0<=cmp(found.to,from):0<cmp(found.to,from))||0<=fromCmp&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.from,to)<=0:cmp(found.from,to)<0)))return 1}}}function visualLine(line){for(var merged;merged=collapsedSpanAtStart(line);)line=merged.find(-1,!0).line;return line}function visualLineNo(vis,lineN){var line=getLine(vis,lineN),vis=visualLine(line);return line==vis?lineN:lineNo(vis)}function visualLineEndNo(doc,lineN){if(lineN>doc.lastLine())return lineN;var merged,line=getLine(doc,lineN);if(!lineIsHidden(doc,line))return lineN;for(;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line;return lineNo(line)+1}function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var sp,i=0;i<sps.length;++i)if((sp=sps[i]).marker.collapsed){if(null==sp.from)return!0;if(!sp.marker.widgetNode&&0==sp.from&&sp.marker.inclusiveLeft&&function lineIsHiddenInner(doc,line,span){if(null==span.to){var end=span.marker.find(1,!0);return lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker))}if(span.marker.inclusiveRight&&span.to==line.text.length)return!0;for(var sp=void 0,i=0;i<line.markedSpans.length;++i)if((sp=line.markedSpans[i]).marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(null==sp.to||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp))return!0}(doc,line,sp))return!0}}function heightAtLine(lineObj){for(var h=0,chunk=(lineObj=visualLine(lineObj)).parent,i=0;i<chunk.lines.length;++i){var line=chunk.lines[i];if(line==lineObj)break;h+=line.height}for(var p=chunk.parent;p;p=(chunk=p).parent)for(var i$1=0;i$1<p.children.length;++i$1){var cur=p.children[i$1];if(cur==chunk)break;h+=cur.height}return h}function lineLength(line){if(0==line.height)return 0;for(var merged,len=line.text.length,cur=line;merged=collapsedSpanAtStart(cur);){var found=merged.find(0,!0),cur=found.from.line;len+=found.from.ch-found.to.ch}for(cur=line;merged=collapsedSpanAtEnd(cur);){var found$1=merged.find(0,!0);len-=cur.text.length-found$1.from.ch,len+=(cur=found$1.to.line).text.length-found$1.to.ch}return len}function findMaxLine(doc){var d=doc.display,doc=doc.doc;d.maxLine=getLine(doc,doc.first),d.maxLineLength=lineLength(d.maxLine),d.maxLineChanged=!0,doc.iter(function(line){var len=lineLength(line);len>d.maxLineLength&&(d.maxLineLength=len,d.maxLine=line)})}var Line=function(text,markedSpans,estimateHeight){this.text=text,attachMarkedSpans(this,markedSpans),this.height=estimateHeight?estimateHeight(this):1};Line.prototype.lineNo=function(){return lineNo(this)},eventMixin(Line);var styleToClassCache={},styleToClassCacheWithMode={};function interpretTokenStyle(style,cache){if(!style||/^\s*$/.test(style))return null;cache=cache.addModeClass?styleToClassCacheWithMode:styleToClassCache;return cache[style]||(cache[style]=style.replace(/\S+/g,"cm-$&"))}function buildLineContent(cm,lineView){var last=eltP("span",null,null,webkit?"padding-right: .1px":null),builder={pre:eltP("pre",[last],"CodeMirror-line"),content:last,col:0,pos:0,cm:cm,trailingSpace:!1,splitSpaces:cm.getOption("lineWrapping")};lineView.measure={};for(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order=void 0;builder.pos=0,builder.addToken=buildToken,function hasBadBidiRects(measure){if(null!=badBidiRects)return badBidiRects;var r1=removeChildrenAndAdd(measure,document.createTextNode("AØ®A")),r0=range(r1,0,1).getBoundingClientRect(),r1=range(r1,1,2).getBoundingClientRect();return removeChildren(measure),r0&&r0.left!=r0.right&&(badBidiRects=r1.right-r0.right<3)}(cm.display.measure)&&(order=getOrder(line,cm.doc.direction))&&(builder.addToken=function buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,css,attributes){style=style?style+" cm-force-border":"cm-force-border";for(var start=builder.pos,end=start+text.length;;){for(var part=void 0,i=0;i<order.length&&!((part=order[i]).to>start&&part.from<=start);i++);if(part.to>=end)return inner(builder,text,style,startStyle,endStyle,css,attributes);inner(builder,text.slice(0,part.to-start),style,startStyle,null,css,attributes),startStyle=null,text=text.slice(part.to-start),start=part.to}}}(builder.addToken,order)),builder.map=[],function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;if(spans)for(var style,css,spanStyle,spanEndStyle,spanStartStyle,collapsed,attributes,len=allText.length,pos=0,i=1,text="",nextChange=0;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=css="",collapsed=attributes=null,nextChange=1/0;for(var foundBookmarks=[],endStyles=void 0,j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;if("bookmark"==m.type&&sp.from==pos&&m.widgetNode)foundBookmarks.push(m);else if(sp.from<=pos&&(null==sp.to||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(null!=sp.to&&sp.to!=pos&&nextChange>sp.to&&(nextChange=sp.to,spanEndStyle=""),m.className&&(spanStyle+=" "+m.className),m.css&&(css=(css?css+";":"")+m.css),m.startStyle&&sp.from==pos&&(spanStartStyle+=" "+m.startStyle),m.endStyle&&sp.to==nextChange&&(endStyles=endStyles||[]).push(m.endStyle,sp.to),m.title&&((attributes=attributes||{}).title=m.title),m.attributes)for(var attr in m.attributes)(attributes=attributes||{})[attr]=m.attributes[attr];m.collapsed&&(!collapsed||compareCollapsedMarkers(collapsed.marker,m)<0)&&(collapsed=sp)}else sp.from>pos&&nextChange>sp.from&&(nextChange=sp.from)}if(endStyles)for(var j$1=0;j$1<endStyles.length;j$1+=2)endStyles[j$1+1]==nextChange&&(spanEndStyle+=" "+endStyles[j$1]);if(!collapsed||collapsed.from==pos)for(var j$2=0;j$2<foundBookmarks.length;++j$2)buildCollapsedSpan(builder,0,foundBookmarks[j$2]);if(collapsed&&(collapsed.from||0)==pos){if(buildCollapsedSpan(builder,(null==collapsed.to?len+1:collapsed.to)-pos,collapsed.marker,null==collapsed.from),null==collapsed.to)return;collapsed.to==pos&&(collapsed=!1)}}if(len<=pos)break;for(var upto=Math.min(len,nextChange);;){if(text){var tokenText,end=pos+text.length;if(collapsed||(tokenText=upto<end?text.slice(0,upto-pos):text,builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",css,attributes)),upto<=end){text=text.slice(upto-pos),pos=upto;break}pos=end,spanStartStyle=""}text=allText.slice(at,at=styles[i++]),style=interpretTokenStyle(styles[i++],builder.cm.options)}}else for(var i$1=1;i$1<styles.length;i$1+=2)builder.addToken(builder,allText.slice(at,at=styles[i$1]),interpretTokenStyle(styles[i$1+1],builder.cm.options))}(line,builder,getLineStyles(cm,line,lineView!=cm.display.externalMeasured&&lineNo(line))),line.styleClasses&&(line.styleClasses.bgClass&&(builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"")),line.styleClasses.textClass&&(builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||""))),0==builder.map.length&&builder.map.push(0,0,builder.content.appendChild(function zeroWidthElement(measure){null==zwspSupported&&(node=elt("span","â"),removeChildrenAndAdd(measure,elt("span",[node,document.createTextNode("x")])),0!=measure.firstChild.offsetHeight&&(zwspSupported=node.offsetWidth<=1&&2<node.offsetHeight&&!(ie&&ie_version<8)));var node=zwspSupported?elt("span","â"):elt("span","Â ",null,"display: inline-block; width: 1px; margin-right: -1px");return node.setAttribute("cm-text",""),node}(cm.display.measure))),0==i?(lineView.measure.map=builder.map,lineView.measure.cache={}):((lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map),(lineView.measure.caches||(lineView.measure.caches=[])).push({}))}return webkit&&(last=builder.content.lastChild,(/\bcm-tab\b/.test(last.className)||last.querySelector&&last.querySelector(".cm-tab"))&&(builder.content.className="cm-tab-wrap-hack")),signal(cm,"renderLine",cm,lineView.line,builder.pre),builder.pre.className&&(builder.textClass=joinClasses(builder.pre.className,builder.textClass||"")),builder}function defaultSpecialCharPlaceholder(ch){var token=elt("span","â¢","cm-invalidchar");return token.title="\\u"+ch.charCodeAt(0).toString(16),token.setAttribute("aria-label",token.title),token}function buildToken(builder,text,fullStyle,startStyle,endStyle,css,attributes){if(text){var displayText=builder.splitSpaces?function splitSpaces(text,trailingBefore){if(1<text.length&&!/  /.test(text))return text;for(var spaceBefore=trailingBefore,result="",i=0;i<text.length;i++){var ch=text.charAt(i);" "!=ch||!spaceBefore||i!=text.length-1&&32!=text.charCodeAt(i+1)||(ch="Â "),result+=ch,spaceBefore=" "==ch}return result}(text,builder.trailingSpace):text,special=builder.cm.state.specialChars,mustWrap=!1;if(special.test(text))for(var content=document.createDocumentFragment(),pos=0;;){special.lastIndex=pos;var m=special.exec(text),tabWidth=m?m.index-pos:text.length-pos;if(tabWidth&&(txt$1=document.createTextNode(displayText.slice(pos,pos+tabWidth)),ie&&ie_version<9?content.appendChild(elt("span",[txt$1])):content.appendChild(txt$1),builder.map.push(builder.pos,builder.pos+tabWidth,txt$1),builder.col+=tabWidth,builder.pos+=tabWidth),!m)break;pos+=1+tabWidth;var txt$1=void 0;"\t"==m[0]?(tabWidth=(tabWidth=builder.cm.options.tabSize)-builder.col%tabWidth,(txt$1=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab"))).setAttribute("role","presentation"),txt$1.setAttribute("cm-text","\t"),builder.col+=tabWidth):("\r"==m[0]||"\n"==m[0]?(txt$1=content.appendChild(elt("span","\r"==m[0]?"â":"â¤","cm-invalidchar"))).setAttribute("cm-text",m[0]):((txt$1=builder.cm.options.specialCharPlaceholder(m[0])).setAttribute("cm-text",m[0]),ie&&ie_version<9?content.appendChild(elt("span",[txt$1])):content.appendChild(txt$1)),builder.col+=1),builder.map.push(builder.pos,builder.pos+1,txt$1),builder.pos++}else builder.col+=text.length,content=document.createTextNode(displayText),builder.map.push(builder.pos,builder.pos+text.length,content),ie&&ie_version<9&&(mustWrap=!0),builder.pos+=text.length;if(builder.trailingSpace=32==displayText.charCodeAt(text.length-1),fullStyle||startStyle||endStyle||mustWrap||css){fullStyle=fullStyle||"";startStyle&&(fullStyle+=startStyle),endStyle&&(fullStyle+=endStyle);var token=elt("span",[content],fullStyle,css);if(attributes)for(var attr in attributes)attributes.hasOwnProperty(attr)&&"style"!=attr&&"class"!=attr&&token.setAttribute(attr,attributes[attr]);return builder.content.appendChild(token)}builder.content.appendChild(content)}}function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode;widget&&builder.map.push(builder.pos,builder.pos+size,widget),!ignoreWidget&&builder.cm.display.input.needsContentAttribute&&(widget=widget||builder.content.appendChild(document.createElement("span"))).setAttribute("cm-marker",marker.id),widget&&(builder.cm.display.input.setUneditable(widget),builder.content.appendChild(widget)),builder.pos+=size,builder.trailingSpace=!1}function LineView(doc,line,lineN){this.line=line,this.rest=function visualLineContinued(line){for(var merged,lines;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line,(lines=lines||[]).push(line);return lines}(line),this.size=this.rest?lineNo(lst(this.rest))-lineN+1:1,this.node=this.text=null,this.hidden=lineIsHidden(doc,line)}function buildViewArray(cm,from,to){for(var array=[],pos=from;pos<to;pos=nextPos){var view=new LineView(cm.doc,getLine(cm.doc,pos),pos),nextPos=pos+view.size;array.push(view)}return array}var operationGroup=null;function finishOperation(op,endCb){var group=op.ownsGroup;if(group)try{!function fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0;do{for(;i<callbacks.length;i++)callbacks[i].call(null);for(var j=0;j<group.ops.length;j++){var op=group.ops[j];if(op.cursorActivityHandlers)for(;op.cursorActivityCalled<op.cursorActivityHandlers.length;)op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm)}}while(i<callbacks.length)}(group)}finally{operationGroup=null,endCb(group)}}var orphanDelayedCallbacks=null;function signalLater(emitter,type){var arr=getHandlers(emitter,type);if(arr.length){var list,args=Array.prototype.slice.call(arguments,2);operationGroup?list=operationGroup.delayedCallbacks:orphanDelayedCallbacks?list=orphanDelayedCallbacks:(list=orphanDelayedCallbacks=[],setTimeout(fireOrphanDelayed,0));for(var i=0;i<arr.length;++i)!function(i){list.push(function(){return arr[i].apply(null,args)})}(i)}}function fireOrphanDelayed(){var delayed=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(var i=0;i<delayed.length;++i)delayed[i]()}function updateLineForChanges(cm,lineView,lineN,dims){for(var j=0;j<lineView.changes.length;j++){var type=lineView.changes[j];"text"==type?function updateLineText(cm,lineView){var cls=lineView.text.className,built=getLineContent(cm,lineView);lineView.text==lineView.node&&(lineView.node=built.pre),lineView.text.parentNode.replaceChild(built.pre,lineView.text),lineView.text=built.pre,built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass?(lineView.bgClass=built.bgClass,lineView.textClass=built.textClass,updateLineClasses(cm,lineView)):cls&&(lineView.text.className=cls)}(cm,lineView):"gutter"==type?updateLineGutter(cm,lineView,lineN,dims):"class"==type?updateLineClasses(cm,lineView):"widget"==type&&function updateLineWidgets(cm,lineView,dims){lineView.alignable&&(lineView.alignable=null);for(var node=lineView.node.firstChild,next=void 0;node;node=next)next=node.nextSibling,"CodeMirror-linewidget"==node.className&&lineView.node.removeChild(node);insertLineWidgets(cm,lineView,dims)}(cm,lineView,dims)}lineView.changes=null}function ensureLineWrapped(lineView){return lineView.node==lineView.text&&(lineView.node=elt("div",null,null,"position: relative"),lineView.text.parentNode&&lineView.text.parentNode.replaceChild(lineView.node,lineView.text),lineView.node.appendChild(lineView.text),ie&&ie_version<8&&(lineView.node.style.zIndex=2)),lineView.node}function getLineContent(cm,lineView){var ext=cm.display.externalMeasured;return ext&&ext.line==lineView.line?(cm.display.externalMeasured=null,lineView.measure=ext.measure,ext.built):buildLineContent(cm,lineView)}function updateLineClasses(textClass,lineView){!function updateLineBackground(cm,lineView){var wrap,cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass;cls&&(cls+=" CodeMirror-linebackground"),lineView.background?cls?lineView.background.className=cls:(lineView.background.parentNode.removeChild(lineView.background),lineView.background=null):cls&&(wrap=ensureLineWrapped(lineView),lineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild),cm.display.input.setUneditable(lineView.background))}(textClass,lineView),lineView.line.wrapClass?ensureLineWrapped(lineView).className=lineView.line.wrapClass:lineView.node!=lineView.text&&(lineView.node.className="");textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass;lineView.text.className=textClass||""}function updateLineGutter(cm,lineView,lineN,dims){lineView.gutter&&(lineView.node.removeChild(lineView.gutter),lineView.gutter=null),lineView.gutterBackground&&(lineView.node.removeChild(lineView.gutterBackground),lineView.gutterBackground=null),lineView.line.gutterClass&&(wrap$1=ensureLineWrapped(lineView),lineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,"left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+dims.gutterTotalWidth+"px"),cm.display.input.setUneditable(lineView.gutterBackground),wrap$1.insertBefore(lineView.gutterBackground,lineView.text));var markers=lineView.line.gutterMarkers;if(cm.options.lineNumbers||markers){var wrap$1=ensureLineWrapped(lineView),gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px");if(cm.display.input.setUneditable(gutterWrap),wrap$1.insertBefore(gutterWrap,lineView.text),lineView.line.gutterClass&&(gutterWrap.className+=" "+lineView.line.gutterClass),!cm.options.lineNumbers||markers&&markers["CodeMirror-linenumbers"]||(lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+dims.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+cm.display.lineNumInnerWidth+"px"))),markers)for(var k=0;k<cm.display.gutterSpecs.length;++k){var id=cm.display.gutterSpecs[k].className,found=markers.hasOwnProperty(id)&&markers[id];found&&gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt","left: "+dims.gutterLeft[id]+"px; width: "+dims.gutterWidth[id]+"px"))}}}function insertLineWidgets(cm,lineView,dims){if(insertLineWidgetsFor(cm,lineView.line,lineView,dims,!0),lineView.rest)for(var i=0;i<lineView.rest.length;i++)insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,!1)}function insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(line.widgets)for(var wrap=ensureLineWrapped(lineView),i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget");widget.handleMouseEvents||node.setAttribute("cm-ignore-events","true"),function positionLineWidget(widget,node,width,dims){widget.noHScroll&&((width.alignable||(width.alignable=[])).push(node),width=dims.wrapperWidth,node.style.left=dims.fixedPos+"px",widget.coverGutter||(width-=dims.gutterTotalWidth,node.style.paddingLeft=dims.gutterTotalWidth+"px"),node.style.width=width+"px"),widget.coverGutter&&(node.style.zIndex=5,node.style.position="relative",widget.noHScroll||(node.style.marginLeft=-dims.gutterTotalWidth+"px"))}(widget,node,lineView,dims),cm.display.input.setUneditable(node),allowAbove&&widget.above?wrap.insertBefore(node,lineView.gutter||lineView.text):wrap.appendChild(node),signalLater(widget,"redraw")}}function widgetHeight(widget){if(null!=widget.height)return widget.height;var parentStyle,cm=widget.doc.cm;return cm?(contains(document.body,widget.node)||(parentStyle="position: relative;",widget.coverGutter&&(parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;"),widget.noHScroll&&(parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;"),removeChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle))),widget.height=widget.node.parentNode.offsetHeight):0}function eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==display.sizer&&n!=display.mover)return 1}function paddingTop(display){return display.lineSpace.offsetTop}function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}function paddingH(display){if(display.cachedPaddingH)return display.cachedPaddingH;var data=removeChildrenAndAdd(display.measure,elt("pre","x","CodeMirror-line-like")),data=window.getComputedStyle?window.getComputedStyle(data):data.currentStyle,data={left:parseInt(data.paddingLeft),right:parseInt(data.paddingRight)};return isNaN(data.left)||isNaN(data.right)||(display.cachedPaddingH=data),data}function scrollGap(cm){return scrollerGap-cm.display.nativeBarWidth}function displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth}function displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight}function mapFromLineView(lineView,line,lineN){if(lineView.line==line)return{map:lineView.measure.map,cache:lineView.measure.cache};for(var i=0;i<lineView.rest.length;i++)if(lineView.rest[i]==line)return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]};for(var i$1=0;i$1<lineView.rest.length;i$1++)if(lineNo(lineView.rest[i$1])>lineN)return{map:lineView.measure.maps[i$1],cache:lineView.measure.caches[i$1],before:!0}}function measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias)}function findViewForLine(ext,lineN){if(lineN>=ext.display.viewFrom&&lineN<ext.display.viewTo)return ext.display.view[findViewIndex(ext,lineN)];ext=ext.display.externalMeasured;return ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size?ext:void 0}function prepareMeasureForLine(cm,line){var info=lineNo(line),view=findViewForLine(cm,info);view&&!view.text?view=null:view&&view.changes&&(updateLineForChanges(cm,view,info,getDimensions(cm)),cm.curOp.forceUpdate=!0);info=mapFromLineView(view=view||function updateExternalMeasurement(cm,view){var built=lineNo(view=visualLine(view));return(view=cm.display.externalMeasured=new LineView(cm.doc,view,built)).lineN=built,built=view.built=buildLineContent(cm,view),view.text=built.pre,removeChildrenAndAdd(cm.display.lineMeasure,built.pre),view}(cm,line),line,info);return{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:!1}}function measureCharPrepared(cm,prepared,ch,bias,varHeight){var found,key=(ch=prepared.before?-1:ch)+(bias||"");return prepared.cache.hasOwnProperty(key)?found=prepared.cache[key]:(prepared.rect||(prepared.rect=prepared.view.text.getBoundingClientRect()),prepared.hasHeights||(function ensureLineHeights(curWidth,lineView,rect){var wrapping=curWidth.options.lineWrapping,curWidth=wrapping&&displayWidth(curWidth);if(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[];if(wrapping){lineView.measure.width=curWidth;for(var rects=lineView.text.firstChild.getClientRects(),i=0;i<rects.length-1;i++){var cur=rects[i],next=rects[i+1];2<Math.abs(cur.bottom-next.bottom)&&heights.push((cur.bottom+next.top)/2-rect.top)}}heights.push(rect.bottom-rect.top)}}(cm,prepared.view,prepared.rect),prepared.hasHeights=!0),(found=function measureCharInner(cm,prepared,rbot,bias){var rect,place=nodeAndOffsetInLineMap(prepared.map,rbot,bias),node=place.node,start=place.start,end=place.end,collapse=place.collapse;if(3==node.nodeType){for(var i$1=0;i$1<4;i$1++){for(;start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start));)--start;for(;place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end));)++end;if((rect=ie&&ie_version<9&&0==start&&end==place.coverEnd-place.coverStart?node.parentNode.getBoundingClientRect():function getUsefulRect(rects,bias){var rect=nullRect;if("left"==bias)for(var i=0;i<rects.length&&(rect=rects[i]).left==rect.right;i++);else for(var i$1=rects.length-1;0<=i$1&&(rect=rects[i$1]).left==rect.right;i$1--);return rect}(range(node,start,end).getClientRects(),bias)).left||rect.right||0==start)break;end=start,start-=1,collapse="right"}ie&&ie_version<11&&(rect=function maybeUpdateRectForZooming(scaleY,rect){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function hasBadZoomedRects(normal){if(null!=badZoomedRects)return badZoomedRects;var normal=(fromRange=removeChildrenAndAdd(normal,elt("span","x"))).getBoundingClientRect(),fromRange=range(fromRange,0,1).getBoundingClientRect();return badZoomedRects=1<Math.abs(normal.left-fromRange.left)}(scaleY))return rect;var scaleX=screen.logicalXDPI/screen.deviceXDPI,scaleY=screen.logicalYDPI/screen.deviceYDPI;return{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY}}(cm.display.measure,rect))}else 0<start&&(collapse=bias="right"),rect=cm.options.lineWrapping&&1<(top=node.getClientRects()).length?top["right"==bias?top.length-1:0]:node.getBoundingClientRect();!(ie&&ie_version<9)||start||rect&&(rect.left||rect.right)||(result=node.parentNode.getClientRects()[0],rect=result?{left:result.left,right:result.left+charWidth(cm.display),top:result.top,bottom:result.bottom}:nullRect);for(var rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top,mid=(rtop+rbot)/2,heights=prepared.view.measure.heights,i=0;i<heights.length-1&&!(mid<heights[i]);i++);var top=i?heights[i-1]:0,result=heights[i],result={left:("right"==collapse?rect.right:rect.left)-prepared.rect.left,right:("left"==collapse?rect.left:rect.right)-prepared.rect.left,top:top,bottom:result};rect.left||rect.right||(result.bogus=!0);cm.options.singleCursorHeightPerLine||(result.rtop=rtop,result.rbottom=rbot);return result}(cm,prepared,ch,bias)).bogus||(prepared.cache[key]=found)),{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom}}var measureText,nullRect={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(map$$1,ch,bias){for(var node,start,end,collapse,mStart,mEnd,i=0;i<map$$1.length;i+=3)if(mStart=map$$1[i],mEnd=map$$1[i+1],ch<mStart?(start=0,end=1,collapse="left"):ch<mEnd?end=(start=ch-mStart)+1:(i==map$$1.length-3||ch==mEnd&&map$$1[i+3]>ch)&&(start=(end=mEnd-mStart)-1,mEnd<=ch&&(collapse="right")),null!=start){if(node=map$$1[i+2],mStart==mEnd&&bias==(node.insertLeft?"left":"right")&&(collapse=bias),"left"==bias&&0==start)for(;i&&map$$1[i-2]==map$$1[i-3]&&map$$1[i-1].insertLeft;)node=map$$1[2+(i-=3)],collapse="left";if("right"==bias&&start==mEnd-mStart)for(;i<map$$1.length-3&&map$$1[i+3]==map$$1[i+4]&&!map$$1[i+5].insertLeft;)node=map$$1[(i+=3)+2],collapse="right";break}return{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd}}function clearLineMeasurementCacheFor(lineView){if(lineView.measure&&(lineView.measure.cache={},lineView.measure.heights=null,lineView.rest))for(var i=0;i<lineView.rest.length;i++)lineView.measure.caches[i]={}}function clearLineMeasurementCache(cm){cm.display.externalMeasure=null,removeChildren(cm.display.lineMeasure);for(var i=0;i<cm.display.view.length;i++)clearLineMeasurementCacheFor(cm.display.view[i])}function clearCaches(cm){clearLineMeasurementCache(cm),cm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null,cm.options.lineWrapping||(cm.display.maxLineChanged=!0),cm.display.lineNumChars=null}function pageScrollX(){return chrome&&android?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){return chrome&&android?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function widgetTopHeight(lineObj){var height=0;if(lineObj.widgets)for(var i=0;i<lineObj.widgets.length;++i)lineObj.widgets[i].above&&(height+=widgetHeight(lineObj.widgets[i]));return height}function intoCoordSystem(lOff,yOff,rect,xOff,height){if(height||(height=widgetTopHeight(yOff),rect.top+=height,rect.bottom+=height),"line"==xOff)return rect;xOff=xOff||"local";yOff=heightAtLine(yOff);return"local"==xOff?yOff+=paddingTop(lOff.display):yOff-=lOff.display.viewOffset,"page"!=xOff&&"window"!=xOff||(yOff+=(lOff=lOff.display.lineSpace.getBoundingClientRect()).top+("window"==xOff?0:pageScrollY()),xOff=lOff.left+("window"==xOff?0:pageScrollX()),rect.left+=xOff,rect.right+=xOff),rect.top+=yOff,rect.bottom+=yOff,rect}function fromCoordSystem(lineSpaceBox,top,localBox){if("div"==localBox)return top;var left=top.left,top=top.top;"page"==localBox?(left-=pageScrollX(),top-=pageScrollY()):"local"!=localBox&&localBox||(left+=(localBox=lineSpaceBox.display.sizer.getBoundingClientRect()).left,top+=localBox.top);lineSpaceBox=lineSpaceBox.display.lineSpace.getBoundingClientRect();return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}function charCoords(cm,pos,context,lineObj,bias){return intoCoordSystem(cm,lineObj=lineObj||getLine(cm.doc,pos.line),measureChar(cm,lineObj,pos.ch,bias),context)}function cursorCoords(cm,other,context,lineObj,preparedMeasure,varHeight){function get(m,right){m=measureCharPrepared(cm,preparedMeasure,m,right?"right":"left",varHeight);return right?m.left=m.right:m.right=m.left,intoCoordSystem(cm,lineObj,m,context)}lineObj=lineObj||getLine(cm.doc,other.line),preparedMeasure=preparedMeasure||prepareMeasureForLine(cm,lineObj);var order=getOrder(lineObj,cm.doc.direction),ch=other.ch,sticky=other.sticky;if(ch>=lineObj.text.length?(ch=lineObj.text.length,sticky="before"):ch<=0&&(ch=0,sticky="after"),!order)return get("before"==sticky?ch-1:ch,"before"==sticky);function getBidi(ch,partPos,invert){return get(invert?ch-1:ch,1==order[partPos].level!=invert)}var val=getBidiPartAt(order,ch,sticky),other=bidiOther,val=getBidi(ch,val,"before"==sticky);return null!=other&&(val.other=getBidi(ch,other,"before"!=sticky)),val}function estimateCoords(top,lineObj){var left=0;lineObj=clipPos(top.doc,lineObj),top.options.lineWrapping||(left=charWidth(top.display)*lineObj.ch);lineObj=getLine(top.doc,lineObj.line),top=heightAtLine(lineObj)+paddingTop(top.display);return{left:left,right:left,top:top,bottom:top+lineObj.height}}function PosWithInfo(line,ch,pos,outside,xRel){pos=Pos(line,ch,pos);return pos.xRel=xRel,outside&&(pos.outside=outside),pos}function coordsChar(cm,x,y){var doc=cm.doc;if((y+=cm.display.viewOffset)<0)return PosWithInfo(doc.first,0,null,-1,-1);var lineN=lineAtHeight(doc,y),last=doc.first+doc.size-1;if(last<lineN)return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,null,1,1);x<0&&(x=0);for(var lineObj=getLine(doc,lineN);;){var found=function coordsCharInner(cm,lineObj,lineNo$$1,x,y){y-=heightAtLine(lineObj);var preparedMeasure=prepareMeasureForLine(cm,lineObj),widgetHeight$$1=widgetTopHeight(lineObj),begin=0,end=lineObj.text.length,coords=!0,ch=getOrder(lineObj,cm.doc.direction);ch&&(outside=(cm.options.lineWrapping?function coordsBidiPartWrapped(cm,lineObj,_lineNo,preparedMeasure,order,x,ref){var ref=wrappedLineExtent(cm,lineObj,preparedMeasure,ref),begin=ref.begin,end=ref.end;/\s/.test(lineObj.text.charAt(end-1))&&end--;for(var part=null,closestDist=null,i=0;i<order.length;i++){var dist,p=order[i];p.from>=end||p.to<=begin||(dist=1!=p.level,dist=measureCharPrepared(cm,preparedMeasure,dist?Math.min(end,p.to)-1:Math.max(begin,p.from)).right,dist=dist<x?x-dist+1e9:dist-x,(!part||dist<closestDist)&&(part=p,closestDist=dist))}part=part||order[order.length-1];part.from<begin&&(part={from:begin,to:part.to,level:part.level});part.to>end&&(part={from:part.from,to:end,level:part.level});return part}:function coordsBidiPart(cm,lineObj,lineNo$$1,preparedMeasure,order,x,y){var index=findFirst(function(ltr){var part=order[ltr],ltr=1!=part.level;return boxIsAfter(cursorCoords(cm,Pos(lineNo$$1,ltr?part.to:part.from,ltr?"before":"after"),"line",lineObj,preparedMeasure),x,y,!0)},0,order.length-1),part=order[index];{var start;0<index&&(start=1!=part.level,boxIsAfter(start=cursorCoords(cm,Pos(lineNo$$1,start?part.from:part.to,start?"after":"before"),"line",lineObj,preparedMeasure),x,y,!0)&&start.top>y&&(part=order[index-1]))}return part})(cm,lineObj,lineNo$$1,preparedMeasure,ch,x,y),coords=1!=outside.level,begin=coords?outside.from:outside.to-1,end=coords?outside.to:outside.from-1);var chAround=null,boxAround=null,ch=findFirst(function(ch){var box=measureCharPrepared(cm,preparedMeasure,ch);return box.top+=widgetHeight$$1,box.bottom+=widgetHeight$$1,boxIsAfter(box,x,y,!1)&&(box.top<=y&&box.left<=x&&(chAround=ch,boxAround=box),1)},begin,end),outside=!1;{var baseX,sticky;boxAround?(baseX=x-boxAround.left<boxAround.right-x,ch=chAround+((sticky=baseX==coords)?0:1),sticky=sticky?"after":"before",baseX=baseX?boxAround.left:boxAround.right):(coords||ch!=end&&ch!=begin||ch++,sticky=0==ch||ch!=lineObj.text.length&&measureCharPrepared(cm,preparedMeasure,ch-(coords?1:0)).bottom+widgetHeight$$1<=y==coords?"after":"before",coords=cursorCoords(cm,Pos(lineNo$$1,ch,sticky),"line",lineObj,preparedMeasure),baseX=coords.left,outside=y<coords.top?-1:y>=coords.bottom?1:0)}return ch=skipExtendingChars(lineObj.text,ch,1),PosWithInfo(lineNo$$1,ch,sticky,outside,x-baseX)}(cm,lineObj,lineN,x,y),rangeEnd=function collapsedSpanAround(line,ch){var found,sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var i=0;i<sps.length;++i){var sp=sps[i];sp.marker.collapsed&&(null==sp.from||sp.from<ch)&&(null==sp.to||sp.to>ch)&&(!found||compareCollapsedMarkers(found,sp.marker)<0)&&(found=sp.marker)}return found}(lineObj,found.ch+(0<found.xRel||0<found.outside?1:0));if(!rangeEnd)return found;rangeEnd=rangeEnd.find(1);if(rangeEnd.line==lineN)return rangeEnd;lineObj=getLine(doc,lineN=rangeEnd.line)}}function wrappedLineExtent(cm,begin,preparedMeasure,y){y-=widgetTopHeight(begin);var end=begin.text.length,begin=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch-1).bottom<=y},end,0);return{begin:begin,end:end=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch).top>y},begin,end)}}function wrappedLineExtentChar(cm,lineObj,preparedMeasure,target){return wrappedLineExtent(cm,lineObj,preparedMeasure=preparedMeasure||prepareMeasureForLine(cm,lineObj),intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,target),"line").top)}function boxIsAfter(box,x,y,left){return!(box.bottom<=y)&&(box.top>y||(left?box.left:box.right)>x)}function textHeight(display){if(null!=display.cachedTextHeight)return display.cachedTextHeight;if(null==measureText){measureText=elt("pre",null,"CodeMirror-line-like");for(var i=0;i<49;++i)measureText.appendChild(document.createTextNode("x")),measureText.appendChild(elt("br"));measureText.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(display.measure,measureText);var height=measureText.offsetHeight/50;return 3<height&&(display.cachedTextHeight=height),removeChildren(display.measure),height||1}function charWidth(display){if(null!=display.cachedCharWidth)return display.cachedCharWidth;var width=elt("span","xxxxxxxxxx"),pre=elt("pre",[width],"CodeMirror-line-like");removeChildrenAndAdd(display.measure,pre);width=width.getBoundingClientRect(),width=(width.right-width.left)/10;return 2<width&&(display.cachedCharWidth=width),width||10}function getDimensions(cm){for(var d=cm.display,left={},width={},gutterLeft=d.gutters.clientLeft,n=d.gutters.firstChild,i=0;n;n=n.nextSibling,++i){var id=cm.display.gutterSpecs[i].className;left[id]=n.offsetLeft+n.clientLeft+gutterLeft,width[id]=n.clientWidth}return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}function compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left}function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping,perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);return function(line){if(lineIsHidden(cm.doc,line))return 0;var widgetsHeight=0;if(line.widgets)for(var i=0;i<line.widgets.length;i++)line.widgets[i].height&&(widgetsHeight+=line.widgets[i].height);return wrapping?widgetsHeight+(Math.ceil(line.text.length/perLine)||1)*th:widgetsHeight+th}}function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);doc.iter(function(line){var estHeight=est(line);estHeight!=line.height&&updateLineHeight(line,estHeight)})}function posFromMouse(cm,e,liberal,forRect){var coords=cm.display;if(!liberal&&"true"==e_target(e).getAttribute("cm-not-content"))return null;var x,y,space=coords.lineSpace.getBoundingClientRect();try{x=e.clientX-space.left,y=e.clientY-space.top}catch(e){return null}var colDiff,coords=coordsChar(cm,x,y);return forRect&&1==coords.xRel&&(colDiff=getLine(cm.doc,coords.line).text).length==coords.ch&&(colDiff=countColumn(colDiff,colDiff.length,cm.options.tabSize)-colDiff.length,coords=Pos(coords.line,Math.max(0,Math.round((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff))),coords}function findViewIndex(cm,n){if(n>=cm.display.viewTo)return null;if((n-=cm.display.viewFrom)<0)return null;for(var view=cm.display.view,i=0;i<view.length;i++)if((n-=view[i].size)<0)return i}function regChange(ext,from,to,lendiff){null==from&&(from=ext.doc.first),null==to&&(to=ext.doc.first+ext.doc.size),lendiff=lendiff||0;var cutTop,cutBot,display=ext.display;lendiff&&to<display.viewTo&&(null==display.updateLineNumbers||display.updateLineNumbers>from)&&(display.updateLineNumbers=from),ext.curOp.viewChanged=!0,from>=display.viewTo?sawCollapsedSpans&&visualLineNo(ext.doc,from)<display.viewTo&&resetView(ext):to<=display.viewFrom?sawCollapsedSpans&&visualLineEndNo(ext.doc,to+lendiff)>display.viewFrom?resetView(ext):(display.viewFrom+=lendiff,display.viewTo+=lendiff):from<=display.viewFrom&&to>=display.viewTo?resetView(ext):from<=display.viewFrom?(cutTop=viewCuttingPoint(ext,to,to+lendiff,1))?(display.view=display.view.slice(cutTop.index),display.viewFrom=cutTop.lineN,display.viewTo+=lendiff):resetView(ext):to>=display.viewTo?(cutBot=viewCuttingPoint(ext,from,from,-1))?(display.view=display.view.slice(0,cutBot.index),display.viewTo=cutBot.lineN):resetView(ext):(cutTop=viewCuttingPoint(ext,from,from,-1),cutBot=viewCuttingPoint(ext,to,to+lendiff,1),cutTop&&cutBot?(display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(ext,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index)),display.viewTo+=lendiff):resetView(ext));ext=display.externalMeasured;ext&&(to<ext.lineN?ext.lineN+=lendiff:from<ext.lineN+ext.size&&(display.externalMeasured=null))}function regLineChange(cm,arr,type){cm.curOp.viewChanged=!0;var display=cm.display,ext=cm.display.externalMeasured;ext&&arr>=ext.lineN&&arr<ext.lineN+ext.size&&(display.externalMeasured=null),arr<display.viewFrom||arr>=display.viewTo||(null==(arr=display.view[findViewIndex(cm,arr)]).node||-1==indexOf(arr=arr.changes||(arr.changes=[]),type)&&arr.push(type))}function resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first,cm.display.view=[],cm.display.viewOffset=0}function viewCuttingPoint(cm,oldN,newN,dir){var diff,index=findViewIndex(cm,oldN),view=cm.display.view;if(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size)return{index:index,lineN:newN};for(var n=cm.display.viewFrom,i=0;i<index;i++)n+=view[i].size;if(n!=oldN){if(0<dir){if(index==view.length-1)return null;diff=n+view[index].size-oldN,index++}else diff=n-oldN;oldN+=diff,newN+=diff}for(;visualLineNo(cm.doc,newN)!=newN;){if(index==(dir<0?0:view.length-1))return null;newN+=dir*view[index-(dir<0?1:0)].size,index+=dir}return{index:index,lineN:newN}}function countDirtyView(cm){for(var view=cm.display.view,dirty=0,i=0;i<view.length;i++){var lineView=view[i];lineView.hidden||lineView.node&&!lineView.changes||++dirty}return dirty}function updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection())}function prepareSelection(cm,primary){void 0===primary&&(primary=!0);for(var range$$1,collapsed,doc=cm.doc,result={},curFragment=result.cursors=document.createDocumentFragment(),selFragment=result.selection=document.createDocumentFragment(),i=0;i<doc.sel.ranges.length;i++)!primary&&i==doc.sel.primIndex||((range$$1=doc.sel.ranges[i]).from().line>=cm.display.viewTo||range$$1.to().line<cm.display.viewFrom||(((collapsed=range$$1.empty())||cm.options.showCursorWhenSelecting)&&drawSelectionCursor(cm,range$$1.head,curFragment),collapsed||function drawSelectionRange(cm,singleVLine,output){var rightStart=cm.display,doc=cm.doc,fragment=document.createDocumentFragment(),leftEnd=paddingH(cm.display),leftSide=leftEnd.left,rightSide=Math.max(rightStart.sizerWidth,displayWidth(cm)-rightStart.sizer.offsetLeft)-leftEnd.right,docLTR="ltr"==doc.direction;function add(left,top,width,bottom){top<0&&(top=0),top=Math.round(top),bottom=Math.round(bottom),fragment.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+left+"px;\n                             top: "+top+"px; width: "+(null==width?rightSide-left:width)+"px;\n                             height: "+(bottom-top)+"px"))}function drawForLine(line,fromArg,toArg){var start,end,lineObj=getLine(doc,line),lineLen=lineObj.text.length;function coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias)}function wrapX(extent,prop,side){extent=wrappedLineExtentChar(cm,lineObj,null,extent),prop="ltr"==prop==("after"==side)?"left":"right";return coords("after"==side?extent.begin:extent.end-(/\s/.test(lineObj.text.charAt(extent.end-1))?2:1),prop)[prop]}var order=getOrder(lineObj,doc.direction);return function iterateBidiSections(order,from,to,f){if(!order)return f(from,to,"ltr",0);for(var found=!1,i=0;i<order.length;++i){var part=order[i];(part.from<to&&part.to>from||from==to&&part.to==from)&&(f(Math.max(part.from,from),Math.min(part.to,to),1==part.level?"rtl":"ltr",i),found=!0)}found||f(from,to,"ltr")}(order,fromArg||0,null==toArg?lineLen:toArg,function(from,to,botRight,left){var right,topLeft,topRight,botLeft,ltr="ltr"==botRight,fromPos=coords(from,ltr?"left":"right"),toPos=coords(to-1,ltr?"right":"left"),openStart=null==fromArg&&0==from,openEnd=null==toArg&&to==lineLen,first=0==left,last=!order||left==order.length-1;toPos.top-fromPos.top<=3?(right=(docLTR?openEnd:openStart)&&last,left=(docLTR?openStart:openEnd)&&first?leftSide:(ltr?fromPos:toPos).left,right=right?rightSide:(ltr?toPos:fromPos).right,add(left,fromPos.top,right-left,fromPos.bottom)):(botRight=ltr?(topLeft=docLTR&&openStart&&first?leftSide:fromPos.left,topRight=docLTR?rightSide:wrapX(from,botRight,"before"),botLeft=docLTR?leftSide:wrapX(to,botRight,"after"),docLTR&&openEnd&&last?rightSide:toPos.right):(topLeft=docLTR?wrapX(from,botRight,"before"):leftSide,topRight=!docLTR&&openStart&&first?rightSide:fromPos.right,botLeft=!docLTR&&openEnd&&last?leftSide:toPos.left,docLTR?wrapX(to,botRight,"after"):rightSide),add(topLeft,fromPos.top,topRight-topLeft,fromPos.bottom),fromPos.bottom<toPos.top&&add(leftSide,fromPos.bottom,null,toPos.top),add(botLeft,toPos.top,botRight-botLeft,toPos.bottom)),(!start||cmpCoords(fromPos,start)<0)&&(start=fromPos),cmpCoords(toPos,start)<0&&(start=toPos),(!end||cmpCoords(fromPos,end)<0)&&(end=fromPos),cmpCoords(toPos,end)<0&&(end=toPos)}),{start:start,end:end}}var sFrom=singleVLine.from(),rightStart=singleVLine.to();sFrom.line==rightStart.line?drawForLine(sFrom.line,sFrom.ch,rightStart.ch):(leftEnd=getLine(doc,sFrom.line),singleVLine=getLine(doc,rightStart.line),singleVLine=visualLine(leftEnd)==visualLine(singleVLine),leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?leftEnd.text.length+1:null).end,rightStart=drawForLine(rightStart.line,singleVLine?0:null,rightStart.ch).start,singleVLine&&(leftEnd.top<rightStart.top-2?(add(leftEnd.right,leftEnd.top,null,leftEnd.bottom),add(leftSide,rightStart.top,rightStart.left,rightStart.bottom)):add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom)),leftEnd.bottom<rightStart.top&&add(leftSide,leftEnd.bottom,null,rightStart.top)),output.appendChild(fragment)}(cm,range$$1,selFragment)));return result}function drawSelectionCursor(cm,cursor,otherCursor){var pos=cursorCoords(cm,cursor,"div",null,null,!cm.options.singleCursorHeightPerLine),cursor=otherCursor.appendChild(elt("div","Â ","CodeMirror-cursor"));cursor.style.left=pos.left+"px",cursor.style.top=pos.top+"px",cursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px",pos.other&&((otherCursor=otherCursor.appendChild(elt("div","Â ","CodeMirror-cursor CodeMirror-secondarycursor"))).style.display="",otherCursor.style.left=pos.other.left+"px",otherCursor.style.top=pos.other.top+"px",otherCursor.style.height=.85*(pos.other.bottom-pos.other.top)+"px")}function cmpCoords(a,b){return a.top-b.top||a.left-b.left}function restartBlink(cm){var display,on;cm.state.focused&&(display=cm.display,clearInterval(display.blinker),on=!0,display.cursorDiv.style.visibility="",0<cm.options.cursorBlinkRate?display.blinker=setInterval(function(){return display.cursorDiv.style.visibility=(on=!on)?"":"hidden"},cm.options.cursorBlinkRate):cm.options.cursorBlinkRate<0&&(display.cursorDiv.style.visibility="hidden"))}function ensureFocus(cm){cm.state.focused||(cm.display.input.focus(),onFocus(cm))}function delayBlurEvent(cm){cm.state.delayingBlurEvent=!0,setTimeout(function(){cm.state.delayingBlurEvent&&(cm.state.delayingBlurEvent=!1,onBlur(cm))},100)}function onFocus(cm,e){cm.state.delayingBlurEvent&&(cm.state.delayingBlurEvent=!1),"nocursor"!=cm.options.readOnly&&(cm.state.focused||(signal(cm,"focus",cm,e),cm.state.focused=!0,addClass(cm.display.wrapper,"CodeMirror-focused"),cm.curOp||cm.display.selForContextMenu==cm.doc.sel||(cm.display.input.reset(),webkit&&setTimeout(function(){return cm.display.input.reset(!0)},20)),cm.display.input.receivedFocus()),restartBlink(cm))}function onBlur(cm,e){cm.state.delayingBlurEvent||(cm.state.focused&&(signal(cm,"blur",cm,e),cm.state.focused=!1,rmClass(cm.display.wrapper,"CodeMirror-focused")),clearInterval(cm.display.blinker),setTimeout(function(){cm.state.focused||(cm.display.shift=!1)},150))}function updateHeightsInViewport(cm){for(var display=cm.display,prevBottom=display.lineDiv.offsetTop,i=0;i<display.view.length;i++){var bot,cur=display.view[i],wrapping=cm.options.lineWrapping,height=void 0,chWidth=0;if(!cur.hidden){ie&&ie_version<8?(height=(bot=cur.node.offsetTop+cur.node.offsetHeight)-prevBottom,prevBottom=bot):(height=(diff=cur.node.getBoundingClientRect()).bottom-diff.top,!wrapping&&cur.text.firstChild&&(chWidth=cur.text.firstChild.getBoundingClientRect().right-diff.left-1));var diff=cur.line.height-height;if((.005<diff||diff<-.005)&&(updateLineHeight(cur.line,height),updateWidgetHeight(cur.line),cur.rest))for(var j=0;j<cur.rest.length;j++)updateWidgetHeight(cur.rest[j]);chWidth>cm.display.sizerWidth&&((chWidth=Math.ceil(chWidth/charWidth(cm.display)))>cm.display.maxLineLength&&(cm.display.maxLineLength=chWidth,cm.display.maxLine=cur.line,cm.display.maxLineChanged=!0))}}}function updateWidgetHeight(line){if(line.widgets)for(var i=0;i<line.widgets.length;++i){var w=line.widgets[i],parent=w.node.parentNode;parent&&(w.height=parent.offsetHeight)}}function visibleLines(display,doc,ensureTo){var to=ensureTo&&null!=ensureTo.top?Math.max(0,ensureTo.top):display.scroller.scrollTop,to=Math.floor(to-paddingTop(display)),ensureFrom=ensureTo&&null!=ensureTo.bottom?ensureTo.bottom:to+display.wrapper.clientHeight,from=lineAtHeight(doc,to),to=lineAtHeight(doc,ensureFrom);return ensureTo&&ensureTo.ensure&&(ensureFrom=ensureTo.ensure.from.line,ensureTo=ensureTo.ensure.to.line,ensureFrom<from?to=lineAtHeight(doc,heightAtLine(getLine(doc,from=ensureFrom))+display.wrapper.clientHeight):Math.min(ensureTo,doc.lastLine())>=to&&(from=lineAtHeight(doc,heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight),to=ensureTo)),{from:from,to:Math.max(to,from+1)}}function calculateScrollPos(screenw,rect){var tooWide=screenw.display,atBottom=textHeight(screenw.display);rect.top<0&&(rect.top=0);var screentop=(screenw.curOp&&null!=screenw.curOp.scrollTop?screenw.curOp:tooWide.scroller).scrollTop,screen=displayHeight(screenw),result={};rect.bottom-rect.top>screen&&(rect.bottom=rect.top+screen);var docBottom=screenw.doc.height+paddingVert(tooWide),atTop=rect.top<atBottom,atBottom=rect.bottom>docBottom-atBottom;rect.top<screentop?result.scrollTop=atTop?0:rect.top:rect.bottom>screentop+screen&&((screenleft=Math.min(rect.top,(atBottom?docBottom:rect.bottom)-screen))!=screentop&&(result.scrollTop=screenleft));var screenleft=(screenw.curOp&&null!=screenw.curOp.scrollLeft?screenw.curOp:tooWide.scroller).scrollLeft,screenw=displayWidth(screenw)-(screenw.options.fixedGutter?tooWide.gutters.offsetWidth:0),tooWide=rect.right-rect.left>screenw;return tooWide&&(rect.right=rect.left+screenw),rect.left<10?result.scrollLeft=0:rect.left<screenleft?result.scrollLeft=Math.max(0,rect.left-(tooWide?0:10)):rect.right>screenw+screenleft-3&&(result.scrollLeft=rect.right+(tooWide?0:10)-screenw),result}function addToScrollTop(cm,top){null!=top&&(resolveScrollToPos(cm),cm.curOp.scrollTop=(null==cm.curOp.scrollTop?cm.doc:cm.curOp).scrollTop+top)}function ensureCursorVisible(cm){resolveScrollToPos(cm);var cur=cm.getCursor();cm.curOp.scrollToPos={from:cur,to:cur,margin:cm.options.cursorScrollMargin}}function scrollToCoords(cm,x,y){null==x&&null==y||resolveScrollToPos(cm),null!=x&&(cm.curOp.scrollLeft=x),null!=y&&(cm.curOp.scrollTop=y)}function resolveScrollToPos(cm){var range$$1=cm.curOp.scrollToPos;range$$1&&(cm.curOp.scrollToPos=null,scrollToCoordsRange(cm,estimateCoords(cm,range$$1.from),estimateCoords(cm,range$$1.to),range$$1.margin))}function scrollToCoordsRange(cm,from,to,sPos){sPos=calculateScrollPos(cm,{left:Math.min(from.left,to.left),top:Math.min(from.top,to.top)-sPos,right:Math.max(from.right,to.right),bottom:Math.max(from.bottom,to.bottom)+sPos});scrollToCoords(cm,sPos.scrollLeft,sPos.scrollTop)}function updateScrollTop(cm,val){Math.abs(cm.doc.scrollTop-val)<2||(gecko||updateDisplaySimple(cm,{top:val}),setScrollTop(cm,val,!0),gecko&&updateDisplaySimple(cm),startWorker(cm,100))}function setScrollTop(cm,val,forceScroll){val=Math.min(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,val),cm.display.scroller.scrollTop==val&&!forceScroll||(cm.doc.scrollTop=val,cm.display.scrollbars.setScrollTop(val),cm.display.scroller.scrollTop!=val&&(cm.display.scroller.scrollTop=val))}function setScrollLeft(cm,val,isScroller,forceScroll){val=Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth),(isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2)&&!forceScroll||(cm.doc.scrollLeft=val,alignHorizontally(cm),cm.display.scroller.scrollLeft!=val&&(cm.display.scroller.scrollLeft=val),cm.display.scrollbars.setScrollLeft(val))}function measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth,docH=Math.round(cm.doc.height+paddingVert(cm.display));return{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW}}ContentEditableInput=function(place,scroll,cm){this.cm=cm;var vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");vert.tabIndex=horiz.tabIndex=-1,place(vert),place(horiz),on(vert,"scroll",function(){vert.clientHeight&&scroll(vert.scrollTop,"vertical")}),on(horiz,"scroll",function(){horiz.clientWidth&&scroll(horiz.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,ie&&ie_version<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ContentEditableInput.prototype.update=function(measure){var totalWidth,needsH=measure.scrollWidth>measure.clientWidth+1,needsV=measure.scrollHeight>measure.clientHeight+1,sWidth=measure.nativeBarWidth;return needsV?(this.vert.style.display="block",this.vert.style.bottom=needsH?sWidth+"px":"0",totalWidth=measure.viewHeight-(needsH?sWidth:0),this.vert.firstChild.style.height=Math.max(0,measure.scrollHeight-measure.clientHeight+totalWidth)+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0"),needsH?(this.horiz.style.display="block",this.horiz.style.right=needsV?sWidth+"px":"0",this.horiz.style.left=measure.barLeft+"px",totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0),this.horiz.firstChild.style.width=Math.max(0,measure.scrollWidth-measure.clientWidth+totalWidth)+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0"),!this.checkedZeroWidth&&0<measure.clientHeight&&(0==sWidth&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:needsV?sWidth:0,bottom:needsH?sWidth:0}},ContentEditableInput.prototype.setScrollLeft=function(pos){this.horiz.scrollLeft!=pos&&(this.horiz.scrollLeft=pos),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ContentEditableInput.prototype.setScrollTop=function(pos){this.vert.scrollTop!=pos&&(this.vert.scrollTop=pos),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ContentEditableInput.prototype.zeroWidthHack=function(){var w=mac&&!mac_geMountainLion?"12px":"18px";this.horiz.style.height=this.vert.style.width=w,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Delayed,this.disableVert=new Delayed},ContentEditableInput.prototype.enableZeroWidthBar=function(bar,delay,type){bar.style.pointerEvents="auto",delay.set(1e3,function maybeDisable(){var box=bar.getBoundingClientRect();("vert"==type?document.elementFromPoint(box.right-1,(box.top+box.bottom)/2):document.elementFromPoint((box.right+box.left)/2,box.bottom-1))!=bar?bar.style.pointerEvents="none":delay.set(1e3,maybeDisable)})},ContentEditableInput.prototype.clear=function(){var parent=this.horiz.parentNode;parent.removeChild(this.horiz),parent.removeChild(this.vert)};TextareaInput=function(){};function updateScrollbars(cm,measure){measure=measure||measureForScrollbars(cm);var startWidth=cm.display.barWidth,startHeight=cm.display.barHeight;updateScrollbarsInner(cm,measure);for(var i=0;i<4&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;i++)startWidth!=cm.display.barWidth&&cm.options.lineWrapping&&updateHeightsInViewport(cm),updateScrollbarsInner(cm,measureForScrollbars(cm)),startWidth=cm.display.barWidth,startHeight=cm.display.barHeight}function updateScrollbarsInner(cm,measure){var d=cm.display,sizes=d.scrollbars.update(measure);d.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px",d.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px",d.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent",sizes.right&&sizes.bottom?(d.scrollbarFiller.style.display="block",d.scrollbarFiller.style.height=sizes.bottom+"px",d.scrollbarFiller.style.width=sizes.right+"px"):d.scrollbarFiller.style.display="",sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter?(d.gutterFiller.style.display="block",d.gutterFiller.style.height=sizes.bottom+"px",d.gutterFiller.style.width=measure.gutterWidth+"px"):d.gutterFiller.style.display=""}TextareaInput.prototype.update=function(){return{bottom:0,right:0}},TextareaInput.prototype.setScrollLeft=function(){},TextareaInput.prototype.setScrollTop=function(){},TextareaInput.prototype.clear=function(){};var scrollbarModel={native:ContentEditableInput,null:TextareaInput};function initScrollbars(cm){cm.display.scrollbars&&(cm.display.scrollbars.clear(),cm.display.scrollbars.addClass&&rmClass(cm.display.wrapper,cm.display.scrollbars.addClass)),cm.display.scrollbars=new scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller),on(node,"mousedown",function(){cm.state.focused&&setTimeout(function(){return cm.display.input.focus()},0)}),node.setAttribute("cm-not-content","true")},function(pos,axis){("horizontal"==axis?setScrollLeft:updateScrollTop)(cm,pos)},cm),cm.display.scrollbars.addClass&&addClass(cm.display.wrapper,cm.display.scrollbars.addClass)}var nextOpId=0;function startOperation(cm){cm.curOp={cm:cm,viewChanged:!1,startHeight:cm.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++nextOpId},function pushOperation(op){operationGroup?operationGroup.ops.push(op):op.ownsGroup=operationGroup={ops:[op],delayedCallbacks:[]}}(cm.curOp)}function endOperation(op){op=op.curOp;op&&finishOperation(op,function(group){for(var i=0;i<group.ops.length;i++)group.ops[i].cm.curOp=null;!function endOperations(group){for(var ops=group.ops,i=0;i<ops.length;i++)!function endOperation_R1(op){var cm=op.cm,display=cm.display;(function maybeClipScrollbars(cm){var display=cm.display;!display.scrollbarsClipped&&display.scroller.offsetWidth&&(display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth,display.heightForcer.style.height=scrollGap(cm)+"px",display.sizer.style.marginBottom=-display.nativeBarWidth+"px",display.sizer.style.borderRightWidth=scrollGap(cm)+"px",display.scrollbarsClipped=!0)})(cm),op.updateMaxLine&&findMaxLine(cm),op.mustUpdate=op.viewChanged||op.forceUpdate||null!=op.scrollTop||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping,op.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate)}(ops[i]);for(var i$1=0;i$1<ops.length;i$1++)!function endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update)}(ops[i$1]);for(var i$2=0;i$2<ops.length;i$2++)!function endOperation_R2(op){var cm=op.cm,display=cm.display;op.updatedDisplay&&updateHeightsInViewport(cm),op.barMeasure=measureForScrollbars(cm),display.maxLineChanged&&!cm.options.lineWrapping&&(op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3,cm.display.sizerWidth=op.adjustWidthTo,op.barMeasure.scrollWidth=Math.max(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth),op.maxScrollLeft=Math.max(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm))),(op.updatedDisplay||op.selectionChanged)&&(op.preparedSelection=display.input.prepareSelection())}(ops[i$2]);for(var i$3=0;i$3<ops.length;i$3++)!function endOperation_W2(op){var cm=op.cm;null!=op.adjustWidthTo&&(cm.display.sizer.style.minWidth=op.adjustWidthTo+"px",op.maxScrollLeft<cm.doc.scrollLeft&&setScrollLeft(cm,Math.min(cm.display.scroller.scrollLeft,op.maxScrollLeft),!0),cm.display.maxLineChanged=!1);var takeFocus=op.focus&&op.focus==activeElt();op.preparedSelection&&cm.display.input.showSelection(op.preparedSelection,takeFocus),!op.updatedDisplay&&op.startHeight==cm.doc.height||updateScrollbars(cm,op.barMeasure),op.updatedDisplay&&setDocumentHeight(cm,op.barMeasure),op.selectionChanged&&restartBlink(cm),cm.state.focused&&op.updateInput&&cm.display.input.reset(op.typing),takeFocus&&ensureFocus(op.cm)}(ops[i$3]);for(var i$4=0;i$4<ops.length;i$4++)!function endOperation_finish(op){var rect,cm=op.cm,display=cm.display,doc=cm.doc;op.updatedDisplay&&postUpdateDisplay(cm,op.update),null==display.wheelStartX||null==op.scrollTop&&null==op.scrollLeft&&!op.scrollToPos||(display.wheelStartX=display.wheelStartY=null),null!=op.scrollTop&&setScrollTop(cm,op.scrollTop,op.forceScroll),null!=op.scrollLeft&&setScrollLeft(cm,op.scrollLeft,!0,!0),op.scrollToPos&&(rect=function scrollPosIntoView(cm,pos,end,margin){null==margin&&(margin=0),cm.options.lineWrapping||pos!=end||(end="before"==(pos=pos.ch?Pos(pos.line,"before"==pos.sticky?pos.ch-1:pos.ch,"after"):pos).sticky?Pos(pos.line,pos.ch+1,"before"):pos);for(var limit=0;limit<5;limit++){var rect,changed=!1,startTop=cursorCoords(cm,pos),startLeft=end&&end!=pos?cursorCoords(cm,end):startTop,scrollPos=calculateScrollPos(cm,rect={left:Math.min(startTop.left,startLeft.left),top:Math.min(startTop.top,startLeft.top)-margin,right:Math.max(startTop.left,startLeft.left),bottom:Math.max(startTop.bottom,startLeft.bottom)+margin}),startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(null!=scrollPos.scrollTop&&(updateScrollTop(cm,scrollPos.scrollTop),1<Math.abs(cm.doc.scrollTop-startTop)&&(changed=!0)),null!=scrollPos.scrollLeft&&(setScrollLeft(cm,scrollPos.scrollLeft),1<Math.abs(cm.doc.scrollLeft-startLeft)&&(changed=!0)),!changed)break}return rect}(cm,clipPos(doc,op.scrollToPos.from),clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin),function maybeScrollWindow(cm,scrollNode){var display,box,doScroll;signalDOMEvent(cm,"scrollCursorIntoView")||(box=(display=cm.display).sizer.getBoundingClientRect(),doScroll=null,scrollNode.top+box.top<0?doScroll=!0:scrollNode.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)&&(doScroll=!1),null==doScroll||phantom||(scrollNode=elt("div","â",null,"position: absolute;\n                         top: "+(scrollNode.top-display.viewOffset-paddingTop(cm.display))+"px;\n                         height: "+(scrollNode.bottom-scrollNode.top+scrollGap(cm)+display.barHeight)+"px;\n                         left: "+scrollNode.left+"px; width: "+Math.max(2,scrollNode.right-scrollNode.left)+"px;"),cm.display.lineSpace.appendChild(scrollNode),scrollNode.scrollIntoView(doScroll),cm.display.lineSpace.removeChild(scrollNode)))}(cm,rect));var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;if(hidden)for(var i=0;i<hidden.length;++i)hidden[i].lines.length||signal(hidden[i],"hide");if(unhidden)for(var i$1=0;i$1<unhidden.length;++i$1)unhidden[i$1].lines.length&&signal(unhidden[i$1],"unhide");display.wrapper.offsetHeight&&(doc.scrollTop=cm.display.scroller.scrollTop),op.changeObjs&&signal(cm,"changes",cm,op.changeObjs),op.update&&op.update.finish()}(ops[i$4])}(group)})}function runInOp(cm,f){if(cm.curOp)return f();startOperation(cm);try{return f()}finally{endOperation(cm)}}function operation(cm,f){return function(){if(cm.curOp)return f.apply(cm,arguments);startOperation(cm);try{return f.apply(cm,arguments)}finally{endOperation(cm)}}}function methodOp(f){return function(){if(this.curOp)return f.apply(this,arguments);startOperation(this);try{return f.apply(this,arguments)}finally{endOperation(this)}}}function docMethodOp(f){return function(){var cm=this.cm;if(!cm||cm.curOp)return f.apply(this,arguments);startOperation(cm);try{return f.apply(this,arguments)}finally{endOperation(cm)}}}function startWorker(cm,time){cm.doc.highlightFrontier<cm.display.viewTo&&cm.state.highlight.set(time,bind(highlightWorker,cm))}function highlightWorker(cm){var end,context,changedLines,doc=cm.doc;doc.highlightFrontier>=cm.display.viewTo||(end=+new Date+cm.options.workTime,context=getContextBefore(cm,doc.highlightFrontier),changedLines=[],doc.iter(context.line,Math.min(doc.first+doc.size,cm.display.viewTo+500),function(line){if(context.line>=cm.display.viewFrom){var oldStyles=line.styles,oldCls=line.text.length>cm.options.maxHighlightLength?copyState(doc.mode,context.state):null,newCls=highlightLine(cm,line,context,!0);oldCls&&(context.state=oldCls),line.styles=newCls.styles;oldCls=line.styleClasses,newCls=newCls.classes;newCls?line.styleClasses=newCls:oldCls&&(line.styleClasses=null);for(var ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass),i=0;!ischange&&i<oldStyles.length;++i)ischange=oldStyles[i]!=line.styles[i];ischange&&changedLines.push(context.line),line.stateAfter=context.save(),context.nextLine()}else line.text.length<=cm.options.maxHighlightLength&&processLine(cm,line.text,context),line.stateAfter=context.line%5==0?context.save():null,context.nextLine();if(+new Date>end)return startWorker(cm,cm.options.workDelay),!0}),doc.highlightFrontier=context.line,doc.modeFrontier=Math.max(doc.modeFrontier,context.line),changedLines.length&&runInOp(cm,function(){for(var i=0;i<changedLines.length;i++)regLineChange(cm,changedLines[i],"text")}))}var DisplayUpdate=function(cm,viewport,force){var display=cm.display;this.viewport=viewport,this.visible=visibleLines(display,cm.doc,viewport),this.editorIsHidden=!display.wrapper.offsetWidth,this.wrapperHeight=display.wrapper.clientHeight,this.wrapperWidth=display.wrapper.clientWidth,this.oldDisplayWidth=displayWidth(cm),this.force=force,this.dims=getDimensions(cm),this.events=[]};function updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc;if(update.editorIsHidden)return resetView(cm),!1;if(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(null==display.updateLineNumbers||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&0==countDirtyView(cm))return!1;maybeUpdateLineNumberWidth(cm)&&(resetView(cm),update.dims=getDimensions(cm));var different=doc.first+doc.size,toUpdate=Math.max(update.visible.from-cm.options.viewportMargin,doc.first),selSnapshot=Math.min(different,update.visible.to+cm.options.viewportMargin);display.viewFrom<toUpdate&&toUpdate-display.viewFrom<20&&(toUpdate=Math.max(doc.first,display.viewFrom)),display.viewTo>selSnapshot&&display.viewTo-selSnapshot<20&&(selSnapshot=Math.min(different,display.viewTo)),sawCollapsedSpans&&(toUpdate=visualLineNo(cm.doc,toUpdate),selSnapshot=visualLineEndNo(cm.doc,selSnapshot));different=toUpdate!=display.viewFrom||selSnapshot!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth;!function adjustView(cm,from,to){var display=cm.display;0==display.view.length||from>=display.viewTo||to<=display.viewFrom?(display.view=buildViewArray(cm,from,to),display.viewFrom=from):(display.viewFrom>from?display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view):display.viewFrom<from&&(display.view=display.view.slice(findViewIndex(cm,from))),display.viewFrom=from,display.viewTo<to?display.view=display.view.concat(buildViewArray(cm,display.viewTo,to)):display.viewTo>to&&(display.view=display.view.slice(0,findViewIndex(cm,to)))),display.viewTo=to}(cm,toUpdate,selSnapshot),display.viewOffset=heightAtLine(getLine(cm.doc,display.viewFrom)),cm.display.mover.style.top=display.viewOffset+"px";toUpdate=countDirtyView(cm);if(!different&&0==toUpdate&&!update.force&&display.renderedView==display.view&&(null==display.updateLineNumbers||display.updateLineNumbers>=display.viewTo))return!1;selSnapshot=function selectionSnapshot(cm){if(cm.hasFocus())return null;var sel=activeElt();if(!sel||!contains(cm.display.lineDiv,sel))return null;var result={activeElt:sel};return!window.getSelection||(sel=window.getSelection()).anchorNode&&sel.extend&&contains(cm.display.lineDiv,sel.anchorNode)&&(result.anchorNode=sel.anchorNode,result.anchorOffset=sel.anchorOffset,result.focusNode=sel.focusNode,result.focusOffset=sel.focusOffset),result}(cm);return 4<toUpdate&&(display.lineDiv.style.display="none"),function patchDisplay(cm,updateNumbersFrom,dims){var display=cm.display,lineNumbers=cm.options.lineNumbers,container=display.lineDiv,cur=container.firstChild;function rm(node){var next=node.nextSibling;return webkit&&mac&&cm.display.currentWheelTarget==node?node.style.display="none":node.parentNode.removeChild(node),next}for(var view=display.view,lineN=display.viewFrom,i=0;i<view.length;i++){var lineView=view[i];if(!lineView.hidden)if(lineView.node&&lineView.node.parentNode==container){for(;cur!=lineView.node;)cur=rm(cur);var node=lineNumbers&&null!=updateNumbersFrom&&updateNumbersFrom<=lineN&&lineView.lineNumber;lineView.changes&&(-1<indexOf(lineView.changes,"gutter")&&(node=!1),updateLineForChanges(cm,lineView,lineN,dims)),node&&(removeChildren(lineView.lineNumber),lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)))),cur=lineView.node.nextSibling}else{node=function buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView);return lineView.text=lineView.node=built.pre,built.bgClass&&(lineView.bgClass=built.bgClass),built.textClass&&(lineView.textClass=built.textClass),updateLineClasses(cm,lineView),updateLineGutter(cm,lineView,lineN,dims),insertLineWidgets(cm,lineView,dims),lineView.node}(cm,lineView,lineN,dims);container.insertBefore(node,cur)}lineN+=lineView.size}for(;cur;)cur=rm(cur)}(cm,display.updateLineNumbers,update.dims),4<toUpdate&&(display.lineDiv.style.display=""),display.renderedView=display.view,function restoreSelection(snapshot){var sel,range$$1;snapshot&&snapshot.activeElt&&snapshot.activeElt!=activeElt()&&(snapshot.activeElt.focus(),snapshot.anchorNode&&contains(document.body,snapshot.anchorNode)&&contains(document.body,snapshot.focusNode)&&(sel=window.getSelection(),(range$$1=document.createRange()).setEnd(snapshot.anchorNode,snapshot.anchorOffset),range$$1.collapse(!1),sel.removeAllRanges(),sel.addRange(range$$1),sel.extend(snapshot.focusNode,snapshot.focusOffset)))}(selSnapshot),removeChildren(display.cursorDiv),removeChildren(display.selectionDiv),display.gutters.style.height=display.sizer.style.minHeight=0,different&&(display.lastWrapHeight=update.wrapperHeight,display.lastWrapWidth=update.wrapperWidth,startWorker(cm,400)),!(display.updateLineNumbers=null)}function postUpdateDisplay(cm,update){for(var viewport=update.viewport,first=!0;(first&&cm.options.lineWrapping&&update.oldDisplayWidth!=displayWidth(cm)||(viewport&&null!=viewport.top&&(viewport={top:Math.min(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)}),update.visible=visibleLines(cm.display,cm.doc,viewport),!(update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo)))&&updateDisplayIfNeeded(cm,update);first=!1){updateHeightsInViewport(cm);var barMeasure=measureForScrollbars(cm);updateSelection(cm),updateScrollbars(cm,barMeasure),setDocumentHeight(cm,barMeasure),update.force=!1}update.signal(cm,"update",cm),cm.display.viewFrom==cm.display.reportedViewFrom&&cm.display.viewTo==cm.display.reportedViewTo||(update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo),cm.display.reportedViewFrom=cm.display.viewFrom,cm.display.reportedViewTo=cm.display.viewTo)}function updateDisplaySimple(cm,barMeasure){var update=new DisplayUpdate(cm,barMeasure);updateDisplayIfNeeded(cm,update)&&(updateHeightsInViewport(cm),postUpdateDisplay(cm,update),barMeasure=measureForScrollbars(cm),updateSelection(cm),updateScrollbars(cm,barMeasure),setDocumentHeight(cm,barMeasure),update.finish())}function updateGutterSpace(display){var width=display.gutters.offsetWidth;display.sizer.style.marginLeft=width+"px"}function setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px",cm.display.heightForcer.style.top=measure.docHeight+"px",cm.display.gutters.style.height=measure.docHeight+cm.display.barHeight+scrollGap(cm)+"px"}function alignHorizontally(cm){var display=cm.display,view=display.view;if(display.alignWidgets||display.gutters.firstChild&&cm.options.fixedGutter){for(var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft,gutterW=display.gutters.offsetWidth,left=comp+"px",i=0;i<view.length;i++)if(!view[i].hidden){cm.options.fixedGutter&&(view[i].gutter&&(view[i].gutter.style.left=left),view[i].gutterBackground&&(view[i].gutterBackground.style.left=left));var align=view[i].alignable;if(align)for(var j=0;j<align.length;j++)align[j].style.left=left}cm.options.fixedGutter&&(display.gutters.style.left=comp+gutterW+"px")}}function maybeUpdateLineNumberWidth(cm){if(cm.options.lineNumbers){var innerW=cm.doc,last=lineNumberFor(cm.options,innerW.first+innerW.size-1),display=cm.display;if(last.length!=display.lineNumChars){var padding=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt")),innerW=padding.firstChild.offsetWidth,padding=padding.offsetWidth-innerW;return display.lineGutter.style.width="",display.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding)+1,display.lineNumWidth=display.lineNumInnerWidth+padding,display.lineNumChars=display.lineNumInnerWidth?last.length:-1,display.lineGutter.style.width=display.lineNumWidth+"px",updateGutterSpace(cm.display),1}}}function getGutters(gutters,lineNumbers){for(var result=[],sawLineNumbers=!1,i=0;i<gutters.length;i++){var name=gutters[i],style=null;if("string"!=typeof name&&(style=name.style,name=name.className),"CodeMirror-linenumbers"==name){if(!lineNumbers)continue;sawLineNumbers=!0}result.push({className:name,style:style})}return lineNumbers&&!sawLineNumbers&&result.push({className:"CodeMirror-linenumbers",style:null}),result}function renderGutters(display){var gutters=display.gutters,specs=display.gutterSpecs;removeChildren(gutters),display.lineGutter=null;for(var i=0;i<specs.length;++i){var gElt=specs[i],className=gElt.className,style=gElt.style,gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+className));style&&(gElt.style.cssText=style),"CodeMirror-linenumbers"==className&&((display.lineGutter=gElt).style.width=(display.lineNumWidth||1)+"px")}gutters.style.display=specs.length?"":"none",updateGutterSpace(display)}function updateGutters(cm){renderGutters(cm.display),regChange(cm),alignHorizontally(cm)}function Display(place,doc,input,options){var d=this;this.input=input,d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler"),d.scrollbarFiller.setAttribute("cm-not-content","true"),d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler"),d.gutterFiller.setAttribute("cm-not-content","true"),d.lineDiv=eltP("div",null,"CodeMirror-code"),d.selectionDiv=elt("div",null,null,"position: relative; z-index: 1"),d.cursorDiv=elt("div",null,"CodeMirror-cursors"),d.measure=elt("div",null,"CodeMirror-measure"),d.lineMeasure=elt("div",null,"CodeMirror-measure"),d.lineSpace=eltP("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none");var lines=eltP("div",[d.lineSpace],"CodeMirror-lines");d.mover=elt("div",[lines],null,"position: relative"),d.sizer=elt("div",[d.mover],"CodeMirror-sizer"),d.sizerWidth=null,d.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerGap+"px; width: 1px;"),d.gutters=elt("div",null,"CodeMirror-gutters"),d.lineGutter=null,d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll"),d.scroller.setAttribute("tabIndex","-1"),d.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror"),ie&&ie_version<8&&(d.gutters.style.zIndex=-1,d.scroller.style.paddingRight=0),webkit||gecko&&mobile||(d.scroller.draggable=!0),place&&(place.appendChild?place.appendChild(d.wrapper):place(d.wrapper)),d.viewFrom=d.viewTo=doc.first,d.reportedViewFrom=d.reportedViewTo=doc.first,d.view=[],d.renderedView=null,d.externalMeasured=null,d.viewOffset=0,d.lastWrapHeight=d.lastWrapWidth=0,d.updateLineNumbers=null,d.nativeBarWidth=d.barHeight=d.barWidth=0,d.scrollbarsClipped=!1,d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null,d.alignWidgets=!1,d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null,d.maxLine=null,d.maxLineLength=0,d.maxLineChanged=!1,d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null,d.shift=!1,d.selForContextMenu=null,d.activeTouch=null,d.gutterSpecs=getGutters(options.gutters,options.lineNumbers),renderGutters(d),input.init(d)}DisplayUpdate.prototype.signal=function(emitter,type){hasHandler(emitter,type)&&this.events.push(arguments)},DisplayUpdate.prototype.finish=function(){for(var i=0;i<this.events.length;i++)signal.apply(null,this.events[i])};var wheelSamples=0,wheelPixelsPerUnit=null;function wheelEventDelta(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;return null==dx&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(dx=e.detail),null==dy&&e.detail&&e.axis==e.VERTICAL_AXIS?dy=e.detail:null==dy&&(dy=e.wheelDelta),{x:dx,y:dy}}function wheelEventPixels(delta){delta=wheelEventDelta(delta);return delta.x*=wheelPixelsPerUnit,delta.y*=wheelPixelsPerUnit,delta}function onScrollWheel(cm,e){var pixels=wheelEventDelta(e),dx=pixels.x,dy=pixels.y,display=cm.display,scroll=display.scroller,top=scroll.scrollWidth>scroll.clientWidth,bot=scroll.scrollHeight>scroll.clientHeight;if(dx&&top||dy&&bot){if(dy&&mac&&webkit)outer:for(var cur=e.target,view=display.view;cur!=scroll;cur=cur.parentNode)for(var i=0;i<view.length;i++)if(view[i].node==cur){cm.display.currentWheelTarget=cur;break outer}if(dx&&!gecko&&!presto&&null!=wheelPixelsPerUnit)return dy&&bot&&updateScrollTop(cm,Math.max(0,scroll.scrollTop+dy*wheelPixelsPerUnit)),setScrollLeft(cm,Math.max(0,scroll.scrollLeft+dx*wheelPixelsPerUnit)),(!dy||dy&&bot)&&e_preventDefault(e),void(display.wheelStartX=null);dy&&null!=wheelPixelsPerUnit&&(pixels=dy*wheelPixelsPerUnit,bot=(top=cm.doc.scrollTop)+display.wrapper.clientHeight,pixels<0?top=Math.max(0,top+pixels-50):bot=Math.min(cm.doc.height,bot+pixels+50),updateDisplaySimple(cm,{top:top,bottom:bot})),wheelSamples<20&&(null==display.wheelStartX?(display.wheelStartX=scroll.scrollLeft,display.wheelStartY=scroll.scrollTop,display.wheelDX=dx,display.wheelDY=dy,setTimeout(function(){var movedY,sample;null!=display.wheelStartX&&(sample=scroll.scrollLeft-display.wheelStartX,sample=(movedY=scroll.scrollTop-display.wheelStartY)&&display.wheelDY&&movedY/display.wheelDY||sample&&display.wheelDX&&sample/display.wheelDX,display.wheelStartX=display.wheelStartY=null,sample&&(wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1),++wheelSamples))},200)):(display.wheelDX+=dx,display.wheelDY+=dy))}}ie?wheelPixelsPerUnit=-.53:gecko?wheelPixelsPerUnit=15:chrome?wheelPixelsPerUnit=-.7:safari&&(wheelPixelsPerUnit=-1/3);var Selection=function(ranges,primIndex){this.ranges=ranges,this.primIndex=primIndex};Selection.prototype.primary=function(){return this.ranges[this.primIndex]},Selection.prototype.equals=function(other){if(other==this)return!0;if(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var here=this.ranges[i],there=other.ranges[i];if(!equalCursorPos(here.anchor,there.anchor)||!equalCursorPos(here.head,there.head))return!1}return!0},Selection.prototype.deepCopy=function(){for(var out=[],i=0;i<this.ranges.length;i++)out[i]=new Range(copyPos(this.ranges[i].anchor),copyPos(this.ranges[i].head));return new Selection(out,this.primIndex)},Selection.prototype.somethingSelected=function(){for(var i=0;i<this.ranges.length;i++)if(!this.ranges[i].empty())return!0;return!1},Selection.prototype.contains=function(pos,end){end=end||pos;for(var i=0;i<this.ranges.length;i++){var range=this.ranges[i];if(0<=cmp(end,range.from())&&cmp(pos,range.to())<=0)return i}return-1};var Range=function(anchor,head){this.anchor=anchor,this.head=head};function normalizeSelection(prim,ranges,primIndex){var mayTouch=prim&&prim.options.selectionsMayTouch,prim=ranges[primIndex];ranges.sort(function(a,b){return cmp(a.from(),b.from())}),primIndex=indexOf(ranges,prim);for(var i=1;i<ranges.length;i++){var from,cur=ranges[i],inv=ranges[i-1],to=cmp(inv.to(),cur.from());(mayTouch&&!cur.empty()?0<to:0<=to)&&(from=minPos(inv.from(),cur.from()),to=maxPos(inv.to(),cur.to()),inv=inv.empty()?cur.from()==cur.head:inv.from()==inv.head,i<=primIndex&&--primIndex,ranges.splice(--i,2,new Range(inv?to:from,inv?from:to)))}return new Selection(ranges,primIndex)}function simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0)}function changeEnd(change){return change.text?Pos(change.from.line+change.text.length-1,lst(change.text).length+(1==change.text.length?change.from.ch:0)):change.to}function adjustForChange(pos,change){if(cmp(pos,change.from)<0)return pos;if(cmp(pos,change.to)<=0)return changeEnd(change);var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;return pos.line==change.to.line&&(ch+=changeEnd(change).ch-change.to.ch),Pos(line,ch)}function computeSelAfterChange(doc,change){for(var out=[],i=0;i<doc.sel.ranges.length;i++){var range=doc.sel.ranges[i];out.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)))}return normalizeSelection(doc.cm,out,doc.sel.primIndex)}function offsetPos(pos,old,nw){return pos.line==old.line?Pos(nw.line,pos.ch-old.ch+nw.ch):Pos(nw.line+(pos.line-old.line),pos.ch)}function loadMode(cm){cm.doc.mode=getMode(cm.options,cm.doc.modeOption),resetModeState(cm)}function resetModeState(cm){cm.doc.iter(function(line){line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null)}),cm.doc.modeFrontier=cm.doc.highlightFrontier=cm.doc.first,startWorker(cm,100),cm.state.modeGen++,cm.curOp&&regChange(cm)}function isWholeLineUpdate(doc,change){return 0==change.from.ch&&0==change.to.ch&&""==lst(change.text)&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore)}function updateDoc(doc,change,markedSpans,estimateHeight$$1){function spansFor(n){return markedSpans?markedSpans[n]:null}function update(line,text,spans){!function updateLine(line,text,markedSpans,estHeight){line.text=text,line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null),null!=line.order&&(line.order=null),detachMarkedSpans(line),attachMarkedSpans(line,markedSpans),(estHeight=estHeight?estHeight(line):1)!=line.height&&updateLineHeight(line,estHeight)}(line,text,spans,estimateHeight$$1),signalLater(line,"change",line,change)}function linesFor(start,end){for(var result=[],i=start;i<end;++i)result.push(new Line(text[i],spansFor(i),estimateHeight$$1));return result}var added$1,from=change.from,to=change.to,text=change.text,firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line),lastText=lst(text),added$2=spansFor(text.length-1),nlines=to.line-from.line;change.full?(doc.insert(0,linesFor(0,text.length)),doc.remove(text.length,doc.size-text.length)):isWholeLineUpdate(doc,change)?(added$1=linesFor(0,text.length-1),update(lastLine,lastLine.text,added$2),nlines&&doc.remove(from.line,nlines),added$1.length&&doc.insert(from.line,added$1)):firstLine==lastLine?1==text.length?update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),added$2):((added$1=linesFor(1,text.length-1)).push(new Line(lastText+firstLine.text.slice(to.ch),added$2,estimateHeight$$1)),update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),doc.insert(from.line+1,added$1)):1==text.length?(update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0)),doc.remove(from.line+1,nlines)):(update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),update(lastLine,lastText+lastLine.text.slice(to.ch),added$2),added$2=linesFor(1,text.length-1),1<nlines&&doc.remove(from.line+1,nlines-1),doc.insert(from.line+1,added$2)),signalLater(doc,"change",doc,change)}function linkedDocs(doc,f,sharedHistOnly){!function propagate(doc,skip,sharedHist){if(doc.linked)for(var i=0;i<doc.linked.length;++i){var shared,rel=doc.linked[i];rel.doc!=skip&&(shared=sharedHist&&rel.sharedHist,sharedHistOnly&&!shared||(f(rel.doc,shared),propagate(rel.doc,doc,shared)))}}(doc,null,!0)}function attachDoc(cm,doc){if(doc.cm)throw new Error("This document is already in use.");cm.doc=doc,estimateLineHeights(doc.cm=cm),loadMode(cm),setDirectionClass(cm),cm.options.lineWrapping||findMaxLine(cm),cm.options.mode=doc.modeOption,regChange(cm)}function setDirectionClass(cm){("rtl"==cm.doc.direction?addClass:rmClass)(cm.display.lineDiv,"CodeMirror-rtl")}function History(startGen){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=startGen||1}function historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)};return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1),linkedDocs(doc,function(doc){return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1),0},!0),histChange}function clearSelectionEvents(array){for(;array.length;){if(!lst(array).ranges)break;array.pop()}}function addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history;hist.undone.length=0;var cur,last,time=+new Date;if((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&("+"==change.origin.charAt(0)&&hist.lastModTime>time-(doc.cm?doc.cm.options.historyEventDelay:500)||"*"==change.origin.charAt(0)))&&(cur=function lastChangeEvent(hist,force){return force?(clearSelectionEvents(hist.done),lst(hist.done)):hist.done.length&&!lst(hist.done).ranges?lst(hist.done):1<hist.done.length&&!hist.done[hist.done.length-2].ranges?(hist.done.pop(),lst(hist.done)):void 0}(hist,hist.lastOp==opId)))last=lst(cur.changes),0==cmp(change.from,change.to)&&0==cmp(change.from,last.to)?last.to=changeEnd(change):cur.changes.push(historyChangeFromChange(doc,change));else{var before=lst(hist.done);for(before&&before.ranges||pushSelectionToHistory(doc.sel,hist.done),cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation},hist.done.push(cur);hist.done.length>hist.undoDepth;)hist.done.shift(),hist.done[0].ranges||hist.done.shift()}hist.done.push(selAfter),hist.generation=++hist.maxGeneration,hist.lastModTime=hist.lastSelTime=time,hist.lastOp=hist.lastSelOp=opId,hist.lastOrigin=hist.lastSelOrigin=change.origin,last||signal(doc,"historyAdded")}function addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin;opId==hist.lastSelOp||origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||function selectionEventCanBeMerged(doc,ch,prev,sel){return"*"==(ch=ch.charAt(0))||"+"==ch&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500)}(doc,origin,lst(hist.done),sel))?hist.done[hist.done.length-1]=sel:pushSelectionToHistory(sel,hist.done),hist.lastSelTime=+new Date,hist.lastSelOrigin=origin,hist.lastSelOp=opId,options&&!1!==options.clearRedo&&clearSelectionEvents(hist.undone)}function pushSelectionToHistory(sel,dest){var top=lst(dest);top&&top.ranges&&top.equals(sel)||dest.push(sel)}function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;doc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){line.markedSpans&&((existing=existing||(change["spans_"+doc.id]={}))[n]=line.markedSpans),++n})}function getOldSpans(doc,change){var found=change["spans_"+doc.id];if(!found)return null;for(var nw=[],i=0;i<change.text.length;++i)nw.push(function removeClearedSpans(spans){if(!spans)return null;for(var out,i=0;i<spans.length;++i)spans[i].marker.explicitlyCleared?out=out||spans.slice(0,i):out&&out.push(spans[i]);return out?out.length?out:null:spans}(found[i]));return nw}function mergeOldSpans(doc,change){var old=getOldSpans(doc,change),stretched=stretchSpansOverChange(doc,change);if(!old)return stretched;if(!stretched)return old;for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur)spans:for(var j=0;j<stretchCur.length;++j){for(var span=stretchCur[j],k=0;k<oldCur.length;++k)if(oldCur[k].marker==span.marker)continue spans;oldCur.push(span)}else stretchCur&&(old[i]=stretchCur)}return old}function copyHistoryArray(events,newGroup,instantiateSel){for(var copy=[],i=0;i<events.length;++i){var event=events[i];if(event.ranges)copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event);else{var changes=event.changes,newChanges=[];copy.push({changes:newChanges});for(var j=0;j<changes.length;++j){var m,change=changes[j];if(newChanges.push({from:change.from,to:change.to,text:change.text}),newGroup)for(var prop in change)(m=prop.match(/^spans_(\d+)$/))&&-1<indexOf(newGroup,Number(m[1]))&&(lst(newChanges)[prop]=change[prop],delete change[prop])}}}return copy}function extendRange(posBefore,head,other,anchor){if(anchor){anchor=posBefore.anchor;return other&&((posBefore=cmp(head,anchor)<0)!=cmp(other,anchor)<0?(anchor=head,head=other):posBefore!=cmp(head,other)<0&&(head=other)),new Range(anchor,head)}return new Range(other||head,head)}function extendSelection(doc,head,other,options,extend){null==extend&&(extend=doc.cm&&(doc.cm.display.shift||doc.extend)),setSelection(doc,new Selection([extendRange(doc.sel.primary(),head,other,extend)],0),options)}function extendSelections(doc,heads,options){for(var out=[],extend=doc.cm&&(doc.cm.display.shift||doc.extend),i=0;i<doc.sel.ranges.length;i++)out[i]=extendRange(doc.sel.ranges[i],heads[i],null,extend);setSelection(doc,normalizeSelection(doc.cm,out,doc.sel.primIndex),options)}function replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0);ranges[i]=range,setSelection(doc,normalizeSelection(doc.cm,ranges,doc.sel.primIndex),options)}function setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options)}function setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done);last&&last.ranges?setSelectionNoUndo(doc,done[done.length-1]=sel,options):setSelection(doc,sel,options)}function setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options),addSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options)}function setSelectionNoUndo(doc,sel,options){(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange"))&&(sel=function filterSelectionChange(doc,sel,obj){return obj={ranges:sel.ranges,update:function(ranges){this.ranges=[];for(var i=0;i<ranges.length;i++)this.ranges[i]=new Range(clipPos(doc,ranges[i].anchor),clipPos(doc,ranges[i].head))},origin:obj&&obj.origin},signal(doc,"beforeSelectionChange",doc,obj),doc.cm&&signal(doc.cm,"beforeSelectionChange",doc.cm,obj),obj.ranges!=sel.ranges?normalizeSelection(doc.cm,obj.ranges,obj.ranges.length-1):sel}(doc,sel,options));var bias=options&&options.bias||(cmp(sel.primary().head,doc.sel.primary().head)<0?-1:1);setSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,!0)),options&&!1===options.scroll||!doc.cm||ensureCursorVisible(doc.cm)}function setSelectionInner(doc,sel){sel.equals(doc.sel)||(doc.sel=sel,doc.cm&&(doc.cm.curOp.updateInput=1,doc.cm.curOp.selectionChanged=!0,signalCursorActivity(doc.cm)),signalLater(doc,"cursorActivity",doc))}function reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,!1))}function skipAtomicInSelection(doc,sel,bias,mayClear){for(var out,i=0;i<sel.ranges.length;i++){var range=sel.ranges[i],newHead=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i],newAnchor=skipAtomic(doc,range.anchor,newHead&&newHead.anchor,bias,mayClear),newHead=skipAtomic(doc,range.head,newHead&&newHead.head,bias,mayClear);!out&&newAnchor==range.anchor&&newHead==range.head||((out=out||sel.ranges.slice(0,i))[i]=new Range(newAnchor,newHead))}return out?normalizeSelection(doc.cm,out,sel.primIndex):sel}function skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line);if(line.markedSpans)for(var i=0;i<line.markedSpans.length;++i){var diff=line.markedSpans[i],far=diff.marker,preventCursorLeft="selectLeft"in far?!far.selectLeft:far.inclusiveLeft,preventCursorRight="selectRight"in far?!far.selectRight:far.inclusiveRight;if((null==diff.from||(preventCursorLeft?diff.from<=pos.ch:diff.from<pos.ch))&&(null==diff.to||(preventCursorRight?diff.to>=pos.ch:diff.to>pos.ch))){if(mayClear&&(signal(far,"beforeCursorEnter"),far.explicitlyCleared)){if(line.markedSpans){--i;continue}break}if(far.atomic){if(oldPos){var near=far.find(dir<0?1:-1),diff=void 0;if((near=(dir<0?preventCursorRight:preventCursorLeft)?movePos(doc,near,-dir,near&&near.line==pos.line?line:null):near)&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(dir<0?diff<0:0<diff))return skipAtomicInner(doc,near,pos,dir,mayClear)}far=far.find(dir<0?-1:1);return(far=(dir<0?preventCursorLeft:preventCursorRight)?movePos(doc,far,dir,far.line==pos.line?line:null):far)?skipAtomicInner(doc,far,pos,dir,mayClear):null}}}return pos}function skipAtomic(doc,pos,oldPos,found,mayClear){found=found||1,found=skipAtomicInner(doc,pos,oldPos,found,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,found,!0)||skipAtomicInner(doc,pos,oldPos,-found,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,-found,!0);return found||(doc.cantEdit=!0,Pos(doc.first,0))}function movePos(doc,pos,dir,line){return dir<0&&0==pos.ch?pos.line>doc.first?clipPos(doc,Pos(pos.line-1)):null:0<dir&&pos.ch==(line||getLine(doc,pos.line)).text.length?pos.line<doc.first+doc.size-1?Pos(pos.line+1,0):null:new Pos(pos.line,pos.ch+dir)}function selectAll(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll)}function filterChange(doc,change,update){var obj={canceled:!1,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){return obj.canceled=!0}};return update&&(obj.update=function(from,to,text,origin){from&&(obj.from=clipPos(doc,from)),to&&(obj.to=clipPos(doc,to)),text&&(obj.text=text),void 0!==origin&&(obj.origin=origin)}),signal(doc,"beforeChange",doc,obj),doc.cm&&signal(doc.cm,"beforeChange",doc.cm,obj),obj.canceled?(doc.cm&&(doc.cm.curOp.updateInput=2),null):{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}function makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp)return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly);if(doc.cm.state.suppressEdits)return}if(!(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"))||(change=filterChange(doc,change,!0))){var split=sawReadOnlySpans&&!ignoreReadOnly&&function removeReadOnlyRanges(doc,from,to){var markers=null;if(doc.iter(from.line,to.line+1,function(line){if(line.markedSpans)for(var i=0;i<line.markedSpans.length;++i){var mark=line.markedSpans[i].marker;!mark.readOnly||markers&&-1!=indexOf(markers,mark)||(markers=markers||[]).push(mark)}}),!markers)return null;for(var parts=[{from:from,to:to}],i=0;i<markers.length;++i)for(var mk=markers[i],m=mk.find(0),j=0;j<parts.length;++j){var newParts,dfrom,dto,p=parts[j];cmp(p.to,m.from)<0||0<cmp(p.from,m.to)||(newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to),(dfrom<0||!mk.inclusiveLeft&&!dfrom)&&newParts.push({from:p.from,to:m.from}),(0<dto||!mk.inclusiveRight&&!dto)&&newParts.push({from:m.to,to:p.to}),parts.splice.apply(parts,newParts),j+=newParts.length-3)}return parts}(doc,change.from,change.to);if(split)for(var i=split.length-1;0<=i;--i)makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text,origin:change.origin});else makeChangeInner(doc,change)}}function makeChangeInner(doc,change){var selAfter,rebased;1==change.text.length&&""==change.text[0]&&0==cmp(change.from,change.to)||(selAfter=computeSelAfterChange(doc,change),addChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN),makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change)),rebased=[],linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change))}))}function makeChangeFromHistory(doc,type,allowSelectionOnly){var suppress=doc.cm&&doc.cm.state.suppressEdits;if(!suppress||allowSelectionOnly){for(var event,hist=doc.history,selAfter=doc.sel,source="undo"==type?hist.done:hist.undone,dest="undo"==type?hist.undone:hist.done,i=0;i<source.length&&(event=source[i],allowSelectionOnly?!event.ranges||event.equals(doc.sel):event.ranges);i++);if(i!=source.length){for(hist.lastOrigin=hist.lastSelOrigin=null;;){if(!(event=source.pop()).ranges){if(suppress)return void source.push(event);break}if(pushSelectionToHistory(event,dest),allowSelectionOnly&&!event.equals(doc.sel))return void setSelection(doc,event,{clearRedo:!1});selAfter=event}var antiChanges=[];pushSelectionToHistory(selAfter,dest),dest.push({changes:antiChanges,generation:hist.generation}),hist.generation=event.generation||++hist.maxGeneration;for(var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"),i$1=event.changes.length-1;0<=i$1;--i$1){var returned=function(i){var change=event.changes[i];if(change.origin=type,filter&&!filterChange(doc,change,!1))return source.length=0,{};antiChanges.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change):lst(source);makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change)),!i&&doc.cm&&doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)});var rebased=[];linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change))})}(i$1);if(returned)return returned.v}}}}function shiftDoc(doc,distance){if(0!=distance&&(doc.first+=distance,doc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch))}),doc.sel.primIndex),doc.cm)){regChange(doc.cm,doc.first,doc.first-distance,distance);for(var d=doc.cm.display,l=d.viewFrom;l<d.viewTo;l++)regLineChange(doc.cm,l,"gutter")}}function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans);var last;change.to.line<doc.first?shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line)):change.from.line>doc.lastLine()||(change.from.line<doc.first&&(shiftDoc(doc,last=change.text.length-1-(doc.first-change.from.line)),change={from:Pos(doc.first,0),to:Pos(change.to.line+last,change.to.ch),text:[lst(change.text)],origin:change.origin}),last=doc.lastLine(),(change=change.to.line>last?{from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin}:change).removed=getBetween(doc,change.from,change.to),selAfter=selAfter||computeSelAfterChange(doc,change),doc.cm?function makeChangeSingleDocInEditor(cm,obj,spans){var changesHandler=cm.doc,display=cm.display,from=obj.from,to=obj.to,recomputeMaxLength=!1,changeHandler=from.line;cm.options.lineWrapping||(changeHandler=lineNo(visualLine(getLine(changesHandler,from.line))),changesHandler.iter(changeHandler,to.line+1,function(line){if(line==display.maxLine)return recomputeMaxLength=!0})),-1<changesHandler.sel.contains(obj.from,obj.to)&&signalCursorActivity(cm),updateDoc(changesHandler,obj,spans,estimateHeight(cm)),cm.options.lineWrapping||(changesHandler.iter(changeHandler,from.line+obj.text.length,function(line){var len=lineLength(line);len>display.maxLineLength&&(display.maxLine=line,display.maxLineLength=len,display.maxLineChanged=!0,recomputeMaxLength=!1)}),recomputeMaxLength&&(cm.curOp.updateMaxLine=!0)),function retreatFrontier(doc,n){if(doc.modeFrontier=Math.min(doc.modeFrontier,n),!(doc.highlightFrontier<n-10)){for(var start=doc.first,line=n-1;start<line;line--){var saved=getLine(doc,line).stateAfter;if(saved&&(!(saved instanceof SavedContext)||line+saved.lookAhead<n)){start=line+1;break}}doc.highlightFrontier=Math.min(doc.highlightFrontier,start)}}(changesHandler,from.line),startWorker(cm,400),changeHandler=obj.text.length-(to.line-from.line)-1,obj.full?regChange(cm):from.line!=to.line||1!=obj.text.length||isWholeLineUpdate(cm.doc,obj)?regChange(cm,from.line,to.line+1,changeHandler):regLineChange(cm,from.line,"text"),changesHandler=hasHandler(cm,"changes"),((changeHandler=hasHandler(cm,"change"))||changesHandler)&&(obj={from:from,to:to,text:obj.text,removed:obj.removed,origin:obj.origin},changeHandler&&signalLater(cm,"change",cm,obj),changesHandler&&(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj)),cm.display.selForContextMenu=null}(doc.cm,change,spans):updateDoc(doc,change,spans),setSelectionNoUndo(doc,selAfter,sel_dontScroll),doc.cantEdit&&skipAtomic(doc,Pos(doc.firstLine(),0))&&(doc.cantEdit=!1))}function replaceRange(doc,code,from,to,origin){var assign;cmp(to=to||from,from)<0&&(from=(assign=[to,from])[0],to=assign[1]),"string"==typeof code&&(code=doc.splitLines(code)),makeChange(doc,{from:from,to:to,text:code,origin:origin})}function rebaseHistSelSingle(pos,from,to,diff){to<pos.line?pos.line+=diff:from<pos.line&&(pos.line=from,pos.ch=0)}function rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){var sub=array[i],ok=!0;if(sub.ranges){sub.copied||((sub=array[i]=sub.deepCopy()).copied=!0);for(var j=0;j<sub.ranges.length;j++)rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff),rebaseHistSelSingle(sub.ranges[j].head,from,to,diff)}else{for(var j$1=0;j$1<sub.changes.length;++j$1){var cur=sub.changes[j$1];if(to<cur.from.line)cur.from=Pos(cur.from.line+diff,cur.from.ch),cur.to=Pos(cur.to.line+diff,cur.to.ch);else if(from<=cur.to.line){ok=!1;break}}ok||(array.splice(0,i+1),i=0)}}}function rebaseHist(hist,diff){var from=diff.from.line,to=diff.to.line,diff=diff.text.length-(to-from)-1;rebaseHistArray(hist.done,from,to,diff),rebaseHistArray(hist.undone,from,to,diff)}function changeLine(doc,handle,changeType,op){var no=handle,line=handle;return"number"==typeof handle?line=getLine(doc,clipLine(doc,handle)):no=lineNo(handle),null==no?null:(op(line,no)&&doc.cm&&regLineChange(doc.cm,no,changeType),line)}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var height=0,i=0;i<lines.length;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}function BranchChunk(children){this.children=children;for(var size=0,height=0,i=0;i<children.length;++i){var ch=children[i];size+=ch.chunkSize(),height+=ch.height,ch.parent=this}this.size=size,this.height=height,this.parent=null}Range.prototype.from=function(){return minPos(this.anchor,this.head)},Range.prototype.to=function(){return maxPos(this.anchor,this.head)},Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},LeafChunk.prototype={chunkSize:function(){return this.lines.length},removeInner:function(at,n){for(var i=at,e=at+n;i<e;++i){var line=this.lines[i];this.height-=line.height,function cleanUpLine(line){line.parent=null,detachMarkedSpans(line)}(line),signalLater(line,"delete")}this.lines.splice(at,n)},collapse:function(lines){lines.push.apply(lines,this.lines)},insertInner:function(at,lines,height){this.height+=height,this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0;i<lines.length;++i)lines[i].parent=this},iterN:function(at,n,op){for(var e=at+n;at<e;++at)if(op(this.lines[at]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},removeInner:function(at,n){this.size-=n;for(var lines,i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;if(child.removeInner(at,rm),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null),0==(n-=rm))break;at=0}else at-=sz}this.size-n<25&&(1<this.children.length||!(this.children[0]instanceof LeafChunk))&&(lines=[],this.collapse(lines),this.children=[new LeafChunk(lines)],this.children[0].parent=this)},collapse:function(lines){for(var i=0;i<this.children.length;++i)this.children[i].collapse(lines)},insertInner:function(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){if(child.insertInner(at,lines,height),child.lines&&50<child.lines.length){for(var remaining=child.lines.length%25+25,pos=remaining;pos<child.lines.length;){var leaf=new LeafChunk(child.lines.slice(pos,pos+=25));child.height-=leaf.height,this.children.splice(++i,0,leaf),leaf.parent=this}child.lines=child.lines.slice(0,remaining),this.maybeSpill()}break}at-=sz}},maybeSpill:function(){if(!(this.children.length<=10)){var me=this;do{var copy,sibling=new BranchChunk(me.children.splice(me.children.length-5,5))}while(me.parent?(me.size-=sibling.size,me.height-=sibling.height,copy=indexOf(me.parent.children,me),me.parent.children.splice(copy+1,0,sibling)):(((copy=new BranchChunk(me.children)).parent=me).children=[copy,sibling],me=copy),sibling.parent=me.parent,10<me.children.length);me.parent.maybeSpill()}},iterN:function(at,n,op){for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op))return!0;if(0==(n-=used))break;at=0}else at-=sz}}};function LineWidget(doc,node,options){if(options)for(var opt in options)options.hasOwnProperty(opt)&&(this[opt]=options[opt]);this.doc=doc,this.node=node}function adjustScrollWhenAboveVisible(cm,line,diff){heightAtLine(line)<(cm.curOp&&cm.curOp.scrollTop||cm.doc.scrollTop)&&addToScrollTop(cm,diff)}LineWidget.prototype.clear=function(){var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line);if(null!=no&&ws){for(var i=0;i<ws.length;++i)ws[i]==this&&ws.splice(i--,1);ws.length||(line.widgets=null);var height=widgetHeight(this);updateLineHeight(line,Math.max(0,line.height-height)),cm&&(runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height),regLineChange(cm,no,"widget")}),signalLater(cm,"lineWidgetCleared",cm,this,no))}},LineWidget.prototype.changed=function(){var this$1=this,oldH=this.height,cm=this.doc.cm,line=this.line;this.height=null;var diff=widgetHeight(this)-oldH;diff&&(lineIsHidden(this.doc,line)||updateLineHeight(line,line.height+diff),cm&&runInOp(cm,function(){cm.curOp.forceUpdate=!0,adjustScrollWhenAboveVisible(cm,line,diff),signalLater(cm,"lineWidgetChanged",cm,this$1,lineNo(line))}))},eventMixin(LineWidget);var nextMarkerId=0,TextMarker=function(doc,type){this.lines=[],this.type=type,this.doc=doc,this.id=++nextMarkerId};function markText(doc,from,to,options,diff){if(options&&options.shared)return function markTextShared(doc,from,to,options,type){(options=copyObj(options)).shared=!1;var markers=[markText(doc,from,to,options,type)],primary=markers[0],widget=options.widgetNode;return linkedDocs(doc,function(doc){widget&&(options.widgetNode=widget.cloneNode(!0)),markers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;++i)if(doc.linked[i].isParent)return;primary=lst(markers)}),new SharedTextMarker(markers,primary)}(doc,from,to,options,diff);if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,markText)(doc,from,to,options,diff);var marker=new TextMarker(doc,diff),diff=cmp(from,to);if(options&&copyObj(options,marker,!1),0<diff||0==diff&&!1!==marker.clearWhenEmpty)return marker;if(marker.replacedWith&&(marker.collapsed=!0,marker.widgetNode=eltP("span",[marker.replacedWith],"CodeMirror-widget"),options.handleMouseEvents||marker.widgetNode.setAttribute("cm-ignore-events","true"),options.insertLeft&&(marker.widgetNode.insertLeft=!0)),marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker))throw new Error("Inserting collapsed marker partially overlapping an existing one");!function seeCollapsedSpans(){sawCollapsedSpans=!0}()}marker.addToHistory&&addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN);var updateMaxLine,curLine=from.line,cm=doc.cm;if(doc.iter(curLine,to.line+1,function(line){cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine&&(updateMaxLine=!0),marker.collapsed&&curLine!=from.line&&updateLineHeight(line,0),function addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span],span.marker.attachLine(line)}(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null)),++curLine}),marker.collapsed&&doc.iter(from.line,to.line+1,function(line){lineIsHidden(doc,line)&&updateLineHeight(line,0)}),marker.clearOnEnter&&on(marker,"beforeCursorEnter",function(){return marker.clear()}),marker.readOnly&&(function seeReadOnlySpans(){sawReadOnlySpans=!0}(),(doc.history.done.length||doc.history.undone.length)&&doc.clearHistory()),marker.collapsed&&(marker.id=++nextMarkerId,marker.atomic=!0),cm){if(updateMaxLine&&(cm.curOp.updateMaxLine=!0),marker.collapsed)regChange(cm,from.line,to.line+1);else if(marker.className||marker.startStyle||marker.endStyle||marker.css||marker.attributes||marker.title)for(var i=from.line;i<=to.line;i++)regLineChange(cm,i,"text");marker.atomic&&reCheckSelection(cm.doc),signalLater(cm,"markerAdded",cm,marker)}return marker}TextMarker.prototype.clear=function(){if(!this.explicitlyCleared){var found,cm=this.doc.cm,withOp=cm&&!cm.curOp;withOp&&startOperation(cm),!hasHandler(this,"clear")||(found=this.find())&&signalLater(this,"clear",found.from,found.to);for(var min=null,max=null,i=0;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);cm&&!this.collapsed?regLineChange(cm,lineNo(line),"text"):cm&&(null!=span.to&&(max=lineNo(line)),null!=span.from&&(min=lineNo(line))),line.markedSpans=function removeMarkedSpan(spans,span){for(var r,i=0;i<spans.length;++i)spans[i]!=span&&(r=r||[]).push(spans[i]);return r}(line.markedSpans,span),null==span.from&&this.collapsed&&!lineIsHidden(this.doc,line)&&cm&&updateLineHeight(line,textHeight(cm.display))}if(cm&&this.collapsed&&!cm.options.lineWrapping)for(var i$1=0;i$1<this.lines.length;++i$1){var visual=visualLine(this.lines[i$1]),len=lineLength(visual);len>cm.display.maxLineLength&&(cm.display.maxLine=visual,cm.display.maxLineLength=len,cm.display.maxLineChanged=!0)}null!=min&&cm&&this.collapsed&&regChange(cm,min,max+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,cm&&reCheckSelection(cm.doc)),cm&&signalLater(cm,"markerCleared",cm,this,min,max),withOp&&endOperation(cm),this.parent&&this.parent.clear()}},TextMarker.prototype.find=function(side,lineObj){var from,to;null==side&&"bookmark"==this.type&&(side=1);for(var i=0;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);if(null!=span.from&&(from=Pos(lineObj?line:lineNo(line),span.from),-1==side))return from;if(null!=span.to&&(to=Pos(lineObj?line:lineNo(line),span.to),1==side))return to}return from&&{from:from,to:to}},TextMarker.prototype.changed=function(){var this$1=this,pos=this.find(-1,!0),widget=this,cm=this.doc.cm;pos&&cm&&runInOp(cm,function(){var line=pos.line,dHeight=lineNo(pos.line),dHeight=findViewForLine(cm,dHeight);dHeight&&(clearLineMeasurementCacheFor(dHeight),cm.curOp.selectionChanged=cm.curOp.forceUpdate=!0),cm.curOp.updateMaxLine=!0,lineIsHidden(widget.doc,line)||null==widget.height||(dHeight=widget.height,widget.height=null,(dHeight=widgetHeight(widget)-dHeight)&&updateLineHeight(line,line.height+dHeight)),signalLater(cm,"markerChanged",cm,this$1)})},TextMarker.prototype.attachLine=function(line){var op;!this.lines.length&&this.doc.cm&&((op=this.doc.cm.curOp).maybeHiddenMarkers&&-1!=indexOf(op.maybeHiddenMarkers,this)||(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this)),this.lines.push(line)},TextMarker.prototype.detachLine=function(op){this.lines.splice(indexOf(this.lines,op),1),!this.lines.length&&this.doc.cm&&((op=this.doc.cm.curOp).maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this)},eventMixin(TextMarker);var SharedTextMarker=function(markers,primary){this.markers=markers,this.primary=primary;for(var i=0;i<markers.length;++i)markers[i].parent=this};function findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent})}function detachSharedMarkers(markers){for(var i=0;i<markers.length;i++)!function(i){var marker=markers[i],linked=[marker.primary.doc];linkedDocs(marker.primary.doc,function(d){return linked.push(d)});for(var j=0;j<marker.markers.length;j++){var subMarker=marker.markers[j];-1==indexOf(linked,subMarker.doc)&&(subMarker.parent=null,marker.markers.splice(j--,1))}}(i)}SharedTextMarker.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var i=0;i<this.markers.length;++i)this.markers[i].clear();signalLater(this,"clear")}},SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj)},eventMixin(SharedTextMarker);var nextDocId=0,Doc=function(text,mode,start,lineSep,direction){if(!(this instanceof Doc))return new Doc(text,mode,start,lineSep,direction);null==start&&(start=0),BranchChunk.call(this,[new LeafChunk([new Line("",null)])]),this.first=start,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1;start=Pos(this.modeFrontier=this.highlightFrontier=start,0);this.sel=simpleSelection(start),this.history=new History(null),this.id=++nextDocId,this.modeOption=mode,this.lineSep=lineSep,this.direction="rtl"==direction?"rtl":"ltr",this.extend=!1,"string"==typeof text&&(text=this.splitLines(text)),updateDoc(this,{from:start,to:start,text:text}),setSelection(this,simpleSelection(start),sel_dontScroll)};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){op?this.iterN(from-this.first,to-from,op):this.iterN(this.first,this.first+this.size,from)},insert:function(at,lines){for(var height=0,i=0;i<lines.length;++i)height+=lines[i].height;this.insertInner(at-this.first,lines,height)},remove:function(at,n){this.removeInner(at-this.first,n)},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size);return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1;makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:!0},!0),this.cm&&scrollToCoords(this.cm,0,0),setSelection(this,simpleSelection(top),sel_dontScroll)}),replaceRange:function(code,from,to,origin){replaceRange(this,code,from=clipPos(this,from),to=to?clipPos(this,to):from,origin)},getRange:function(from,lines,lineSep){lines=getBetween(this,clipPos(this,from),clipPos(this,lines));return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},getLine:function(l){l=this.getLineHandle(l);return l&&l.text},getLineHandle:function(line){if(isLine(this,line))return getLine(this,line)},getLineNumber:lineNo,getLineHandleVisualStart:function(line){return visualLine(line="number"==typeof line?getLine(this,line):line)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(pos){return clipPos(this,pos)},getCursor:function(start){var pos=this.sel.primary(),pos=null==start||"head"==start?pos.head:"anchor"==start?pos.anchor:"end"==start||"to"==start||!1===start?pos.to():pos.from();return pos},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,clipPos(this,"number"==typeof line?Pos(line,ch||0):line),null,options)}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),options)}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,clipPos(this,head),other&&clipPos(this,other),options)}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options)}),extendSelectionsBy:docMethodOp(function(f,options){extendSelections(this,clipPosArray(this,map(this.sel.ranges,f)),options)}),setSelections:docMethodOp(function(ranges,primary,options){if(ranges.length){for(var out=[],i=0;i<ranges.length;i++)out[i]=new Range(clipPos(this,ranges[i].anchor),clipPos(this,ranges[i].head));null==primary&&(primary=Math.min(ranges.length-1,this.sel.primIndex)),setSelection(this,normalizeSelection(this.cm,out,primary),options)}}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0);ranges.push(new Range(clipPos(this,anchor),clipPos(this,head||anchor))),setSelection(this,normalizeSelection(this.cm,ranges,ranges.length-1),options)}),getSelection:function(lineSep){for(var ranges=this.sel.ranges,i=0;i<ranges.length;i++)var sel=getBetween(this,ranges[i].from(),ranges[i].to()),lines=lines?lines.concat(sel):sel;return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},getSelections:function(lineSep){for(var parts=[],ranges=this.sel.ranges,i=0;i<ranges.length;i++){var sel=getBetween(this,ranges[i].from(),ranges[i].to());!1!==lineSep&&(sel=sel.join(lineSep||this.lineSeparator())),parts[i]=sel}return parts},replaceSelection:function(code,collapse,origin){for(var dup=[],i=0;i<this.sel.ranges.length;i++)dup[i]=code;this.replaceSelections(dup,collapse,origin||"+input")},replaceSelections:docMethodOp(function(code,newSel,origin){for(var changes=[],sel=this.sel,i=0;i<sel.ranges.length;i++){var range$$1=sel.ranges[i];changes[i]={from:range$$1.from(),to:range$$1.to(),text:this.splitLines(code[i]),origin:origin}}for(var newSel=newSel&&"end"!=newSel&&function computeReplacedSel(doc,changes,hint){for(var out=[],newPrev=oldPrev=Pos(doc.first,0),i=0;i<changes.length;i++){var inv=changes[i],from=offsetPos(inv.from,oldPrev,newPrev),to=offsetPos(changeEnd(inv),oldPrev,newPrev),oldPrev=inv.to,newPrev=to;"around"==hint?(inv=cmp((inv=doc.sel.ranges[i]).head,inv.anchor)<0,out[i]=new Range(inv?to:from,inv?from:to)):out[i]=new Range(from,from)}return new Selection(out,doc.sel.primIndex)}(this,changes,newSel),i$1=changes.length-1;0<=i$1;i$1--)makeChange(this,changes[i$1]);newSel?setSelectionReplaceHistory(this,newSel):this.cm&&ensureCursorVisible(this.cm)}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo")}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo")}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",!0)}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",!0)}),setExtending:function(val){this.extend=val},getExtending:function(){return this.extend},historySize:function(){for(var hist=this.history,done=0,undone=0,i=0;i<hist.done.length;i++)hist.done[i].ranges||++done;for(var i$1=0;i$1<hist.undone.length;i$1++)hist.undone[i$1].ranges||++undone;return{undo:done,redo:undone}},clearHistory:function(){this.history=new History(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(forceSplit){return forceSplit&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(histData){var hist=this.history=new History(this.history.maxGeneration);hist.done=copyHistoryArray(histData.done.slice(0),null,!0),hist.undone=copyHistoryArray(histData.undone.slice(0),null,!0)},setGutterMarker:docMethodOp(function(line,gutterID,value){return changeLine(this,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});return!(markers[gutterID]=value)&&isEmpty(markers)&&(line.gutterMarkers=null),1})}),clearGutter:docMethodOp(function(gutterID){var this$1=this;this.iter(function(line){line.gutterMarkers&&line.gutterMarkers[gutterID]&&changeLine(this$1,line,"gutter",function(){return line.gutterMarkers[gutterID]=null,isEmpty(line.gutterMarkers)&&(line.gutterMarkers=null),1})})}),lineInfo:function(line){var n;if("number"==typeof line){if(!isLine(this,line))return null;if(!(line=getLine(this,n=line)))return null}else if(null==(n=lineNo(line)))return null;return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,"gutter"==where?"gutter":"class",function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"gutter"==where?"gutterClass":"wrapClass";if(line[prop]){if(classTest(cls).test(line[prop]))return;line[prop]+=" "+cls}else line[prop]=cls;return 1})}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,"gutter"==where?"gutter":"class",function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"gutter"==where?"gutterClass":"wrapClass",cur=line[prop];if(cur){if(null==cls)line[prop]=null;else{var found=cur.match(classTest(cls));if(!found)return;var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(found.index&&end!=cur.length?" ":"")+cur.slice(end)||null}return 1}})}),addLineWidget:docMethodOp(function(handle,node,options){return function addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options),cm=doc.cm;return cm&&widget.noHScroll&&(cm.display.alignWidgets=!0),changeLine(doc,handle,"widget",function(line){var aboveVisible=line.widgets||(line.widgets=[]);return null==widget.insertAt?aboveVisible.push(widget):aboveVisible.splice(Math.min(aboveVisible.length-1,Math.max(0,widget.insertAt)),0,widget),widget.line=line,cm&&!lineIsHidden(doc,line)&&(aboveVisible=heightAtLine(line)<doc.scrollTop,updateLineHeight(line,line.height+widgetHeight(widget)),aboveVisible&&addToScrollTop(cm,widget.height),cm.curOp.forceUpdate=!0),1}),cm&&signalLater(cm,"lineWidgetAdded",cm,widget,"number"==typeof handle?handle:lineNo(handle)),widget}(this,handle,node,options)}),removeLineWidget:function(widget){widget.clear()},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,options&&options.type||"range")},setBookmark:function(pos,realOpts){realOpts={replacedWith:realOpts&&(null==realOpts.nodeType?realOpts.widget:realOpts),insertLeft:realOpts&&realOpts.insertLeft,clearWhenEmpty:!1,shared:realOpts&&realOpts.shared,handleMouseEvents:realOpts&&realOpts.handleMouseEvents};return markText(this,pos=clipPos(this,pos),pos,realOpts,"bookmark")},findMarksAt:function(pos){var markers=[],spans=getLine(this,(pos=clipPos(this,pos)).line).markedSpans;if(spans)for(var i=0;i<spans.length;++i){var span=spans[i];(null==span.from||span.from<=pos.ch)&&(null==span.to||span.to>=pos.ch)&&markers.push(span.marker.parent||span.marker)}return markers},findMarks:function(from,to,filter){from=clipPos(this,from),to=clipPos(this,to);var found=[],lineNo$$1=from.line;return this.iter(from.line,to.line+1,function(line){var spans=line.markedSpans;if(spans)for(var i=0;i<spans.length;i++){var span=spans[i];null!=span.to&&lineNo$$1==from.line&&from.ch>=span.to||null==span.from&&lineNo$$1!=from.line||null!=span.from&&lineNo$$1==to.line&&span.from>=to.ch||filter&&!filter(span.marker)||found.push(span.marker.parent||span.marker)}++lineNo$$1}),found},getAllMarks:function(){var markers=[];return this.iter(function(line){var sps=line.markedSpans;if(sps)for(var i=0;i<sps.length;++i)null!=sps[i].from&&markers.push(sps[i].marker)}),markers},posFromIndex:function(off){var ch,lineNo$$1=this.first,sepSize=this.lineSeparator().length;return this.iter(function(sz){sz=sz.text.length+sepSize;if(off<sz)return ch=off,!0;off-=sz,++lineNo$$1}),clipPos(this,Pos(lineNo$$1,ch))},indexFromPos:function(coords){var index=(coords=clipPos(this,coords)).ch;if(coords.line<this.first||coords.ch<0)return 0;var sepSize=this.lineSeparator().length;return this.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize}),index},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return doc.scrollTop=this.scrollTop,doc.scrollLeft=this.scrollLeft,doc.sel=this.sel,doc.extend=!1,copyHistory&&(doc.history.undoDepth=this.history.undoDepth,doc.setHistory(this.getHistory())),doc},linkedDoc:function(options){options=options||{};var copy=this.first,to=this.first+this.size;null!=options.from&&options.from>copy&&(copy=options.from),null!=options.to&&options.to<to&&(to=options.to);copy=new Doc(getLines(this,copy,to),options.mode||this.modeOption,copy,this.lineSep,this.direction);return options.sharedHist&&(copy.history=this.history),(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist}),copy.linked=[{doc:this,isParent:!0,sharedHist:options.sharedHist}],function copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],subMark=marker.find(),mFrom=doc.clipPos(subMark.from),subMark=doc.clipPos(subMark.to);cmp(mFrom,subMark)&&(subMark=markText(doc,mFrom,subMark,marker.primary,marker.primary.type),marker.markers.push(subMark),subMark.parent=marker)}}(copy,findSharedMarkers(this)),copy},unlinkDoc:function(other){var splitIds;if(other instanceof CodeMirror&&(other=other.doc),this.linked)for(var i=0;i<this.linked.length;++i)if(this.linked[i].doc==other){this.linked.splice(i,1),other.unlinkDoc(this),detachSharedMarkers(findSharedMarkers(this));break}other.history==this.history&&(splitIds=[other.id],linkedDocs(other,function(doc){return splitIds.push(doc.id)},!0),other.history=new History(null),other.history.done=copyHistoryArray(this.history.done,splitIds),other.history.undone=copyHistoryArray(this.history.undone,splitIds))},iterLinkedDocs:function(f){linkedDocs(this,f)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(str){return this.lineSep?str.split(this.lineSep):splitLinesAuto(str)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:docMethodOp(function(dir){(dir="rtl"!=dir?"ltr":dir)!=this.direction&&(this.direction=dir,this.iter(function(line){return line.order=null}),this.cm&&function directionChanged(cm){runInOp(cm,function(){setDirectionClass(cm),regChange(cm)})}(this.cm))})}),Doc.prototype.eachLine=Doc.prototype.iter;var lastDrop=0;function onDrop(e){var cm=this;if(clearDragCursor(cm),!signalDOMEvent(cm,e)&&!eventInWidget(cm.display,e)){e_preventDefault(e),ie&&(lastDrop=+new Date);var pos=posFromMouse(cm,e,!0),files=e.dataTransfer.files;if(pos&&!cm.isReadOnly())if(files&&files.length&&window.FileReader&&window.File)for(var n=files.length,text=Array(n),read=0,i=0;i<n;++i)!function(file,i){var reader;cm.options.allowDropFileTypes&&-1==indexOf(cm.options.allowDropFileTypes,file.type)||((reader=new FileReader).onload=operation(cm,function(){var change=reader.result;/[\x00-\x08\x0e-\x1f]{2}/.test(change)&&(change=""),text[i]=change,++read==n&&(change={from:pos=clipPos(cm.doc,pos),to:pos,text:cm.doc.splitLines(text.join(cm.doc.lineSeparator())),origin:"paste"},makeChange(cm.doc,change),setSelectionReplaceHistory(cm.doc,simpleSelection(pos,changeEnd(change))))}),reader.readAsText(file))}(files[i],i);else{if(cm.state.draggingText&&-1<cm.doc.sel.contains(pos))return cm.state.draggingText(e),void setTimeout(function(){return cm.display.input.focus()},20);try{var selected,text$1=e.dataTransfer.getData("Text");if(text$1){if(cm.state.draggingText&&!cm.state.draggingText.copy&&(selected=cm.listSelections()),setSelectionNoUndo(cm.doc,simpleSelection(pos,pos)),selected)for(var i$1=0;i$1<selected.length;++i$1)replaceRange(cm.doc,"",selected[i$1].anchor,selected[i$1].head,"drag");cm.replaceSelection(text$1,"around","paste"),cm.display.input.focus()}}catch(e){}}}}function clearDragCursor(cm){cm.display.dragCursor&&(cm.display.lineSpace.removeChild(cm.display.dragCursor),cm.display.dragCursor=null)}function forEachCodeMirror(f){if(document.getElementsByClassName){for(var byClass=document.getElementsByClassName("CodeMirror"),editors=[],i=0;i<byClass.length;i++){var cm=byClass[i].CodeMirror;cm&&editors.push(cm)}editors.length&&editors[0].operation(function(){for(var i=0;i<editors.length;i++)f(editors[i])})}}var globalsRegistered=!1;function ensureGlobalHandlers(){globalsRegistered||(function registerGlobalHandlers(){var resizeTimer;on(window,"resize",function(){null==resizeTimer&&(resizeTimer=setTimeout(function(){resizeTimer=null,forEachCodeMirror(onResize)},100))}),on(window,"blur",function(){return forEachCodeMirror(onBlur)})}(),globalsRegistered=!0)}function onResize(cm){var d=cm.display;d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null,d.scrollbarsClipped=!1,cm.setSize()}for(var keyNames={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},i=0;i<10;i++)keyNames[i+48]=keyNames[i+96]=String(i);for(var i$1=65;i$1<=90;i$1++)keyNames[i$1]=String.fromCharCode(i$1);for(var i$2=1;i$2<=12;i$2++)keyNames[i$2+111]=keyNames[i$2+63235]="F"+i$2;var keyMap={};function normalizeKeyName(name){var alt,ctrl,shift,cmd,parts=name.split(/-(?!$)/);name=parts[parts.length-1];for(var i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))cmd=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else{if(!/^s(hift)?$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);shift=!0}}return alt&&(name="Alt-"+name),ctrl&&(name="Ctrl-"+name),cmd&&(name="Cmd-"+name),name=shift?"Shift-"+name:name}function normalizeKeyMap(keymap){var keyname,prop,copy={};for(keyname in keymap)if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname];if(!/^(name|fallthrough|(de|at)tach)$/.test(keyname))if("..."!=value){for(var keys=map(keyname.split(" "),normalizeKeyName),i=0;i<keys.length;i++){var val=void 0,name=void 0,val=i==keys.length-1?(name=keys.join(" "),value):(name=keys.slice(0,i+1).join(" "),"..."),prev=copy[name];if(prev){if(prev!=val)throw new Error("Inconsistent bindings for "+name)}else copy[name]=val}delete keymap[keyname]}else delete keymap[keyname]}for(prop in copy)keymap[prop]=copy[prop];return keymap}function lookupKey(key,map$$1,handle,context){var found=(map$$1=getKeyMap(map$$1)).call?map$$1.call(key,context):map$$1[key];if(!1===found)return"nothing";if("..."===found)return"multi";if(null!=found&&handle(found))return"handled";if(map$$1.fallthrough){if("[object Array]"!=Object.prototype.toString.call(map$$1.fallthrough))return lookupKey(key,map$$1.fallthrough,handle,context);for(var i=0;i<map$$1.fallthrough.length;i++){var result=lookupKey(key,map$$1.fallthrough[i],handle,context);if(result)return result}}}function isModifierKey(name){name="string"==typeof name?name:keyNames[name.keyCode];return"Ctrl"==name||"Alt"==name||"Shift"==name||"Mod"==name}function addModifierNames(name,event,noShift){var base=name;return event.altKey&&"Alt"!=base&&(name="Alt-"+name),(flipCtrlCmd?event.metaKey:event.ctrlKey)&&"Ctrl"!=base&&(name="Ctrl-"+name),(flipCtrlCmd?event.ctrlKey:event.metaKey)&&"Cmd"!=base&&(name="Cmd-"+name),name=!noShift&&event.shiftKey&&"Shift"!=base?"Shift-"+name:name}function keyName(event,noShift){if(presto&&34==event.keyCode&&event.char)return!1;var name=keyNames[event.keyCode];return null!=name&&!event.altGraphKey&&addModifierNames(name=3==event.keyCode&&event.code?event.code:name,event,noShift)}function getKeyMap(val){return"string"==typeof val?keyMap[val]:val}function deleteNearSelection(cm,compute){for(var ranges=cm.doc.sel.ranges,kill=[],i=0;i<ranges.length;i++){for(var toKill=compute(ranges[i]);kill.length&&cmp(toKill.from,lst(kill).to)<=0;){var replaced=kill.pop();if(cmp(replaced.from,toKill.from)<0){toKill.from=replaced.from;break}}kill.push(toKill)}runInOp(cm,function(){for(var i=kill.length-1;0<=i;i--)replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete");ensureCursorVisible(cm)})}function moveCharLogically(line,ch,target){target=skipExtendingChars(line.text,ch+target,target);return target<0||target>line.text.length?null:target}function moveLogically(ch,start,dir){ch=moveCharLogically(ch,start.ch,dir);return null==ch?null:new Pos(start.line,ch,dir<0?"after":"before")}function endOfLine(part,cm,lineObj,lineNo,dir){if(part){var sticky=getOrder(lineObj,cm.doc.direction);if(sticky){var prep,ch,targetTop,part=dir<0?lst(sticky):sticky[0],sticky=dir<0==(1==part.level)?"after":"before";return 0<part.level||"rtl"==cm.doc.direction?(prep=prepareMeasureForLine(cm,lineObj),ch=dir<0?lineObj.text.length-1:0,targetTop=measureCharPrepared(cm,prep,ch).top,ch=findFirst(function(ch){return measureCharPrepared(cm,prep,ch).top==targetTop},dir<0==(1==part.level)?part.from:part.to-1,ch),"before"==sticky&&(ch=moveCharLogically(lineObj,ch,1))):ch=dir<0?part.to:part.from,new Pos(lineNo,ch,sticky)}}return new Pos(lineNo,dir<0?lineObj.text.length:0,dir<0?"before":"after")}function moveVisually(cm,line,start,dir){var bidi=getOrder(line,cm.doc.direction);if(!bidi)return moveLogically(line,start,dir);start.ch>=line.text.length?(start.ch=line.text.length,start.sticky="before"):start.ch<=0&&(start.ch=0,start.sticky="after");var res=getBidiPartAt(bidi,start.ch,start.sticky),part=bidi[res];if("ltr"==cm.doc.direction&&part.level%2==0&&(0<dir?part.to>start.ch:part.from<start.ch))return moveLogically(line,start,dir);function mv(pos,dir){return moveCharLogically(line,pos instanceof Pos?pos.ch:pos,dir)}function getWrappedLineExtent(ch){return cm.options.lineWrapping?(prep=prep||prepareMeasureForLine(cm,line),wrappedLineExtentChar(cm,line,prep,ch)):{begin:0,end:line.text.length}}var prep,nextCh=getWrappedLineExtent("before"==start.sticky?mv(start,-1):start.ch);if("rtl"==cm.doc.direction||1==part.level){var moveInStorageOrder=1==part.level==dir<0,ch=mv(start,moveInStorageOrder?1:-1);if(null!=ch&&(moveInStorageOrder?ch<=part.to&&ch<=nextCh.end:ch>=part.from&&ch>=nextCh.begin)){var searchInVisualLine=moveInStorageOrder?"before":"after";return new Pos(start.line,ch,searchInVisualLine)}}searchInVisualLine=function(partPos,dir,wrappedLineExtent){for(var getRes=function(ch,moveInStorageOrder){return moveInStorageOrder?new Pos(start.line,mv(ch,1),"before"):new Pos(start.line,ch,"after")};0<=partPos&&partPos<bidi.length;partPos+=dir){var part=bidi[partPos],moveInStorageOrder=0<dir==(1!=part.level),ch=moveInStorageOrder?wrappedLineExtent.begin:mv(wrappedLineExtent.end,-1);if(part.from<=ch&&ch<part.to)return getRes(ch,moveInStorageOrder);if(ch=moveInStorageOrder?part.from:mv(part.to,-1),wrappedLineExtent.begin<=ch&&ch<wrappedLineExtent.end)return getRes(ch,moveInStorageOrder)}},res=searchInVisualLine(res+dir,dir,nextCh);if(res)return res;nextCh=0<dir?nextCh.end:mv(nextCh.begin,-1);return null==nextCh||0<dir&&nextCh==line.text.length||!(res=searchInVisualLine(0<dir?0:bidi.length-1,dir,getWrappedLineExtent(nextCh)))?null:res}keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},keyMap.default=mac?keyMap.macDefault:keyMap.pcDefault;var commands={selectAll:selectAll,singleSelection:function(cm){return cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll)},killLine:function(cm){return deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length;return range.head.ch==len&&range.head.line<cm.lastLine()?{from:range.head,to:Pos(range.head.line+1,0)}:{from:range.head,to:Pos(range.head.line,len)}}return{from:range.from(),to:range.to()}})},deleteLine:function(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:clipPos(cm.doc,Pos(range.to().line+1,0))}})},delLineLeft:function(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:range.from()}})},delWrappedLineLeft:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;return{from:cm.coordsChar({left:0,top:top},"div"),to:range.from()}})},delWrappedLineRight:function(cm){return deleteNearSelection(cm,function(range){var rightPos=cm.charCoords(range.head,"div").top+5,rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:rightPos},"div");return{from:range.from(),to:rightPos}})},undo:function(cm){return cm.undo()},redo:function(cm){return cm.redo()},undoSelection:function(cm){return cm.undoSelection()},redoSelection:function(cm){return cm.redoSelection()},goDocStart:function(cm){return cm.extendSelection(Pos(cm.firstLine(),0))},goDocEnd:function(cm){return cm.extendSelection(Pos(cm.lastLine()))},goLineStart:function(cm){return cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(cm){return cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head)},{origin:"+move",bias:1})},goLineEnd:function(cm){return cm.extendSelectionsBy(function(range){return function lineEnd(cm,lineN){var line=getLine(cm.doc,lineN),visual=function visualLineEnd(line){for(var merged;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line;return line}(line);visual!=line&&(lineN=lineNo(visual));return endOfLine(!0,cm,line,lineN,-1)}(cm,range.head.line)},{origin:"+move",bias:-1})},goLineRight:function(cm){return cm.extendSelectionsBy(function(top){top=cm.cursorCoords(top.head,"div").top+5;return cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")},sel_move)},goLineLeft:function(cm){return cm.extendSelectionsBy(function(top){top=cm.cursorCoords(top.head,"div").top+5;return cm.coordsChar({left:0,top:top},"div")},sel_move)},goLineLeftSmart:function(cm){return cm.extendSelectionsBy(function(range){var pos=cm.cursorCoords(range.head,"div").top+5,pos=cm.coordsChar({left:0,top:pos},"div");return pos.ch<cm.getLine(pos.line).search(/\S/)?lineStartSmart(cm,range.head):pos},sel_move)},goLineUp:function(cm){return cm.moveV(-1,"line")},goLineDown:function(cm){return cm.moveV(1,"line")},goPageUp:function(cm){return cm.moveV(-1,"page")},goPageDown:function(cm){return cm.moveV(1,"page")},goCharLeft:function(cm){return cm.moveH(-1,"char")},goCharRight:function(cm){return cm.moveH(1,"char")},goColumnLeft:function(cm){return cm.moveH(-1,"column")},goColumnRight:function(cm){return cm.moveH(1,"column")},goWordLeft:function(cm){return cm.moveH(-1,"word")},goGroupRight:function(cm){return cm.moveH(1,"group")},goGroupLeft:function(cm){return cm.moveH(-1,"group")},goWordRight:function(cm){return cm.moveH(1,"word")},delCharBefore:function(cm){return cm.deleteH(-1,"char")},delCharAfter:function(cm){return cm.deleteH(1,"char")},delWordBefore:function(cm){return cm.deleteH(-1,"word")},delWordAfter:function(cm){return cm.deleteH(1,"word")},delGroupBefore:function(cm){return cm.deleteH(-1,"group")},delGroupAfter:function(cm){return cm.deleteH(1,"group")},indentAuto:function(cm){return cm.indentSelection("smart")},indentMore:function(cm){return cm.indentSelection("add")},indentLess:function(cm){return cm.indentSelection("subtract")},insertTab:function(cm){return cm.replaceSelection("\t")},insertSoftTab:function(cm){for(var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize,i=0;i<ranges.length;i++){var col=ranges[i].from(),col=countColumn(cm.getLine(col.line),col.ch,tabSize);spaces.push(spaceStr(tabSize-col%tabSize))}cm.replaceSelections(spaces)},defaultTab:function(cm){cm.somethingSelected()?cm.indentSelection("add"):cm.execCommand("insertTab")},transposeChars:function(cm){return runInOp(cm,function(){for(var cur,line,prev,ranges=cm.listSelections(),newSel=[],i=0;i<ranges.length;i++)ranges[i].empty()&&(cur=ranges[i].head,(line=getLine(cm.doc,cur.line).text)&&(0<(cur=cur.ch==line.length?new Pos(cur.line,cur.ch-1):cur).ch?(cur=new Pos(cur.line,cur.ch+1),cm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose")):cur.line>cm.doc.first&&((prev=getLine(cm.doc,cur.line-1).text)&&(cur=new Pos(cur.line,1),cm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+prev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),cur,"+transpose")))),newSel.push(new Range(cur,cur)));cm.setSelections(newSel)})},newlineAndIndent:function(cm){return runInOp(cm,function(){for(var i=(sels=cm.listSelections()).length-1;0<=i;i--)cm.replaceRange(cm.doc.lineSeparator(),sels[i].anchor,sels[i].head,"+input");for(var sels=cm.listSelections(),i$1=0;i$1<sels.length;i$1++)cm.indentLine(sels[i$1].from().line,null,!0);ensureCursorVisible(cm)})},openLine:function(cm){return cm.replaceSelection("\n","start")},toggleOverwrite:function(cm){return cm.toggleOverwrite()}};function lineStart(cm,lineN){var line=getLine(cm.doc,lineN),visual=visualLine(line);return endOfLine(!0,cm,visual,lineN=visual!=line?lineNo(visual):lineN,1)}function lineStartSmart(order,inWS){var start=lineStart(order,inWS.line),firstNonWS=getLine(order.doc,start.line),order=getOrder(firstNonWS,order.doc.direction);if(order&&0!=order[0].level)return start;firstNonWS=Math.max(0,firstNonWS.text.search(/\S/)),inWS=inWS.line==start.line&&inWS.ch<=firstNonWS&&inWS.ch;return Pos(start.line,inWS?0:firstNonWS,start.sticky)}function doHandleBinding(cm,bound,dropShift){if("string"==typeof bound&&!(bound=commands[bound]))return!1;cm.display.input.ensurePolled();var prevShift=cm.display.shift,done=!1;try{cm.isReadOnly()&&(cm.state.suppressEdits=!0),dropShift&&(cm.display.shift=!1),done=bound(cm)!=Pass}finally{cm.display.shift=prevShift,cm.state.suppressEdits=!1}return done}var stopSeq=new Delayed;function dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq;if(seq){if(isModifierKey(name))return"handled";if(/\'$/.test(name)?cm.state.keySeq=null:stopSeq.set(50,function(){cm.state.keySeq==seq&&(cm.state.keySeq=null,cm.display.input.reset())}),dispatchKeyInner(cm,seq+" "+name,e,handle))return!0}return dispatchKeyInner(cm,name,e,handle)}function dispatchKeyInner(cm,name,e,result){result=function lookupKeyForEditor(cm,name,handle){for(var i=0;i<cm.state.keyMaps.length;i++){var result=lookupKey(name,cm.state.keyMaps[i],handle,cm);if(result)return result}return cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm)||lookupKey(name,cm.options.keyMap,handle,cm)}(cm,name,result);return"multi"==result&&(cm.state.keySeq=name),"handled"==result&&signalLater(cm,"keyHandled",cm,name,e),"handled"!=result&&"multi"!=result||(e_preventDefault(e),restartBlink(cm)),!!result}function handleKeyBinding(cm,e){var name=keyName(e,!0);return!!name&&(e.shiftKey&&!cm.state.keySeq?dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,!0)})||dispatchKey(cm,name,e,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return doHandleBinding(cm,b)}):dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b)}))}var lastStoppedKey=null;function onKeyDown(e){var code,handled,cm=this;cm.curOp.focus=activeElt(),signalDOMEvent(cm,e)||(ie&&ie_version<11&&27==e.keyCode&&(e.returnValue=!1),code=e.keyCode,cm.display.shift=16==code||e.shiftKey,handled=handleKeyBinding(cm,e),presto&&(lastStoppedKey=handled?code:null,!handled&&88==code&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey)&&cm.replaceSelection("",null,"cut")),18!=code||/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className)||function showCrossHair(cm){var lineDiv=cm.display.lineDiv;function up(e){18!=e.keyCode&&e.altKey||(rmClass(lineDiv,"CodeMirror-crosshair"),off(document,"keyup",up),off(document,"mouseover",up))}addClass(lineDiv,"CodeMirror-crosshair"),on(document,"keyup",up),on(document,"mouseover",up)}(cm))}function onKeyUp(e){16==e.keyCode&&(this.doc.sel.shift=!1),signalDOMEvent(this,e)}function onKeyPress(e){var cm=this;if(!(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey)){var keyCode=e.keyCode,ch=e.charCode;if(presto&&keyCode==lastStoppedKey)return lastStoppedKey=null,void e_preventDefault(e);presto&&(!e.which||e.which<10)&&handleKeyBinding(cm,e)||("\b"==(ch=String.fromCharCode(null==ch?keyCode:ch))||function handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,!0)})}(cm,e,ch)||cm.display.input.onKeyPress(e))}}var lastClick,lastDoubleClick,PastClick=function(time,pos,button){this.time=time,this.pos=pos,this.button=button};function onMouseDown(e){var pos,button,repeat,cm=this,display=cm.display;signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch()||(display.input.ensurePolled(),display.shift=e.shiftKey,eventInWidget(display,e)?webkit||(display.scroller.draggable=!1,setTimeout(function(){return display.scroller.draggable=!0},100)):clickInGutter(cm,e)||(pos=posFromMouse(cm,e),button=e_button(e),repeat=pos?function clickRepeat(pos,button){var now=+new Date;return lastDoubleClick&&lastDoubleClick.compare(now,pos,button)?(lastClick=lastDoubleClick=null,"triple"):lastClick&&lastClick.compare(now,pos,button)?(lastDoubleClick=new PastClick(now,pos,button),lastClick=null,"double"):(lastClick=new PastClick(now,pos,button),lastDoubleClick=null,"single")}(pos,button):"single",window.focus(),1==button&&cm.state.selectingText&&cm.state.selectingText(e),pos&&function handleMappedButton(cm,button,pos,repeat,event){var name="Click";"double"==repeat?name="Double"+name:"triple"==repeat&&(name="Triple"+name);return dispatchKey(cm,addModifierNames(name=(1==button?"Left":2==button?"Middle":"Right")+name,event),event,function(bound){if(!(bound="string"==typeof bound?commands[bound]:bound))return!1;var done=!1;try{cm.isReadOnly()&&(cm.state.suppressEdits=!0),done=bound(cm,pos)!=Pass}finally{cm.state.suppressEdits=!1}return done})}(cm,button,pos,repeat,e)||(1==button?pos?function leftButtonDown(cm,pos,repeat,event){ie?setTimeout(bind(ensureFocus,cm),0):cm.curOp.focus=activeElt();var contained,behavior=function configureMouse(cm,repeat,event){var rect=cm.getOption("configureMouse"),value=rect?rect(cm,repeat,event):{};null==value.unit&&(rect=chromeOS?event.shiftKey&&event.metaKey:event.altKey,value.unit=rect?"rectangle":"single"==repeat?"char":"double"==repeat?"word":"line");null!=value.extend&&!cm.doc.extend||(value.extend=cm.doc.extend||event.shiftKey);null==value.addNew&&(value.addNew=mac?event.metaKey:event.ctrlKey);null==value.moveOnDrag&&(value.moveOnDrag=!(mac?event.altKey:event.ctrlKey));return value}(cm,repeat,event),sel=cm.doc.sel;(cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&"single"==repeat&&-1<(contained=sel.contains(pos))&&(cmp((contained=sel.ranges[contained]).from(),pos)<0||0<pos.xRel)&&(0<cmp(contained.to(),pos)||pos.xRel<0)?function leftButtonStartDrag(cm,event,pos,behavior){var display=cm.display,moved=!1,dragEnd=operation(cm,function(e){webkit&&(display.scroller.draggable=!1),cm.state.draggingText=!1,off(display.wrapper.ownerDocument,"mouseup",dragEnd),off(display.wrapper.ownerDocument,"mousemove",mouseMove),off(display.scroller,"dragstart",dragStart),off(display.scroller,"drop",dragEnd),moved||(e_preventDefault(e),behavior.addNew||extendSelection(cm.doc,pos,null,null,behavior.extend),webkit||ie&&9==ie_version?setTimeout(function(){display.wrapper.ownerDocument.body.focus(),display.input.focus()},20):display.input.focus())}),mouseMove=function(e2){moved=moved||10<=Math.abs(event.clientX-e2.clientX)+Math.abs(event.clientY-e2.clientY)},dragStart=function(){return moved=!0};webkit&&(display.scroller.draggable=!0),(cm.state.draggingText=dragEnd).copy=!behavior.moveOnDrag,display.scroller.dragDrop&&display.scroller.dragDrop(),on(display.wrapper.ownerDocument,"mouseup",dragEnd),on(display.wrapper.ownerDocument,"mousemove",mouseMove),on(display.scroller,"dragstart",dragStart),on(display.scroller,"drop",dragEnd),delayBlurEvent(cm),setTimeout(function(){return display.input.focus()},20)}:function leftButtonSelect(cm,range$$1,start,behavior){var display=cm.display,doc=cm.doc;e_preventDefault(range$$1);var ourRange,ourIndex,startSel=doc.sel,ranges=startSel.ranges;behavior.addNew&&!behavior.extend?(ourIndex=doc.sel.contains(start),ourRange=-1<ourIndex?ranges[ourIndex]:new Range(start,start)):(ourRange=doc.sel.primary(),ourIndex=doc.sel.primIndex),"rectangle"==behavior.unit?(behavior.addNew||(ourRange=new Range(start,start)),start=posFromMouse(cm,range$$1,!0,!0),ourIndex=-1):(range$$1=rangeForUnit(cm,start,behavior.unit),ourRange=behavior.extend?extendRange(ourRange,range$$1.anchor,range$$1.head,behavior.extend):range$$1),behavior.addNew?-1==ourIndex?(ourIndex=ranges.length,setSelection(doc,normalizeSelection(cm,ranges.concat([ourRange]),ourIndex),{scroll:!1,origin:"*mouse"})):1<ranges.length&&ranges[ourIndex].empty()&&"char"==behavior.unit&&!behavior.extend?(setSelection(doc,normalizeSelection(cm,ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:!1,origin:"*mouse"}),startSel=doc.sel):replaceOneSelection(doc,ourIndex,ourRange,sel_mouse):(setSelection(doc,new Selection([ourRange],ourIndex=0),sel_mouse),startSel=doc.sel);var lastPos=start;function extendTo(anchor){if(0!=cmp(lastPos,anchor))if(lastPos=anchor,"rectangle"==behavior.unit){for(var ranges=[],tabSize=cm.options.tabSize,oldRange=countColumn(getLine(doc,start.line).text,start.ch,tabSize),ranges$1=countColumn(getLine(doc,anchor.line).text,anchor.ch,tabSize),left=Math.min(oldRange,ranges$1),right=Math.max(oldRange,ranges$1),line=Math.min(start.line,anchor.line),end=Math.min(cm.lastLine(),Math.max(start.line,anchor.line));line<=end;line++){var text=getLine(doc,line).text,leftPos=findColumn(text,left,tabSize);left==right?ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos))):text.length>leftPos&&ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))))}ranges.length||ranges.push(new Range(start,start)),setSelection(doc,normalizeSelection(cm,startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:!1}),cm.scrollIntoView(anchor)}else{var head,oldRange=ourRange,ranges$1=rangeForUnit(cm,anchor,behavior.unit),anchor=oldRange.anchor,anchor=0<cmp(ranges$1.anchor,anchor)?(head=ranges$1.head,minPos(oldRange.from(),ranges$1.anchor)):(head=ranges$1.anchor,maxPos(oldRange.to(),ranges$1.head)),ranges$1=startSel.ranges.slice(0);ranges$1[ourIndex]=function bidiSimplify(headIndex,range$$1){var anchor=range$$1.anchor,head=range$$1.head,ch=getLine(headIndex.doc,anchor.line);if(0==cmp(anchor,head)&&anchor.sticky==head.sticky)return range$$1;var order=getOrder(ch);if(!order)return range$$1;var index=getBidiPartAt(order,anchor.ch,anchor.sticky),part=order[index];if(part.from!=anchor.ch&&part.to!=anchor.ch)return range$$1;ch=index+(part.from==anchor.ch==(1!=part.level)?0:1);if(0==ch||ch==order.length)return range$$1;sticky=head.line!=anchor.line?0<(head.line-anchor.line)*("ltr"==headIndex.doc.direction?1:-1):(headIndex=getBidiPartAt(order,head.ch,head.sticky),sticky=headIndex-index||(head.ch-anchor.ch)*(1==part.level?-1:1),headIndex==ch-1||headIndex==ch?sticky<0:0<sticky);var ch=order[ch+(sticky?-1:0)],sticky=sticky==(1==ch.level),ch=sticky?ch.from:ch.to,sticky=sticky?"after":"before";return anchor.ch==ch&&anchor.sticky==sticky?range$$1:new Range(new Pos(anchor.line,ch,sticky),head)}(cm,new Range(clipPos(doc,anchor),head)),setSelection(doc,normalizeSelection(cm,ranges$1,ourIndex),sel_mouse)}}var editorSize=display.wrapper.getBoundingClientRect(),counter=0;function done(e){cm.state.selectingText=!1,counter=1/0,e&&(e_preventDefault(e),display.input.focus()),off(display.wrapper.ownerDocument,"mousemove",move),off(display.wrapper.ownerDocument,"mouseup",up),doc.history.lastSelOrigin=null}var move=operation(cm,function(e){(0!==e.buttons&&e_button(e)?function extend(e){var visible,outside,curCount=++counter,cur=posFromMouse(cm,e,!0,"rectangle"==behavior.unit);cur&&(0!=cmp(cur,lastPos)?(cm.curOp.focus=activeElt(),extendTo(cur),visible=visibleLines(display,doc),(cur.line>=visible.to||cur.line<visible.from)&&setTimeout(operation(cm,function(){counter==curCount&&extend(e)}),150)):(outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0)&&setTimeout(operation(cm,function(){counter==curCount&&(display.scroller.scrollTop+=outside,extend(e))}),50))}:done)(e)}),up=operation(cm,done);cm.state.selectingText=up,on(display.wrapper.ownerDocument,"mousemove",move),on(display.wrapper.ownerDocument,"mouseup",up)})(cm,event,pos,behavior)}(cm,pos,repeat,e):e_target(e)==display.scroller&&e_preventDefault(e):2==button?(pos&&extendSelection(cm.doc,pos),setTimeout(function(){return display.input.focus()},20)):3==button&&(captureRightClick?cm.display.input.onContextMenu(e):delayBlurEvent(cm)))))}function rangeForUnit(cm,result,unit){if("char"==unit)return new Range(result,result);if("word"==unit)return cm.findWordAt(result);if("line"==unit)return new Range(Pos(result.line,0),clipPos(cm.doc,Pos(result.line+1,0)));result=unit(cm,result);return new Range(result.from,result.to)}function gutterEvent(cm,e,type,lineBox){var mX,mY;if(e.touches)mX=e.touches[0].clientX,mY=e.touches[0].clientY;else try{mX=e.clientX,mY=e.clientY}catch(e){return!1}if(mX>=Math.floor(cm.display.gutters.getBoundingClientRect().right))return!1;lineBox&&e_preventDefault(e);var display=cm.display,lineBox=display.lineDiv.getBoundingClientRect();if(mY>lineBox.bottom||!hasHandler(cm,type))return e_defaultPrevented(e);mY-=lineBox.top-display.viewOffset;for(var i=0;i<cm.display.gutterSpecs.length;++i){var g=display.gutters.childNodes[i];if(g&&g.getBoundingClientRect().right>=mX)return signal(cm,type,cm,lineAtHeight(cm.doc,mY),cm.display.gutterSpecs[i].className,e),e_defaultPrevented(e)}}function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",!0)}function onContextMenu(cm,e){eventInWidget(cm.display,e)||function contextMenuInGutter(cm,e){return!!hasHandler(cm,"gutterContextMenu")&&gutterEvent(cm,e,"gutterContextMenu",!1)}(cm,e)||signalDOMEvent(cm,e,"contextmenu")||captureRightClick||cm.display.input.onContextMenu(e)}function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+cm.options.theme.replace(/(^|\s)\s*/g," cm-s-"),clearCaches(cm)}PastClick.prototype.compare=function(time,pos,button){return this.time+400>time&&0==cmp(pos,this.pos)&&button==this.button};var Init={toString:function(){return"CodeMirror.Init"}},defaults={},optionHandlers={};function dragDropChanged(cm,toggle,funcs){!toggle!=!(funcs&&funcs!=Init)&&(funcs=cm.display.dragFunctions,(toggle=toggle?on:off)(cm.display.scroller,"dragstart",funcs.start),toggle(cm.display.scroller,"dragenter",funcs.enter),toggle(cm.display.scroller,"dragover",funcs.over),toggle(cm.display.scroller,"dragleave",funcs.leave),toggle(cm.display.scroller,"drop",funcs.drop))}function wrappingChanged(cm){cm.options.lineWrapping?(addClass(cm.display.wrapper,"CodeMirror-wrap"),cm.display.sizer.style.minWidth="",cm.display.sizerWidth=null):(rmClass(cm.display.wrapper,"CodeMirror-wrap"),findMaxLine(cm)),estimateLineHeights(cm),regChange(cm),clearCaches(cm),setTimeout(function(){return updateScrollbars(cm)},100)}function CodeMirror(place,options){var this$1=this;if(!(this instanceof CodeMirror))return new CodeMirror(place,options);this.options=options=options?copyObj(options):{},copyObj(defaults,options,!1);var doc=options.value;"string"==typeof doc?doc=new Doc(doc,options.mode,null,options.lineSeparator,options.direction):options.mode&&(doc.modeOption=options.mode),this.doc=doc;var opt,display=new CodeMirror.inputStyles[options.inputStyle](this),display=this.display=new Display(place,doc,display,options);for(opt in themeChanged(display.wrapper.CodeMirror=this),options.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),initScrollbars(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Delayed,keySeq:null,specialChars:null},options.autofocus&&!mobile&&display.input.focus(),ie&&ie_version<11&&setTimeout(function(){return this$1.display.input.reset(!0)},20),function registerEventHandlers(cm){var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown)),on(d.scroller,"dblclick",ie&&ie_version<11?operation(cm,function(e){var word;signalDOMEvent(cm,e)||(!(word=posFromMouse(cm,e))||clickInGutter(cm,e)||eventInWidget(cm.display,e)||(e_preventDefault(e),word=cm.findWordAt(word),extendSelection(cm.doc,word.anchor,word.head)))}):function(e){return signalDOMEvent(cm,e)||e_preventDefault(e)}),on(d.scroller,"contextmenu",function(e){return onContextMenu(cm,e)});var touchFinished,prevTouch={end:0};function finishTouch(){d.activeTouch&&(touchFinished=setTimeout(function(){return d.activeTouch=null},1e3),(prevTouch=d.activeTouch).end=+new Date)}function farAway(dy,other){if(null==other.left)return 1;var dx=other.left-dy.left,dy=other.top-dy.top;return 400<dx*dx+dy*dy}on(d.scroller,"touchstart",function(e){var now;signalDOMEvent(cm,e)||function isMouseLikeTouchEvent(touch){if(1==touch.touches.length){touch=touch.touches[0];return touch.radiusX<=1&&touch.radiusY<=1}}(e)||clickInGutter(cm,e)||(d.input.ensurePolled(),clearTimeout(touchFinished),now=+new Date,d.activeTouch={start:now,moved:!1,prev:now-prevTouch.end<=300?prevTouch:null},1==e.touches.length&&(d.activeTouch.left=e.touches[0].pageX,d.activeTouch.top=e.touches[0].pageY))}),on(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)}),on(d.scroller,"touchend",function(e){var range,touch=d.activeTouch;touch&&!eventInWidget(d,e)&&null!=touch.left&&!touch.moved&&new Date-touch.start<300&&(range=cm.coordsChar(d.activeTouch,"page"),range=!touch.prev||farAway(touch,touch.prev)?new Range(range,range):!touch.prev.prev||farAway(touch,touch.prev.prev)?cm.findWordAt(range):new Range(Pos(range.line,0),clipPos(cm.doc,Pos(range.line+1,0))),cm.setSelection(range.anchor,range.head),cm.focus(),e_preventDefault(e)),finishTouch()}),on(d.scroller,"touchcancel",finishTouch),on(d.scroller,"scroll",function(){d.scroller.clientHeight&&(updateScrollTop(cm,d.scroller.scrollTop),setScrollLeft(cm,d.scroller.scrollLeft,!0),signal(cm,"scroll",cm))}),on(d.scroller,"mousewheel",function(e){return onScrollWheel(cm,e)}),on(d.scroller,"DOMMouseScroll",function(e){return onScrollWheel(cm,e)}),on(d.wrapper,"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0}),d.dragFunctions={enter:function(e){signalDOMEvent(cm,e)||e_stop(e)},over:function(e){signalDOMEvent(cm,e)||(function onDragOver(cm,frag){(frag=posFromMouse(cm,frag))&&(drawSelectionCursor(cm,frag,frag=document.createDocumentFragment()),cm.display.dragCursor||(cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),cm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv)),removeChildrenAndAdd(cm.display.dragCursor,frag))}(cm,e),e_stop(e))},start:function(e){return function onDragStart(cm,e){var img;ie&&(!cm.state.draggingText||+new Date-lastDrop<100)?e_stop(e):signalDOMEvent(cm,e)||eventInWidget(cm.display,e)||(e.dataTransfer.setData("Text",cm.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!safari&&((img=elt("img",null,null,"position: fixed; left: 0; top: 0;")).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",presto&&(img.width=img.height=1,cm.display.wrapper.appendChild(img),img._top=img.offsetTop),e.dataTransfer.setDragImage(img,0,0),presto&&img.parentNode.removeChild(img)))}(cm,e)},drop:operation(cm,onDrop),leave:function(e){signalDOMEvent(cm,e)||clearDragCursor(cm)}};var inp=d.input.getField();on(inp,"keyup",function(e){return onKeyUp.call(cm,e)}),on(inp,"keydown",operation(cm,onKeyDown)),on(inp,"keypress",operation(cm,onKeyPress)),on(inp,"focus",function(e){return onFocus(cm,e)}),on(inp,"blur",function(e){return onBlur(cm,e)})}(this),ensureGlobalHandlers(),startOperation(this),this.curOp.forceUpdate=!0,attachDoc(this,doc),options.autofocus&&!mobile||this.hasFocus()?setTimeout(bind(onFocus,this),20):onBlur(this),optionHandlers)optionHandlers.hasOwnProperty(opt)&&optionHandlers[opt](this$1,options[opt],Init);maybeUpdateLineNumberWidth(this),options.finishInit&&options.finishInit(this);for(var i=0;i<initHooks.length;++i)initHooks[i](this$1);endOperation(this),webkit&&options.lineWrapping&&"optimizelegibility"==getComputedStyle(display.lineDiv).textRendering&&(display.lineDiv.style.textRendering="auto")}CodeMirror.defaults=defaults,CodeMirror.optionHandlers=optionHandlers;var initHooks=[];function indentLine(cm,n,how,aggressive){var state,doc=cm.doc;"smart"==(how=null==how?"add":how)&&(doc.mode.indent?state=getContextBefore(cm,n).state:how="prev");var tabSize=cm.options.tabSize,line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize);line.stateAfter&&(line.stateAfter=null);var curSpaceString=line.text.match(/^\s*/)[0];if(aggressive||/\S/.test(line.text)){if("smart"==how&&((indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text))==Pass||150<indentation)){if(!aggressive)return;how="prev"}}else indentation=0,how="not";"prev"==how?indentation=n>doc.first?countColumn(getLine(doc,n-1).text,null,tabSize):0:"add"==how?indentation=curSpace+cm.options.indentUnit:"subtract"==how?indentation=curSpace-cm.options.indentUnit:"number"==typeof how&&(indentation=curSpace+how);var indentation=Math.max(0,indentation),indentString="",pos=0;if(cm.options.indentWithTabs)for(var i=Math.floor(indentation/tabSize);i;--i)pos+=tabSize,indentString+="\t";if(pos<indentation&&(indentString+=spaceStr(indentation-pos)),indentString!=curSpaceString)return replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input"),!(line.stateAfter=null);for(var i$1=0;i$1<doc.sel.ranges.length;i$1++){var pos$1=doc.sel.ranges[i$1];if(pos$1.head.line==n&&pos$1.head.ch<curSpaceString.length){pos$1=Pos(n,curSpaceString.length);replaceOneSelection(doc,i$1,new Range(pos$1,pos$1));break}}}CodeMirror.defineInitHook=function(f){return initHooks.push(f)};var lastCopied=null;function setLastCopied(newLastCopied){lastCopied=newLastCopied}function applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc;cm.display.shift=!1,sel=sel||doc.sel;var recent=+new Date-200,paste="paste"==origin||cm.state.pasteIncoming>recent,textLines=splitLinesAuto(inserted),multiPaste=null;if(paste&&1<sel.ranges.length)if(lastCopied&&lastCopied.text.join("\n")==inserted){if(sel.ranges.length%lastCopied.text.length==0)for(var multiPaste=[],i=0;i<lastCopied.text.length;i++)multiPaste.push(doc.splitLines(lastCopied.text[i]))}else textLines.length==sel.ranges.length&&cm.options.pasteLinesPerSelection&&(multiPaste=map(textLines,function(l){return[l]}));for(var updateInput=cm.curOp.updateInput,i$1=sel.ranges.length-1;0<=i$1;i$1--){var range$$1=sel.ranges[i$1],from=range$$1.from(),changeEvent=range$$1.to();range$$1.empty()&&(deleted&&0<deleted?from=Pos(from.line,from.ch-deleted):cm.state.overwrite&&!paste?changeEvent=Pos(changeEvent.line,Math.min(getLine(doc,changeEvent.line).text.length,changeEvent.ch+lst(textLines).length)):paste&&lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\n")==inserted&&(from=changeEvent=Pos(from.line,0)));changeEvent={from:from,to:changeEvent,text:multiPaste?multiPaste[i$1%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming>recent?"cut":"+input")};makeChange(cm.doc,changeEvent),signalLater(cm,"inputRead",cm,changeEvent)}inserted&&!paste&&triggerElectric(cm,inserted),ensureCursorVisible(cm),cm.curOp.updateInput<2&&(cm.curOp.updateInput=updateInput),cm.curOp.typing=!0,cm.state.pasteIncoming=cm.state.cutIncoming=-1}function handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text");return pasted&&(e.preventDefault(),cm.isReadOnly()||cm.options.disableInput||runInOp(cm,function(){return applyTextInput(cm,pasted,0,null,"paste")}),1)}function triggerElectric(cm,inserted){if(cm.options.electricChars&&cm.options.smartIndent)for(var sel=cm.doc.sel,i=sel.ranges.length-1;0<=i;i--){var range$$1=sel.ranges[i];if(!(100<range$$1.head.ch||i&&sel.ranges[i-1].head.line==range$$1.head.line)){var mode=cm.getModeAt(range$$1.head),indented=!1;if(mode.electricChars){for(var j=0;j<mode.electricChars.length;j++)if(-1<inserted.indexOf(mode.electricChars.charAt(j))){indented=indentLine(cm,range$$1.head.line,"smart");break}}else mode.electricInput&&mode.electricInput.test(getLine(cm.doc,range$$1.head.line).text.slice(0,range$$1.head.ch))&&(indented=indentLine(cm,range$$1.head.line,"smart"));indented&&signalLater(cm,"electricInput",cm,range$$1.head.line)}}}function copyableRanges(cm){for(var text=[],ranges=[],i=0;i<cm.doc.sel.ranges.length;i++){var lineRange=cm.doc.sel.ranges[i].head.line,lineRange={anchor:Pos(lineRange,0),head:Pos(lineRange+1,0)};ranges.push(lineRange),text.push(cm.getRange(lineRange.anchor,lineRange.head))}return{text:text,ranges:ranges}}function disableBrowserMagic(field,spellcheck,autocorrect,autocapitalize){field.setAttribute("autocorrect",autocorrect?"":"off"),field.setAttribute("autocapitalize",autocapitalize?"":"off"),field.setAttribute("spellcheck",!!spellcheck)}function hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return webkit?te.style.width="1000px":te.setAttribute("wrap","off"),ios&&(te.style.border="1px solid black"),disableBrowserMagic(te),div}function findPosH(doc,pos,dir,unit,visually){var oldPos=pos,result=dir,lineObj=getLine(doc,pos.line);function moveOnce(boundToLine){var next=visually?moveVisually(doc.cm,lineObj,pos,dir):moveLogically(lineObj,pos,dir);if(null==next){if(boundToLine||!function findNextLine(){var l=pos.line+dir;return!(l<doc.first||l>=doc.first+doc.size)&&(pos=new Pos(l,pos.ch,pos.sticky),lineObj=getLine(doc,l))}())return;pos=endOfLine(visually,doc.cm,lineObj,pos.line,dir)}else pos=next;return 1}if("char"==unit)moveOnce();else if("column"==unit)moveOnce(!0);else if("word"==unit||"group"==unit)for(var sawType=null,group="group"==unit,helper=doc.cm&&doc.cm.getHelper(pos,"wordChars"),first=!0;!(dir<0)||moveOnce(!first);first=!1){var type=lineObj.text.charAt(pos.ch)||"\n",type=isWordChar(type,helper)?"w":group&&"\n"==type?"n":!group||/\s/.test(type)?null:"p";if(!group||first||type||(type="s"),sawType&&sawType!=type){dir<0&&(dir=1,moveOnce(),pos.sticky="after");break}if(type&&(sawType=type),0<dir&&!moveOnce(!first))break}result=skipAtomic(doc,pos,oldPos,result,!0);return equalCursorPos(oldPos,result)&&(result.hitSide=!0),result}function findPosV(cm,pos,dir,unit){var moveAmount,y,target,doc=cm.doc,x=pos.left;for("page"==unit?(moveAmount=Math.min(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),moveAmount=Math.max(moveAmount-.5*textHeight(cm.display),3),y=(0<dir?pos.bottom:pos.top)+dir*moveAmount):"line"==unit&&(y=0<dir?pos.bottom+3:pos.top-3);(target=coordsChar(cm,x,y)).outside;){if(dir<0?y<=0:y>=doc.height){target.hitSide=!0;break}y+=5*dir}return target}ContentEditableInput=function(cm){this.cm=cm,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Delayed,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function posToDOM(result,pos){var info=findViewForLine(result,pos.line);if(!info||info.hidden)return null;var order=getLine(result.doc,pos.line),info=mapFromLineView(info,order,pos.line),order=getOrder(order,result.doc.direction),result="left";order&&(result=getBidiPartAt(order,pos.ch)%2?"right":"left");result=nodeAndOffsetInLineMap(info.map,pos.ch,result);return result.offset="right"==result.collapse?result.end:result.start,result}function badPos(pos,bad){return bad&&(pos.bad=!0),pos}function domToPos(cm,node,offset){var lineNode;if(node==cm.display.lineDiv){if(!(lineNode=cm.display.lineDiv.childNodes[offset]))return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),!0);node=null,offset=0}else for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv)return null;if(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv)break}for(var i=0;i<cm.display.view.length;i++){var lineView=cm.display.view[i];if(lineView.node==lineNode)return function locateNodeInLineView(lineView,node,offset){var wrapper=lineView.text.firstChild,bad=!1;if(!node||!contains(wrapper,node))return badPos(Pos(lineNo(lineView.line),0),!0);if(node==wrapper&&(bad=!0,node=wrapper.childNodes[offset],offset=0,!node)){var textNode=lineView.rest?lst(lineView.rest):lineView.line;return badPos(Pos(lineNo(textNode),textNode.text.length),bad)}var textNode=3==node.nodeType?node:null,topNode=node;textNode||1!=node.childNodes.length||3!=node.firstChild.nodeType||(textNode=node.firstChild,offset=offset&&textNode.nodeValue.length);for(;topNode.parentNode!=wrapper;)topNode=topNode.parentNode;var measure=lineView.measure,maps=measure.maps;function find(textNode,topNode,offset){for(var i=-1;i<(maps?maps.length:0);i++)for(var map$$1=i<0?measure.map:maps[i],j=0;j<map$$1.length;j+=3){var curNode=map$$1[j+2];if(curNode==textNode||curNode==topNode){var line=lineNo(i<0?lineView.line:lineView.rest[i]),ch=map$$1[j]+offset;return Pos(line,ch=offset<0||curNode!=textNode?map$$1[j+(offset?1:0)]:ch)}}}var found=find(textNode,topNode,offset);if(found)return badPos(found,bad);for(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;after;after=after.nextSibling){if(found=find(after,after.firstChild,0))return badPos(Pos(found.line,found.ch-dist),bad);dist+=after.textContent.length}for(var before=topNode.previousSibling,dist$1=offset;before;before=before.previousSibling){if(found=find(before,before.firstChild,-1))return badPos(Pos(found.line,found.ch+dist$1),bad);dist$1+=before.textContent.length}}(lineView,node,offset)}}ContentEditableInput.prototype.init=function(display){var this$1=this,input=this,cm=input.cm,div=input.div=display.lineDiv;function onCopyCut(te){if(!signalDOMEvent(cm,te)){if(cm.somethingSelected())setLastCopied({lineWise:!1,text:cm.getSelections()}),"cut"==te.type&&cm.replaceSelection("",null,"cut");else{if(!cm.options.lineWiseCopyCut)return;var ranges=copyableRanges(cm);setLastCopied({lineWise:!0,text:ranges.text}),"cut"==te.type&&cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll),cm.replaceSelection("",null,"cut")})}if(te.clipboardData){te.clipboardData.clearData();var content=lastCopied.text.join("\n");if(te.clipboardData.setData("Text",content),te.clipboardData.getData("Text")==content)return void te.preventDefault()}var kludge=hiddenTextarea(),te=kludge.firstChild;cm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild),te.value=lastCopied.text.join("\n");var hadFocus=document.activeElement;selectInput(te),setTimeout(function(){cm.display.lineSpace.removeChild(kludge),hadFocus.focus(),hadFocus==div&&input.showPrimarySelection()},50)}}disableBrowserMagic(div,cm.options.spellcheck,cm.options.autocorrect,cm.options.autocapitalize),on(div,"paste",function(e){signalDOMEvent(cm,e)||handlePaste(e,cm)||ie_version<=11&&setTimeout(operation(cm,function(){return this$1.updateFromDOM()}),20)}),on(div,"compositionstart",function(e){this$1.composing={data:e.data,done:!1}}),on(div,"compositionupdate",function(e){this$1.composing||(this$1.composing={data:e.data,done:!1})}),on(div,"compositionend",function(e){this$1.composing&&(e.data!=this$1.composing.data&&this$1.readFromDOMSoon(),this$1.composing.done=!0)}),on(div,"touchstart",function(){return input.forceCompositionEnd()}),on(div,"input",function(){this$1.composing||this$1.readFromDOMSoon()}),on(div,"copy",onCopyCut),on(div,"cut",onCopyCut)},ContentEditableInput.prototype.prepareSelection=function(){var result=prepareSelection(this.cm,!1);return result.focus=this.cm.state.focused,result},ContentEditableInput.prototype.showSelection=function(info,takeFocus){info&&this.cm.display.view.length&&((info.focus||takeFocus)&&this.showPrimarySelection(),this.showMultipleSelections(info))},ContentEditableInput.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},ContentEditableInput.prototype.showPrimarySelection=function(){var sel=this.getSelection(),cm=this.cm,view=cm.doc.sel.primary(),from=view.from(),to=view.to();if(cm.display.viewTo==cm.display.viewFrom||from.line>=cm.display.viewTo||to.line<cm.display.viewFrom)sel.removeAllRanges();else{var curAnchor=domToPos(cm,sel.anchorNode,sel.anchorOffset),view=domToPos(cm,sel.focusNode,sel.focusOffset);if(!curAnchor||curAnchor.bad||!view||view.bad||0!=cmp(minPos(curAnchor,view),from)||0!=cmp(maxPos(curAnchor,view),to)){var view=cm.display.view,start=from.line>=cm.display.viewFrom&&posToDOM(cm,from)||{node:view[0].measure.map[2],offset:0},end=to.line<cm.display.viewTo&&posToDOM(cm,to);if(end||(end={node:(old=(old=view[view.length-1].measure).maps?old.maps[old.maps.length-1]:old.map)[old.length-1],offset:old[old.length-2]-old[old.length-3]}),start&&end){var rng,old=sel.rangeCount&&sel.getRangeAt(0);try{rng=range(start.node,start.offset,end.offset,end.node)}catch(e){}rng&&(!gecko&&cm.state.focused?(sel.collapse(start.node,start.offset),rng.collapsed||(sel.removeAllRanges(),sel.addRange(rng))):(sel.removeAllRanges(),sel.addRange(rng)),old&&null==sel.anchorNode?sel.addRange(old):gecko&&this.startGracePeriod()),this.rememberSelection()}else sel.removeAllRanges()}}},ContentEditableInput.prototype.startGracePeriod=function(){var this$1=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){this$1.gracePeriod=!1,this$1.selectionChanged()&&this$1.cm.operation(function(){return this$1.cm.curOp.selectionChanged=!0})},20)},ContentEditableInput.prototype.showMultipleSelections=function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors),removeChildrenAndAdd(this.cm.display.selectionDiv,info.selection)},ContentEditableInput.prototype.rememberSelection=function(){var sel=this.getSelection();this.lastAnchorNode=sel.anchorNode,this.lastAnchorOffset=sel.anchorOffset,this.lastFocusNode=sel.focusNode,this.lastFocusOffset=sel.focusOffset},ContentEditableInput.prototype.selectionInEditor=function(){var node=this.getSelection();if(!node.rangeCount)return!1;node=node.getRangeAt(0).commonAncestorContainer;return contains(this.div,node)},ContentEditableInput.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},ContentEditableInput.prototype.blur=function(){this.div.blur()},ContentEditableInput.prototype.getField=function(){return this.div},ContentEditableInput.prototype.supportsTouch=function(){return!0},ContentEditableInput.prototype.receivedFocus=function(){var input=this;this.selectionInEditor()?this.pollSelection():runInOp(this.cm,function(){return input.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,function poll(){input.cm.state.focused&&(input.pollSelection(),input.polling.set(input.cm.options.pollInterval,poll))})},ContentEditableInput.prototype.selectionChanged=function(){var sel=this.getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset},ContentEditableInput.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var anchor,head,sel=this.getSelection(),cm=this.cm;if(android&&chrome&&this.cm.display.gutterSpecs.length&&function isInGutter(node){for(var scan=node;scan;scan=scan.parentNode)if(/CodeMirror-gutter-wrapper/.test(scan.className))return!0;return!1}(sel.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();this.composing||(this.rememberSelection(),anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset),head=domToPos(cm,sel.focusNode,sel.focusOffset),anchor&&head&&runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll),(anchor.bad||head.bad)&&(cm.curOp.selectionChanged=!0)}))}},ContentEditableInput.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var fromLine,cm=this.cm,display=cm.display,chTo=cm.doc.sel.primary(),from=chTo.from(),chTo=chTo.to();if(0==from.ch&&from.line>cm.firstLine()&&(from=Pos(from.line-1,getLine(cm.doc,from.line-1).length)),chTo.ch==getLine(cm.doc,chTo.line).text.length&&chTo.line<cm.lastLine()&&(chTo=Pos(chTo.line+1,0)),from.line<display.viewFrom||chTo.line>display.viewTo-1)return!1;var toLine,chFrom=from.line==display.viewFrom||0==(chFrom=findViewIndex(cm,from.line))?(fromLine=lineNo(display.view[0].line),display.view[0].node):(fromLine=lineNo(display.view[chFrom].line),display.view[chFrom-1].node.nextSibling),chTo=findViewIndex(cm,chTo.line),chTo=chTo==display.view.length-1?(toLine=display.viewTo-1,display.lineDiv.lastChild):(toLine=lineNo(display.view[chTo+1].line)-1,display.view[chTo+1].node.previousSibling);if(!chFrom)return!1;for(var newText=cm.doc.splitLines(function domTextBetween(cm,from,to,fromLine,toLine){var text="",closing=!1,lineSep=cm.doc.lineSeparator(),extraLinebreak=!1;function close(){closing&&(text+=lineSep,extraLinebreak&&(text+=lineSep),closing=extraLinebreak=!1)}function addText(str){str&&(close(),text+=str)}for(;!function walk(node){if(1==node.nodeType){var found=node.getAttribute("cm-text");if(found)addText(found);else if(found=node.getAttribute("cm-marker"))(found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),function recognizeMarker(id){return function(marker){return marker.id==id}}(+found))).length&&(isBlock=found[0].find(0))&&addText(getBetween(cm.doc,isBlock.from,isBlock.to).join(lineSep));else if("false"!=node.getAttribute("contenteditable")){var isBlock=/^(pre|div|p|li|table|br)$/i.test(node.nodeName);if(/^br$/i.test(node.nodeName)||0!=node.textContent.length){isBlock&&close();for(var i=0;i<node.childNodes.length;i++)walk(node.childNodes[i]);/^(pre|p)$/i.test(node.nodeName)&&(extraLinebreak=!0),isBlock&&(closing=!0)}}}else 3==node.nodeType&&addText(node.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}(from),from!=to;)from=from.nextSibling,extraLinebreak=!1;return text}(cm,chFrom,chTo,fromLine,toLine)),oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length));1<newText.length&&1<oldText.length;)if(lst(newText)==lst(oldText))newText.pop(),oldText.pop(),toLine--;else{if(newText[0]!=oldText[0])break;newText.shift(),oldText.shift(),fromLine++}for(var cutFront=0,cutEnd=0,newTop=newText[0],oldTop=oldText[0],maxCutFront=Math.min(newTop.length,oldTop.length);cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront);)++cutFront;for(var newBot=lst(newText),oldBot=lst(oldText),maxCutEnd=Math.min(newBot.length-(1==newText.length?cutFront:0),oldBot.length-(1==oldText.length?cutFront:0));cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1);)++cutEnd;if(1==newText.length&&1==oldText.length&&fromLine==from.line)for(;cutFront&&cutFront>from.ch&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1);)cutFront--,cutEnd++;newText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd).replace(/^\u200b+/,""),newText[0]=newText[0].slice(cutFront).replace(/\u200b+$/,"");chFrom=Pos(fromLine,cutFront),chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0);return 1<newText.length||newText[0]||cmp(chFrom,chTo)?(replaceRange(cm.doc,newText,chFrom,chTo,"+input"),!0):void 0},ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},ContentEditableInput.prototype.readFromDOMSoon=function(){var this$1=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(this$1.readDOMTimeout=null,this$1.composing){if(!this$1.composing.done)return;this$1.composing=null}this$1.updateFromDOM()},80))},ContentEditableInput.prototype.updateFromDOM=function(){var this$1=this;!this.cm.isReadOnly()&&this.pollContent()||runInOp(this.cm,function(){return regChange(this$1.cm)})},ContentEditableInput.prototype.setUneditable=function(node){node.contentEditable="false"},ContentEditableInput.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},ContentEditableInput.prototype.readOnlyChanged=function(val){this.div.contentEditable=String("nocursor"!=val)},ContentEditableInput.prototype.onContextMenu=function(){},ContentEditableInput.prototype.resetPosition=function(){},ContentEditableInput.prototype.needsContentAttribute=!0;TextareaInput=function(cm){this.cm=cm,this.prevInput="",this.pollingFast=!1,this.polling=new Delayed,this.hasSelection=!1,this.composing=null};TextareaInput.prototype.init=function(display){var this$1=this,input=this,cm=this.cm;this.createField(display);var te=this.textarea;function prepareCopyCut(e){if(!signalDOMEvent(cm,e)){if(cm.somethingSelected())setLastCopied({lineWise:!1,text:cm.getSelections()});else{if(!cm.options.lineWiseCopyCut)return;var ranges=copyableRanges(cm);setLastCopied({lineWise:!0,text:ranges.text}),"cut"==e.type?cm.setSelections(ranges.ranges,null,sel_dontScroll):(input.prevInput="",te.value=ranges.text.join("\n"),selectInput(te))}"cut"==e.type&&(cm.state.cutIncoming=+new Date)}}display.wrapper.insertBefore(this.wrapper,display.wrapper.firstChild),ios&&(te.style.width="0px"),on(te,"input",function(){ie&&9<=ie_version&&this$1.hasSelection&&(this$1.hasSelection=null),input.poll()}),on(te,"paste",function(e){signalDOMEvent(cm,e)||handlePaste(e,cm)||(cm.state.pasteIncoming=+new Date,input.fastPoll())}),on(te,"cut",prepareCopyCut),on(te,"copy",prepareCopyCut),on(display.scroller,"paste",function(e){if(!eventInWidget(display,e)&&!signalDOMEvent(cm,e)){if(!te.dispatchEvent)return cm.state.pasteIncoming=+new Date,void input.focus();var event=new Event("paste");event.clipboardData=e.clipboardData,te.dispatchEvent(event)}}),on(display.lineSpace,"selectstart",function(e){eventInWidget(display,e)||e_preventDefault(e)}),on(te,"compositionstart",function(){var start=cm.getCursor("from");input.composing&&input.composing.range.clear(),input.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})}}),on(te,"compositionend",function(){input.composing&&(input.poll(),input.composing.range.clear(),input.composing=null)})},TextareaInput.prototype.createField=function(_display){this.wrapper=hiddenTextarea(),this.textarea=this.wrapper.firstChild},TextareaInput.prototype.prepareSelection=function(){var headPos,wrapOff=this.cm,display=wrapOff.display,lineOff=wrapOff.doc,result=prepareSelection(wrapOff);return wrapOff.options.moveInputWithCursor&&(headPos=cursorCoords(wrapOff,lineOff.sel.primary().head,"div"),wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect(),result.teTop=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top)),result.teLeft=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left))),result},TextareaInput.prototype.showSelection=function(drawn){var display=this.cm.display;removeChildrenAndAdd(display.cursorDiv,drawn.cursors),removeChildrenAndAdd(display.selectionDiv,drawn.selection),null!=drawn.teTop&&(this.wrapper.style.top=drawn.teTop+"px",this.wrapper.style.left=drawn.teLeft+"px")},TextareaInput.prototype.reset=function(typing){var cm,content;this.contextMenuPending||this.composing||((cm=this.cm).somethingSelected()?(this.prevInput="",content=cm.getSelection(),this.textarea.value=content,cm.state.focused&&selectInput(this.textarea),ie&&9<=ie_version&&(this.hasSelection=content)):typing||(this.prevInput=this.textarea.value="",ie&&9<=ie_version&&(this.hasSelection=null)))},TextareaInput.prototype.getField=function(){return this.textarea},TextareaInput.prototype.supportsTouch=function(){return!1},TextareaInput.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!mobile||activeElt()!=this.textarea))try{this.textarea.focus()}catch(e){}},TextareaInput.prototype.blur=function(){this.textarea.blur()},TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},TextareaInput.prototype.receivedFocus=function(){this.slowPoll()},TextareaInput.prototype.slowPoll=function(){var this$1=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){this$1.poll(),this$1.cm.state.focused&&this$1.slowPoll()})},TextareaInput.prototype.fastPoll=function(){var missed=!1,input=this;input.pollingFast=!0,input.polling.set(20,function p(){input.poll()||missed?(input.pollingFast=!1,input.slowPoll()):(missed=!0,input.polling.set(60,p))})},TextareaInput.prototype.poll=function(){var this$1=this,cm=this.cm,input=this.textarea,prevInput=this.prevInput;if(this.contextMenuPending||!cm.state.focused||hasSelection(input)&&!prevInput&&!this.composing||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq)return!1;var text=input.value;if(text==prevInput&&!cm.somethingSelected())return!1;if(ie&&9<=ie_version&&this.hasSelection===text||mac&&/[\uf700-\uf7ff]/.test(text))return cm.display.input.reset(),!1;if(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0);if(8203!=first||prevInput||(prevInput="â"),8666==first)return this.reset(),this.cm.execCommand("undo")}for(var same=0,l=Math.min(prevInput.length,text.length);same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same);)++same;return runInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,this$1.composing?"*compose":null),1e3<text.length||-1<text.indexOf("\n")?input.value=this$1.prevInput="":this$1.prevInput=text,this$1.composing&&(this$1.composing.range.clear(),this$1.composing.range=cm.markText(this$1.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},TextareaInput.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},TextareaInput.prototype.onKeyPress=function(){ie&&9<=ie_version&&(this.hasSelection=null),this.fastPoll()},TextareaInput.prototype.onContextMenu=function(e){var input=this,cm=input.cm,display=cm.display,te=input.textarea;input.contextMenuPending&&input.contextMenuPending();var oldCSS,oldWrapperCSS,oldScrollY,mouseup,wrapperBox=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;function prepareSelectAllHack(){var selected,extval;null!=te.selectionStart&&(extval="â"+((selected=cm.somethingSelected())?te.value:""),te.value="â",te.value=extval,input.prevInput=selected?"":"â",te.selectionStart=1,te.selectionEnd=extval.length,display.selForContextMenu=cm.doc.sel)}function rehide(){var i,poll;input.contextMenuPending==rehide&&(input.contextMenuPending=!1,input.wrapper.style.cssText=oldWrapperCSS,te.style.cssText=oldCSS,ie&&ie_version<9&&display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos),null!=te.selectionStart&&((!ie||ie&&ie_version<9)&&prepareSelectAllHack(),i=0,poll=function(){display.selForContextMenu==cm.doc.sel&&0==te.selectionStart&&0<te.selectionEnd&&"â"==input.prevInput?operation(cm,selectAll)(cm):i++<10?display.detectingSelectAll=setTimeout(poll,500):(display.selForContextMenu=null,display.input.reset())},display.detectingSelectAll=setTimeout(poll,200)))}wrapperBox&&!presto&&(cm.options.resetSelectionOnContextMenu&&-1==cm.doc.sel.contains(wrapperBox)&&operation(cm,setSelection)(cm.doc,simpleSelection(wrapperBox),sel_dontScroll),oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText,wrapperBox=input.wrapper.offsetParent.getBoundingClientRect(),input.wrapper.style.cssText="position: static",te.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px;\n      z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",webkit&&(oldScrollY=window.scrollY),display.input.focus(),webkit&&window.scrollTo(null,oldScrollY),display.input.reset(),cm.somethingSelected()||(te.value=input.prevInput=" "),input.contextMenuPending=rehide,display.selForContextMenu=cm.doc.sel,clearTimeout(display.detectingSelectAll),ie&&9<=ie_version&&prepareSelectAllHack(),captureRightClick?(e_stop(e),mouseup=function(){off(window,"mouseup",mouseup),setTimeout(rehide,20)},on(window,"mouseup",mouseup)):setTimeout(rehide,50))},TextareaInput.prototype.readOnlyChanged=function(val){val||this.reset(),this.textarea.disabled="nocursor"==val},TextareaInput.prototype.setUneditable=function(){},TextareaInput.prototype.needsContentAttribute=!1,function defineOptions(CodeMirror){var optionHandlers=CodeMirror.optionHandlers;function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt,handle&&(optionHandlers[name]=notOnInit?function(cm,val,old){old!=Init&&handle(cm,val,old)}:handle)}CodeMirror.defineOption=option,CodeMirror.Init=Init,option("value","",function(cm,val){return cm.setValue(val)},!0),option("mode",null,function(cm,val){cm.doc.modeOption=val,loadMode(cm)},!0),option("indentUnit",2,loadMode,!0),option("indentWithTabs",!1),option("smartIndent",!0),option("tabSize",4,function(cm){resetModeState(cm),clearCaches(cm),regChange(cm)},!0),option("lineSeparator",null,function(cm,val){if(cm.doc.lineSep=val){var newBreaks=[],lineNo=cm.doc.first;cm.doc.iter(function(line){for(var pos=0;;){var found=line.text.indexOf(val,pos);if(-1==found)break;pos=found+val.length,newBreaks.push(Pos(lineNo,found))}lineNo++});for(var i=newBreaks.length-1;0<=i;i--)replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length))}}),option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\t")?"":"|\t"),"g"),old!=Init&&cm.refresh()}),option("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){return cm.refresh()},!0),option("electricChars",!0),option("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),option("spellcheck",!1,function(cm,val){return cm.getInputField().spellcheck=val},!0),option("autocorrect",!1,function(cm,val){return cm.getInputField().autocorrect=val},!0),option("autocapitalize",!1,function(cm,val){return cm.getInputField().autocapitalize=val},!0),option("rtlMoveVisually",!windows),option("wholeLineUpdateBefore",!0),option("theme","default",function(cm){themeChanged(cm),updateGutters(cm)},!0),option("keyMap","default",function(cm,next,prev){next=getKeyMap(next),prev=prev!=Init&&getKeyMap(prev);prev&&prev.detach&&prev.detach(cm,next),next.attach&&next.attach(cm,prev||null)}),option("extraKeys",null),option("configureMouse",null),option("lineWrapping",!1,wrappingChanged,!0),option("gutters",[],function(cm,val){cm.display.gutterSpecs=getGutters(val,cm.options.lineNumbers),updateGutters(cm)},!0),option("fixedGutter",!0,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0",cm.refresh()},!0),option("coverGutterNextToScrollbar",!1,function(cm){return updateScrollbars(cm)},!0),option("scrollbarStyle","native",function(cm){initScrollbars(cm),updateScrollbars(cm),cm.display.scrollbars.setScrollTop(cm.doc.scrollTop),cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft)},!0),option("lineNumbers",!1,function(cm,val){cm.display.gutterSpecs=getGutters(cm.options.gutters,val),updateGutters(cm)},!0),option("firstLineNumber",1,updateGutters,!0),option("lineNumberFormatter",function(integer){return integer},updateGutters,!0),option("showCursorWhenSelecting",!1,updateSelection,!0),option("resetSelectionOnContextMenu",!0),option("lineWiseCopyCut",!0),option("pasteLinesPerSelection",!0),option("selectionsMayTouch",!1),option("readOnly",!1,function(cm,val){"nocursor"==val&&(onBlur(cm),cm.display.input.blur()),cm.display.input.readOnlyChanged(val)}),option("disableInput",!1,function(cm,val){val||cm.display.input.reset()},!0),option("dragDrop",!0,dragDropChanged),option("allowDropFileTypes",null),option("cursorBlinkRate",530),option("cursorScrollMargin",0),option("cursorHeight",1,updateSelection,!0),option("singleCursorHeightPerLine",!0,updateSelection,!0),option("workTime",100),option("workDelay",100),option("flattenSpans",!0,resetModeState,!0),option("addModeClass",!1,resetModeState,!0),option("pollInterval",100),option("undoDepth",200,function(cm,val){return cm.doc.history.undoDepth=val}),option("historyEventDelay",1250),option("viewportMargin",10,function(cm){return cm.refresh()},!0),option("maxHighlightLength",1e4,resetModeState,!0),option("moveInputWithCursor",!0,function(cm,val){val||cm.display.input.resetPosition()}),option("tabindex",null,function(cm,val){return cm.display.input.getField().tabIndex=val||""}),option("autofocus",null),option("direction","ltr",function(cm,val){return cm.doc.setDirection(val)},!0),option("phrases",null)}(CodeMirror),function addEditorMethods(CodeMirror){var optionHandlers=CodeMirror.optionHandlers,helpers=CodeMirror.helpers={};CodeMirror.prototype={constructor:CodeMirror,focus:function(){window.focus(),this.display.input.focus()},setOption:function(option,value){var options=this.options,old=options[option];options[option]==value&&"mode"!=option||(options[option]=value,optionHandlers.hasOwnProperty(option)&&operation(this,optionHandlers[option])(this,value,old),signal(this,"optionChange",this,option))},getOption:function(option){return this.options[option]},getDoc:function(){return this.doc},addKeyMap:function(map$$1,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map$$1))},removeKeyMap:function(map$$1){for(var maps=this.state.keyMaps,i=0;i<maps.length;++i)if(maps[i]==map$$1||maps[i].name==map$$1)return maps.splice(i,1),!0},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);if(mode.startState)throw new Error("Overlays may not be stateful.");!function insertSorted(array,value,score){for(var pos=0,priority=score(value);pos<array.length&&score(array[pos])<=priority;)pos++;array.splice(pos,0,value)}(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:options&&options.priority||0},function(overlay){return overlay.priority}),this.state.modeGen++,regChange(this)}),removeOverlay:methodOp(function(spec){for(var overlays=this.state.overlays,i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec;if(cur==spec||"string"==typeof spec&&cur.name==spec)return overlays.splice(i,1),this.state.modeGen++,void regChange(this)}}),indentLine:methodOp(function(n,dir,aggressive){"string"!=typeof dir&&"number"!=typeof dir&&(dir=null==dir?this.options.smartIndent?"smart":"prev":dir?"add":"subtract"),isLine(this.doc,n)&&indentLine(this,n,dir,aggressive)}),indentSelection:methodOp(function(how){for(var ranges=this.doc.sel.ranges,end=-1,i=0;i<ranges.length;i++){var newRanges=ranges[i];if(newRanges.empty())newRanges.head.line>end&&(indentLine(this,newRanges.head.line,how,!0),end=newRanges.head.line,i==this.doc.sel.primIndex&&ensureCursorVisible(this));else{for(var from=newRanges.from(),to=newRanges.to(),newRanges=Math.max(end,from.line),end=Math.min(this.lastLine(),to.line-(to.ch?0:1))+1,j=newRanges;j<end;++j)indentLine(this,j,how);newRanges=this.doc.sel.ranges;0==from.ch&&ranges.length==newRanges.length&&0<newRanges[i].from().ch&&replaceOneSelection(this.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll)}}}),getTokenAt:function(pos,precise){return takeToken(this,pos,precise)},getLineTokens:function(line,precise){return takeToken(this,Pos(line),precise,!0)},getTokenTypeAt:function(cut){cut=clipPos(this.doc,cut);var type,styles=getLineStyles(this,getLine(this.doc,cut.line)),before=0,after=(styles.length-1)/2,ch=cut.ch;if(0==ch)type=styles[2];else for(;;){var mid=before+after>>1;if((mid?styles[2*mid-1]:0)>=ch)after=mid;else{if(!(styles[2*mid+1]<ch)){type=styles[2*mid+2];break}before=1+mid}}cut=type?type.indexOf("overlay "):-1;return cut<0?type:0==cut?null:type.slice(0,cut-1)},getModeAt:function(pos){var mode=this.doc.mode;return mode.innerMode?CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode:mode},getHelper:function(pos,type){return this.getHelpers(pos,type)[0]},getHelpers:function(pos,type){var found=[];if(!helpers.hasOwnProperty(type))return found;var help=helpers[type],mode=this.getModeAt(pos);if("string"==typeof mode[type])help[mode[type]]&&found.push(help[mode[type]]);else if(mode[type])for(var i=0;i<mode[type].length;i++){var val=help[mode[type][i]];val&&found.push(val)}else mode.helperType&&help[mode.helperType]?found.push(help[mode.helperType]):help[mode.name]&&found.push(help[mode.name]);for(var i$1=0;i$1<help._global.length;i$1++){var cur=help._global[i$1];cur.pred(mode,this)&&-1==indexOf(found,cur.val)&&found.push(cur.val)}return found},getStateAfter:function(line,precise){var doc=this.doc;return getContextBefore(this,(line=clipLine(doc,null==line?doc.first+doc.size-1:line))+1,precise).state},cursorCoords:function(start,mode){var pos=this.doc.sel.primary(),pos=null==start?pos.head:"object"==typeof start?clipPos(this.doc,start):start?pos.from():pos.to();return cursorCoords(this,pos,mode||"page")},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page")},coordsChar:function(coords,mode){return coordsChar(this,(coords=fromCoordSystem(this,coords,mode||"page")).left,coords.top)},lineAtHeight:function(height,mode){return height=fromCoordSystem(this,{top:height,left:0},mode||"page").top,lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function(lineObj,mode,includeWidgets){var last,end=!1,lineObj="number"==typeof lineObj?(last=this.doc.first+this.doc.size-1,lineObj<this.doc.first?lineObj=this.doc.first:last<lineObj&&(lineObj=last,end=!0),getLine(this.doc,lineObj)):lineObj;return intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page",includeWidgets||end).top+(end?this.doc.height-heightAtLine(lineObj):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(pos,node,scroll,vert,horiz){var vspace,hspace,display=this.display,top=(pos=cursorCoords(this,clipPos(this.doc,pos))).bottom,left=pos.left;node.style.position="absolute",node.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(node),display.sizer.appendChild(node),"over"==vert?top=pos.top:"above"!=vert&&"near"!=vert||(vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth),("above"==vert||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight?top=pos.top-node.offsetHeight:pos.bottom+node.offsetHeight<=vspace&&(top=pos.bottom),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)),node.style.top=top+"px",node.style.left=node.style.right="","right"==horiz?(left=display.sizer.clientWidth-node.offsetWidth,node.style.right="0px"):("left"==horiz?left=0:"middle"==horiz&&(left=(display.sizer.clientWidth-node.offsetWidth)/2),node.style.left=left+"px"),scroll&&function scrollIntoView(cm,scrollPos){null!=(scrollPos=calculateScrollPos(cm,scrollPos)).scrollTop&&updateScrollTop(cm,scrollPos.scrollTop),null!=scrollPos.scrollLeft&&setScrollLeft(cm,scrollPos.scrollLeft)}(this,{left:left,top:top,right:left+node.offsetWidth,bottom:top+node.offsetHeight})},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(cmd){if(commands.hasOwnProperty(cmd))return commands[cmd].call(null,this)},triggerElectric:methodOp(function(text){triggerElectric(this,text)}),findPosH:function(from,amount,unit,visually){var dir=1;amount<0&&(dir=-1,amount=-amount);for(var cur=clipPos(this.doc,from),i=0;i<amount&&!(cur=findPosH(this.doc,cur,dir,unit,visually)).hitSide;++i);return cur},moveH:methodOp(function(dir,unit){var this$1=this;this.extendSelectionsBy(function(range$$1){return this$1.display.shift||this$1.doc.extend||range$$1.empty()?findPosH(this$1.doc,range$$1.head,dir,unit,this$1.options.rtlMoveVisually):dir<0?range$$1.from():range$$1.to()},sel_move)}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc;sel.somethingSelected()?doc.replaceSelection("",null,"+delete"):deleteNearSelection(this,function(range$$1){var other=findPosH(doc,range$$1.head,dir,unit,!1);return dir<0?{from:other,to:range$$1.head}:{from:range$$1.head,to:other}})}),findPosV:function(from,amount,unit,goalColumn){var dir=1,x=goalColumn;amount<0&&(dir=-1,amount=-amount);for(var cur=clipPos(this.doc,from),i=0;i<amount;++i){var coords=cursorCoords(this,cur,"div");if(null==x?x=coords.left:coords.left=x,(cur=findPosV(this,coords,dir,unit)).hitSide)break}return cur},moveV:methodOp(function(dir,unit){var this$1=this,doc=this.doc,goals=[],collapse=!this.display.shift&&!doc.extend&&doc.sel.somethingSelected();if(doc.extendSelectionsBy(function(range$$1){if(collapse)return dir<0?range$$1.from():range$$1.to();var headPos=cursorCoords(this$1,range$$1.head,"div");null!=range$$1.goalColumn&&(headPos.left=range$$1.goalColumn),goals.push(headPos.left);var pos=findPosV(this$1,headPos,dir,unit);return"page"==unit&&range$$1==doc.sel.primary()&&addToScrollTop(this$1,charCoords(this$1,pos,"div").top-headPos.top),pos},sel_move),goals.length)for(var i=0;i<doc.sel.ranges.length;i++)doc.sel.ranges[i].goalColumn=goals[i]}),findWordAt:function(pos){var line=getLine(this.doc,pos.line).text,start=pos.ch,end=pos.ch;if(line){var helper=this.getHelper(pos,"wordChars");"before"!=pos.sticky&&end!=line.length||!start?++end:--start;for(var startChar=line.charAt(start),check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper)}:/\s/.test(startChar)?function(ch){return/\s/.test(ch)}:function(ch){return!/\s/.test(ch)&&!isWordChar(ch)};0<start&&check(line.charAt(start-1));)--start;for(;end<line.length&&check(line.charAt(end));)++end}return new Range(Pos(pos.line,start),Pos(pos.line,end))},toggleOverwrite:function(value){null!=value&&value==this.state.overwrite||(((this.state.overwrite=!this.state.overwrite)?addClass:rmClass)(this.display.cursorDiv,"CodeMirror-overwrite"),signal(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:methodOp(function(x,y){scrollToCoords(this,x,y)}),getScrollInfo:function(){var scroller=this.display.scroller;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(range$$1,margin){null==range$$1?(range$$1={from:this.doc.sel.primary().head,to:null},null==margin&&(margin=this.options.cursorScrollMargin)):"number"==typeof range$$1?range$$1={from:Pos(range$$1,0),to:null}:null==range$$1.from&&(range$$1={from:range$$1,to:null}),range$$1.to||(range$$1.to=range$$1.from),range$$1.margin=margin||0,null!=range$$1.from.line?function scrollToRange(cm,range$$1){resolveScrollToPos(cm),cm.curOp.scrollToPos=range$$1}(this,range$$1):scrollToCoordsRange(this,range$$1.from,range$$1.to,range$$1.margin)}),setSize:methodOp(function(width,height){function interpret(val){return"number"==typeof val||/^\d+$/.test(String(val))?val+"px":val}var this$1=this;null!=width&&(this.display.wrapper.style.width=interpret(width)),null!=height&&(this.display.wrapper.style.height=interpret(height)),this.options.lineWrapping&&clearLineMeasurementCache(this);var lineNo$$1=this.display.viewFrom;this.doc.iter(lineNo$$1,this.display.viewTo,function(line){if(line.widgets)for(var i=0;i<line.widgets.length;i++)if(line.widgets[i].noHScroll){regLineChange(this$1,lineNo$$1,"widget");break}++lineNo$$1}),this.curOp.forceUpdate=!0,signal(this,"refresh",this)}),operation:function(f){return runInOp(this,f)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight;regChange(this),this.curOp.forceUpdate=!0,clearCaches(this),scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop),updateGutterSpace(this.display),(null==oldHeight||.5<Math.abs(oldHeight-textHeight(this.display)))&&estimateLineHeights(this),signal(this,"refresh",this)}),swapDoc:methodOp(function(doc){var old=this.doc;return old.cm=null,this.state.selectingText&&this.state.selectingText(),attachDoc(this,doc),clearCaches(this),this.display.input.reset(),scrollToCoords(this,doc.scrollLeft,doc.scrollTop),this.curOp.forceScroll=!0,signalLater(this,"swapDoc",this,old),old}),phrase:function(phraseText){var phrases=this.options.phrases;return phrases&&Object.prototype.hasOwnProperty.call(phrases,phraseText)?phrases[phraseText]:phraseText},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},eventMixin(CodeMirror),CodeMirror.registerHelper=function(type,name,value){helpers.hasOwnProperty(type)||(helpers[type]=CodeMirror[type]={_global:[]}),helpers[type][name]=value},CodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value),helpers[type]._global.push({pred:predicate,val:value})}}(CodeMirror);var prop,dontDelegate="iter insert remove copy getEditor constructor".split(" ");for(prop in Doc.prototype)Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0&&(CodeMirror.prototype[prop]=function(method){return function(){return method.apply(this.doc,arguments)}}(Doc.prototype[prop]));return eventMixin(Doc),CodeMirror.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput},CodeMirror.defineMode=function(name){CodeMirror.defaults.mode||"null"==name||(CodeMirror.defaults.mode=name),function defineMode(name,mode){2<arguments.length&&(mode.dependencies=Array.prototype.slice.call(arguments,2)),modes[name]=mode}.apply(this,arguments)},CodeMirror.defineMIME=function defineMIME(mime,spec){mimeModes[mime]=spec},CodeMirror.defineMode("null",function(){return{token:function(stream){return stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null"),CodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func},CodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func},CodeMirror.fromTextArea=function fromTextArea(textarea,options){var hasFocus;function save(){textarea.value=cm.getValue()}if(options=options?copyObj(options):{},options.value=textarea.value,!options.tabindex&&textarea.tabIndex&&(options.tabindex=textarea.tabIndex),!options.placeholder&&textarea.placeholder&&(options.placeholder=textarea.placeholder),null==options.autofocus&&(hasFocus=activeElt(),options.autofocus=hasFocus==textarea||null!=textarea.getAttribute("autofocus")&&hasFocus==document.body),textarea.form&&(on(textarea.form,"submit",save),!options.leaveSubmitMethodAlone)){var form=textarea.form,realSubmit=form.submit;try{var wrappedSubmit=form.submit=function(){save(),form.submit=realSubmit,form.submit(),form.submit=wrappedSubmit}}catch(e){}}options.finishInit=function(cm){cm.save=save,cm.getTextArea=function(){return textarea},cm.toTextArea=function(){cm.toTextArea=isNaN,save(),textarea.parentNode.removeChild(cm.getWrapperElement()),textarea.style.display="",textarea.form&&(off(textarea.form,"submit",save),options.leaveSubmitMethodAlone||"function"!=typeof textarea.form.submit||(textarea.form.submit=realSubmit))}},textarea.style.display="none";var cm=CodeMirror(function(node){return textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return cm},function addLegacyProps(CodeMirror){CodeMirror.off=off,CodeMirror.on=on,CodeMirror.wheelEventPixels=wheelEventPixels,CodeMirror.Doc=Doc,CodeMirror.splitLines=splitLinesAuto,CodeMirror.countColumn=countColumn,CodeMirror.findColumn=findColumn,CodeMirror.isWordChar=isWordCharBasic,CodeMirror.Pass=Pass,CodeMirror.signal=signal,CodeMirror.Line=Line,CodeMirror.changeEnd=changeEnd,CodeMirror.scrollbarModel=scrollbarModel,CodeMirror.Pos=Pos,CodeMirror.cmpPos=cmp,CodeMirror.modes=modes,CodeMirror.mimeModes=mimeModes,CodeMirror.resolveMode=resolveMode,CodeMirror.getMode=getMode,CodeMirror.modeExtensions=modeExtensions,CodeMirror.extendMode=extendMode,CodeMirror.copyState=copyState,CodeMirror.startState=startState,CodeMirror.innerMode=innerMode,CodeMirror.commands=commands,CodeMirror.keyMap=keyMap,CodeMirror.keyName=keyName,CodeMirror.isModifierKey=isModifierKey,CodeMirror.lookupKey=lookupKey,CodeMirror.normalizeKeyMap=normalizeKeyMap,CodeMirror.StringStream=StringStream,CodeMirror.SharedTextMarker=SharedTextMarker,CodeMirror.TextMarker=TextMarker,CodeMirror.LineWidget=LineWidget,CodeMirror.e_preventDefault=e_preventDefault,CodeMirror.e_stopPropagation=e_stopPropagation,CodeMirror.e_stop=e_stop,CodeMirror.addClass=addClass,CodeMirror.contains=contains,CodeMirror.rmClass=rmClass,CodeMirror.keyNames=keyNames}(CodeMirror),CodeMirror.version="5.49.2",CodeMirror}),define("chatroom",["jquery","form","cm/lib/codemirror","utils","config","modal","links","chat","backend","laconic"],function($,form,CodeMirror,utils,config,modal,links,chat,backend){!function($){var lasthangoutwarning=0,methods={_init:function(options){return this.each(function(){var btn,send,text,elem=$(this),close={messages:[]},hangout="gitty:"+config.swish.hangout;function enable_btn(){$(send).prop("disabled",""==$(text).val().trim())}function send_chat(){$(send).prop("disabled",!0),elem.chatroom("send"),$(text).val("")}close.docid=options.docid,elem.data("chatroom",close),elem.addClass("chatroom each-minute swish-event-receiver"),btn=$.el.div({class:"btn-group dropup"},send=$.el.button({type:"button",class:"btn btn-primary btn-xs"},"Send"),$.el.button({type:"button",class:"btn btn-info btn-xs dropdown-toggle","data-toggle":"dropdown","aria-haspopup":!0,"aria-expanded":!1},$.el.span({class:"caret"})),ul=$.el.ul({class:"dropdown-menu pull-right"})),text=$.el.textarea({placeholder:"Type chat message here ..."}),elem.append($.el.div({class:"chat-conversation"},$.el.div({class:"chat-outer-wrapper"},$.el.div({class:"chat-inner-wrapper"},$.el.div({class:"chat-content-wrapper"},$.el.div({class:"chat-stretch"}),$.el.div({class:"chat-content"}))))),close=$.el.span({class:"glyphicon menu glyphicon-remove-circle"}),$.el.div({class:"chat-input"},$.el.table({class:"chat-input"},$.el.tr($.el.td({class:"chat-text"},text),$.el.td({class:"chat-send"},btn))))),enable_btn(),$(send).on("click",send_chat),$(text).on("change",enable_btn),form.widgets.populateMenu($(btn),elem,{"Include my query":function(){var query=$(".prolog-query-editor").queryEditor("getQuery");""!=query.trim()?this.chatroom("send",{payload:[{type:"query",query:query}]}):modal.alert("Your query editor is empty")}}),options.docid!=hangout&&form.widgets.populateMenu($(btn),elem,{"Broadcast to hangout":function(){this.chatroom("send",{broadcast:"gitty:"+config.swish.hangout})}}),$(close).on("click",function(){elem.tile("close")}),$(text).keypress(function(ev){if("Enter"==ev.key&&options.oneline||ev.ctrlKey||ev.metaKey)return send_chat(),!1}),options.oneline||$(text).on("keyup",function(){var h,that=$(this);0!=that.scrollTop()&&(h=that.height())<500&&(h+=parseFloat(that.css("line-height")),that.animate({height:h},200,function(){elem.chatroom("scrollToBottom")})),enable_btn()}),options.docid==hangout&&$(text).focus(function(){var now;""!=$(text).val()||3e5<(now=(new Date).getTime())-lasthangoutwarning&&(lasthangoutwarning=now,modal.help({file:"hangout.html",notagain:"hangout"}))}),elem.on("click",".chat-message button",function(ev){var val,button=$(ev.target).closest("button");return(val=button.data("commit"))?elem.closest(".swish").swish("playFile",val):(val=button.data("diff"))&&elem.chatroom("diff",val),ev.preventDefault(),!1}),elem.on("click",".chat-content a",links.followLink),elem.on("pane.resize",function(){elem.chatroom("scrollToBottom",!0)}),elem.on("minute",function(){elem.chatroom("update_time")}),elem.on("activate-tab",function(){elem.chatroom("read_until")}),$(text).height(parseFloat($(text).css("line-height"))+5),elem.chatroom("load_from_server")})},close:function(){return this.tile("close")},send:function(options){options=options||{};var data=this.data("chatroom"),msg={type:"chat-message"},hangout=this.find("textarea");msg.text=hangout.val().trim();var payload=options.payload||[],has_payload=!1,selection=this.chatroom("storage").storage("getSelection"),hangout="gitty:"+config.swish.hangout;selection&&payload.push({type:"selection",selection:selection});for(var i=0;i<payload.length;i++)if("about"!=payload[i].type){has_payload=!0;break}options.broadcast||data.docid==hangout||0!=data.messages.length||(options.broadcast=hangout),""!=msg.text||has_payload?(msg.uuid=utils.generateUUID(),msg.payload=payload,msg.docid=options.docid||data.docid,options.class&&(msg.class=options.class),1==options.clear?this.chatroom("clear"):data.clear=msg.uuid,$("#chat").chat("send",msg),options.broadcast&&(msg.payload.unshift({type:"about",docid:data.docid}),msg.docid=options.broadcast,$("#chat").chat("send",msg))):options.payload||modal.alert("No message to send")},storage:function(){return this.closest(".tab-pane").find(".storage")},is_self:function(self){var muser=self.user||{},suser=config.swish.user||{},self=$("#chat").chat("self");return muser.id&&muser.id==self.id||muser.avatar&&muser.avatar==self.avatar||muser.profile_id&&muser.profile_id==suser.profile_id},read_until:function(msg){var data;(msg=null==msg&&(data=this.data("chatroom"))&&0<data.messages.length?data.messages[data.messages.length-1]:msg)&&($("#chat").chat("read_until",msg.docid,msg.time),$(".chat-bell").chatbell("read_until",msg.docid,msg.time))},render:function(msg){var html,span,muser=msg.user||{};config.swish.user;if(void 0===msg.is_self&&(msg.is_self=this.chatroom("is_self",msg)),elem=$($.el.div({class:"chat-message"+(msg.is_self?" self":""),"data-userid":muser.wsid})),!msg.is_self&&muser.avatar&&elem.append(chat.avatar(muser)),elem.append($.el.span({class:"chat-sender"},msg.is_self?"Me":muser.name)),msg.time&&(span=new Date(1e3*msg.time).toLocaleString(),elem.append($.el.span({class:"chat-time",title:span},"(",utils.ago(msg.time),") ")),elem.data("time",msg.time)),msg.payload)for(var i=0;i<msg.payload.length;i++){var pl=msg.payload[i];payload_handlers[pl.type]?payload_handlers[pl.type].call(elem,pl):console.log(pl)}return msg.html?html=msg.html:msg.text&&(html=function markdown(text){var replace=[{regex:/[a-z][a-zA-Z0-9_]*\/[0-9]/g,func:function(match){return'<a class="builtin" href="/pldoc/man?predicate='+match+'">'+match+"</a>"}},{regex:/[a-zA-Z0-9_-]+\.(pl|swinb)\b/g,func:function(match){return'<a class="builtin" href="'+config.http.locations.web_storage+match+'">'+match+"</a>"}},{regex:/`(.)`/g,func:function(match,content){return"<code>"+content+"</code>"}},{regex:/`([\w\[\{\(][^`]*[\w\]\}\)])`/g,func:function(match,content){return"<code>"+content+"</code>"}},{delim:"\\*",a:"\\*\\b",z:"\\b\\*",tag:"b"},{delim:"__",a:"\\b__",z:"__\\b",tag:"b"},{delim:"_",a:"\\b_",z:"_\\b",tag:"i"}];for(var i=0;i<replace.length;i++){var r=replace[i];r.regex?text=text.replace(r.regex,r.func):r.delim&&(text=text.replace(RegExp(r.a+"([^"+r.delim+"]+)"+r.z,"g"),function wrap(tag){return function(match,content){return"<"+tag+">"+content+"</"+tag+">"}}(r.tag)))}return text}(html=$($.el.span(msg.text)).html())),html&&(span=$.el.span({class:"chat-message html"}),$(span).html(html),elem.append(span)),elem},add:function(msg,seen){var elem,data=this.data("chatroom");return msg.docid==data.docid&&(null==seen&&(seen=this.is(":visible")),null==msg.is_self&&(msg.is_self=this.chatroom("is_self",msg)),data.messages.push(msg),elem=this.chatroom("render",msg),this.find(".chat-content").append(elem),this.chatroom("scrollToBottom"),seen&&this.chatroom("read_until",msg)),msg.uuid&&msg.uuid==data.clear&&this.chatroom("clear"),this},clear:function(){var ta=this.find("textarea");ta.val(""),ta.height(parseFloat(ta.css("line-height")+5))},load_from_server:function(ifempty){var data=this.data("chatroom"),elem=$(this);return backend.ajax({url:config.http.locations.chat_messages,data:{docid:data.docid,max:100},success:function(messages){if(0==messages.length)ifempty?elem.chatroom("close"):data.docid!="gitty:"+config.swish.hangout&&modal.help({file:"newchat.html",notagain:"newchat"});else for(var i=0;i<messages.length;i++)elem.chatroom("add",messages[i],i==messages.length-1)},error:function(jqXHR){modal.ajaxError(jqXHR)}}),this},update_time:function(){return this.find(".chat-message").each(function(){var time,elem=$(this);(time=elem.data("time"))&&elem.find(".chat-time").text("("+utils.ago(time)+") ")})},diff:function(options){function error(jqXHR){modal.ajaxError(jqXHR)}backend.ajax({url:config.http.locations.web_storage+options.from,data:{format:"raw"},success:function(from){backend.ajax({url:config.http.locations.web_storage+options.to,data:{format:"raw"},success:function(to){form.showDialog({title:"Update differences",body:function diffBody(){var diff=$.el.div();this.append(diff),$(diff).diff({base:from,head:to,baseName:options.name+" (before)",headName:options.name+" (after)"}),this.parents("div.modal-dialog").addClass("modal-wide")}})},error:error})},error:error})},docid:function(docid,ifempty){var data=this.data("chatroom");data.docid!=docid&&(this.find(".chat-content").html(""),data.docid=docid,this.chatroom("load_from_server",ifempty))},rooms:function(docid){var rooms=[];return this.each(function(){$(this).data("chatroom").docid==docid&&rooms.push(this)}),$(rooms)},scrollToBottom:function(onlydown){return this.each(function(){var room=$(this);scroll=room.find("div.chat-inner-wrapper"),wrap=scroll.find("div.chat-content-wrapper"),content=wrap.find("div.chat-content");var height=content[0].scrollHeight,room=wrap.height()-height-8;(0<room||!0!==onlydown)&&(wrap.find("div.chat-stretch").height(0<room?room:0),scroll.scrollTop(height))}),this}},payload_handlers={selection:function(selection){var btn=$().storage("getSelectionLabel",selection.selection),btn=$($.el.button({class:"btn btn-xs btn-primary"},btn+" ",form.widgets.glyphIcon("eye-open")));btn.on("click",function(ev){$(ev.target).chatroom("storage").storage("restoreSelection",selection.selection)}),this.append(" ",btn," ")},query:function(query){var btn=$($.el.button({class:"btn btn-xs btn-primary"},"Query ",form.widgets.glyphIcon("download")));btn.on("click",function(){var qe=$(".prolog-query-editor");qe.queryEditor("setQuery",query.query),utils.flash(qe.find(".CodeMirror"))}),function sourceToolTip(elem,src){var pre=$.el.pre({class:"cm-s-prolog"});CodeMirror.runMode(src,"prolog",pre),elem.attr("title",$.el.div(pre).innerHTML),elem.data("html",!0),elem.data("placement","bottom"),elem.data("trigger","hover"),elem.tooltip()}(btn,query.query),this.append(" ",btn," ")},update:function(update){var old,dif,nwe;this.append(" ",$.el.span({class:"update"},old=btn("play","btn-primary","Open old version"),dif=btn("zoom-in","btn-info","View changes"),nwe=btn("play","btn-primary","Open new version"))," "),$(old).data("commit",update.previous),$(dif).data("diff",{from:update.previous,to:update.commit,name:update.name}),$(nwe).data("commit",update.commit)},about:function(file){file=file.docid.replace("gitty:","");this.append(" ",$.el.a({href:config.http.locations.web_storage+file,class:"store btn btn-primary btn-xs"},file)," ")}};function btn(glyph,type,title){return form.widgets.glyphIconButton(glyph,{class:"btn-xs "+type,title:title})}$.fn.chatroom=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.chatroom"):methods._init.apply(this,arguments)}}(jQuery)}),define("chatbell",["jquery","form","modal","config","preferences","backend","laconic","chatroom"],function($,form,modal,config,preferences,backend){!function($){var methods={_init:function(options){return options=options||{},this.each(function(){var elem=$(this),data=$.extend({},options);data.docid=options.docid||elem.data("document"),elem.data("chatbell",data),elem.addClass("chat-bell"),elem.attr("title","Messages available"),elem.append(form.widgets.glyphIcon("bell"),$.el.span({class:"chat-bell-count"},"-")),elem.chatbell("update")})},chats:function(chats){var count,data=this.data("chatbell"),span=this.find(".chat-bell-count"),elem=this;function empty(){span.text("-"),elem.removeClass("chat-available chat-alert"),elem.attr("title",data.empty_title||"No messages available")}return null==chats?(delete data.docid,delete data.count,delete data.total,empty()):(count=null==chats.count?chats.total:chats.count,chats.docid&&(data.docid=chats.docid),chats.count&&(data.count=chats.count),chats.total&&(data.total=chats.total),0<chats.total?(this.addClass("chat-available"),0<count?(span.text(count),this.addClass("chat-alert"),this.attr("title",count+" new messages")):(span.text(chats.total),this.removeClass("chat-alert"),this.attr("title",chats.total+" old messages"))):empty()),this},"chats++":function(docid){var data=this.data("chatbell");return null!=data.total?data.total++:data.total=1,null!=data.count&&data.count++,null!=docid&&(data.docid=docid),data.total&&this.chatbell("chats",{total:data.total,count:data.count}),this},update:function(chats){var docid,elem,after=this.data("chatbell");return null!=(chats=chats||{}).total&&null!=chats.count?this.chatbell("chats",chats):(docid=chats.docid||after.docid,after=preferences.getDocVal(docid,"chatBar",0),docid&&(after||null==chats.total)?(elem=$(this),backend.ajax({url:config.http.locations.chat_status,data:{docid:docid,after:after},success:function(chats){elem.chatbell("chats",chats)}})):null!=chats.total&&this.chatbell("chats",chats)),this},read_until:function(docid,time){return this.each(function(){var elem=$(this),data=elem.data("chatbell");data.docid==docid&&data.total&&elem.chatbell("chats",{total:data.total,count:0})})},"chat-message":function(options){null==options.is_self&&(options.is_self=this.chatroom("is_self",options)),this.chatbell("chats++"),options.is_self||(options={dom:this.chatroom("render",options)},modal.notify(this,options))}};$.fn.chatbell=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.chatbell"):methods._init.apply(this,arguments)}}(jQuery)}),define("sourcelist",["jquery","config","form","modal","backend","laconic"],function($,config,form,modal,backend){!function($){var current_profile,pluginName="sourcelist",current_query={q:config.swish.default_query||""},query_cache=[],pending=[],qid=0,methods={_init:function(options){return this.each(function(){var elem=$(this);elem.data(pluginName,{}),elem.sourcelist("fill",void 0,current_query),elem.sourcelist("check_cache"),elem.sourcelist("update",current_query),elem.on("login",function(){elem.sourcelist("check_cache")&&elem.sourcelist("update",current_query)})})},check_cache:function(){var profile=$("#login").login("get_profile",["display_name","avatar"]);return current_profile&&current_profile.display_name==profile.display_name&&current_profile.avatar==profile.avatar?(current_profile=current_profile||profile,!1):(query_cache=[],current_profile=profile,!0)},update:function(query){var reply,elem=this;this.sourcelist("check_cache"),(reply=function from_cache(cache,query){if(null!=query){query.offset=query.offset||0,query.limit=query.limit||10;for(var i=cache.length-1;0<=i;i--){var entry=cache[i];if(function qmatch(entry){var e=entry.query;return query.q==e.q&&(query.offset>=e.offset&&(query.offset+query.limit<=e.offset+entry.matches.length||e.offset+entry.matches.length==entry.total)&&e)}(entry))return entry}}}(query_cache,query))?backend.ajax({url:config.http.locations.source_modified,dataType:"json",success:function(json){json.modified<reply.modified+10?elem.sourcelist("fill",reply,query):(query_cache=[],elem.sourcelist("update",query))},error:function(jqXHDR){modal.ajaxError(jqXHDR)}}):(query=query||{},$.extend(query,current_profile),query.q=query.q||"",query.offset=query.offset||0,query.limit=query.limit||10,query.qid=qid++,'user:"me"'!=query.q||query.avatar||query.display_name?(pending.push(query),elem.sourcelist("busy",!0),backend.ajax({url:config.http.locations.source_list,data:query,dataType:"json",success:function(reply){reply.query=query,pending.pop(),0==pending.length&&elem.sourcelist("busy",!1),function add_to_cache(cache,result){var qr=result.query;if(0!=result.cache){qr.offset=qr.offset||0,qr.limit=qr.limit||10;for(var i=cache.length-1;0<=i;i--){var entry=cache[i],qc=entry.query;if(qc.q==qr.q&&qc.offset+entry.matches.length==qr.offset){for(i=0;i<result.matches.length;i++)entry.matches.push(result.matches[i]);return}}cache.push(result)}}(query_cache,reply),elem.sourcelist("fill",reply,query)},error:function(jqXHDR){pending.pop(),0==pending.length&&elem.sourcelist("busy",!1),modal.ajaxError(jqXHDR)}})):elem.sourcelist("fill",null,query))},page:function(move){var data=this.data(pluginName);if(data&&data.page){var q=$.extend({},data.page.query);switch(null==q.offset&&(q.offset=0),move){case"first":q.offset=0;break;case"prev":q.offset-=data.page.size;break;case"next":q.offset+=data.page.size;break;case"last":q.offset=function roundUp(v,n){return Math.floor((v+(n-1))/n)*n}(data.page.total,data.page.size)-data.page.size;break;default:return}q.offset=Math.max(0,q.offset),this.sourcelist("update",q)}},fill:function(results,query){var body,input=this.data(pluginName);if(!input)return this;function h(title){return $.el.th(title)}results&&(current_query=query,input.page={query:query,offset:query.offset,size:query.limit,total:results.total}),0==(body=this.find("tbody")).length?(this.append($.el.div({class:"search-form input-group"}),$.el.div({class:"search-results"},table=$.el.table({class:"table table-striped table-hover table-condensed"},$.el.thead($.el.tr(h("Type"),h("Name"),h("Tags"),h("User"),h("Modified"))),body=$.el.tbody()),$.el.div({class:"search-no-results"}),$.el.div({class:"loading search"})),$.el.div({class:"search-footer"})),this.sourcelist("search_form"),(body=$(body)).on("click","tr",function(tr){tr=$(tr.target).closest("tr");$("body").swish("playFile",{file:tr.attr("data-name")})})):$(body).html("");input=this.find("input.search");if(input.is(":focus")||(input.val(results?results.query.q:query?query.q:""),input.trigger("propertychange",!1)),results){var i=query.offset-results.query.offset,e=Math.min(i+query.limit,results.matches.length);for(i<e?$(table).show():$(table).hide();i<e;i++){var match=results.matches[i],ext=match.name.split(".").pop(),base=match.name.slice(0,-(ext.length+1)),tdtags=$.el.td({class:"tags"});(match.tags||[]).forEach(function(tag){$(tdtags).append($.el.span({class:"tag"},tag))}),body.append($.el.tr({"data-name":match.name},$.el.td(form.widgets.typeIcon(ext)),$.el.td(base),tdtags,$.el.td(match.author),$.el.td(function humanize(s){return(s=new Date(1e3*s).toISOString()).slice(0,10)+" "+s.slice(11,19)}(match.time))))}this.sourcelist("search_footer",results,query)}},search_footer:function(results,query){var footer=this.find("div.search-footer"),noresults=this.find("div.search-no-results"),bopts={};function btn(action,dir,icon){return bopts.action=action,bopts.class="btn-primary "+dir,form.widgets.glyphIconButton(icon,bopts)}0==footer.find(".f-total").length&&(footer.append(btn("first","backward","fast-backward"),btn("prev","backward","step-backward"),$.el.button({class:"btn btn-default"},$.el.span({class:"f-from"}),$.el.label("to"),$.el.span({class:"f-to"}),$.el.label("from"),$.el.span({class:"f-total"})),btn("next","forward","step-forward"),btn("last","forward","fast-forward"),$.el.br(),$.el.span({class:"f-time"}),$.el.span({class:"f-time-label"}," sec")),footer.on("click","button",function(act){var b=$(act.target).closest("button"),act=b.data("action");act&&b.closest("div.sourcelist").sourcelist("page",act)}));var a,helpfile,end=Math.min(query.offset+query.limit,results.total);0==results.total?(0==noresults.find("div").length&&(noresults.append($.el.div($.el.span({class:"no-search-results-warning"},form.widgets.glyphIcon("alert")," No matching files"),$.el.br(),"If you are a new user you may",$.el.ul($.el.li("Use the Examples menu from the navigation bar"),$.el.li("Use the Program or Notebook button above")),$.el.div(a=$.el.a({href:"#"},"help on search")))),helpfile=(config.swish.sourcelist||{}).help||"sourcelist.html",$(a).on("click",function(){modal.help({file:helpfile})})),noresults.show(),footer.hide()):(noresults.hide(),0<query.offset||end<results.total?(footer.show(),0==query.offset?footer.find(".backward").attr("disabled","disabled"):footer.find(".backward").removeAttr("disabled"),end>=results.total?footer.find(".forward").attr("disabled","disabled"):footer.find(".forward").removeAttr("disabled"),footer.find(".f-from").text(""+query.offset),footer.find(".f-to").text(""+end),footer.find(".f-total").text(""+results.total),footer.find(".f-time").text(""+results.cpu)):footer.hide())},search_form:function(){this.data(pluginName);var btnsubmit,elem=this,div=this.find("div.search-form");function btn(div,members){var ul,div=$.el.div({class:"btn-group"},$.el.button({type:"button",class:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":!0,"aria-expanded":!1},div," ",$.el.span({class:"caret"})),ul=$.el.ul({class:"dropdown-menu"}));for(var i=0;i<members.length;i++)$(ul).append($.el.li(function add(item){var a;return"string"==typeof item?$.el.a({"data-tag":item},item):(a=item.i?$.el.a({"data-tag":item.t,"data-value":item.v},form.widgets.typeIcon(item.i)," "+item.l):$.el.a({"data-tag":item.t,"data-value":item.v},item.l),$(a).data("quote",null==item.q?'"':item.q),a)}(members[i])));return div}function submit(q){$(btnsubmit).prop("disabled",!0),q&&q.preventDefault();q=elem.find("input").val();return elem.sourcelist("update",{q:q}),!1}div.append($.el.div({class:"form-group has-feedback has-clear"},$.el.input({type:"text",class:"form-control search",placeholder:"Find files"}),$.el.span({class:"form-control-clear glyphicon glyphicon-remove form-control-feedback hidden"})),$.el.div({class:"input-group-btn"},btn("Filter",[{t:"user",l:"My files",v:"me",q:'"'},{t:"user",l:"By user",v:"",q:'"'},{t:"user",l:"By user (regex)",v:"",q:"/"},{t:"tag",l:"By tag",v:"",q:'"'},{t:"tag",l:"By tag (regex)",v:"",q:"/"},{t:"name",l:"By name",v:"",q:'"'},{t:"name",l:"By name (regex)",v:"",q:"/"}]),btn("Type",[{t:"type",l:"Program",i:"pl",v:"pl",q:""},{t:"type",l:"Notebook",i:"swinb",v:"swinb",q:""},{t:"type",l:"Permalink",i:"lnk",v:"lnk",q:""}]),btnsubmit=$.el.button({class:"btn btn-primary",type:"submit"},$.el.i({class:"glyphicon glyphicon-search"})))),form.dyn_clear(div,submit),div.on("click","a",function(a){a=$(a.target).closest("a");!function tag(tag,value,val){var input=div.find("input"),tagv=tag+":"+val+(value||"")+val,val=""==(val=input.val()).trim()?tagv:value&&RegExp("\\b"+tag+":").test(val)?val.replace(RegExp("\\b"+tag+':(\\S*|\\s*"[^"]*")'),tagv):val.trim()+" "+tagv;input.val(val).trigger("propertychange"),!value&&"tag"!=tag||submit()}(a.data("tag"),a.data("value"),a.data("quote"))}),$(btnsubmit).on("click",submit),elem.find("input").keydown(function(ev){if(13==ev.which)return submit(ev)}).on("input propertychange",function(ev,propagate){0!=propagate&&$(btnsubmit).prop("disabled",!1)})},busy:function(busy){var div=this.find("div.loading");busy?div.show():div.hide()}};$.fn.sourcelist=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery)}),define("tabbed",["jquery","form","config","preferences","modal","backend","laconic","search","chatbell","sourcelist"],function($,form,config,preferences,modal,backend){var tabbed={tabTypes:{},type:function(from){var k,ext=from.split(".").pop();for(k in tabbed.tabTypes)if(tabbed.tabTypes.hasOwnProperty(k)&&tabbed.tabTypes[k].dataType==ext)return tabbed.tabTypes[k]}};return tabbed.tabTypes.permalink={dataType:"lnk",typeName:"program",label:"Program",create:function(dom,options){$(dom).addClass("prolog-editor printable").prologEditor($.extend({save:!0},options)).prologEditor("makeCurrent")}},function($){var tabid=0,methods={_init:function(options){return options=options||{},this.each(function(){var elem=$(this),data={};data.newTab=options.newTab,data.tabTypes=options.tabTypes||tabbed.tabTypes,elem.data("tabbed",data),elem.addClass("tabbed unloadable"),elem.tabbed("makeTabbed"),elem.on("trace-location",function(ev,prompt){elem.tabbed("showTracePort",prompt)}),elem.on("data-is-clean",function(a,clean){a=$(a.target).closest(".tab-pane"),a=elem.tabbed("navTab",a.attr("id"));a&&(clean?a.removeClass("data-dirty"):a.addClass("data-dirty"))}),elem.on("unload",function(state){state.target==elem[0]&&elem.closest(".swish").swish("preserve_state")&&(state=elem.tabbed("getState"),localStorage.setItem("tabs",JSON.stringify(state)))}),elem.on("restore",function(ev){var state;if(ev.target==elem[0]){try{var str=localStorage.getItem("tabs");str&&(state=JSON.parse(str))}catch(err){}state&&"object"==typeof state&&elem.tabbed("setState",state)}}),elem.on("preference",function(ev,pref){"preserve-state"==pref.name&&0==pref.value&&localStorage.removeItem("tabs")})})},makeTabbed:function(){var children=this.children(),ul=$.el.ul({class:"nav nav-tabs",role:"tablist"}),contents=$.el.div({class:"tab-content"});this.prepend(contents),this.prepend(ul),$(ul).on("click","span.xclose",function(ev){var id=$(ev.target).parent().attr("data-id");$(ev.target).parents(".tabbed").first().tabbed("removeTab",id),ev.preventDefault()}),$(ul).on("click","a",function(ev){$(ev.target).closest("a").tab("show"),ev.preventDefault()});for(var i=0;i<children.length;i++){var active=$(children[i]),id=genId(),label=active.attr("data-label")||"Unknown",li="disabled"!=active.attr("data-close"),active=i==children.length-1,li=this.tabbed("tabLabel",id,label,li);active&&$(li).addClass("active"),$(ul).append(li),$(contents).append(wrapInTab($(children[i]),id,active))}var create=$.el.a({class:"tab-new compact",title:"Open a new tab"},glyphicon("plus"));$(ul).append($.el.li({class:"tab-new",role:"presentation"},create)),$(create).on("click",function(ev){return $(ev.target).parents(".tabbed").first().tabbed("newTab"),ev.preventDefault(),!1}),$(ul).on("shown.bs.tab","a",function(newContentID){newContentID=$(newContentID.target).data("id");$("#"+newContentID+" .swish-event-receiver").trigger("activate-tab"),$("#"+newContentID+" .storage").storage("activate")}),0==this.tabbed("navContent").children().length&&this.tabbed("newTab")},newTab:function(dom,active){var sl=this.data("tabbed");return null==dom&&(sl.newTab?dom=sl.newTab():(dom=this.tabbed("tabSelect"),$(dom).append(this.tabbed("profileForm"),$.el.hr(),sl=$.el.div({class:"sourcelist"})),$(sl).sourcelist())),null==active&&(active=!0),this.tabbed("addTab",dom,{active:active,close:!0})},getState:function(){var state=this.tabbed("get_ordered_storage").storage("getState");return state.pathname=window.location.pathname,state.time=(new Date).getTime(),state},setState:function(state){for(var fromURL=0<this.find(".storage").length,i=0;i<state.tabs.length;i++){var data=state.tabs[i];this.tabbed("restoreTab",data,fromURL)}},restoreTab:function(data,fromURL){var tab,elem=this;data.query=null,data.noHistory=!0;var active,newtab,url,restoring=this.find(".storage").storage("match",data);function restoreData(into,from){from.data&&into.find(".storage").storage("setValue",{data:from.data,role:"source"}),from.chatroom&&into.find(".storage").storage("chat",from.chatroom)}restoring?(restoring.data("storage").url=data.url,tab=restoring.closest(".tab-pane"),elem.tabbed("move_right",tab)):tab=void 0,restoring?restoreData(tab,data):restoring||(active=this.find("div.tabbed-select"),restoring='<div class="restore-tab">Restoring '+(data.file||data.url)+" ...</div>",0<active.length?(newtab=active.first().closest(".tab-pane")).html(restoring):(active=!fromURL&&Boolean(data.active),newtab=elem.tabbed("newTab",$(restoring),active)),"gitty"==data.st_type?(url=config.http.locations.web_storage+data.file,backend.ajax({url:url,type:"GET",data:{format:"json"},success:function(reply){reply.url=url,reply.st_type="gitty",reply.noHistory=!0,elem.tabbed("setSource",newtab,reply)||(console.log("Failed to restore",data.file),elem.tabbed("removeTab",tab.attr("id"))),restoreData(newtab,data),!fromURL&&newtab.hasClass("active")&&newtab.find(".storage").storage("activate")},error:function(jqXHR){modal.ajaxError(jqXHR)}})):data.url?backend.ajax({url:data.url,type:"GET",data:{format:"json"},success:function(source){var msg;if("string"==typeof source)msg={data:source,st_type:"external"};else{if("object"!=typeof source||"string"!=typeof source.data)return void alert("Invalid data");(msg=source).st_type="filesys"}msg.noHistory=!0,msg.url=data.url,elem.tabbed("setSource",newtab,msg)||(console.log("Failed to restore",data.url),elem.tabbed("removeTab",newtab.attr("id"))),restoreData(newtab,data),!fromURL&&newtab.hasClass("active")&&newtab.find(".storage").storage("activate")},error:function(jqXHR){modal.ajaxError(jqXHR)}}):console.log("Cannot restore ",data))},tabFromSource:function(src){var tab,elem=this,select=this.find("div.tabbed-select");function inNewTab(){var tab=elem.tabbed("newTab",$("<span></span>"));elem.tabbed("setSource",tab,src)||elem.tabbed("removeTab",tab.attr("id"))}return"string"==typeof src&&(src={data:src}),0<select.length?(tab=select.first().closest(".tab-pane"),this.tabbed("show",tab.attr("id")),this.tabbed("setSource",tab,src)):src.newTab||preferences.getVal("new-tab")?inNewTab():(this.find(".storage").each(function(i,st){if($(st).storage("setSource",src))return tab=$(st).closest(".tab-pane"),!1}),tab?this.tabbed("show",tab.attr("id")):inNewTab()),this},setSource:function(tab,src){if("object"==typeof src&&(src.meta&&src.meta.name||src.url)){var options=src.meta&&src.meta.name?src.meta.name:src.url,tabType=tabbed.type(options),content=$.el.div(),options={};return src.noHistory&&(options.noHistory=!0),tab.html(""),tab.tabbed("title",tabType.label,tabType.dataType),tab.append(content),tabType.create(content,options),$(content).storage("setSource",src),!0}return!1},showTracePort:function(prompt){if(prompt&&prompt.source&&prompt.source.file){var pengineID,store,editors,file=prompt.source.file;if(pengineID=function isPengineSrc(){if(file.startsWith("pengine://"))return file.split("/")[2]}())editors=this.find(".prolog-editor").filter(function(i,e){return $(e).prologEditor("pengine",{has:pengineID})});else if((store=function isStoreSrc(){if(file.startsWith("swish://"))return file.slice("swish://".length)}())&&!(editors=this.find(".storage").storage("match",{file:store})))return this.closest(".swish").swish("playFile",{file:store,newTab:!0,noHistory:!0,prompt:prompt}),this;editors&&editors.prologEditor("showTracePort",prompt)}return this},addTab:function(li,options){var ul=this.tabbed("navTabs"),create=genId(),tab=wrapInTab(li,create,options.active);this.tabbed("navContent").append(tab);li=this.tabbed("tabLabel",create,"New tab",close,"select"),create=ul.find("a.tab-new");return 1==create.length?$(li).insertBefore(create.first().parent()):ul.append(li),options.active&&$(li).find("a").first().tab("show"),tab},removeTab:function(tab,force){var new_active,li=this.tabbed("navTabs").find("a[data-id='"+tab+"']").parent(),tab=$("#"+tab);!0!==force&&0==tab.find(".storage").storage("unload","closetab")||(tab.is(":visible")&&(new_active=li.prev()||li.next()),li.remove(),tab.find(".prolog-runner").prologRunner("close"),tab.find(".storage").storage("close"),tab.remove(),new_active&&0<new_active.length?new_active.find("a").first().tab("show"):0==this.tabbed("navContent").children().length&&this.tabbed("newTab"),$(".storage").storage("chat_status",!0))},show:function(a){a=this.tabbed("navTab",a);a&&a.tab("show"),$(".storage").storage("chat_status",!0)},move_right:function(id){var ul=this.find(">ul"),id="string"==typeof id?id:id.attr("id");ul.find("a[data-id="+id+"]").closest("li").insertBefore(ul.children().last())},tabLabel:function(id,label,close,chat){close&&(li=glyphicon("remove","xclose"),$(li).attr("title","Close tab")),chat=chat||"pl";var li=$.el.a({class:"compact",href:"#"+id,"data-id":id},$.el.span({class:"tab-icon type-icon "+chat}),$.el.span({class:"tab-dirty",title:"Tab is modified. See File/Save and Edit/View changes"}),chat=$.el.a({class:"tab-chat"}),$.el.span({class:"tab-title"},label),li),li=$.el.li({role:"presentation"},li);return $(chat).chatbell().on("click",function(id){id=$(id.target).closest("a.compact").data("id");return $("#"+id).find(".storage").storage("chat"),!1}),li},anchor:function(){var id=this.closest(".tab-pane");if(0!=id.length){var tabbed=id.closest(".tabbed"),id=id.attr("id");return tabbed.tabbed("navTabs").find("a[data-id="+id+"]")}},get_ordered_storage:function(){var elem=this,result=[];return this.find(">ul>li").each(function(){var id=$(this).find(">a").data("id");elem.find(">div.tab-content>div[id="+id+"] .storage").each(function(){result.push(this)})}),$(result)},title:function(title,type){var icon=this.tabbed("anchor");return icon&&(icon.find(".tab-title").text(title),type&&((icon=icon.find(".tab-icon")).removeClass(),icon.addClass("tab-icon type-icon "+type))),this},chats:function(chats){var a=this.tabbed("anchor");return a&&a.find(".chat-bell").chatbell("update",chats),this},"chats++":function(docid){var a=this.tabbed("anchor");return a&&a.find(".chat-bell").chatbell("chats++",docid),this},tabSelect:function(){var k,data=this.data("tabbed"),dom=$.el.div({class:"tabbed-select"},$.el.div({class:"tabbed-create"},$.el.label({class:"tabbed-left"},"Create a "),g=$.el.div({class:"btn-group",role:"group"}),$.el.label({class:"tabbed-right"},"here"))),types=[];for(k in data.tabTypes)data.tabTypes.hasOwnProperty(k)&&data.tabTypes[k].order&&types.push(k);types.sort(function(a,b){return data.tabTypes[a].order-data.tabTypes[b].order});for(var i=0;i<types.length;i++){var type=data.tabTypes[types[i]];$(g).append($.el.button({type:"button",class:"btn btn-primary","data-type":type.typeName,"data-ext":type.dataType},type.label))}return $(g).on("click",".btn",function(profile){var type=$(profile.target).data("type"),tab=$(profile.target).closest(".tab-pane"),content=$.el.div(),options=$.extend({},tabbed.tabTypes[type]),profile=tab.find("label.active > input[name=profile]").val();profile&&(options.profile=profile,options.value=tab.tabbed("profileValue",profile,tabbed.tabTypes[type].dataType),null!=options.value&&preferences.setVal("default-profile",profile)),tab.html(""),tab.tabbed("title",options.label,options.dataType),tab.append(content),tabbed.tabTypes[type].create(content,options)}),$(g).addClass("swish-event-receiver"),$(g).on("download save fileInfo print",function(ev){$(ev.target).closest(".tab-pane").is(":visible")&&(modal.alert("Please activate the tab "+{download:"you wish to download",save:"you wish to save",print:"you wish to print",fileInfo:"for which you want details"}[ev.type]),ev.stopPropagation())}),$(g).on("profile-selected",function(ev,profile){$(ev.target).find("button").each(function(){$(this).prop("disabled",profile.type.indexOf($(this).data("ext"))<0)})}),dom},searchForm:function(){var sform=$.el.form({class:"search-sources"},$.el.label({class:"control-label"},"Open source file containing"),$.el.div({class:"input-group"},$.el.input({type:"text",class:"form-control search",placeholder:"Search sources","data-search-in":"sources store_content"}),$.el.div({class:"input-group-btn"},$.el.button({class:"btn btn-default",type:"submit"},$.el.i({class:"glyphicon glyphicon-search"})))),$.el.div({class:"input-group"},form.fields.radio("smatch",[{label:"Start of line",value:"sol"},{label:"Start of word",value:"sow",active:!0},{label:"Anywhere",value:"anywhere"}])));return $(sform).find("input.search").search(),sform},sourceList:function(){},profileForm:function(){if(config.swish.profiles&&0<config.swish.profiles.length){for(var def,i=0;i<config.swish.profiles.length;i++)delete config.swish.profiles[i].active;if(def=preferences.getVal("default-profile"))for(i=0;i<config.swish.profiles.length;i++)config.swish.profiles[i].value==def&&(config.swish.profiles[i].active=!0);else config.swish.profiles[0].active=!0;var pform=$.el.div({class:"tabbed-profile"},$.el.label({class:"tabbed-left"},"based on"),$.el.div({class:"input-group select-profile"},form.fields.radio("profile",config.swish.profiles)),$.el.label({class:"tabbed-right"},"profile"));return $(pform).on("click",function(ev){var profile=function profileObject(name){if(config.swish.profiles)for(var i=0;i<config.swish.profiles.length;i++)if(config.swish.profiles[i].value==name)return config.swish.profiles[i]}($(ev.target).find("input").val());$(ev.target).closest(".tab-pane").find(".tabbed-create .btn-group").trigger("profile-selected",profile)}),pform}},profileValue:function(name,url){url=config.http.locations.swish+"profile/"+name+"."+url;return backend.ajax({url:url,type:"GET",data:{format:"raw"},async:!1,error:function(jqXHR){modal.ajaxError(jqXHR)}}).responseText},navTabs:function(){return this.find("ul.nav-tabs").first()},navTab:function(a){a=this.find("ul.nav-tabs").first().find("a[data-id='"+a+"']");if(0<a.length)return a},navContent:function(){return this.find("div.tab-content").first()}};function wrapInTab(wrapped,id,active){$(wrapped).wrap('<div role="tabpanel" class="tab-pane" id="'+id+'"></div>');wrapped=$(wrapped).parent();return active&&wrapped.addClass("active"),wrapped}function glyphicon(span,className){span=$.el.span({class:"glyphicon glyphicon-"+span});return className&&$(span).addClass(className),span}function genId(){return"tabbed-tab-"+tabid++}$.fn.tabbed=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.tabbed"):methods._init.apply(this,arguments)},$.fn.tabbed.methods=methods}(jQuery),tabbed}),define("prolog",["jquery","config","form","preferences"],function($,config,form,preferences){var prolog={downloadCSV:function(query,source,options){if((options=options||{}).disposition=options.disposition||options.filename||"swish-results.csv",options.projection){var formel=options.format||"prolog";function attr(name,value){return $.el.input({type:"hidden",name:name,value:value})}if(options.distinct&&(query="distinct(["+options.projection+"],("+query+"))"),options.limit){var limit=parseInt(options.limit.replace(/[ _]/g,""));if("number"!=typeof limit)return alert("Not an integer: ",options.limit),!1;query="limit("+limit+",("+query+"))"}formel=$.el.form({method:"POST",action:config.http.locations.pengines+"/create",target:"_blank"},attr("format","csv"),attr("chunk","10"),attr("solutions","all"),attr("disposition",options.disposition),attr("application","swish"),attr("ask",query),attr("src_text",source),attr("template",formel+"("+options.projection+")")),$("body").append(formel),formel.submit(),$(formel).remove()}else{var vars=$().prologEditor("variables",query,{projection:!0}),disposition=options.disposition;disposition.indexOf(".")<0&&(disposition+=".csv"),form.showDialog({title:"Download query results as CSV",body:function infoBody(){var formel=$.el.form({class:"form-horizontal"},form.fields.projection(vars.join(",")),form.fields.csvFormat(config.swish.csv_formats,preferences.getVal("csvFormat")),form.fields.limit("10 000",!1),form.fields.filename(disposition,2),form.fields.buttons({label:"Download CSV",action:function(ev,params){return ev.preventDefault(),1<config.swish.csv_formats.length&&preferences.setVal("csvFormat",params.format),prolog.downloadCSV(query,source,params),!1}}));this.append(formel)}})}return this},trimFullStop:function(s){return s.replace(/\.\s*$/m,"")},options:{application:"swish",chunk:5}};return $.swish=function(options){for(var opt in prolog.options)prolog.options.hasOwnProperty(opt)&&!options.hasOwnProperty(opt)&&(options[opt]=prolog.options[opt]);return new Pengine(options)},prolog}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/hint/templates-hint",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){var templatesMap=[],Pos=CodeMirror.Pos;CodeMirror.templatesHint={};var ourMap={Tab:selectNextVariable,Enter:function(cm){selectNextVariable(cm,!0)},Esc:uninstall,"Ctrl-Space":function hintValue(cm){var pos=cm._templateState,sels=pos.selectableMarkers[pos.varIndex],pos={state:pos};cm._hintTemplateMarker&&(pos.marker=cm._hintTemplateMarker);cm._templateStack||(cm._templateStack=[]);function samePos(p1,p2){return p1.ch==p2.ch&&p1.line==p2.line}cm._templateStack.push(pos),delete cm._templateState;pos=(cm._hintTemplateMarker=sels).find(),sels=cm.listSelections();1==sels.length&&samePos(sels[0].anchor,pos.from)&&samePos(sels[0].head,pos.to)&&cm.replaceRange("â°",pos.from,pos.to);CodeMirror.commands.autocomplete(cm)}};function TemplateState(){this.marked=[],this.selectableMarkers=[],this.varIndex=-1}function isNested(cm){return cm._templateStack?cm._templateStack.length:0}function Template(data){this.name=data.name,this.description=data.description,this.text=data.text,data.varTemplates&&(this.varTemplates=data.varTemplates),null!=data.template?this.source=data.template:null!=data.tokens&&(this._tokens=data.tokens)}function onChange(cm,textChanged){var state=cm._templateState;if(textChanged.origin&&state&&!state.updating)try{state.updating=!0;var markerChanged=function getMarkerChanged(cm,textChanged){var markers=cm.findMarksAt(textChanged.from);if(markers)for(var i=0;i<markers.length;i++){var marker=markers[i];if(marker._templateVar)return marker}return null}(cm,textChanged);if(null==markerChanged)uninstall(cm);else for(var posChanged=markerChanged.find(),newContent=cm.getRange(posChanged.from,posChanged.to),i=0;i<state.marked.length;i++){var pos=state.marked[i];pos!=markerChanged&&pos._templateVar==markerChanged._templateVar&&(pos=pos.find(),cm.replaceRange(newContent,pos.from,pos.to))}}finally{state.updating=!1}}function onEndCompletion(cm){isNested(cm),isNested(cm)&&uninstall(cm,!0)}function selectNextVariable(cm,pos){var state=cm._templateState;if(0<state.selectableMarkers.length){if(state.varIndex++,state.varIndex>=state.selectableMarkers.length){if(pos)return void exit(cm);state.varIndex=0}var marker=state.selectableMarkers[state.varIndex],pos=marker.find();cm.setSelection(pos.from,pos.to);marker._templateVar;for(var i=0;i<state.marked.length;i++){var m=state.marked[i];m==marker?(m.className="",m.startStyle="",m.endStyle=""):m._templateVar==marker._templateVar?(m.className="CodeMirror-templates-variable-selected",m.startStyle="",m.endStyle=""):(m.className="CodeMirror-templates-variable",m.startStyle="CodeMirror-templates-variable-start",m.endStyle="CodeMirror-templates-variable-end")}cm.refresh()}else exit(cm)}function exit(cm){var cursorPos=cm._templateState.cursor;null==cursorPos||null!=(cursorPos=cursorPos.find())&&cm.setSelection(cursorPos,cursorPos),uninstall(cm)}function uninstall(cm,canceled){var prev,state=cm._templateState;if(state){state.marked.length;for(var i=0;i<state.marked.length;i++)state.marked[i].clear();null!=state.cursor&&state.cursor.clear(),state.marked.length=0,state.selectableMarkers.length=0}cm._templateStack&&0<cm._templateStack.length?(cm._templateStack.length,prev=cm._templateStack.pop(),state=cm._templateState=prev.state,canceled&&cm._hintTemplateMarker&&function canceledMarker(){for(var i=0;i<state.marked.length;i++){var pos,mark=state.marked[i];mark!=cm._hintTemplateMarker||(pos=mark.find())&&"â°"==cm.getRange(pos.from,pos.to)&&cm.replaceRange(mark._templateVar,pos.from,pos.to)}}(),prev.marker?cm._hintTemplateMarker=prev.marker:delete cm._hintTemplateMarker):(cm.off("change",onChange),cm.off("endCompletion",onEndCompletion),cm.removeKeyMap(ourMap),delete cm._templateState,delete cm._hintTemplateMarker)}Template.prototype.tokens=function(){return null==this._tokens&&(this._tokens=function parseTemplate(content){for(var tokens=[],varParsing=!1,last=null,token="",i=0;i<content.length;i++){var addChar,current=content.charAt(i);last="\n"==current?(""!=token&&tokens.push(token),token="",tokens.push(current),null):(addChar=!0,varParsing?"}"==current&&(addChar=varParsing=!1,"cursor"==token?tokens.push({cursor:!0}):"line_selection"==token?tokens.push({line_selection:!0}):tokens.push({variable:token}),token=""):"$"==current&&i+1<=content.length&&(i++,"{"==content.charAt(i)&&(addChar=!(varParsing=!0),""!=token&&tokens.push(token),token="")),addChar&&"$"!=last?(token+=current,current):null)}""!=token&&tokens.push(token);return tokens}(this.source)),this._tokens},Template.prototype.content=function(){if(null==this._content){for(var tokens=this.tokens(),content="",i=0;i<tokens.length;i++){var token=tokens[i];"string"==typeof token?content+=token:token.variable&&(content+=token.variable)}this._content=content}return this._content},Template.prototype.insert=function(cm,data){var template=this,nested=isNested(cm);if((cm._templateState||nested)&&uninstall(cm),template.text)cm.replaceRange(template.text,data.from,data.to);else{var state=new TemplateState;cm._templateState=state;for(var tokens=this.tokens(),content="",line=data.from.line,col=data.from.ch,markers=[],variables=[],cursor=null,i=0;i<tokens.length;i++){var selectable,token=tokens[i];"string"==typeof token?(content+=token,"\n"==token?(line++,col=0):col+=token.length):token.variable?(content+=token.variable,from=Pos(line,col),to=Pos(line,col+token.variable.length),selectable=0!=variables[token.variable],col+=token.variable.length,markers.push({from:from,to:to,variable:token.variable,selectable:selectable}),variables[token.variable]=!1):token.cursor&&(cursor=Pos(line,col))}var from=data.from,to=data.to,startLine=from.line;cm.replaceRange(content,from,to);for(i=0;i<markers.length;i++){var marker=markers[i],from=marker.from,to=marker.to,markText=cm.markText(from,to,{className:"CodeMirror-templates-variable",startStyle:"CodeMirror-templates-variable-start",endStyle:"CodeMirror-templates-variable-end",inclusiveLeft:!0,inclusiveRight:!0,clearWhenEmpty:!1,_templateVar:marker.variable,_templates:function subTemplate(tvar){if(template.varTemplates&&template.varTemplates[tvar])return template.varTemplates[tvar]}(marker.variable)});state.marked.push(markText),1==marker.selectable&&state.selectableMarkers.push(markText)}null!=cursor&&(state.cursor=cm.setBookmark(cursor));for(var lines=content.split("\n"),x=1;x<lines.length;x++){var targetLine=startLine+x;cm.indentLine(targetLine)}nested||(cm.on("change",onChange),cm.on("endCompletion",onEndCompletion),cm.addKeyMap(ourMap)),selectNextVariable(cm,!0)}},CodeMirror.templatesHint.getCompletions=function(cm,completions,text){var mode=cm.doc.mode.name,list=templatesMap[mode];if(list)for(var i=0;i<list.length;i++){var label,className,completion=list[i];!function startsWith(str,token){return str.slice(0,token.length).toUpperCase()==token.toUpperCase()}(completion.name,text)||(label=completion.name,completion.description&&(label+="- "+completion.description),className="CodeMirror-hint-template",((completion={className:className=completion.className?completion.className:className,text:label,template:completion}).data=completion).hint=function(cm,data,completion){completion.template.insert(cm,data)},completion.info=function(result){var content=result.template.content();if(CodeMirror.runMode){result=document.createElement("div");return result.className="cm-s-default",cm.options&&cm.options.theme&&(result.className="cm-s-"+cm.options.theme),CodeMirror.runMode(content,cm.getMode().name,result),result}return content},completions.push(completion))}},CodeMirror.templatesHint.Template=Template,CodeMirror.templatesHint.addTemplates=function(templates){var list,context=templates.context;context&&((list=templatesMap[context])||(list=[],templatesMap[context]=list),templates.templates.forEach(function(template){list.push(new Template(template))}))}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/prolog/prolog-template-hint",["../../lib/codemirror","../../addon/hint/templates-hint","jquery","config","laconic"],mod):mod(CodeMirror)}(function(CodeMirror,TemplatesHint,$,config){"use strict";var templates=config.swish.templates||[];function PrologHint(options){var hint=this;var copy=["template","displayText","text",{from:"summary",to:"description"},"className","varTemplates"];if("string"==typeof options)this.displayText=options,this.text=options;else{for(var i=0;i<copy.length;i++){var spec=copy[i];"string"==typeof spec?options[spec]&&(this[spec]=options[spec]):options[spec.from]&&(this[spec.to]=options[spec.from])}options.mode&&function modeToTemplate(mode){if(hint.template||(hint.template=mode.replace(/[-+?:^@!]*([A-Z][A-Za-z_0-9]*)/g,"$${$1}").replace(/\bis\s+(det|nondet|semidet|fail|multi)$/,""),hint.template.match(/\${cursor}/)||(hint.template+="${cursor}")),hint.displayText||(hint.displayText=mode),!hint.varTemplates){var metav=mode.match(/:[A-Z][A-Za-z_0-9]*/g);if(metav&&0<metav.length){for(var vt={},i=0;i<metav.length;i++)vt[metav[i].substring(1)]=templates;hint.varTemplates=vt}}}(options.mode),options.classes&&(options.className=options.classes.join(" "))}this.render=function(li,data,me){$(li).append(me.displayText)},this.info=function(me){return me.description}}function getHints(cm,callback,data){data=function hintsFor(cm,state,options){var text=state.token.string,results=[],myTemplates=templates;function startsWith(str,start){return str.slice(0,start.length)==start}cm._hintTemplateMarker&&("â°"==text&&(text=""),myTemplates=cm._hintTemplateMarker._templates);var symbol=0<text.length&&!text.match(/\w/);if(myTemplates)for(var i=0;i<myTemplates.length;i++){var templ=myTemplates[i];if("string"==typeof templ)startsWith(templ,text)&&results.push(new PrologHint(templ));else{var fields=["name","mode","template","text"];if(symbol)templ.name&&0<=templ.name.indexOf(text)&&results.push(new PrologHint(templ));else for(var j=0;j<fields.length;j++)if(templ[fields[j]]){startsWith(templ[fields[j]],text)&&results.push(new PrologHint(templ));break}}}if(0==results.length)for(var anyhint=(0,CodeMirror.hint.anyword)(cm,""==text&&cm._hintTemplateMarker?{word:/[A-Z][A-Za-z0-9_]*/}:options),i=0;i<anyhint.list.length;i++)results.push(new PrologHint(anyhint.list[i]));return{list:results,from:state.position.from,to:state.position.to}}(cm,getState(cm),data);CodeMirror.attachContextInfo(data),callback(data)}function getState(cm){var cur=cm.getCursor(),token=cm.getTokenAt(cur);return"prolog"!=CodeMirror.innerMode(cm.getMode(),token.state).mode.name?null:{token:token,position:{from:new CodeMirror.Pos(cur.line,token.start),to:new CodeMirror.Pos(cur.line,token.end)}}}return PrologHint.prototype.hint=function(cm,data,completion){new CodeMirror.templatesHint.Template(this).insert(cm,data)},getHints.async=!0,CodeMirror.registerHelper("hint","prologTemplate",getHints),{getHints:getHints,getState:getState}}),define("gitty",["jquery","config","form","modal","backend","laconic"],function($,config,form,modal,backend){function diffMeta(m1,m2){var diff={};function diffAttr(a){(m1[a]||m2[a])&&m1[a]!=m2[a]&&(diff[a]={from:m1[a],to:m2[a]})}return diffAttr("author"),diffAttr("title"),diffAttr("data"),diffAttr("public"),diffAttr("example"),diffAttr("name"),(d=diffTags(m1.tags,m2.tags))&&(diff.tags=d),$.isEmptyObject(diff)?null:diff}function diffTags(t1,t2){var d,diff={};function added(t1,t2){for(var a=[],i=0;i<t2.length;i++)t1.indexOf(t2[i])<0&&a.push(t2[i]);return a}return 0<(d=added(t1=t1||[],t2=t2||[])).length&&(diff.added=d),0<(d=added(t2,t1)).length&&(diff.deleted=d),$.isEmptyObject(diff)?null:diff}return function($){var methods={_init:function(options){return this.each(function(){var elem=$(this),data=elem.data("gitty")||{},tabs=options.meta;function tab(label,active,id,disabled){var attrs={role:"presentation"},classes=[];return active&&classes.push("active"),disabled&&classes.push("disabled"),classes!=[]&&(attrs.class=classes.join(" ")),$.el.li(attrs,$.el.a({href:"#"+id,"data-toggle":"tab"},label))}data.commits=[],data.commits[tabs.commit]=tabs,data.commit=tabs.commit,data.editor=options.editor,henabled=!Boolean(tabs.previous),tabs=$($.el.div({class:"tab-content"})),elem.append($.el.ul({class:"nav nav-tabs"},tab("Meta data",!0,"gitty-meta-data"),tab("History",!1,"gitty-history",henabled),tab("Changes",!1,"gitty-diff",henabled))),elem.append(tabs),tabs.append($.el.div({class:"tab-pane fade in active gitty-meta-data",id:"gitty-meta-data"})),elem.find('[href="#gitty-meta-data"]').on("show.bs.tab",function(ev){elem.gitty("showMetaData")}),tabs.append($.el.div({class:"tab-pane fade gitty-history",id:"gitty-history"})),elem.find('[href="#gitty-history"]').on("show.bs.tab",function(ev){elem.gitty("showHistory")}),tabs.append($.el.div({class:"tab-pane fade gitty-diff",id:"gitty-diff"})),elem.find('[href="#gitty-diff"]').on("show.bs.tab",function(ev){elem.gitty("showDiff")}),elem.data("gitty",data),elem.gitty("showMetaData")})},title:function(meta){var title=$.el.span("File ",$.el.span({class:"filename"},meta.name));return"HEAD"!=meta.symbolic&&meta.commit&&$(title).append("@",$.el.span({class:"sha1 abbrev"},meta.commit.substring(0,7))),title},showMetaData:function(){return this.each(function(){var formel=$(this),data=formel.data("gitty"),tab=formel.find(".gitty-meta-data"),meta=data.commits[data.commit];data.metaData!=data.commit&&(data.metaData=data.commit,tab.html(""),formel=$.el.form({class:"form-horizontal"},form.fields.fileName(meta.name,meta.public,meta.example,!0),form.fields.title(meta.title),form.fields.author(meta.author),form.fields.date(meta.time,"Date","date"),form.fields.tags(meta.tags)),"HEAD"==meta.symbolic&&$(formel).append(form.fields.buttons({label:"Update meta data",action:function(ev,newMetaData){return data.editor.storage("save",newMetaData,"only-meta-data"),!1}})),tab.append(formel))})},showHistory:function(options){return this.each(function(){var playButton,elem=$(this),data=elem.data("gitty"),tab=elem.find(".gitty-history"),url=data.commits[data.commit];data.history||((options=options||{}).depth||(options.depth=100),tab.html(""),tab.append($.el.div({class:"gitty-history-table"},$.el.table({class:"table table-striped table-condensed gitty-history","data-click-to-select":!0,"data-single-select":!0},$.el.tr($.el.th("Comment"),$.el.th("Date"),$.el.th("User"),$.el.th("Changed")),$.el.tbody()))),playButton=form.widgets.glyphIconButton("play",{title:"Open the highlighted version in SWISH",class:"btn-primary"}),tab.append(playButton),$(playButton).on("click",function(ev){var commit=elem.find("tr.success");return 1==commit.length&&(commit=commit.data("commit"),file="HEAD"==data.commits[commit].symbolic?data.commits[commit].name:commit,elem.parents(".swish").swish("playFile",file),$("#ajaxModal").modal("hide")),!1}),url=config.http.locations.web_storage+encodeURI(url.name),backend.ajax({url:url,contentType:"application/json",type:"GET",data:{format:"history",depth:options.depth,to:data.commit},success:function(reply){elem.gitty("fillHistoryTable",reply),data.history=data.commit},error:function(jqXHDR){modal.ajaxError(jqXHR)}}))})},fillHistoryTable:function(historyobj){for(var gitty=this,data=this.data("gitty"),table=this.find(".table.gitty-history tbody"),history=historyobj.history||historyobj,i=0;i<history.length;i++){var h=history[i];data.commits[h.commit]||(data.commits[h.commit]=h)}historyobj.skipped&&table.append($.el.tr($.el.td({class:"skipped-commits",colspan:4},"(Skipped "+historyobj.skipped+" commits)")));for(i=0;i<history.length;i++){h=history[i];if(i==history.length-1&&h.previous&&!data.commit[h.previous])break;var tr={"data-commit":h.commit};data.commit==h.commit&&(tr.class="success"),tr=$.el.tr(tr,h.commit_message?$.el.td({class:"commit-message"},h.commit_message):$.el.td({class:"commit-message no-comment"},"No comment"),$.el.td({class:"date"},new Date(1e3*h.time).toLocaleString()),$.el.td({class:"author"},h.author||"No author"),$.el.td({class:"changes"},function changedAttributes(m1){var m2,diff,elem=$.el.span();if(m1.previous){if((m2=data.commits[m1.previous])&&(diff=diffMeta(m1,m2))){var d,ch,change=0;for(d in diff)diff.hasOwnProperty(d)&&(ch="name"==d?"forked "+m2.name:d,$(elem).append(0==change++?void 0:", ",$.el.span({class:"change-type"},ch)))}}else $(elem).append("initial");return elem}(h))),table.append(tr)}table.on("click","tr",function(commit){commit=$(commit.target).parents("tr").data("commit");gitty.gitty("setCommit",commit)})},setCommit:function(commit){var data=this.data("gitty"),h2=this.parent(".modal-content").find("h2");return h2.html(""),h2.append(this.gitty("title",data.commits[commit])),this.find("tr.success").removeClass("success"),this.find("tr[data-commit="+commit+"]").addClass("success"),data.commit=commit,this},showDiff:function(){return this.each(function(){var url,elem=$(this),data=elem.data("gitty");data.diff!=data.commit&&(elem.find(".gitty-diff").html(""),url=config.http.locations.web_storage+encodeURI(data.commit),backend.ajax({url:url,contentType:"application/json",type:"GET",data:{format:"diff"},success:function(reply){elem.gitty("fillDiff",reply),data.diff=data.commit},error:function(jqXHR){modal.ajaxError(jqXHR)}}))})},fillDiff:function(diff){diff.tags&&this.gitty("diffTags",diff.tags),diff.data&&this.gitty("udiffData",diff.data)},diffTags:function(diff){var tab=this.find(".gitty-diff"),div=$($.el.div({class:"diff-tags"},$.el.label("Tags"))),span=$($.el.span({class:"diff-tags"}));function addTag(tag,className){span.append($.el.span({class:"diff-tag "+className},tag))}if(div.append(span),diff.deleted.length){span.append("Removed: ");for(var i=0;i<diff.deleted.length;i++)addTag(diff.deleted[i],"deleted")}if(diff.added.length){span.append(diff.deleted.length?", ":"","Added: ");for(i=0;i<diff.added.length;i++)addTag(diff.added[i],"added")}return tab.append(div),this},udiffData:function(diff){for(var tab=this.find(".gitty-diff"),lines=diff.split("\n"),pre=$($.el.pre({class:"udiff"})),i=0;i<lines.length;i++){var line=lines[i];pre.append($.el.span({class:{"@":"udiff-hdr"," ":"udiff-ctx","+":"udiff-add","-":"udiff-del"}[line.charAt(0)]},line),$.el.br())}tab.append(pre)}};$.fn.gitty=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.gitty"):methods._init.apply(this,arguments)}}(jQuery),{diffMeta:diffMeta,reduceMeta:function reduceMeta(meta,old){var k,r={};for(k in meta)if(meta.hasOwnProperty(k)){switch(typeof meta[k]){case"object":if($.isArray(meta[k])&&!diffTags(meta[k],old[k]))continue;break;case"string":case"boolean":if(old[k]==meta[k])continue}r[k]=meta[k]}return r},diffTags:diffTags}});var __whitespace={" ":!0,"\t":!0,"\n":!0,"\f":!0,"\r":!0},difflib={defaultJunkFunction:function(c){return __whitespace.hasOwnProperty(c)},stripLinebreaks:function(str){return str.replace(/^[\n\r]*|[\n\r]*$/g,"")},stringAsLines:function(str){for(var lfpos=str.indexOf("\n"),linebreak=str.indexOf("\r"),linebreak=-1<lfpos&&-1<linebreak||linebreak<0?"\n":"\r",lines=str.split(linebreak),i=0;i<lines.length;i++)lines[i]=difflib.stripLinebreaks(lines[i]);return lines},__reduce:function(func,list,initial){if(null!=initial)var value=initial,idx=0;else{if(!list)return null;value=list[0],idx=1}for(;idx<list.length;idx++)value=func(value,list[idx]);return value},__ntuplecomp:function(a,b){for(var mlen=Math.max(a.length,b.length),i=0;i<mlen;i++){if(a[i]<b[i])return-1;if(a[i]>b[i])return 1}return a.length==b.length?0:a.length<b.length?-1:1},__calculate_ratio:function(matches,length){return length?2*matches/length:1},__isindict:function(dict){return function(key){return dict.hasOwnProperty(key)}},__dictget:function(dict,key,defaultValue){return dict.hasOwnProperty(key)?dict[key]:defaultValue},SequenceMatcher:function(a,b,isjunk){this.set_seqs=function(a,b){this.set_seq1(a),this.set_seq2(b)},this.set_seq1=function(a){a!=this.a&&(this.a=a,this.matching_blocks=this.opcodes=null)},this.set_seq2=function(b){b!=this.b&&(this.b=b,this.matching_blocks=this.opcodes=this.fullbcount=null,this.__chain_b())},this.__chain_b=function(){for(var b=this.b,n=b.length,b2j=this.b2j={},populardict={},i=0;i<b.length;i++){var indices,elt=b[i];b2j.hasOwnProperty(elt)?(indices=b2j[elt],200<=n&&100*indices.length>n?(populardict[elt]=1,delete b2j[elt]):indices.push(i)):b2j[elt]=[i]}for(elt in populardict)populardict.hasOwnProperty(elt)&&delete b2j[elt];var isjunk=this.isjunk,junkdict={};if(isjunk){for(var elt in populardict)populardict.hasOwnProperty(elt)&&isjunk(elt)&&(junkdict[elt]=1,delete populardict[elt]);for(var elt in b2j)b2j.hasOwnProperty(elt)&&isjunk(elt)&&(junkdict[elt]=1,delete b2j[elt])}this.isbjunk=difflib.__isindict(junkdict),this.isbpopular=difflib.__isindict(populardict)},this.find_longest_match=function(alo,ahi,blo,bhi){for(var j,k,a=this.a,b=this.b,b2j=this.b2j,isbjunk=this.isbjunk,besti=alo,bestj=blo,bestsize=0,j2len={},nothing=[],i=alo;i<ahi;i++){var jkey,newj2len={},jdict=difflib.__dictget(b2j,a[i],nothing);for(jkey in jdict)if(jdict.hasOwnProperty(jkey)&&!((j=jdict[jkey])<blo)){if(bhi<=j)break;newj2len[j]=k=difflib.__dictget(j2len,j-1,0)+1,bestsize<k&&(besti=i-k+1,bestj=j-k+1,bestsize=k)}j2len=newj2len}for(;alo<besti&&blo<bestj&&!isbjunk(b[bestj-1])&&a[besti-1]==b[bestj-1];)besti--,bestj--,bestsize++;for(;besti+bestsize<ahi&&bestj+bestsize<bhi&&!isbjunk(b[bestj+bestsize])&&a[besti+bestsize]==b[bestj+bestsize];)bestsize++;for(;alo<besti&&blo<bestj&&isbjunk(b[bestj-1])&&a[besti-1]==b[bestj-1];)besti--,bestj--,bestsize++;for(;besti+bestsize<ahi&&bestj+bestsize<bhi&&isbjunk(b[bestj+bestsize])&&a[besti+bestsize]==b[bestj+bestsize];)bestsize++;return[besti,bestj,bestsize]},this.get_matching_blocks=function(){if(null!=this.matching_blocks)return this.matching_blocks;for(var alo,ahi,blo,bhi,i,j,k,x,la=this.a.length,lb=this.b.length,queue=[[0,la,0,lb]],matching_blocks=[];queue.length;)alo=(k=queue.pop())[0],ahi=k[1],blo=k[2],bhi=k[3],i=(x=this.find_longest_match(alo,ahi,blo,bhi))[0],j=x[1],(k=x[2])&&(matching_blocks.push(x),alo<i&&blo<j&&queue.push([alo,i,blo,j]),i+k<ahi&&j+k<bhi&&queue.push([i+k,ahi,j+k,bhi]));matching_blocks.sort(difflib.__ntuplecomp);var block,i2,j2,k2,idx,i1=0,j1=0,k1=0,non_adjacent=[];for(idx in matching_blocks)matching_blocks.hasOwnProperty(idx)&&(i2=(block=matching_blocks[idx])[0],j2=block[1],k2=block[2],i1+k1==i2&&j1+k1==j2?k1+=k2:(k1&&non_adjacent.push([i1,j1,k1]),i1=i2,j1=j2,k1=k2));return k1&&non_adjacent.push([i1,j1,k1]),non_adjacent.push([la,lb,0]),this.matching_blocks=non_adjacent,this.matching_blocks},this.get_opcodes=function(){if(null!=this.opcodes)return this.opcodes;var ai,bj,size,tag,i=0,j=0,answer=[];this.opcodes=answer;var idx,blocks=this.get_matching_blocks();for(idx in blocks)blocks.hasOwnProperty(idx)&&(ai=(tag=blocks[idx])[0],bj=tag[1],size=tag[2],tag="",i<ai&&j<bj?tag="replace":i<ai?tag="delete":j<bj&&(tag="insert"),tag&&answer.push([tag,i,ai,j,bj]),i=ai+size,j=bj+size,size&&answer.push(["equal",ai,i,bj,j]));return answer},this.get_grouped_opcodes=function(n){n=n||3;var code,tag,i1,i2,j1,j2,codes=this.get_opcodes();"equal"==(codes=codes||[["equal",0,1,0,1]])[0][0]&&(tag=(code=codes[0])[0],i1=code[1],i2=code[2],j1=code[3],j2=code[4],codes[0]=[tag,Math.max(i1,i2-n),i2,Math.max(j1,j2-n),j2]),"equal"==codes[codes.length-1][0]&&(tag=(code=codes[codes.length-1])[0],i1=code[1],i2=code[2],j1=code[3],j2=code[4],codes[codes.length-1]=[tag,i1,Math.min(i2,i1+n),j1,Math.min(j2,j1+n)]);var idx,nn=n+n,group=[],groups=[];for(idx in codes)codes.hasOwnProperty(idx)&&(tag=(code=codes[idx])[0],i1=code[1],i2=code[2],j1=code[3],j2=code[4],"equal"==tag&&nn<i2-i1&&(group.push([tag,i1,Math.min(i2,i1+n),j1,Math.min(j2,j1+n)]),groups.push(group),group=[],i1=Math.max(i1,i2-n),j1=Math.max(j1,j2-n)),group.push([tag,i1,i2,j1,j2]));return!group||1==group.length&&"equal"==group[0][0]||groups.push(group),groups},this.ratio=function(){return matches=difflib.__reduce(function(sum,triple){return sum+triple[triple.length-1]},this.get_matching_blocks(),0),difflib.__calculate_ratio(matches,this.a.length+this.b.length)},this.quick_ratio=function(){var elt;if(null==this.fullbcount){this.fullbcount=fullbcount={};for(var i=0;i<this.b.length;i++)fullbcount[elt=this.b[i]]=difflib.__dictget(fullbcount,elt,0)+1}for(var fullbcount=this.fullbcount,avail={},availhas=difflib.__isindict(avail),matches=numb=0,i=0;i<this.a.length;i++)elt=this.a[i],numb=availhas(elt)?avail[elt]:difflib.__dictget(fullbcount,elt,0),avail[elt]=numb-1,0<numb&&matches++;return difflib.__calculate_ratio(matches,this.a.length+this.b.length)},this.real_quick_ratio=function(){var la=this.a.length,lb=this.b.length;return _calculate_ratio(Math.min(la,lb),la+lb)},this.isjunk=isjunk||difflib.defaultJunkFunction,this.a=this.b=null,this.set_seqs(a,b)}};define("difflib",function(){}),diffview={buildView:function(params){var baseTextLines=params.baseTextLines,newTextLines=params.newTextLines,opcodes=params.opcodes,baseTextName=params.baseTextName||"Base Text",newTextName=params.newTextName||"New Text",contextSize=params.contextSize,inline=0==params.viewType||1==params.viewType?params.viewType:0;if(null==baseTextLines)throw"Cannot build diff view; baseTextLines is not defined.";if(null==newTextLines)throw"Cannot build diff view; newTextLines is not defined.";if(!opcodes)throw"Canno build diff view; opcodes is not defined.";function celt(e,clazz){e=document.createElement(e);return e.className=clazz,e}function telt(e,text){e=document.createElement(e);return e.appendChild(document.createTextNode(text)),e}function ctelt(e,clazz,text){e=document.createElement(e);return e.className=clazz,e.appendChild(document.createTextNode(text)),e}var tdata=document.createElement("thead"),node=document.createElement("tr");tdata.appendChild(node),inline?(node.appendChild(document.createElement("th")),node.appendChild(document.createElement("th")),node.appendChild(ctelt("th","texttitle",baseTextName+" vs. "+newTextName))):(node.appendChild(document.createElement("th")),node.appendChild(ctelt("th","texttitle",baseTextName)),node.appendChild(document.createElement("th")),node.appendChild(ctelt("th","texttitle",newTextName)));var node2,tdata=[tdata],rows=[];function addCells(row,tidx,tend,textLines,change){return tidx<tend?(row.appendChild(telt("th",(tidx+1).toString())),row.appendChild(ctelt("td",change,textLines[tidx].replace(/\t/g,"Â Â Â Â "))),tidx+1):(row.appendChild(document.createElement("th")),row.appendChild(celt("td","empty")),tidx)}function addCellsInline(row,tidx,tidx2,textLines,change){row.appendChild(telt("th",null==tidx?"":(tidx+1).toString())),row.appendChild(telt("th",null==tidx2?"":(tidx2+1).toString())),row.appendChild(ctelt("td",change,textLines[null!=tidx?tidx:tidx2].replace(/\t/g,"Â Â Â Â ")))}for(var idx=0;idx<opcodes.length;idx++){code=opcodes[idx],change=code[0];for(var b=code[1],be=code[2],n=code[3],ne=code[4],rowcnt=Math.max(be-b,ne-n),toprows=[],botrows=[],i=0;i<rowcnt;i++){if(contextSize&&1<opcodes.length&&(0<idx&&i==contextSize||0==idx&&0==i)&&"equal"==change){var jump=rowcnt-(0==idx?1:2)*contextSize;if(1<jump){if(toprows.push(node=document.createElement("tr")),b+=jump,n+=jump,i+=jump-1,node.appendChild(telt("th","...")),inline||node.appendChild(ctelt("td","skip","")),node.appendChild(telt("th","...")),node.appendChild(ctelt("td","skip","")),idx+1==opcodes.length)break;continue}}toprows.push(node=document.createElement("tr")),inline?"insert"==change?addCellsInline(node,null,n++,newTextLines,change):"replace"==change?(botrows.push(node2=document.createElement("tr")),b<be&&addCellsInline(node,b++,null,baseTextLines,"delete"),n<ne&&addCellsInline(node2,null,n++,newTextLines,"insert")):"delete"==change?addCellsInline(node,b++,null,baseTextLines,change):addCellsInline(node,b++,n++,baseTextLines,change):(b=addCells(node,b,be,baseTextLines,change),n=addCells(node,n,ne,newTextLines,change))}for(i=0;i<toprows.length;i++)rows.push(toprows[i]);for(i=0;i<botrows.length;i++)rows.push(botrows[i])}for(idx in rows.push(node=ctelt("th","author","diff view generated by ")),node.setAttribute("colspan",inline?3:4),node.appendChild(node2=telt("a","jsdifflib")),node2.setAttribute("href","http://github.com/cemerick/jsdifflib"),tdata.push(node=document.createElement("tbody")),rows)rows.hasOwnProperty(idx)&&node.appendChild(rows[idx]);for(idx in node=celt("table","diff"+(inline?" inlinediff":"")),tdata)tdata.hasOwnProperty(idx)&&node.appendChild(tdata[idx]);return node}},define("diffview",function(){}),define("diff",["jquery","difflib","diffview"],function(){var $,methods;$=jQuery,methods={_init:function(options){return this.each(function(){var base=difflib.stringAsLines(options.base),newtxt=difflib.stringAsLines(options.head),opcodes=new difflib.SequenceMatcher(base,newtxt).get_opcodes(),contextSize=null==options.contextSize?3:options.contextSize;this.appendChild(diffview.buildView({baseTextLines:base,newTextLines:newtxt,opcodes:opcodes,baseTextName:options.baseName||"Base text",newTextName:options.headName||"Current text",contextSize:contextSize,viewType:$("inline").checked?1:0}))})}},$.fn.diff=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.diff"):methods._init.apply(this,arguments)}}),define("storage",["jquery","config","modal","form","gitty","history","tabbed","utils","backend","laconic","diff"],function($,config,modal,form,gitty,history,tabbed,utils,backend){function udiff(diff){if(diff){for(var lines=diff.split("\n"),pre=$($.el.pre({class:"udiff"})),i=0;i<lines.length;i++){var line=lines[i];pre.append($.el.span({class:{"@":"udiff-hdr"," ":"udiff-ctx","+":"udiff-add","-":"udiff-del"}[line.charAt(0)]},line),$.el.br())}return pre}return $($.el.div({class:"udiff"},"No changes"))}function editConflicts(merged){var lines=merged.split("\n"),pre=$($.el.pre({class:"udiff"})),cls=null;function addLine(line,cls){pre.append($.el.span({class:cls},line),$.el.br())}for(var i=0;i<lines.length;i++){var line=lines[i];"<<<<<<<"==line?(addLine(line,"edit-conflict-sep"),cls="edit-conflict-me"):"edit-conflict-me"==cls&&"======="==line?(addLine(line,"edit-conflict-sep"),cls="edit-conflict-them"):"edit-conflict-them"==cls&&">>>>>>>"==line?(addLine(line,"edit-conflict-sep"),cls=null):cls&&addLine(line,cls)}return pre}!function($){var defaults={typeName:"program",is_clean:!0,markClean:function(clean){}},methods={_init:function(options){return this.each(function(){var elem=$(this),data=$.extend({},defaults,options);function onStorage(ev,method){var target=$(ev.target);if(target.hasClass("storage")&&target.is(":visible")&&"propagate"==target.storage.apply(target,Array.prototype.slice.call(arguments,1)))return;ev.stopPropagation()}elem.data("storage",data),elem.addClass("storage unloadable"),elem.storage("update_tab_title"),elem.on("storage",function(ev,action,...args){args.unshift(ev,action),onStorage.apply(this,args)}),elem.on("save",function(ev,data){onStorage(ev,"save",data)}),elem.on("download",function(ev){onStorage(ev,"download")}),elem.on("fileInfo",function(ev){onStorage(ev,"info")}),elem.on("diff",function(ev){onStorage(ev,"diff")}),elem.on("revert",function(ev){onStorage(ev,"revert")}),elem.on("reload",function(ev){onStorage(ev,"reload")}),elem.on("chat-about-file",function(ev){onStorage(ev,"chat")}),elem.on("follow-file",function(ev){onStorage(ev,"follow")}),elem.on("activate-tab",function(ev){}),elem.on("data-is-clean",function(ev,clean){elem.storage("markClean",clean)}),elem.on("fullscreen",function(ev,val){val||elem.storage("update_tab_title")}),elem.on("unload",function(ev,rc){rc.rc=elem.storage("unload","beforeunload",ev)}),elem.storage("chat",(data.meta||{}).chat||"update")})},supportsType:function(name){var type=this.data("storage"),type=tabbed.tabTypes[type.typeName];if((name="string"==typeof name?{data:name}:name).meta&&name.meta.name||name.url){name=name.meta&&name.meta.name?name.meta.name:name.url;if(tabbed.type(name).typeName!=type.typeName)return!1}return!0},setSource:function(src){var data=this.data("storage");if("string"==typeof src&&(src={data:src}),this.storage("supportsType",src))return 0!=this.storage("unload","setSource")&&(src.meta?(data.file=src.meta.name,data.meta=src.meta,data.url=null,"HEAD"==src.meta.symbolic&&(src.url=config.http.locations.web_storage+src.meta.name)):(data.file=null,data.meta=null),data.url=src.url,data.st_type=src.st_type,data.chats=src.chats,data.setValue(src),data.cleanGeneration=data.changeGen(),data.cleanData=data.getValue(),data.cleanCheckpoint=src.cleanCheckpoint||"load",data.markClean(!0),this.storage("update_tab_title"),src.url||(src.url=config.http.locations.swish),src.noHistory||history.push({url:src.url,reason:"load"}),this.storage("chat",src.chat||(src.meta||{}).chat||"update"),$(".storage").storage("chat_status",!0),this)},is_clean:function(){var data=this.data("storage");return data.isClean(data.cleanGeneration)},setValue:function(value){var data=this.data("storage");return data.setValue(value),this.trigger("data-is-clean",data.isClean(data.cleanGeneration)),this},update_tab_title:function(action){return this.each(function(){var data,file,type,title,elem=$(this),docid=elem.storage("docid");"chats++"==action?elem.tabbed("chats++",docid):((file=(data=elem.data("storage")).file||data.url)&&(type=tabbed.type(file))||(type=tabbed.tabTypes[data.typeName]),file?(title=function filebase(file){return file?file.split(".").slice(0,-1).join("."):null}(utils.basename(file)),data.meta&&"HEAD"!=data.meta.symbolic&&data.meta.commit&&(title+="@"+data.meta.commit.substring(0,7))):title=type.label,docid&&data.chats&&(data.chats.docid=docid),elem.tabbed("title",title,type.dataType),elem.tabbed("chats",data.chats))})},load:function(file){var that;return file&&((that=this).data("storage"),backend.ajax({url:config.http.locations.web_storage+file,dataType:"text",success:function(data){that.storage("setSource",{data:data,meta:{name:file}})},error:function(jqXHDR){modal.ajaxError(jqXHR)}})),this},revert:function(){var data=this.data("storage");return data.setValue(data.cleanData),data.cleanGeneration=data.changeGen(),data.markClean(!0),this},reload:function(file){var elem=this,data=elem.data("storage");file=file||data.file;var url=config.http.locations.web_storage+encodeURI(file);return backend.ajax({url:url,type:"GET",data:{format:"json"},success:function(reply){reply.url=url,reply.st_type="gitty",reply.noHistory=!0,elem.storage("setSource",reply),$("#chat").trigger("send",{type:"reloaded",file:file,commit:reply.meta.commit})},error:function(jqXHR){modal.ajaxError(jqXHR)}}),this},save:function(meta,what){var post,data=this.data("storage"),type=tabbed.tabTypes[data.typeName],url=config.http.locations.web_storage,method="POST",elem=this;if(("filesys"==data.st_type||"external"==data.st_type)&&data.url)return this.storage("saveURL");if("as"==meta)return this.storage("saveAs"),this;if(!data.file||"only-meta-data"!=what&&(meta&&meta.default||meta&&meta.name!=data.file)||(url+=encodeURI(data.file),method="PUT"),"only-meta-data"==what){if($.isEmptyObject(gitty.reduceMeta(meta,data.meta)))return void alert("No change");post={update:"meta-data"}}else if("POST"==method)post={data:data.getValue(),type:type.dataType};else if(data.isClean(data.cleanGeneration)){if(null==gitty.diffTags(data.meta.tags,meta.tags))return void alert("No change")}else post={data:data.getValue(),type:type.dataType};return meta&&(post.meta=meta),data.meta&&(post.previous=data.meta.commit),backend.ajax({url:url,dataType:"json",contentType:"application/json",type:method,data:JSON.stringify(post),success:function(reply){reply.error?modal.alert(errorString("Could not save",reply)):(data.meta&&data.meta.example!=reply.meta.example&&elem.closest(".swish").trigger("examples-changed"),data.file=reply.file,data.meta=reply.meta,data.st_type="gitty",data.cleanGeneration=data.changeGen(),data.cleanData=data.getValue(),data.cleanCheckpoint="save",data.markClean(!0),modal.feedback({html:"Saved",owner:elem}),"POST"==method&&(data.chats={docid:elem.storage("docid"),total:0}),elem.storage("update_tab_title"),elem.storage("chat",(data.meta||{}).chat||"update"),elem.storage("load_messages",reply.messages||[]),$(".storage").storage("chat_status",!0),history.push({url:reply.url,reason:"save"}))},error:function(jqXHR,textStatus,errorThrown){409==jqXHR.status?elem.storage("resolveEditConflict",JSON.parse(jqXHR.responseText)):403==jqXHR.status?modal.alert("Permission denied.  Please try a different name"):(alert('Save failed; click "ok" to try again'),elem.storage("saveAs"))}}),this},saveAs:function(options){var canmodify,data=this.data("storage"),meta=data.meta||{},editor=this,update=Boolean(data.file),fork=data.meta&&"HEAD"!=meta.symbolic&&!meta.default,type=tabbed.tabTypes[data.typeName],profile=$("#login").login("get_profile",["display_name","avatar","email","identity"]),author=profile.display_name,modify=meta.modify;return void 0===meta.public&&(meta.public=!0),modify=profile.identity?modify||["login","owner"]:["any","login","owner"],canmodify=!!profile.identity&&(profile.identity==meta.identity||!(meta.identity||meta.user)),options=options||{},form.showDialog({title:options.title||(fork?"Fork from "+meta.commit.substring(0,7):update?"Save new version":"Save "+type.label+" as"),body:function saveAsBody(){this.append($.el.form({class:"form-horizontal"},form.fields.hidden("identity",profile.identity),form.fields.hidden("default",meta.default),form.fields.hidden("chat",meta.chat),profile.identity?void 0:form.fields.hidden("avatar",profile.avatar),form.fields.fileName(fork?null:data.file,meta.public,meta.example),form.fields.title(meta.title),form.fields.author(author,profile.identity),update?form.fields.commit_message():void 0,form.fields.tags(meta.tags),form.fields.modify(modify,canmodify),form.fields.follow(profile.email),form.fields.buttons({label:fork?"Fork "+type.label:update?"Update "+type.label:"Save "+type.label,action:function(ev,as){return editor.storage("save",as),!1}})))}}),this},saveURL:function(){var options=this.data("storage"),data=options.getValue(),type=tabbed.type(options.url)||{},elem=this;return options.isClean(options.cleanGeneration)?alert("No change"):backend.ajax({url:options.url,dataType:"json",contentType:type.contentType||"text/plain",type:"PUT",data:data,success:function(reply){reply.error?modal.alert(errorString("Could not save",reply)):(options.cleanGeneration=options.changeGen(),options.cleanData=options.getValue(),options.cleanCheckpoint="save",options.markClean(!0),modal.feedback({html:"Saved",owner:elem}))},error:function(jqXHR){var url;403==jqXHR.status?(url=options.url,delete options.meta,delete options.st_type,delete options.url,elem.storage("saveAs",{title:"<div class='warning'>Could not save to "+url+"</div> Save a copy as"})):modal.ajaxError(jqXHR)}}),this},activate:function(){var data=this.data("storage");return data&&data.url&&history.push({url:data.url,reason:"activate"}),this},getState:function(always){var state={tabs:[]};return this.each(function(){var tab,h=$(this),data=h.data("storage"),meta=h.meta||{};(data.file||data.url)&&data.isClean&&data.cleanGeneration&&(!meta.name&&data.file&&(meta.name=data.file),tab={file:meta.name,st_type:data.st_type,url:data.url},h.storage("getActive")&&(tab.active=!0),(h=h.storage("chatroom_size"))&&(tab.chatroom=h),state.tabs.push(tab),!always&&data.isClean(data.cleanGeneration)||(tab.meta=meta,tab.data=data.getValue()))}),state},restoreLocal:function(name){var data,str=localStorage.getItem("$file$"+name);try{"object"!=typeof(data=JSON.parse(str))&&(data=void 0)}catch(err){data=void 0}data?this.storage("setSource",data):this.storage("reload",name)},resolveEditConflict:function(options){var bdiv;return options.storage=this,form.showDialog({title:"Edit conflict",body:function body(){var elem=$(this);function tabLabel(label,active,id,disabled){var attrs={role:"presentation"},classes=[];return active&&classes.push("active"),disabled&&classes.push("disabled"),classes!=[]&&(attrs.class=classes.join(" ")),$.el.li(attrs,$.el.a({href:"#"+id,"data-toggle":"tab"},label))}function tabContent(id,cls){tabs.append($.el.div({class:"tab-pane fade "+id+" "+cls,id:id})),elem.find('[href="#'+id+'"]').on("show.bs.tab",function(ev){elem.storage(id)})}elem.addClass("edit-conflict"),tabs=$($.el.div({class:"tab-content"})),elem.append($.el.ul({class:"nav nav-tabs"},tabLabel("My edits",!0,"merge-my-edits"),tabLabel("Their edits",!1,"merge-server-edits"),tabLabel("Conflicts",!1,"merge-conflicts"))),elem.append(tabs),tabContent("merge-my-edits","in active"),tabContent("merge-server-edits",""),tabContent("merge-conflicts",""),elem.data("edit-conflict",options),elem.storage("merge-my-edits"),elem.append(bdiv=$.el.div({class:"form-group"},$.el.button({name:"merge",class:"btn btn-primary"},"Merge"),$.el.button({name:"discard-my-edits",class:"btn btn-primary"},"Discard my changes"),$.el.button({name:"discard-server-edits",class:"btn btn-primary"},"Discard changes on server"),$.el.button({name:"cancel",class:"btn btn-danger","data-dismiss":"modal"},"Cancel"))),$(bdiv).on("click","button",function(ev){return elem.storage("editConflictAction",$(ev.target).attr("name")),$(ev.target).parents(".modal").modal("hide"),ev.preventDefault(),!1})}}),this},"merge-my-edits":function(){var data=$(this).data("edit-conflict");$(this).find(".merge-my-edits").empty().append(udiff(data.edit.me.data))},"merge-server-edits":function(){var data=$(this).data("edit-conflict");$(this).find(".merge-server-edits").empty().append(udiff(data.edit.server.data))},"merge-conflicts":function(){var data=$(this).data("edit-conflict"),tab=$(this).find(".merge-conflicts");tab.empty(),0!=data.patch_status?tab.append(editConflicts(data.merged)):tab.html("No merge conflicts")},editConflictAction:function(action){var options=$(this).data("edit-conflict"),data=$(options.storage).data("storage");"merge"==action?(data.setValue(options.merged),data.meta.commit=options.edit.server.to.commit):"discard-my-edits"==action?$(options.storage).storage("reload"):"discard-server-edits"==action&&((data=$(options.storage).data("storage")).meta.commit=options.edit.server.to.commit)},download:function(){var options=this.data("storage"),a=tabbed.tabTypes[options.typeName],href=options.getValue(),href="data:text/plain;charset=UTF-8,"+encodeURIComponent(href),a=$.el.a({href:href,download:options.file||"swish."+a.dataType});return this.append(a),a.click(),$(a).remove(),this},getData:function(options){var result=[];return options=options||{},this.each(function(){var value,data=$(this).data("storage"),obj={};function copyMeta(name){data.meta[name]&&(obj[name]=data.meta[name])}obj.type=data.st_type,data.url&&(obj.url=data.url),data.meta&&(copyMeta("name"),copyMeta("path"),copyMeta("modified"),copyMeta("loaded"),copyMeta("modified_since_loaded"),copyMeta("module")),$(this).storage("getActive")&&(obj.active=!0),(!options.type||options.name&&options.name.split(".").pop()==options.type)&&(options.data&&(value=data.getValue(),obj.modified=value!=data.cleanData,(1==options.data||obj.modified&&"if_modified"==options.data)&&(obj.data=value)),result.push(obj))}),result},match:function(to){for(var k=0;k<this.length;k++){me=$(this[k]);var data=me.data("storage");if(to.file&&to.file==data.file)return me;if(to.url&&to.url==data.url)return me}},expose:function(reason){var tab=this.closest(".tab-pane");if(1==tab.length)return tab.closest(".tabbed").tabbed("show",tab.attr("id")),reason&&modal.feedback({html:reason,owner:this}),this},kill:function(force){return this.each(function(){var tab=$(this).closest(".tab-pane");1==tab.length&&tab.closest(".tabbed").tabbed("removeTab",tab.attr("id"),force)})},info:function(){var title,data=this.data("storage"),meta=data.meta||{},editor=this;return title="gitty"==data.st_type?$().gitty("title",meta):"filesys"==data.st_type?"File system -- "+utils.basename(meta.path):"external"==data.st_type?"External -- "+data.url:"Scratch source",form.showDialog({title:title,body:function infoBody(){"gitty"==data.st_type?(data.editor=editor,this.gitty(data)):"filesys"==data.st_type?function filesysInfo(form,meta){var table=$.el.table({class:"table table-striped"});$(table).append($.el.tr($.el.th("Path"),$.el.td(meta.path))),$(table).append($.el.tr($.el.th("Modified"),$.el.td(new Date(1e3*meta.last_modified).toLocaleString()))),$(table).append($.el.tr($.el.th("Loaded"),$.el.td(meta.modified_since_loaded?"yes (modified)":meta.loaded?"yes":"no"))),form.append(table)}(this,meta):data.st_type||this.append($.el.p("The source is not associated with a file. ","Use ",$.el.b("Save ...")," to save the source with meta information."))}}),this},diff:function(){var data=this.data("storage"),baseName={load:"Loaded text",new:"New text",save:"Saved text"};return form.showDialog({title:"Changes since "+baseName[data.cleanCheckpoint],body:function infoBody(){var rb,buttons,diff=$.el.div(),current=data.getValue();this.append(diff),current==data.cleanData?$(diff).append($.el.p("No changes")):(buttons=$.el.div({class:"btn-group diff",role:"group"},$.el.button({name:"close","data-dismiss":"modal",class:"btn btn-primary"},"Close"),rb=$.el.button({name:"revert",class:"btn btn-danger","data-dismiss":"modal"},"Revert changes")),$(diff).diff({base:data.cleanData,head:current,baseName:baseName[data.cleanCheckpoint]}),this.append($.el.div({class:"wrapper text-center"},buttons)),$(rb).on("click",function(ev){$(".swish-event-receiver").trigger("revert")}),this.parents("div.modal-dialog").addClass("modal-wide"))}}),this},getSelection:function(){if(this.hasClass("prolog-editor")){var sel=this.prologEditor("getSelection");return sel?sel[0].selections:null}if(this.hasClass("notebook"))return this.notebook("getSelection");console.log("Don't know how to get selection from",this)},getSelectionLabel:function(sel){function editorLabel(sels){for(var label="",i=0;i<sels.length;i++){var s=sels[i];""!=label&&(label+=";"),label+="@L"+(s.from.line+1),s.to.line!=s.from.line&&(label+="-"+(s.to.line+1))}return label}if(sel[0].selections){for(var label="",i=0;i<sel.length;i++){var ed=sel[i];""!=label&&(label+=","),label+=(ed.cell||"")+editorLabel(ed.selections)}return label}return editorLabel(sel)},restoreSelection:function(sel){return this.hasClass("prolog-editor")?this.prologEditor("restoreSelection",sel):this.hasClass("notebook")?this.notebook("restoreSelection",sel):void console.log(sel)},getActive:function(){return 1==$(this).closest(".tab-pane.active").length},docid:function(meta,data){if(data=data||this.data("storage"),!meta||meta==data.st_type){meta=data.meta||{};return"gitty"==data.st_type?"gitty:"+meta.name:"filesys"==data.st_type?"filesys:"+meta.path:"external"==data.st_type?"url:"+data.url:void 0}},chat:function(action){var chat,percentage,data=this.data("storage"),docid=this.storage("docid","gitty");return docid?0<(chat=this.closest(".tab-pane").find(".chatroom")).length?"update"==action?chat.chatroom("docid",docid,"close"):utils.flash(chat):"update"!=action&&(percentage="number"==typeof action?action:"large"==action?80:20,(chat=$($.el.div({class:"chatroom"}))).chatroom({docid:docid}),this.tile("split",chat,"below",percentage,150).addClass("chat-container")):"update"==action?this.storage("close_chat"):data.st_type?modal.alert("The chat facility is only available for user-saved files.<br>You can use the <b>Open hangout</b> menu from the top-right bell to access the hangout room."):modal.alert("You can only chat about a saved document.<br>Please save your document and try again."),this},close_chat:function(){this.closest(".chat-container").find(".chatroom").chatroom("close")},chatroom_size:function(){var h=this.closest(".tab-pane"),cr=h.find(".chatroom").closest(".pane-wrapper");if(0<cr.length){h=h.height();return 0==h?20:Math.round(100*cr.height()/h)}return!1},chat_message:function(msg){return msg.displayed||0!=msg.create?this.each(function(){var data,elem=$(this);msg.docid==elem.storage("docid")&&((data=elem.data("storage")).chats?(null!=data.chats.total&&data.chats.total++,null!=data.chats.count&&data.chats.count++):data.chats={total:1},elem.storage("update_tab_title","chats++"))}):this},load_messages:function(messages){for(var done,explain,warnings=0,errors=0,html="",i=0;i<messages.length;i++){var msg=messages[i];if("warning"==msg.kind)warnings++;else{if("error"!=msg.kind){if(msg.code!=done)continue;done=msg.data[0];continue}errors++}msg.html?html+=msg.html:html+=$($.el.div($.el.pre({class:"msg-"+msg.kind},msg.data[0]))).html(),this.prologEditor("highlightError",msg)}return errors||warnings?(explain=$($.el.div($.el.p("The following messages where generated while compiling the file.  These messages are inserted in the editor."))).html(),modal.alert(explain+html)):done&&modal.feedback({html:done,owner:this}),this},follow:function(){var docid=this.storage("docid","gitty");docid?modal.server_form({title:"Follow file options",url:config.http.locations.follow_file_options,data:{docid:docid}}):modal.alert("Sorry, can only follow files")},unload:function(why,ev){var data=this.data("storage");if(data&&(data.meta&&history.addRecent({st_type:"gitty",id:data.meta.name}),data.cleanData&&data.getValue&&data.cleanData!=data.getValue())){if("beforeunload"==why){var message="The source editor has unsaved changes.\nThese will be lost if you leave the page";return(ev=ev||window.event)&&(ev.returnValue=message),message}message="The source editor has unsaved changes.\nThese will be lost"+("setSource"==why?" if you load a new program":"closetab"==why?" close this tab":"");return confirm(message)}},close:function(){},markClean:function(clean){this.data("storage").is_clean=clean},chat_status:function(always){var opened=[];this.each(function(){var state,data=$(this).data("storage");"gitty"==data.st_type&&data.meta&&data.meta.name&&(state={file:data.meta.name},data.is_clean||(state.modified=!0),$(this).is(":visible")&&(state.visible=!0),opened.push(state))}),(always||0<opened.length)&&$("#chat").trigger("send",{type:"has-open-files",files:opened})}};function errorString(action,error){return"file_exists"==error.error?action+": file exists: "+error.file:JSON.stringify(error)}$.fn.storage=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.storage"):methods._init.apply(this,arguments)},$.fn.storage.methods=methods}(jQuery)}),define("cm/mode/prolog/prolog-ctype",[],function(){var uflags_map=["@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\0@      ","","","\0\0\0\0\0\0\0\0\0\0","  ","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","@@@@@\0@\0@","\0@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0      \0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0      \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0   \0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0       \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0      \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","          \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0",3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",'\0\0\0\0\0"""""""""           \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0',"",3,"\b\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0          \0\0\0\0\0\0","@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",'\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"\0\0\0',"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\b\b\b\b\b\b\b\b\b\b\b@@@@@\b\b@@@@@\b\b@@@@@\0@@@@@@@@@@ \0\0                \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0       \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","                 \0\0\0\0\0\0",16,"\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0                                                                                  ",16,16,"\0                              ",16,16,16,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0 ","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\b\0\0\0","\0\0\0\0\0\0\0\0\0    \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0                                                          \0",16,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0",3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0",3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0   \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0      \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@","@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@","@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@",3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@@@\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0                                             \0\0\0     \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0    \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,"\0\0\0\0\0\0\0\0\0\0        \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","      \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0        \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0  \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0        \0\0\0\0\0        \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0                               \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,"\0\0\0\0                    \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0","\0\0@@@@@@@@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0                  \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0","\0\0","\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","           \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,"\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0","\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@\0\0","@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0@\0\0",0];function uflagsW(map){var code=map.charCodeAt(0),map=Math.floor(code/256);if(map<4353){map=uflags_map[map];return"number"==typeof map?map:map.charCodeAt(255&code)}return 0}return{flags:uflagsW,id_start:function(chr){return 0!=(1&uflagsW(chr))},id_continue:function(chr){return 0!=(2&uflagsW(chr))},uppercase:function(chr){return 0!=(4&uflagsW(chr))},separator:function(chr){return 0!=(8&uflagsW(chr))},symbol:function(chr){return 0!=(16&uflagsW(chr))},other:function(chr){return 0!=(32&uflagsW(chr))},control:function(chr){return 0!=(64&uflagsW(chr))}}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/prolog/prolog",["../../lib/codemirror","./prolog-ctype"],mod):mod(CodeMirror)}(function(CodeMirror,ctype){"use strict";CodeMirror.defineMode("prolog",function(cmConfig,parserConfig){function chain(stream,state,f){return(state.tokenize=f)(stream,state)}var type,content,config={quasiQuotations:!0,dicts:!0,unicodeEscape:!0,multiLineQuoted:!0,groupedIntegers:!0,rationals:!0},quoteType={'"':"string","'":"qatom","`":"bqstring"},isSingleEscChar=/[abref\\'"nrtsv]/,isOctalDigit=/[0-7]/,isHexDigit=/[0-9a-fA-F]/,isSoloChar=/[[\]{}(),;|!]/,isNeck=/^(:-|-->|=>)$/,isControlOp=/^(,|;|->|\*->|\\+|\|)$/;function readDigits(stream,re,count){if(0<count){for(;0<count--;)if(!re.test(stream.next()))return!1}else for(;re.test(stream.peek());)stream.next();return!0}function readEsc(stream){var next=stream.next();if(isSingleEscChar.test(next))return 1;switch(next){case"u":return config.unicodeEscape?readDigits(stream,isHexDigit,4):void 0;case"U":return config.unicodeEscape?readDigits(stream,isHexDigit,8):void 0;case null:return 1;case"c":return stream.eatSpace(),1;case"x":return readDigits(stream,isHexDigit,2)}return isOctalDigit.test(next)&&(readDigits(stream,isOctalDigit,-1)&&("\\"==stream.peek()&&stream.next(),1))}function nesting(state){return state.nesting.slice(-1)[0]}function setArgAlignment(nest){nest=nesting(nest);nest&&!nest.alignment&&null!=nest.arg&&(0==nest.arg?nest.alignment=nest.leftCol?nest.leftCol+4:nest.column+4:nest.alignment=nest.column+1)}function isControl(state){var nest=nesting(state);return nest?"control"==nest.type:state.inBody}function ret(tp,style,cont){return type=tp,content=cont,style}function plTokenBase(stream,state){var sec=stream.next();if("("==sec)return"functor"==state.lastType?(state.nesting.push({functor:state.functorName,column:stream.column(),leftCol:state.functorColumn,arg:0}),delete state.functorName,delete state.functorColumn):state.nesting.push({type:"control",closeColumn:stream.column(),alignment:stream.column()+4}),ret("solo",null,"(");if("{"==sec&&"tag"==state.lastType)return state.nesting.push({tag:state.tagName,column:stream.column(),leftCol:state.tagColumn,arg:0}),delete state.tagName,delete state.tagColumn,ret("dict_open",null);if("/"==sec&&stream.eat("*"))return chain(stream,state,plTokenComment);if("%"==sec)return stream.skipToEnd(),ret("comment","comment");if(!function setArg1(state){var nest=nesting(state);nest?0==nest.arg?nest.arg=1:"control"==nest.type&&(state.goalStart=!1):state.goalStart=!1}(state),isSoloChar.test(sec)){switch(sec){case")":state.nesting.pop();break;case"]":return state.nesting.pop(),ret("list_close",null,"]");case"}":var type=nesting(state),type=type&&type.tag?"dict_close":"brace_term_close";return state.nesting.pop(),ret(type,null);case",":stream.eol()&&(state.commaAtEOL=!0),function nextArg(state){var nest=nesting(state);nest?nest.arg?nest.arg++:"control"==nest.type&&(state.goalStart=!0):state.goalStart=!0}(state);case";":isControl(state)&&(state.goalStart=!0);break;case"[":return state.nesting.push({type:"list",closeColumn:stream.column(),alignment:stream.column()+2}),ret("list_open",null,"[");case"{":return config.quasiQuotations&&stream.eat("|")?(state.nesting.push({type:"quasi-quotation",alignment:stream.column()+1}),ret("qq_open","qq_open")):(state.nesting.push({type:"curly",closeColumn:stream.column(),alignment:stream.column()+2}),ret("brace_term_open",null));case"|":if(config.quasiQuotations){if(stream.eat("|"))return state.tokenize=plTokenQuasiQuotation,ret("qq_sep","qq_sep");if(stream.eat("}"))return state.nesting.pop(),ret("qq_close","qq_close")}isControl(state)&&(state.goalStart=!0)}return ret("solo",null,sec)}if('"'==sec||"'"==sec||"`"==sec)return state.nesting.push({type:"quoted",alignment:stream.column()+1}),chain(stream,state,function plTokenString(quote){return function(stream,state){if(!function nextUntilUnescaped(stream,state,end){for(var next;null!=(next=stream.next());){if(next==end&&end!=stream.peek())return void state.nesting.pop();if("\\"==next&&!readEsc(stream))return}return config.multiLineQuoted}(stream,state,quote)){if(state.tokenize=plTokenBase,"("==stream.peek()){var word=stream.current();return ret("functor","functor",state.functorName=word)}if("{"==stream.peek()&&config.dicts){word=stream.current();return ret("tag","tag",state.tagName=word)}}return ret(quoteType[quote],quoteType[quote])}}(sec));if("0"==sec){if(stream.eat(/x/i))return stream.eatWhile(/[\da-f]/i),ret("number","number");if(stream.eat(/o/i))return stream.eatWhile(/[0-7]/i),ret("number","number");if(stream.eat(/'/))return"\\"!=stream.next()||readEsc(stream)?ret("code","code"):ret("error","error")}if(/\d/.test(sec)||/-/.test(sec)&&stream.eat(/\d/)){var tp="-"==sec?"neg-number":"number";return config.rationals&&stream.match(/^\d*[rR]\d+/)?ret(tp="rational",tp,stream.current()):(config.groupedIntegers?stream.match(/^\d*((_|\s+)\d+)*(?:\.\d+)?(?:[eE][+\-]?\d+)?/):stream.match(/^\d*(?:\.\d+)?(?:[eE][+\-]?\d+)?/),ret(tp,tp))}if(ctype.symbol(sec)){stream.eatWhile(ctype.symbol);var word=stream.current();return"{"==stream.peek()&&config.dicts?(state.tagName=word,state.tagColumn=stream.column(),ret("tag","tag",word)):"."==word&&function peekSpace(stream){return!(!stream.eol()&&!/[\s%]/.test(stream.peek()))}(stream)?nesting(state)?ret("fullstop","error",word):ret("fullstop","fullstop",word):isNeck.test(word)?ret("neck","neck",word):(isControl(state)&&isControlOp.test(word)&&(state.goalStart=!0),ret("symbol","operator",word))}stream.eatWhile(ctype.id_continue);word=stream.current();if("{"==stream.peek()&&config.dicts)return state.tagName=word,state.tagColumn=stream.column(),ret("tag","tag",word);if("_"!=sec)return ctype.uppercase(sec)?ret("var","var",word):"("==stream.peek()?(state.functorName=word,state.functorColumn=stream.column(),ret("functor","functor",word)):ret("atom","atom",word);if(1==word.length)return ret("var","anon",word);sec=word.charAt(1);return ctype.uppercase(sec)?ret("var","var-2",word):ret("var","var",word)}function plTokenQuasiQuotation(stream,state){for(var ch,maybeEnd=!1;ch=stream.next();){if("}"==ch&&maybeEnd){state.tokenize=plTokenBase,stream.backUp(2);break}maybeEnd="|"==ch}return ret("qq_content","qq_content")}function plTokenComment(stream,state){for(var ch,maybeEnd=!1;ch=stream.next();){if("/"==ch&&maybeEnd){state.tokenize=plTokenBase;break}maybeEnd="*"==ch}return ret("comment","comment")}return{startState:function(){return{tokenize:plTokenBase,inBody:!1,goalStart:!1,lastType:null,nesting:new Array,curTerm:null,curToken:null}},token:function(stream,state){if(null==state.curTerm&&parserConfig.metainfo&&(state.curTerm=0,state.curToken=0),stream.sol()&&delete state.commaAtEOL,state.tokenize==plTokenBase&&stream.eatSpace())return stream.eol()&&setArgAlignment(state),null;var style=state.tokenize(stream,state);return stream.eol()&&setArgAlignment(state),"neck"==type?(state.inBody=!0,state.goalStart=!0):"fullstop"==type&&(state.inBody=!1,state.goalStart=!1),state.lastType=type,style="function"==typeof parserConfig.enrich?parserConfig.enrich(stream,state,type,content,style):style},indent:function(state,textAfter){return state.tokenize==plTokenComment?CodeMirror.Pass:(nest=nesting(state))?nest.closeColumn&&!state.commaAtEOL?nest.closeColumn:nest.alignment:state.inBody?4:0;var nest},theme:"prolog",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:"%"}}),CodeMirror.defineMIME("text/x-prolog","prolog")}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/prolog/prolog_keys",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.commands.prologStartIfThenElse=function(cm){var start=cm.getCursor("start");if(1!=cm.getTokenAt(start,!0).state.goalStart)return CodeMirror.Pass;cm.replaceSelection("(   ","end")},CodeMirror.commands.prologStartThen=function(cm){var start=cm.getCursor("start"),token=cm.getTokenAt(start,!0);if(start.ch!=token.end||"operator"!=token.type||"-"!=token.string||!function isControl(state){var nest=function nesting(state){var len=state.nesting.length;return 0<len?state.nesting[len-1]:null}(state);return nest?"control"==nest.type:state.inBody}(token.state))return CodeMirror.Pass;cm.replaceSelection(">  ","end")},CodeMirror.commands.prologStartElse=function(cm){var start=cm.getCursor("start"),token=cm.getTokenAt(start,!0);if(0!=token.start||start.ch!=token.end||/\S/.test(token.string))return CodeMirror.Pass;cm.replaceSelection(";   ","end")},CodeMirror.defineOption("prologKeys",null,function(cm,val,prev){prev&&prev!=CodeMirror.Init&&cm.removeKeyMap("prolog"),val&&cm.addKeyMap({name:"prolog","'('":"prologStartIfThenElse","'>'":"prologStartThen","';'":"prologStartElse","Ctrl-L":"refreshHighlight"})})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/prolog/prolog_query",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.commands.prologMaybeFireQuery=function(cm){for(var token,c,lastl=cm.lineCount()-1;0<=lastl&&""==cm.getLine(lastl).trim();)lastl--;return 0<=lastl&&(c=cm.getLine(lastl).length,"fullstop"!=(token=cm.getTokenAt({line:lastl,ch:c},!0)).type||((c=cm.getCursor()).line>lastl||c.line==lastl&&c.ch>=token.end)&&$(".swish-event-receiver").trigger("feedback",{html:"Use <b>Ctrl+Enter</b> to execute the query",owner:$(cm.display.wrapper).closest(".pane-wrapper")})),CodeMirror.Pass},CodeMirror.commands.prologFireQuery=function(cm){return cm.prologFireQuery(cm.getValue())},CodeMirror.defineOption("prologQuery",null,function(cm,func,prev){prev&&prev!=CodeMirror.Init&&cm.removeKeyMap("prologQuery"),"function"==typeof func&&(cm.addKeyMap({name:"prologQuery","Ctrl-Enter":"prologFireQuery",Enter:"prologMaybeFireQuery"}),cm.prologFireQuery=func)})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/prolog/prolog_server",["../../lib/codemirror","../../../backend"],mod):mod(CodeMirror)}(function(CodeMirror,backend){"use strict";function State(options){"object"==typeof options&&(this.enabled=options.enabled||!1,this.role=options.role||"source",options.sourceID&&(this.sourceID=options.sourceID),this.url={change:options.url+"change",tokens:options.url+"tokens",leave:options.url+"leave",info:options.url+"info"},this.delay=options.delay||1e3,this.generationFromServer=-1,this.tmo=null)}function changeEditor(cm,change){var state=cm.state.prologHighlightServer;null!=state&&null!=state.url&&state.enabled&&(state.tmo&&cm.askRefresh(),void 0!==state.changes&&state.changes.push(change),"setValue"!=change.origin&&-1!=state.generationFromServer||(state.changes=void 0,cm.serverAssistedHighlight()))}function leaveEditor(uuid){var state=uuid.state.prologHighlightServer;null!=state&&null!=state.url&&null!=state.uuid&&(uuid=state.uuid,delete state.uuid,backend.ajax({url:state.url.leave,async:!1,contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify({uuid:uuid})}))}CodeMirror.defineOption("prologHighlightServer",!1,function(cm,val,old){function leaveCM(){leaveEditor(cm)}cm.state.prologHighlightServer?null==val?(leaveEditor(cm),cm.off("change",changeEditor),window.removeEventListener("unload",leaveCM),delete cm.state.prologHighlightServer,cm.setOption("mode",{name:"prolog"})):val.enabled!=old.enabled&&(cm.state.prologHighlightServer.enabled=val.enabled,val.enabled?(cm.on("change",changeEditor),window.addEventListener("unload",leaveCM),0<cm.lineCount()&&cm.serverAssistedHighlight(!0)):(leaveEditor(cm),cm.off("change",changeEditor),window.removeEventListener("unload",leaveCM),cm.setOption("mode",{name:"prolog"}))):val&&(cm.state.prologHighlightServer=new State(val),cm.state.prologHighlightServer.enabled&&(cm.on("change",changeEditor),window.addEventListener("unload",leaveCM),0<cm.lineCount()&&cm.serverAssistedHighlight(!0)))}),CodeMirror.prototype.askRefresh=function(time){var cm=this,state=cm.state.prologHighlightServer;null!=state&&(void 0===time&&(time=state.delay),state.tmo&&clearTimeout(state.tmo),state.tmo=setTimeout(function(){cm.serverAssistedHighlight()},time))},CodeMirror.prototype.serverAssistedHighlight=function(always){var cm=this,state=cm.state.prologHighlightServer,msg={};if((state.tmo=null)!=state&&null!=state.url&&state.enabled&&(!cm.isClean(state.generationFromServer)||always)){if(state.uuid)msg.uuid=state.uuid,null==state.changes?(msg.text=cm.getValue(),1e3<msg.text.length&&(state.changes=[])):(msg.changes=state.changes,state.changes=[]);else{if(msg.text=cm.getValue(),""==msg.text.trim())return;state.uuid=function generateUUID(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:7&r|8).toString(16)})}(),msg.uuid=state.uuid}msg.role=state.role,"function"==typeof state.sourceID&&(msg.sourceID=state.sourceID()),state.generationFromServer=cm.changeGeneration(),backend.ajax({url:state.url.tokens,dataType:"json",contentType:"application/json",type:"POST",data:JSON.stringify(msg),success:function(data,status){var opts=function modeOptions(){var opts=cm.getOption("mode");return"object"!=typeof opts?opts={name:"prolog",enrich:enrichStyle,editor:cm}:opts.enrich||(opts.enrich=enrichStyle,opts.editor=cm),opts}();opts.metainfo=data.tokens,cm.setOption("mode",opts)},error:function(jqXHR){409==jqXHR.status&&delete state.uuid}})}},CodeMirror.commands.refreshHighlight=function(cm){cm.serverAssistedHighlight(!0)};var syncOnType={var:"var",atom:"atom",qatom:"qatom",bqstring:"string",symbol:"atom",functor:"functor",tag:"tag",number:"number",string:"string",code:"number","neg-number":"number",rational:"number",list_open:"list_open",list_close:"list_close",qq_open:"qq_open",qq_sep:"qq_sep",qq_close:"qq_close",dict_open:"dict_open",dict_close:"dict_close",brace_term_open:"brace_term_open",brace_term_close:"brace_term_close",neck:"neck",fullstop:"fullstop"},serverSync={var:"var",singleton:"var",uatom:"var",atom:"atom",qatom:"qatom",string:"string",codes:"string",chars:"string",functor:"functor",tag:"tag",control:"atom",meta:"atom",op_type:"atom",int:"number",float:"number",key:"atom",sep:"atom",ext_quant:"atom",expanded:"expanded",comment_string:"string",identifier:"atom",delimiter:"atom",module:"atom",constraint:"atom",head_exported:"atom",head_public:"atom",head_extern:"atom",head_dynamic:"atom",head_multifile:"atom",head_unreferenced:"atom",head_hook:"atom",head_meta:"atom",head_constraint:"atom",head_imported:"atom",head_built_in:"atom",head_iso:"atom",head_def_iso:"atom",head_def_swi:"atom",head:"atom",goal_built_in:"atom",goal_imported:"atom",goal_autoload:"atom",goal_global:"atom",goal_undefined:"atom",goal_thread_local:"atom",goal_dynamic:"atom",goal_multifile:"atom",goal_expanded:"atom",goal_extern:"atom",goal_recursion:"atom",goal_meta:"atom",goal_foreign:"atom",goal_local:"atom",goal_constraint:"atom",goal_not_callable:"atom",function:"atom",no_function:"atom",xpce_method:"functor",xpce_class_builtin:"atom",xpce_class_lib:"atom",xpce_class_user:"atom",xpce_class_undef:"atom",option_name:"atom",no_option_name:"atom",flag_name:"atom",no_flag_name:"atom",format_string:"text",file_no_depends:"atom",file:"atom",nofile:"atom",list_open:"list_open",list_close:"list_close",qq_open:"qq_open",qq_sep:"qq_sep",qq_close:"qq_close",qq_type:"atom",dict_open:"dict_open",dict_close:"dict_close",brace_term_open:"brace_term_open",brace_term_close:"brace_term_close",neck:"neck",fullstop:"fullstop",string_terminal:"string",html:"functor",entity:"atom",html_attribute:"functor",sgml_attr_function:"atom",http_location_for_id:"atom",http_no_location_for_id:"atom"};function enrichStyle(stream,state,type,content,style){var token,serverStyle,parserConfig=this;if(null==state.curTerm)return style;if(state.syntax_error)return"fullstop"==type&&(parserConfig.editor.askRefresh(),delete state.syntax_error),style;if(state.outOfSync){var oos=state.outOfSync;if(oos.skippedTerms<=3){if(oos.skippedTokens.push({type:type,style:style,content:content}),serverStyle=function reSync(){var oos=state.outOfSync;return oos.okToken,oos.okTerm,oos.skippedTerms,null}())return serverStyle;"fullstop"==type&&(oos.skippedTokens=[],oos.skippedTerms++)}return style}return(token=function serverToken(token){var term=parserConfig.metainfo[token.curTerm];return term&&(token=term[token.curToken])||null}(state))?void 0!==(serverStyle=function matchToken(token,state){if(token){if(!syncOnType[type])return content&&token.text==content?(state.curToken++,token.type):style;if(token.text&&content)return function matchTokenText(tokenText){var start;if(content==tokenText)return 1;if(0<=(start=tokenText.lastIndexOf(content,1))){for(var left=tokenText.substring(content.length+start),i=0;i<left.length;i++)if(!stream.eat(left.charAt(i)))return void stream.backUp(i);return 1}}(token.text)?(state.curToken++,token.type):void 0;if(syncOnType[type]==serverSync[token.type])return"fullstop"==type?(state.curTerm++,state.curToken=0):"rational"==type&&"int"==token.type?(token.type="rational",state.curToken++):function isQuoted(last){return(last=last.slice(-1)[0])&&"quoted"==last.type}(state.nesting)||state.curToken++,token.type;if(syncOnType[type]==token.base)return state.curToken++,token.type;if("qatom"==type&&"atom"==serverSync[token.type])return state.curToken++,token.type;if("number"==type&&"meta"==token.type)return state.curToken++,token.type;if("text"==serverSync[token.type]&&("atom"==type||"qatom"==type||"string"==type))return state.curToken++,token.type;if("neg-number"==type&&token.text&&"-"==token.text)return state.curToken+=2,"number"}}(token,state))?serverStyle:"syntax_error"==token.type?(state.syntax_error=!0,state.curToken=0,state.curTerm++,style):(function outOfSync(){state.outOfSync||(console.log("Mismatch: ("+content+") "+type+"/"+token.type),state.outOfSync={okToken:state.curToken,okTerm:state.curTerm,skippedTerms:0,skippedTokens:[]}),parserConfig.editor.askRefresh()}(),style+" outofsync"):(parserConfig.editor.askRefresh(),style)}CodeMirror.prototype.getEnrichedToken=function(token){if(null!=token.state.curTerm&&null!=token.state.curToken){var terminfo,state=this.getOption("mode");if(state.metainfo&&(terminfo=state.metainfo[token.state.curTerm]))return terminfo[token.state.curToken-1]}},CodeMirror.prototype.tokenInfo=function(token,elem){var state=this.state.prologHighlightServer;return elem=elem||$($.el.span({class:"token-info"},"...")),backend.ajax({url:state.url.info,data:token,success:function(data){elem.html(data)}}),elem[0]},CodeMirror.prototype.getTokenReferences=function(token){var obj,result=[];function setFile(obj,from){return from&&0==from.indexOf("swish://")&&(obj.file=from.substring(8),1)}switch(token.type){case"goal_local":setFile(obj={title:"Source for "+token.text+"/"+token.arity,line:token.line,regex:new RegExp("\\b"+RegExp.escape(token.text),"g"),showAllMatches:!0},token.file),result.push(obj);break;case"file":setFile(obj={},token.path)&&(obj.title="Included file "+obj.file,result.push(obj))}return result}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/xml/xml",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var htmlConfig={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},xmlConfig={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};CodeMirror.defineMode("xml",function(editorConf,config_){var prop,type,setStyle,indentUnit=editorConf.indentUnit,config={},defaults=config_.htmlMode?htmlConfig:xmlConfig;for(prop in defaults)config[prop]=defaults[prop];for(prop in config_)config[prop]=config_[prop];function inText(stream,state){function chain(parser){return(state.tokenize=parser)(stream,state)}var ok=stream.next();if("<"==ok)return stream.eat("!")?stream.eat("[")?stream.match("CDATA[")?chain(inBlock("atom","]]>")):null:stream.match("--")?chain(inBlock("comment","--\x3e")):stream.match("DOCTYPE",!0,!0)?(stream.eatWhile(/[\w\._\-]/),chain(function doctype(depth){return function(stream,state){for(var ch;null!=(ch=stream.next());){if("<"==ch)return state.tokenize=doctype(depth+1),state.tokenize(stream,state);if(">"==ch){if(1!=depth)return state.tokenize=doctype(depth-1),state.tokenize(stream,state);state.tokenize=inText;break}}return"meta"}}(1))):null:stream.eat("?")?(stream.eatWhile(/[\w\._\-]/),state.tokenize=inBlock("meta","?>"),"meta"):(type=stream.eat("/")?"closeTag":"openTag",state.tokenize=inTag,"tag bracket");if("&"!=ok)return stream.eatWhile(/[^&<]/),null;ok=stream.eat("#")?stream.eat("x")?stream.eatWhile(/[a-fA-F\d]/)&&stream.eat(";"):stream.eatWhile(/[\d]/)&&stream.eat(";"):stream.eatWhile(/[\w\.\-:]/)&&stream.eat(";");return ok?"atom":"error"}function inTag(stream,next){var ch=stream.next();if(">"==ch||"/"==ch&&stream.eat(">"))return next.tokenize=inText,type=">"==ch?"endTag":"selfcloseTag","tag bracket";if("="==ch)return type="equals",null;if("<"!=ch)return/[\'\"]/.test(ch)?(next.tokenize=function inAttribute(quote){function closure(stream,state){for(;!stream.eol();)if(stream.next()==quote){state.tokenize=inTag;break}return"string"}return closure.isInAttribute=!0,closure}(ch),next.stringStartCol=stream.column(),next.tokenize(stream,next)):(stream.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word");next.tokenize=inText,next.state=baseState,next.tagName=next.tagStart=null;next=next.tokenize(stream,next);return next?next+" tag error":"tag error"}function inBlock(style,terminator){return function(stream,state){for(;!stream.eol();){if(stream.match(terminator)){state.tokenize=inText;break}stream.next()}return style}}function Context(state,tagName,startOfLine){this.prev=state.context,this.tagName=tagName,this.indent=state.indented,this.startOfLine=startOfLine,(config.doNotIndent.hasOwnProperty(tagName)||state.context&&state.context.noIndent)&&(this.noIndent=!0)}function popContext(state){state.context&&(state.context=state.context.prev)}function maybePopContext(state,nextTagName){for(var parentTagName;;){if(!state.context)return;if(parentTagName=state.context.tagName,!config.contextGrabbers.hasOwnProperty(parentTagName)||!config.contextGrabbers[parentTagName].hasOwnProperty(nextTagName))return;popContext(state)}}function baseState(type,stream,state){return"openTag"==type?(state.tagStart=stream.column(),tagNameState):"closeTag"==type?closeTagNameState:baseState}function tagNameState(type,stream,state){return"word"==type?(state.tagName=stream.current(),setStyle="tag",attrState):config.allowMissingTagName&&"endTag"==type?(setStyle="tag bracket",attrState(type,0,state)):(setStyle="error",tagNameState)}function closeTagNameState(type,tagName,state){if("word"!=type)return config.allowMissingTagName&&"endTag"==type?(setStyle="tag bracket",closeState(type,0,state)):(setStyle="error",closeStateErr);tagName=tagName.current();return state.context&&state.context.tagName!=tagName&&config.implicitlyClosed.hasOwnProperty(state.context.tagName)&&popContext(state),state.context&&state.context.tagName==tagName||!1===config.matchClosing?(setStyle="tag",closeState):(setStyle="tag error",closeStateErr)}function closeState(type,_stream,state){return"endTag"!=type?(setStyle="error",closeState):(popContext(state),baseState)}function closeStateErr(type,stream,state){return setStyle="error",closeState(type,0,state)}function attrState(type,_stream,state){if("word"==type)return setStyle="attribute",attrEqState;if("endTag"!=type&&"selfcloseTag"!=type)return setStyle="error",attrState;var tagName=state.tagName,tagStart=state.tagStart;return state.tagName=state.tagStart=null,"selfcloseTag"==type||config.autoSelfClosers.hasOwnProperty(tagName)?maybePopContext(state,tagName):(maybePopContext(state,tagName),state.context=new Context(state,tagName,tagStart==state.indented)),baseState}function attrEqState(type,stream,state){return"equals"==type?attrValueState:(config.allowMissing||(setStyle="error"),attrState(type,0,state))}function attrValueState(type,stream,state){return"string"==type?attrContinuedState:"word"==type&&config.allowUnquoted?(setStyle="string",attrState):(setStyle="error",attrState(type,0,state))}function attrContinuedState(type,stream,state){return"string"==type?attrContinuedState:attrState(type,0,state)}return inText.isInText=!0,{startState:function(baseIndent){var state={tokenize:inText,state:baseState,indented:baseIndent||0,tagName:null,tagStart:null,context:null};return null!=baseIndent&&(state.baseIndent=baseIndent),state},token:function(stream,state){if(!state.tagName&&stream.sol()&&(state.indented=stream.indentation()),stream.eatSpace())return null;type=null;var style=state.tokenize(stream,state);return(style||type)&&"comment"!=style&&(setStyle=null,state.state=state.state(type||style,stream,state),setStyle&&(style="error"==setStyle?style+" error":setStyle)),style},indent:function(state,textAfter,fullLine){var context=state.context;if(state.tokenize.isInAttribute)return state.tagStart==state.indented?state.stringStartCol+1:state.indented+indentUnit;if(context&&context.noIndent)return CodeMirror.Pass;if(state.tokenize!=inTag&&state.tokenize!=inText)return fullLine?fullLine.match(/^(\s*)/)[0].length:0;if(state.tagName)return!1!==config.multilineTagIndentPastTag?state.tagStart+state.tagName.length+2:state.tagStart+indentUnit*(config.multilineTagIndentFactor||1);if(config.alignCDATA&&/<!\[CDATA\[/.test(textAfter))return 0;var tagAfter=textAfter&&/^<(\/)?([\w_:\.-]*)/.exec(textAfter);if(tagAfter&&tagAfter[1])for(;context;){if(context.tagName==tagAfter[2]){context=context.prev;break}if(!config.implicitlyClosed.hasOwnProperty(context.tagName))break;context=context.prev}else if(tagAfter)for(;context;){var grabbers=config.contextGrabbers[context.tagName];if(!grabbers||!grabbers.hasOwnProperty(tagAfter[2]))break;context=context.prev}for(;context&&context.prev&&!context.startOfLine;)context=context.prev;return context?context.indent+indentUnit:state.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:config.htmlMode?"html":"xml",helperType:config.htmlMode?"html":"xml",skipAttribute:function(state){state.state==attrValueState&&(state.state=attrState)},xmlCurrentTag:function(state){return state.tagName?{name:state.tagName,close:"closeTag"==state.type}:null},xmlCurrentContext:function(state){for(var context=[],cx=state.context;cx;cx=cx.prev)cx.tagName&&context.push(cx.tagName);return context.reverse()}}}),CodeMirror.defineMIME("text/xml","xml"),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.mimeModes.hasOwnProperty("text/html")||CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/mode/meta",["../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.modeInfo=[{name:"APL",mime:"text/apl",mode:"apl",ext:["dyalog","apl"]},{name:"PGP",mimes:["application/pgp","application/pgp-encrypted","application/pgp-keys","application/pgp-signature"],mode:"asciiarmor",ext:["asc","pgp","sig"]},{name:"ASN.1",mime:"text/x-ttcn-asn",mode:"asn.1",ext:["asn","asn1"]},{name:"Asterisk",mime:"text/x-asterisk",mode:"asterisk",file:/^extensions\.conf$/i},{name:"Brainfuck",mime:"text/x-brainfuck",mode:"brainfuck",ext:["b","bf"]},{name:"C",mime:"text/x-csrc",mode:"clike",ext:["c","h","ino"]},{name:"C++",mime:"text/x-c++src",mode:"clike",ext:["cpp","c++","cc","cxx","hpp","h++","hh","hxx"],alias:["cpp"]},{name:"Cobol",mime:"text/x-cobol",mode:"cobol",ext:["cob","cpy"]},{name:"C#",mime:"text/x-csharp",mode:"clike",ext:["cs"],alias:["csharp","cs"]},{name:"Clojure",mime:"text/x-clojure",mode:"clojure",ext:["clj","cljc","cljx"]},{name:"ClojureScript",mime:"text/x-clojurescript",mode:"clojure",ext:["cljs"]},{name:"Closure Stylesheets (GSS)",mime:"text/x-gss",mode:"css",ext:["gss"]},{name:"CMake",mime:"text/x-cmake",mode:"cmake",ext:["cmake","cmake.in"],file:/^CMakeLists.txt$/},{name:"CoffeeScript",mimes:["application/vnd.coffeescript","text/coffeescript","text/x-coffeescript"],mode:"coffeescript",ext:["coffee"],alias:["coffee","coffee-script"]},{name:"Common Lisp",mime:"text/x-common-lisp",mode:"commonlisp",ext:["cl","lisp","el"],alias:["lisp"]},{name:"Cypher",mime:"application/x-cypher-query",mode:"cypher",ext:["cyp","cypher"]},{name:"Cython",mime:"text/x-cython",mode:"python",ext:["pyx","pxd","pxi"]},{name:"Crystal",mime:"text/x-crystal",mode:"crystal",ext:["cr"]},{name:"CSS",mime:"text/css",mode:"css",ext:["css"]},{name:"CQL",mime:"text/x-cassandra",mode:"sql",ext:["cql"]},{name:"D",mime:"text/x-d",mode:"d",ext:["d"]},{name:"Dart",mimes:["application/dart","text/x-dart"],mode:"dart",ext:["dart"]},{name:"diff",mime:"text/x-diff",mode:"diff",ext:["diff","patch"]},{name:"Django",mime:"text/x-django",mode:"django"},{name:"Dockerfile",mime:"text/x-dockerfile",mode:"dockerfile",file:/^Dockerfile$/},{name:"DTD",mime:"application/xml-dtd",mode:"dtd",ext:["dtd"]},{name:"Dylan",mime:"text/x-dylan",mode:"dylan",ext:["dylan","dyl","intr"]},{name:"EBNF",mime:"text/x-ebnf",mode:"ebnf"},{name:"ECL",mime:"text/x-ecl",mode:"ecl",ext:["ecl"]},{name:"edn",mime:"application/edn",mode:"clojure",ext:["edn"]},{name:"Eiffel",mime:"text/x-eiffel",mode:"eiffel",ext:["e"]},{name:"Elm",mime:"text/x-elm",mode:"elm",ext:["elm"]},{name:"Embedded Javascript",mime:"application/x-ejs",mode:"htmlembedded",ext:["ejs"]},{name:"Embedded Ruby",mime:"application/x-erb",mode:"htmlembedded",ext:["erb"]},{name:"Erlang",mime:"text/x-erlang",mode:"erlang",ext:["erl"]},{name:"Esper",mime:"text/x-esper",mode:"sql"},{name:"Factor",mime:"text/x-factor",mode:"factor",ext:["factor"]},{name:"FCL",mime:"text/x-fcl",mode:"fcl"},{name:"Forth",mime:"text/x-forth",mode:"forth",ext:["forth","fth","4th"]},{name:"Fortran",mime:"text/x-fortran",mode:"fortran",ext:["f","for","f77","f90","f95"]},{name:"F#",mime:"text/x-fsharp",mode:"mllike",ext:["fs"],alias:["fsharp"]},{name:"Gas",mime:"text/x-gas",mode:"gas",ext:["s"]},{name:"Gherkin",mime:"text/x-feature",mode:"gherkin",ext:["feature"]},{name:"GitHub Flavored Markdown",mime:"text/x-gfm",mode:"gfm",file:/^(readme|contributing|history).md$/i},{name:"Go",mime:"text/x-go",mode:"go",ext:["go"]},{name:"Groovy",mime:"text/x-groovy",mode:"groovy",ext:["groovy","gradle"],file:/^Jenkinsfile$/},{name:"HAML",mime:"text/x-haml",mode:"haml",ext:["haml"]},{name:"Haskell",mime:"text/x-haskell",mode:"haskell",ext:["hs"]},{name:"Haskell (Literate)",mime:"text/x-literate-haskell",mode:"haskell-literate",ext:["lhs"]},{name:"Haxe",mime:"text/x-haxe",mode:"haxe",ext:["hx"]},{name:"HXML",mime:"text/x-hxml",mode:"haxe",ext:["hxml"]},{name:"ASP.NET",mime:"application/x-aspx",mode:"htmlembedded",ext:["aspx"],alias:["asp","aspx"]},{name:"HTML",mime:"text/html",mode:"htmlmixed",ext:["html","htm","handlebars","hbs"],alias:["xhtml"]},{name:"HTTP",mime:"message/http",mode:"http"},{name:"IDL",mime:"text/x-idl",mode:"idl",ext:["pro"]},{name:"Pug",mime:"text/x-pug",mode:"pug",ext:["jade","pug"],alias:["jade"]},{name:"Java",mime:"text/x-java",mode:"clike",ext:["java"]},{name:"Java Server Pages",mime:"application/x-jsp",mode:"htmlembedded",ext:["jsp"],alias:["jsp"]},{name:"JavaScript",mimes:["text/javascript","text/ecmascript","application/javascript","application/x-javascript","application/ecmascript"],mode:"javascript",ext:["js"],alias:["ecmascript","js","node"]},{name:"JSON",mimes:["application/json","application/x-json"],mode:"javascript",ext:["json","map"],alias:["json5"]},{name:"JSON-LD",mime:"application/ld+json",mode:"javascript",ext:["jsonld"],alias:["jsonld"]},{name:"JSX",mime:"text/jsx",mode:"jsx",ext:["jsx"]},{name:"Jinja2",mime:"text/jinja2",mode:"jinja2",ext:["j2","jinja","jinja2"]},{name:"Julia",mime:"text/x-julia",mode:"julia",ext:["jl"]},{name:"Kotlin",mime:"text/x-kotlin",mode:"clike",ext:["kt"]},{name:"LESS",mime:"text/x-less",mode:"css",ext:["less"]},{name:"LiveScript",mime:"text/x-livescript",mode:"livescript",ext:["ls"],alias:["ls"]},{name:"Lua",mime:"text/x-lua",mode:"lua",ext:["lua"]},{name:"Markdown",mime:"text/x-markdown",mode:"markdown",ext:["markdown","md","mkd"]},{name:"mIRC",mime:"text/mirc",mode:"mirc"},{name:"MariaDB SQL",mime:"text/x-mariadb",mode:"sql"},{name:"Mathematica",mime:"text/x-mathematica",mode:"mathematica",ext:["m","nb","wl","wls"]},{name:"Modelica",mime:"text/x-modelica",mode:"modelica",ext:["mo"]},{name:"MUMPS",mime:"text/x-mumps",mode:"mumps",ext:["mps"]},{name:"MS SQL",mime:"text/x-mssql",mode:"sql"},{name:"mbox",mime:"application/mbox",mode:"mbox",ext:["mbox"]},{name:"MySQL",mime:"text/x-mysql",mode:"sql"},{name:"Nginx",mime:"text/x-nginx-conf",mode:"nginx",file:/nginx.*\.conf$/i},{name:"NSIS",mime:"text/x-nsis",mode:"nsis",ext:["nsh","nsi"]},{name:"NTriples",mimes:["application/n-triples","application/n-quads","text/n-triples"],mode:"ntriples",ext:["nt","nq"]},{name:"Objective-C",mime:"text/x-objectivec",mode:"clike",ext:["m"],alias:["objective-c","objc"]},{name:"Objective-C++",mime:"text/x-objectivec++",mode:"clike",ext:["mm"],alias:["objective-c++","objc++"]},{name:"OCaml",mime:"text/x-ocaml",mode:"mllike",ext:["ml","mli","mll","mly"]},{name:"Octave",mime:"text/x-octave",mode:"octave",ext:["m"]},{name:"Oz",mime:"text/x-oz",mode:"oz",ext:["oz"]},{name:"Pascal",mime:"text/x-pascal",mode:"pascal",ext:["p","pas"]},{name:"PEG.js",mime:"null",mode:"pegjs",ext:["jsonld"]},{name:"Perl",mime:"text/x-perl",mode:"perl",ext:["pl","pm"]},{name:"PHP",mimes:["text/x-php","application/x-httpd-php","application/x-httpd-php-open"],mode:"php",ext:["php","php3","php4","php5","php7","phtml"]},{name:"Pig",mime:"text/x-pig",mode:"pig",ext:["pig"]},{name:"Plain Text",mime:"text/plain",mode:"null",ext:["txt","text","conf","def","list","log"]},{name:"PLSQL",mime:"text/x-plsql",mode:"sql",ext:["pls"]},{name:"PostgreSQL",mime:"text/x-pgsql",mode:"sql"},{name:"PowerShell",mime:"application/x-powershell",mode:"powershell",ext:["ps1","psd1","psm1"]},{name:"Properties files",mime:"text/x-properties",mode:"properties",ext:["properties","ini","in"],alias:["ini","properties"]},{name:"ProtoBuf",mime:"text/x-protobuf",mode:"protobuf",ext:["proto"]},{name:"Python",mime:"text/x-python",mode:"python",ext:["BUILD","bzl","py","pyw"],file:/^(BUCK|BUILD)$/},{name:"Puppet",mime:"text/x-puppet",mode:"puppet",ext:["pp"]},{name:"Q",mime:"text/x-q",mode:"q",ext:["q"]},{name:"R",mime:"text/x-rsrc",mode:"r",ext:["r","R"],alias:["rscript"]},{name:"reStructuredText",mime:"text/x-rst",mode:"rst",ext:["rst"],alias:["rst"]},{name:"RPM Changes",mime:"text/x-rpm-changes",mode:"rpm"},{name:"RPM Spec",mime:"text/x-rpm-spec",mode:"rpm",ext:["spec"]},{name:"Ruby",mime:"text/x-ruby",mode:"ruby",ext:["rb"],alias:["jruby","macruby","rake","rb","rbx"]},{name:"Rust",mime:"text/x-rustsrc",mode:"rust",ext:["rs"]},{name:"SAS",mime:"text/x-sas",mode:"sas",ext:["sas"]},{name:"Sass",mime:"text/x-sass",mode:"sass",ext:["sass"]},{name:"Scala",mime:"text/x-scala",mode:"clike",ext:["scala"]},{name:"Scheme",mime:"text/x-scheme",mode:"scheme",ext:["scm","ss"]},{name:"SCSS",mime:"text/x-scss",mode:"css",ext:["scss"]},{name:"Shell",mimes:["text/x-sh","application/x-sh"],mode:"shell",ext:["sh","ksh","bash"],alias:["bash","sh","zsh"],file:/^PKGBUILD$/},{name:"Sieve",mime:"application/sieve",mode:"sieve",ext:["siv","sieve"]},{name:"Slim",mimes:["text/x-slim","application/x-slim"],mode:"slim",ext:["slim"]},{name:"Smalltalk",mime:"text/x-stsrc",mode:"smalltalk",ext:["st"]},{name:"Smarty",mime:"text/x-smarty",mode:"smarty",ext:["tpl"]},{name:"Solr",mime:"text/x-solr",mode:"solr"},{name:"SML",mime:"text/x-sml",mode:"mllike",ext:["sml","sig","fun","smackspec"]},{name:"Soy",mime:"text/x-soy",mode:"soy",ext:["soy"],alias:["closure template"]},{name:"SPARQL",mime:"application/sparql-query",mode:"sparql",ext:["rq","sparql"],alias:["sparul"]},{name:"Spreadsheet",mime:"text/x-spreadsheet",mode:"spreadsheet",alias:["excel","formula"]},{name:"SQL",mime:"text/x-sql",mode:"sql",ext:["sql"]},{name:"SQLite",mime:"text/x-sqlite",mode:"sql"},{name:"Squirrel",mime:"text/x-squirrel",mode:"clike",ext:["nut"]},{name:"Stylus",mime:"text/x-styl",mode:"stylus",ext:["styl"]},{name:"Swift",mime:"text/x-swift",mode:"swift",ext:["swift"]},{name:"sTeX",mime:"text/x-stex",mode:"stex"},{name:"LaTeX",mime:"text/x-latex",mode:"stex",ext:["text","ltx","tex"],alias:["tex"]},{name:"SystemVerilog",mime:"text/x-systemverilog",mode:"verilog",ext:["v","sv","svh"]},{name:"Tcl",mime:"text/x-tcl",mode:"tcl",ext:["tcl"]},{name:"Textile",mime:"text/x-textile",mode:"textile",ext:["textile"]},{name:"TiddlyWiki ",mime:"text/x-tiddlywiki",mode:"tiddlywiki"},{name:"Tiki wiki",mime:"text/tiki",mode:"tiki"},{name:"TOML",mime:"text/x-toml",mode:"toml",ext:["toml"]},{name:"Tornado",mime:"text/x-tornado",mode:"tornado"},{name:"troff",mime:"text/troff",mode:"troff",ext:["1","2","3","4","5","6","7","8","9"]},{name:"TTCN",mime:"text/x-ttcn",mode:"ttcn",ext:["ttcn","ttcn3","ttcnpp"]},{name:"TTCN_CFG",mime:"text/x-ttcn-cfg",mode:"ttcn-cfg",ext:["cfg"]},{name:"Turtle",mime:"text/turtle",mode:"turtle",ext:["ttl"]},{name:"TypeScript",mime:"application/typescript",mode:"javascript",ext:["ts"],alias:["ts"]},{name:"TypeScript-JSX",mime:"text/typescript-jsx",mode:"jsx",ext:["tsx"],alias:["tsx"]},{name:"Twig",mime:"text/x-twig",mode:"twig"},{name:"Web IDL",mime:"text/x-webidl",mode:"webidl",ext:["webidl"]},{name:"VB.NET",mime:"text/x-vb",mode:"vb",ext:["vb"]},{name:"VBScript",mime:"text/vbscript",mode:"vbscript",ext:["vbs"]},{name:"Velocity",mime:"text/velocity",mode:"velocity",ext:["vtl"]},{name:"Verilog",mime:"text/x-verilog",mode:"verilog",ext:["v"]},{name:"VHDL",mime:"text/x-vhdl",mode:"vhdl",ext:["vhd","vhdl"]},{name:"Vue.js Component",mimes:["script/x-vue","text/x-vue"],mode:"vue",ext:["vue"]},{name:"XML",mimes:["application/xml","text/xml"],mode:"xml",ext:["xml","xsl","xsd","svg"],alias:["rss","wsdl","xsd"]},{name:"XQuery",mime:"application/xquery",mode:"xquery",ext:["xy","xquery"]},{name:"Yacas",mime:"text/x-yacas",mode:"yacas",ext:["ys"]},{name:"YAML",mimes:["text/x-yaml","text/yaml"],mode:"yaml",ext:["yaml","yml"],alias:["yml"]},{name:"Z80",mime:"text/x-z80",mode:"z80",ext:["z80"]},{name:"mscgen",mime:"text/x-mscgen",mode:"mscgen",ext:["mscgen","mscin","msc"]},{name:"xu",mime:"text/x-xu",mode:"mscgen",ext:["xu"]},{name:"msgenny",mime:"text/x-msgenny",mode:"mscgen",ext:["msgenny"]}];for(var i=0;i<CodeMirror.modeInfo.length;i++){var info=CodeMirror.modeInfo[i];info.mimes&&(info.mime=info.mimes[0])}CodeMirror.findModeByMIME=function(mime){mime=mime.toLowerCase();for(var i=0;i<CodeMirror.modeInfo.length;i++){var info=CodeMirror.modeInfo[i];if(info.mime==mime)return info;if(info.mimes)for(var j=0;j<info.mimes.length;j++)if(info.mimes[j]==mime)return info}return/\+xml$/.test(mime)?CodeMirror.findModeByMIME("application/xml"):/\+json$/.test(mime)?CodeMirror.findModeByMIME("application/json"):void 0},CodeMirror.findModeByExtension=function(ext){for(var i=0;i<CodeMirror.modeInfo.length;i++){var info=CodeMirror.modeInfo[i];if(info.ext)for(var j=0;j<info.ext.length;j++)if(info.ext[j]==ext)return info}},CodeMirror.findModeByFileName=function(filename){for(var i=0;i<CodeMirror.modeInfo.length;i++){var info=CodeMirror.modeInfo[i];if(info.file&&info.file.test(filename))return info}var ext=filename.lastIndexOf("."),ext=-1<ext&&filename.substring(ext+1,filename.length);if(ext)return CodeMirror.findModeByExtension(ext)},CodeMirror.findModeByName=function(name){name=name.toLowerCase();for(var i=0;i<CodeMirror.modeInfo.length;i++){var info=CodeMirror.modeInfo[i];if(info.name.toLowerCase()==name)return info;if(info.alias)for(var j=0;j<info.alias.length;j++)if(info.alias[j].toLowerCase()==name)return info}}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define("cm/mode/markdown/markdown",["../../lib/codemirror","../xml/xml","../meta"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.defineMode("markdown",function(cmCfg,modeCfg){var htmlMode=CodeMirror.getMode(cmCfg,"text/html"),htmlModeMissing="null"==htmlMode.name;void 0===modeCfg.highlightFormatting&&(modeCfg.highlightFormatting=!1),void 0===modeCfg.maxBlockquoteDepth&&(modeCfg.maxBlockquoteDepth=0),void 0===modeCfg.taskLists&&(modeCfg.taskLists=!1),void 0===modeCfg.strikethrough&&(modeCfg.strikethrough=!1),void 0===modeCfg.emoji&&(modeCfg.emoji=!1),void 0===modeCfg.fencedCodeBlockHighlighting&&(modeCfg.fencedCodeBlockHighlighting=!0),void 0===modeCfg.xml&&(modeCfg.xml=!0),void 0===modeCfg.tokenTypeOverrides&&(modeCfg.tokenTypeOverrides={});var tokenType,tokenTypes={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(tokenType in tokenTypes)tokenTypes.hasOwnProperty(tokenType)&&modeCfg.tokenTypeOverrides[tokenType]&&(tokenTypes[tokenType]=modeCfg.tokenTypeOverrides[tokenType]);var hrRE=/^([*\-_])(?:\s*\1){2,}\s*$/,listRE=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,taskListRE=/^\[(x| )\](?=\s)/i,atxHeaderRE=modeCfg.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,setextHeaderRE=/^ *(?:\={1,}|-{1,})\s*$/,textRE=/^[^#!\[\]*_\\<>` "'(~:]+/,fencedCodeRE=/^(~~~+|```+)[ \t]*([\w+#-]*)[^\n`]*$/,linkDefRE=/^\s*\[[^\]]+?\]:.*$/,punctuation=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/;function switchInline(stream,state,f){return(state.f=state.inline=f)(stream,state)}function switchBlock(stream,state,f){return(state.f=state.block=f)(stream,state)}function blankLine(state){var inner,exit;return state.linkTitle=!1,state.linkHref=!1,state.linkText=!1,state.em=!1,state.strong=!1,state.strikethrough=!1,state.quote=0,state.indentedCode=!1,state.f!=htmlBlock||(exit=!(exit=htmlModeMissing)?"xml"==(inner=CodeMirror.innerMode(htmlMode,state.htmlState)).mode.name&&null===inner.state.tagStart&&!inner.state.context&&inner.state.tokenize.isInText:exit)&&(state.f=inlineNormal,state.block=blockNormal,state.htmlState=null),state.trailingSpace=0,state.trailingSpaceNewLine=!1,state.prevLine=state.thisLine,state.thisLine={stream:null},null}function blockNormal(stream,state){var firstTokenOnLine=stream.column()===state.indentation,listType=function lineIsEmpty(line){return!line||!/\S/.test(line.string)}(state.prevLine.stream),prevLineIsIndentedCode=state.indentedCode,match=state.prevLine.hr,prevLineIsList=!1!==state.list,maxNonCodeIndentation=(state.listStack[state.listStack.length-1]||0)+3;state.indentedCode=!1;var lineIndentation=state.indentation;if(null===state.indentationDiff&&(state.indentationDiff=state.indentation,prevLineIsList)){for(state.list=null;lineIndentation<state.listStack[state.listStack.length-1];)state.listStack.pop(),state.listStack.length?state.indentation=state.listStack[state.listStack.length-1]:state.list=!1;!1!==state.list&&(state.indentationDiff=lineIndentation-state.listStack[state.listStack.length-1])}var allowsInlineContinuation=!(listType||match||state.prevLine.header||prevLineIsList&&prevLineIsIndentedCode||state.prevLine.fencedCodeEnd),isHr=(!1===state.list||match||listType)&&state.indentation<=maxNonCodeIndentation&&stream.match(hrRE),match=null;if(4<=state.indentationDiff&&(prevLineIsIndentedCode||state.prevLine.fencedCodeEnd||state.prevLine.header||listType))return stream.skipToEnd(),state.indentedCode=!0,tokenTypes.code;if(stream.eatSpace())return null;if(firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(atxHeaderRE))&&match[1].length<=6)return state.quote=0,state.header=match[1].length,state.thisLine.header=!0,modeCfg.highlightFormatting&&(state.formatting="header"),state.f=state.inline,getType(state);if(state.indentation<=maxNonCodeIndentation&&stream.eat(">"))return state.quote=firstTokenOnLine?1:state.quote+1,modeCfg.highlightFormatting&&(state.formatting="quote"),stream.eatSpace(),getType(state);if(!isHr&&!state.setext&&firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(listRE))){listType=match[1]?"ol":"ul";return state.indentation=lineIndentation+stream.current().length,state.list=!0,state.quote=0,state.listStack.push(state.indentation),state.em=!1,state.strong=!1,state.code=!1,state.strikethrough=!1,modeCfg.taskLists&&stream.match(taskListRE,!1)&&(state.taskList=!0),state.f=state.inline,modeCfg.highlightFormatting&&(state.formatting=["list","list-"+listType]),getType(state)}return firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(fencedCodeRE,!0))?(state.quote=0,state.fencedEndRE=new RegExp(match[1]+"+ *$"),state.localMode=modeCfg.fencedCodeBlockHighlighting&&function getMode(mode){var found;return!CodeMirror.findModeByName||(found=CodeMirror.findModeByName(mode))&&(mode=found.mime||found.mimes[0]),"null"==(mode=CodeMirror.getMode(cmCfg,mode)).name?null:mode}(match[2]),state.localMode&&(state.localState=CodeMirror.startState(state.localMode)),state.f=state.block=local,modeCfg.highlightFormatting&&(state.formatting="code-block"),state.code=-1,getType(state)):state.setext||!(allowsInlineContinuation&&prevLineIsList||state.quote||!1!==state.list||state.code||isHr||linkDefRE.test(stream.string))&&(match=stream.lookAhead(1))&&(match=match.match(setextHeaderRE))?(state.setext?(state.header=state.setext,state.setext=0,stream.skipToEnd(),modeCfg.highlightFormatting&&(state.formatting="header")):(state.header="="==match[0].charAt(0)?1:2,state.setext=state.header),state.thisLine.header=!0,state.f=state.inline,getType(state)):isHr?(stream.skipToEnd(),state.hr=!0,state.thisLine.hr=!0,tokenTypes.hr):"["===stream.peek()?switchInline(stream,state,footnoteLink):switchInline(stream,state,state.inline)}function htmlBlock(stream,state){var inner,style=htmlMode.token(stream,state.htmlState);return htmlModeMissing||("xml"==(inner=CodeMirror.innerMode(htmlMode,state.htmlState)).mode.name&&null===inner.state.tagStart&&!inner.state.context&&inner.state.tokenize.isInText||state.md_inside&&-1<stream.current().indexOf(">"))&&(state.f=inlineNormal,state.block=blockNormal,state.htmlState=null),style}function local(stream,state){var returnType,maxFencedEndInd=state.listStack[state.listStack.length-1]||0,hasExitedList=state.indentation<maxFencedEndInd,maxFencedEndInd=maxFencedEndInd+3;return state.fencedEndRE&&state.indentation<=maxFencedEndInd&&(hasExitedList||stream.match(state.fencedEndRE))?(modeCfg.highlightFormatting&&(state.formatting="code-block"),hasExitedList||(returnType=getType(state)),state.localMode=state.localState=null,state.block=blockNormal,state.f=inlineNormal,state.fencedEndRE=null,state.code=0,state.thisLine.fencedCodeEnd=!0,hasExitedList?switchBlock(stream,state,state.block):returnType):state.localMode?state.localMode.token(stream,state.localState):(stream.skipToEnd(),tokenTypes.code)}function getType(state){var listMod,styles=[];if(state.formatting){styles.push(tokenTypes.formatting),"string"==typeof state.formatting&&(state.formatting=[state.formatting]);for(var i=0;i<state.formatting.length;i++)styles.push(tokenTypes.formatting+"-"+state.formatting[i]),"header"===state.formatting[i]&&styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.header),"quote"===state.formatting[i]&&(!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote?styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.quote):styles.push("error"))}return state.taskOpen?styles.push("meta"):state.taskClosed?styles.push("property"):(state.linkHref?styles.push(tokenTypes.linkHref,"url"):(state.strong&&styles.push(tokenTypes.strong),state.em&&styles.push(tokenTypes.em),state.strikethrough&&styles.push(tokenTypes.strikethrough),state.emoji&&styles.push(tokenTypes.emoji),state.linkText&&styles.push(tokenTypes.linkText),state.code&&styles.push(tokenTypes.code),state.image&&styles.push(tokenTypes.image),state.imageAltText&&styles.push(tokenTypes.imageAltText,"link"),state.imageMarker&&styles.push(tokenTypes.imageMarker)),state.header&&styles.push(tokenTypes.header,tokenTypes.header+"-"+state.header),state.quote&&(styles.push(tokenTypes.quote),!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote?styles.push(tokenTypes.quote+"-"+state.quote):styles.push(tokenTypes.quote+"-"+modeCfg.maxBlockquoteDepth)),!1!==state.list&&((listMod=(state.listStack.length-1)%3)?1==listMod?styles.push(tokenTypes.list2):styles.push(tokenTypes.list3):styles.push(tokenTypes.list1)),state.trailingSpaceNewLine?styles.push("trailing-space-new-line"):state.trailingSpace&&styles.push("trailing-space-"+(state.trailingSpace%2?"a":"b"))),styles.length?styles.join(" "):null}function handleText(stream,state){if(stream.match(textRE,!0))return getType(state)}function inlineNormal(stream,state){var regex=state.text(stream,state);if(void 0!==regex)return regex;if(state.list)return state.list=null,getType(state);if(state.taskList)return" "===stream.match(taskListRE,!0)[1]?state.taskOpen=!0:state.taskClosed=!0,modeCfg.highlightFormatting&&(state.formatting="task"),state.taskList=!1,getType(state);if(state.taskOpen=!1,state.taskClosed=!1,state.header&&stream.match(/^#+$/,!0))return modeCfg.highlightFormatting&&(state.formatting="header"),getType(state);var ch=stream.next();if(state.linkTitle){state.linkTitle=!1;regex="("===ch?")":ch,regex="^\\s*(?:[^"+(regex=(regex+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+regex;if(stream.match(new RegExp(regex),!0))return tokenTypes.linkHref}if("`"===ch){var before=state.formatting;modeCfg.highlightFormatting&&(state.formatting="code"),stream.eatWhile("`");var after=stream.current().length;if(0!=state.code||state.quote&&1!=after){if(after!=state.code)return state.formatting=before,getType(state);var retType=getType(state);return state.code=0,retType}return state.code=after,getType(state)}if(state.code)return getType(state);if("\\"===ch&&(stream.next(),modeCfg.highlightFormatting)){var rightFlanking=getType(state),leftFlanking=tokenTypes.formatting+"-escape";return rightFlanking?rightFlanking+" "+leftFlanking:leftFlanking}if("!"===ch&&stream.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return state.imageMarker=!0,state.image=!0,modeCfg.highlightFormatting&&(state.formatting="image"),getType(state);if("["===ch&&state.imageMarker&&stream.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return state.imageMarker=!1,state.imageAltText=!0,modeCfg.highlightFormatting&&(state.formatting="image"),getType(state);if("]"===ch&&state.imageAltText){modeCfg.highlightFormatting&&(state.formatting="image");rightFlanking=getType(state);return state.imageAltText=!1,state.image=!1,state.inline=state.f=linkHref,rightFlanking}if("["===ch&&!state.image)return state.linkText&&stream.match(/^.*?\]/)||(state.linkText=!0,modeCfg.highlightFormatting&&(state.formatting="link")),getType(state);if("]"===ch&&state.linkText){modeCfg.highlightFormatting&&(state.formatting="link");rightFlanking=getType(state);return state.linkText=!1,state.inline=state.f=stream.match(/\(.*?\)| ?\[.*?\]/,!1)?linkHref:inlineNormal,rightFlanking}if("<"===ch&&stream.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return state.f=state.inline=linkInline,modeCfg.highlightFormatting&&(state.formatting="link"),(rightFlanking=getType(state))?rightFlanking+=" ":rightFlanking="",rightFlanking+tokenTypes.linkInline;if("<"===ch&&stream.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return state.f=state.inline=linkInline,modeCfg.highlightFormatting&&(state.formatting="link"),(rightFlanking=getType(state))?rightFlanking+=" ":rightFlanking="",rightFlanking+tokenTypes.linkEmail;if(modeCfg.xml&&"<"===ch&&stream.match(/^(!--|\?|!\[CDATA\[|[a-z][a-z0-9-]*(?:\s+[a-z_:.\-]+(?:\s*=\s*[^>]+)?)*\s*(?:>|$))/i,!1)){var setEm=stream.string.indexOf(">",stream.pos);return-1!=setEm&&(setStrong=stream.string.substring(stream.start,setEm),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(setStrong)&&(state.md_inside=!0)),stream.backUp(1),state.htmlState=CodeMirror.startState(htmlMode),switchBlock(stream,state,htmlBlock)}if(modeCfg.xml&&"<"===ch&&stream.match(/^\/\w*?>/))return state.md_inside=!1,"tag";if("*"===ch||"_"===ch){for(var len=1,before=1==stream.pos?" ":stream.string.charAt(stream.pos-2);len<3&&stream.eat(ch);)len++;var after=stream.peek()||" ",leftFlanking=!/\s/.test(after)&&(!punctuation.test(after)||/\s/.test(before)||punctuation.test(before)),rightFlanking=!/\s/.test(before)&&(!punctuation.test(before)||/\s/.test(after)||punctuation.test(after)),setEm=null,setStrong=null;if(len%2&&(state.em||!leftFlanking||"*"!==ch&&rightFlanking&&!punctuation.test(before)?state.em!=ch||!rightFlanking||"*"!==ch&&leftFlanking&&!punctuation.test(after)||(setEm=!1):setEm=!0),1<len&&(state.strong||!leftFlanking||"*"!==ch&&rightFlanking&&!punctuation.test(before)?state.strong!=ch||!rightFlanking||"*"!==ch&&leftFlanking&&!punctuation.test(after)||(setStrong=!1):setStrong=!0),null!=setStrong||null!=setEm){modeCfg.highlightFormatting&&(state.formatting=null==setEm?"strong":null==setStrong?"em":"strong em"),!0===setEm&&(state.em=ch),!0===setStrong&&(state.strong=ch);retType=getType(state);return!1===setEm&&(state.em=!1),!1===setStrong&&(state.strong=!1),retType}}else if(" "===ch&&(stream.eat("*")||stream.eat("_"))){if(" "===stream.peek())return getType(state);stream.backUp(1)}if(modeCfg.strikethrough)if("~"===ch&&stream.eatWhile(ch)){if(state.strikethrough){modeCfg.highlightFormatting&&(state.formatting="strikethrough");retType=getType(state);return state.strikethrough=!1,retType}if(stream.match(/^[^\s]/,!1))return state.strikethrough=!0,modeCfg.highlightFormatting&&(state.formatting="strikethrough"),getType(state)}else if(" "===ch&&stream.match(/^~~/,!0)){if(" "===stream.peek())return getType(state);stream.backUp(2)}if(modeCfg.emoji&&":"===ch&&stream.match(/^(?:[a-z_\d+][a-z_\d+-]*|\-[a-z_\d+][a-z_\d+-]*):/)){state.emoji=!0,modeCfg.highlightFormatting&&(state.formatting="emoji");retType=getType(state);return state.emoji=!1,retType}return" "===ch&&(stream.match(/^ +$/,!1)?state.trailingSpace++:state.trailingSpace&&(state.trailingSpaceNewLine=!0)),getType(state)}function linkInline(stream,type){if(">"!==stream.next())return stream.match(/^[^>]+/,!0),tokenTypes.linkInline;type.f=type.inline=inlineNormal,modeCfg.highlightFormatting&&(type.formatting="link");type=getType(type);return type?type+=" ":type="",type+tokenTypes.linkInline}function linkHref(ch,state){if(ch.eatSpace())return null;ch=ch.next();return"("===ch||"["===ch?(state.f=state.inline=function getLinkHrefInside(endChar){return function(returnState,state){if(returnState.next()!==endChar)return returnState.match(linkRE[endChar]),state.linkHref=!0,getType(state);state.f=state.inline=inlineNormal,modeCfg.highlightFormatting&&(state.formatting="link-string");returnState=getType(state);return state.linkHref=!1,returnState}}("("===ch?")":"]"),modeCfg.highlightFormatting&&(state.formatting="link-string"),state.linkHref=!0,getType(state)):"error"}var linkRE={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/};function footnoteLink(stream,state){return stream.match(/^([^\]\\]|\\.)*\]:/,!1)?(state.f=footnoteLinkInside,stream.next(),modeCfg.highlightFormatting&&(state.formatting="link"),state.linkText=!0,getType(state)):switchInline(stream,state,inlineNormal)}function footnoteLinkInside(stream,state){if(stream.match(/^\]:/,!0)){state.f=state.inline=footnoteUrl,modeCfg.highlightFormatting&&(state.formatting="link");var returnType=getType(state);return state.linkText=!1,returnType}return stream.match(/^([^\]\\]|\\.)+/,!0),tokenTypes.linkText}function footnoteUrl(stream,state){return stream.eatSpace()?null:(stream.match(/^[^\s]+/,!0),void 0===stream.peek()?state.linkTitle=!0:stream.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),state.f=state.inline=inlineNormal,tokenTypes.linkHref+" url")}var mode={startState:function(){return{f:blockNormal,prevLine:{stream:null},thisLine:{stream:null},block:blockNormal,htmlState:null,indentation:0,inline:inlineNormal,text:handleText,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,setext:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,emoji:!1,fencedEndRE:null}},copyState:function(s){return{f:s.f,prevLine:s.prevLine,thisLine:s.thisLine,block:s.block,htmlState:s.htmlState&&CodeMirror.copyState(htmlMode,s.htmlState),indentation:s.indentation,localMode:s.localMode,localState:s.localMode?CodeMirror.copyState(s.localMode,s.localState):null,inline:s.inline,text:s.text,formatting:!1,linkText:s.linkText,linkTitle:s.linkTitle,linkHref:s.linkHref,code:s.code,em:s.em,strong:s.strong,strikethrough:s.strikethrough,emoji:s.emoji,header:s.header,setext:s.setext,hr:s.hr,taskList:s.taskList,list:s.list,listStack:s.listStack.slice(0),quote:s.quote,indentedCode:s.indentedCode,trailingSpace:s.trailingSpace,trailingSpaceNewLine:s.trailingSpaceNewLine,md_inside:s.md_inside,fencedEndRE:s.fencedEndRE}},token:function(stream,state){if(state.formatting=!1,stream!=state.thisLine.stream){if(state.header=0,state.hr=!1,stream.match(/^\s*$/,!0))return blankLine(state),null;if(state.prevLine=state.thisLine,state.thisLine={stream:stream},state.taskList=!1,state.trailingSpace=0,state.trailingSpaceNewLine=!1,!state.localState&&(state.f=state.block,state.f!=htmlBlock)){var indentation=stream.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(state.indentation=indentation,state.indentationDiff=null,0<indentation)return null}}return state.f(stream,state)},innerMode:function(state){return state.block==htmlBlock?{state:state.htmlState,mode:htmlMode}:state.localState?{state:state.localState,mode:state.localMode}:{state:state,mode:mode}},indent:function(state,textAfter,line){return state.block==htmlBlock&&htmlMode.indent?htmlMode.indent(state.htmlState,textAfter,line):state.localState&&state.localMode.indent?state.localMode.indent(state.localState,textAfter,line):CodeMirror.Pass},blankLine:blankLine,getType:getType,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return mode},"xml"),CodeMirror.defineMIME("text/markdown","markdown"),CodeMirror.defineMIME("text/x-markdown","markdown")}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/edit/matchbrackets",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){var ie_lt8=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),Pos=CodeMirror.Pos,matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function bracketRegex(config){return config&&config.bracketRegex||/[(){}[\]]/}function findMatchingBracket(cm,where,found){var style=cm.getLineHandle(where.line),pos=where.ch-1,match=found&&found.afterCursor;null==match&&(match=/(^| )cm-fat-cursor($| )/.test(cm.getWrapperElement().className));var dir=bracketRegex(found),match=!match&&0<=pos&&dir.test(style.text.charAt(pos))&&matching[style.text.charAt(pos)]||dir.test(style.text.charAt(pos+1))&&matching[style.text.charAt(++pos)];if(!match)return null;dir=">"==match.charAt(1)?1:-1;if(found&&found.strict&&0<dir!=(pos==where.ch))return null;style=cm.getTokenTypeAt(Pos(where.line,pos+1)),found=scanForBracket(cm,Pos(where.line,pos+(0<dir?1:0)),dir,style||null,found);return null==found?null:{from:Pos(where.line,pos),to:found&&found.pos,match:found&&found.ch==match.charAt(0),forward:0<dir}}function scanForBracket(cm,where,dir,style,config){for(var maxScanLen=config&&config.maxScanLineLength||1e4,maxScanLines=config&&config.maxScanLines||1e3,stack=[],re=bracketRegex(config),lineEnd=0<dir?Math.min(where.line+maxScanLines,cm.lastLine()+1):Math.max(cm.firstLine()-1,where.line-maxScanLines),lineNo=where.line;lineNo!=lineEnd;lineNo+=dir){var line=cm.getLine(lineNo);if(line){var pos=0<dir?0:line.length-1,end=0<dir?line.length:-1;if(!(line.length>maxScanLen))for(lineNo==where.line&&(pos=where.ch-(dir<0?1:0));pos!=end;pos+=dir){var ch=line.charAt(pos);if(re.test(ch)&&(void 0===style||cm.getTokenTypeAt(Pos(lineNo,pos+1))==style)){var match=matching[ch];if(match&&">"==match.charAt(1)==0<dir)stack.push(ch);else{if(!stack.length)return{pos:Pos(lineNo,pos),ch:ch};stack.pop()}}}}}return lineNo-dir!=(0<dir?cm.lastLine():cm.firstLine())&&null}function matchBrackets(cm,autoclear,config){for(var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1e3,marks=[],ranges=cm.listSelections(),i=0;i<ranges.length;i++){var style,match=ranges[i].empty()&&findMatchingBracket(cm,ranges[i].head,config);match&&cm.getLine(match.from.line).length<=maxHighlightLen&&(style=match.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",marks.push(cm.markText(match.from,Pos(match.from.line,match.from.ch+1),{className:style})),match.to&&cm.getLine(match.to.line).length<=maxHighlightLen&&marks.push(cm.markText(match.to,Pos(match.to.line,match.to.ch+1),{className:style})))}if(marks.length){ie_lt8&&cm.state.focused&&cm.focus();function clear(){cm.operation(function(){for(var i=0;i<marks.length;i++)marks[i].clear()})}if(!autoclear)return clear;setTimeout(clear,800)}}function doMatchBrackets(cm){cm.operation(function(){cm.state.matchBrackets.currentlyHighlighted&&(cm.state.matchBrackets.currentlyHighlighted(),cm.state.matchBrackets.currentlyHighlighted=null),cm.state.matchBrackets.currentlyHighlighted=matchBrackets(cm,!1,cm.state.matchBrackets)})}CodeMirror.defineOption("matchBrackets",!1,function(cm,val,old){old&&old!=CodeMirror.Init&&(cm.off("cursorActivity",doMatchBrackets),cm.state.matchBrackets&&cm.state.matchBrackets.currentlyHighlighted&&(cm.state.matchBrackets.currentlyHighlighted(),cm.state.matchBrackets.currentlyHighlighted=null)),val&&(cm.state.matchBrackets="object"==typeof val?val:{},cm.on("cursorActivity",doMatchBrackets))}),CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,!0)}),CodeMirror.defineExtension("findMatchingBracket",function(pos,config,oldConfig){return findMatchingBracket(this,pos,config=oldConfig||"boolean"==typeof config?oldConfig?(oldConfig.strict=config,oldConfig):config?{strict:!0}:null:config)}),CodeMirror.defineExtension("scanForBracket",function(pos,dir,style,config){return scanForBracket(this,pos,dir,style,config)})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/comment/continuecomment",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){var nonspace=/\S/g,repeat=String.prototype.repeat||function(n){return Array(n+1).join(this)};function continueComment(cm){if(cm.getOption("disableInput"))return CodeMirror.Pass;for(var mode,ranges=cm.listSelections(),inserts=[],i=0;i<ranges.length;i++){var nextFound=ranges[i].head;if(!/\bcomment\b/.test(cm.getTokenTypeAt(nextFound)))return CodeMirror.Pass;var tabSize=cm.getModeAt(nextFound);if(mode){if(mode!=tabSize)return CodeMirror.Pass}else mode=tabSize;var line,found,next,insert=null,blockStart=mode.blockCommentStart,lineCmt=mode.lineComment;if(blockStart&&mode.blockCommentContinue&&(-1!=(tabSize=(line=cm.getLine(nextFound.line)).lastIndexOf(mode.blockCommentEnd,nextFound.ch-mode.blockCommentEnd.length))&&tabSize==nextFound.ch-mode.blockCommentEnd.length||lineCmt&&-1<(found=line.lastIndexOf(lineCmt,nextFound.ch-1))&&/\bcomment\b/.test(cm.getTokenTypeAt({line:nextFound.line,ch:found+1}))||(-1<(found=line.lastIndexOf(blockStart,nextFound.ch-blockStart.length))&&tabSize<found?insert=nonspaceAfter(0,line)>=found?line.slice(0,found):(tabSize=cm.options.tabSize,found=CodeMirror.countColumn(line,found,tabSize),cm.options.indentWithTabs?repeat.call("\t",next=Math.floor(found/tabSize))+repeat.call(" ",found-tabSize*next):repeat.call(" ",found)):-1<(found=line.indexOf(mode.blockCommentContinue))&&found<=nextFound.ch&&found<=nonspaceAfter(0,line)&&(insert=line.slice(0,found))),null!=insert&&(insert+=mode.blockCommentContinue)),null==insert&&lineCmt&&function continueLineCommentEnabled(opt){opt=opt.getOption("continueComments");return!opt||"object"!=typeof opt||!1!==opt.continueLineComment}(cm)&&(found=(line=null==line?cm.getLine(nextFound.line):line).indexOf(lineCmt),nextFound.ch||found?-1<found&&nonspaceAfter(0,line)>=found&&(insert=(insert=!(insert=-1<nonspaceAfter(nextFound.ch,line))?-1<(nextFound=(next=cm.getLine(nextFound.line+1)||"").indexOf(lineCmt))&&nonspaceAfter(0,next)>=nextFound||null:insert)&&line.slice(0,found)+lineCmt+line.slice(found+lineCmt.length).match(/^\s*/)[0]):insert=""),null==insert)return CodeMirror.Pass;inserts[i]="\n"+insert}cm.operation(function(){for(var i=ranges.length-1;0<=i;i--)cm.replaceRange(inserts[i],ranges[i].from(),ranges[i].to(),"+insert")})}function nonspaceAfter(ch,m){nonspace.lastIndex=ch;m=nonspace.exec(m);return m?m.index:-1}CodeMirror.defineOption("continueComments",null,function(cm,map,key){key&&key!=CodeMirror.Init&&cm.removeKeyMap("continueComment"),map&&(key="Enter","string"==typeof map?key=map:"object"==typeof map&&map.key&&(key=map.key),(map={name:"continueComment"})[key]=continueComment,cm.addKeyMap(map))})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/comment/comment",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var noOptions={},nonWS=/[^\s\u00a0]/,Pos=CodeMirror.Pos;function firstNonWS(found){found=found.search(nonWS);return-1==found?0:found}function getMode(cm,pos){var mode=cm.getMode();return!1!==mode.useInnerComments&&mode.innerMode?cm.getModeAt(pos):mode}CodeMirror.commands.toggleComment=function(cm){cm.toggleComment()},CodeMirror.defineExtension("toggleComment",function(options){options=options||noOptions;for(var minLine=1/0,ranges=this.listSelections(),mode=null,i=ranges.length-1;0<=i;i--){var from=ranges[i].from(),to=ranges[i].to();from.line>=minLine||(to.line>=minLine&&(to=Pos(minLine,0)),minLine=from.line,null==mode?mode=this.uncomment(from,to,options)?"un":(this.lineComment(from,to,options),"line"):"un"==mode?this.uncomment(from,to,options):this.lineComment(from,to,options))}}),CodeMirror.defineExtension("lineComment",function(from,to,options){options=options||noOptions;var commentString,end,pad,blankLines,self=this,mode=getMode(self,from),firstLine=self.getLine(from.line);null==firstLine||function probablyInsideString(cm,pos,line){return/\bstring\b/.test(cm.getTokenTypeAt(Pos(pos.line,0)))&&!/^[\'\"\`]/.test(line)}(self,from,firstLine)||((commentString=options.lineComment||mode.lineComment)?(end=Math.min(0!=to.ch||to.line==from.line?to.line+1:to.line,self.lastLine()+1),pad=null==options.padding?" ":options.padding,blankLines=options.commentBlankLines||from.line==to.line,self.operation(function(){if(options.indent){for(var baseString=null,i=from.line;i<end;++i){var whitespace=(line=self.getLine(i)).slice(0,firstNonWS(line));(null==baseString||baseString.length>whitespace.length)&&(baseString=whitespace)}for(i=from.line;i<end;++i){var line=self.getLine(i),cut=baseString.length;(blankLines||nonWS.test(line))&&(line.slice(0,cut)!=baseString&&(cut=firstNonWS(line)),self.replaceRange(baseString+commentString+pad,Pos(i,0),Pos(i,cut)))}}else for(i=from.line;i<end;++i)(blankLines||nonWS.test(self.getLine(i)))&&self.replaceRange(commentString+pad,Pos(i,0))})):(options.blockCommentStart||mode.blockCommentStart)&&(options.fullLines=!0,self.blockComment(from,to,options)))}),CodeMirror.defineExtension("blockComment",function(from,to,options){options=options||noOptions;var end,pad,self=this,mode=getMode(self,from),startString=options.blockCommentStart||mode.blockCommentStart,endString=options.blockCommentEnd||mode.blockCommentEnd;startString&&endString?/\bcomment\b/.test(self.getTokenTypeAt(Pos(from.line,0)))||((end=Math.min(to.line,self.lastLine()))!=from.line&&0==to.ch&&nonWS.test(self.getLine(end))&&--end,pad=null==options.padding?" ":options.padding,from.line>end||self.operation(function(){if(0!=options.fullLines){var lastLineHasText=nonWS.test(self.getLine(end));self.replaceRange(pad+endString,Pos(end)),self.replaceRange(startString+pad,Pos(from.line,0));var lead=options.blockCommentLead||mode.blockCommentLead;if(null!=lead)for(var i=from.line+1;i<=end;++i)i==end&&!lastLineHasText||self.replaceRange(lead+pad,Pos(i,0))}else self.replaceRange(endString,to),self.replaceRange(startString,from)})):(options.lineComment||mode.lineComment)&&0!=options.fullLines&&self.lineComment(from,to,options)}),CodeMirror.defineExtension("uncomment",function(almostLastStart,to,lastStart){lastStart=lastStart||noOptions;var didSomething,self=this,firstEnd=getMode(self,almostLastStart),end=Math.min(0!=to.ch||to.line==almostLastStart.line?to.line:to.line-1,self.lastLine()),start=Math.min(almostLastStart.line,end),lineString=lastStart.lineComment||firstEnd.lineComment,lines=[],pad=null==lastStart.padding?" ":lastStart.padding;lineComment:if(lineString){for(var i=start;i<=end;++i){var line=self.getLine(i),found=line.indexOf(lineString);if(-1==(found=-1<found&&!/comment/.test(self.getTokenTypeAt(Pos(i,found+1)))?-1:found)&&nonWS.test(line))break lineComment;if(-1<found&&nonWS.test(line.slice(0,found)))break lineComment;lines.push(line)}if(self.operation(function(){for(var i=start;i<=end;++i){var line=lines[i-start],pos=line.indexOf(lineString),endPos=pos+lineString.length;pos<0||(line.slice(endPos,endPos+pad.length)==pad&&(endPos+=pad.length),didSomething=!0,self.replaceRange("",Pos(i,pos),Pos(i,endPos)))}}),didSomething)return!0}var startString=lastStart.blockCommentStart||firstEnd.blockCommentStart,endString=lastStart.blockCommentEnd||firstEnd.blockCommentEnd;if(!startString||!endString)return!1;var lead=lastStart.blockCommentLead||firstEnd.blockCommentLead,startLine=self.getLine(start),open=startLine.indexOf(startString);if(-1==open)return!1;var endLine=end==start?startLine:self.getLine(end),close=endLine.indexOf(endString,end==start?open+startString.length:0),lastStart=Pos(start,open+1),firstEnd=Pos(end,close+1);if(-1==close||!/comment/.test(self.getTokenTypeAt(lastStart))||!/comment/.test(self.getTokenTypeAt(firstEnd))||-1<self.getRange(lastStart,firstEnd,"\n").indexOf(endString))return!1;firstEnd=-1==(lastStart=startLine.lastIndexOf(startString,almostLastStart.ch))?-1:startLine.slice(0,almostLastStart.ch).indexOf(endString,lastStart+startString.length);if(-1!=lastStart&&-1!=firstEnd&&firstEnd+endString.length!=almostLastStart.ch)return!1;firstEnd=endLine.indexOf(endString,to.ch),almostLastStart=endLine.slice(to.ch).lastIndexOf(startString,firstEnd-to.ch),lastStart=-1==firstEnd||-1==almostLastStart?-1:to.ch+almostLastStart;return(-1==firstEnd||-1==lastStart||lastStart==to.ch)&&(self.operation(function(){self.replaceRange("",Pos(end,close-(pad&&endLine.slice(close-pad.length,close)==pad?pad.length:0)),Pos(end,close+endString.length));var openEnd=open+startString.length;if(pad&&startLine.slice(openEnd,openEnd+pad.length)==pad&&(openEnd+=pad.length),self.replaceRange("",Pos(start,open),Pos(start,openEnd)),lead)for(var i=start+1;i<=end;++i){var foundEnd,line=self.getLine(i),found=line.indexOf(lead);-1==found||nonWS.test(line.slice(0,found))||(foundEnd=found+lead.length,pad&&line.slice(foundEnd,foundEnd+pad.length)==pad&&(foundEnd+=pad.length),self.replaceRange("",Pos(i,found),Pos(i,foundEnd)))}}),!0)})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/hint/show-hint",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";function Completion(cm,options){this.cm=cm,this.options=options,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var self=this;cm.on("cursorActivity",this.activityFunc=function(){self.cursorActivity()})}CodeMirror.showHint=function(cm,getHints,options){if(!getHints)return cm.showHint(options);options&&options.async&&(getHints.async=!0);var newOpts={hint:getHints};if(options)for(var prop in options)newOpts[prop]=options[prop];return cm.showHint(newOpts)},CodeMirror.defineExtension("showHint",function(completion){completion=function parseOptions(cm,pos,options){var editor=cm.options.hintOptions,out={};for(prop in defaultOptions)out[prop]=defaultOptions[prop];if(editor)for(var prop in editor)void 0!==editor[prop]&&(out[prop]=editor[prop]);if(options)for(var prop in options)void 0!==options[prop]&&(out[prop]=options[prop]);out.hint.resolve&&(out.hint=out.hint.resolve(cm,pos));return out}(this,this.getCursor("start"),completion);var selections=this.listSelections();if(!(1<selections.length)){if(this.somethingSelected()){if(!completion.hint.supportsSelection)return;for(var i=0;i<selections.length;i++)if(selections[i].head.line!=selections[i].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();completion=this.state.completionActive=new Completion(this,completion);completion.options.hint&&(CodeMirror.signal(this,"startCompletion",this),completion.update(!0))}}),CodeMirror.defineExtension("closeHint",function(){this.state.completionActive&&this.state.completionActive.close()});var requestAnimationFrame=window.requestAnimationFrame||function(fn){return setTimeout(fn,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||clearTimeout;function getText(completion){return"string"==typeof completion?completion:completion.text}function getHintElement(hintsElement,el){for(;el&&el!=hintsElement;){if("LI"===el.nodeName.toUpperCase()&&el.parentNode==hintsElement)return el;el=el.parentNode}}function Widget(completion,data){this.completion=completion,this.data=data,this.picked=!1;var widget=this,cm=completion.cm,ownerDocument=cm.getInputField().ownerDocument,parentWindow=ownerDocument.defaultView||ownerDocument.parentWindow,hints=this.hints=ownerDocument.createElement("ul"),winW=completion.cm.options.theme;hints.className="CodeMirror-hints "+winW,this.selectedHint=data.selectedHint||0;for(var completions=data.list,i=0;i<completions.length;++i){var elt=hints.appendChild(ownerDocument.createElement("li")),cur=completions[i],className="CodeMirror-hint"+(i!=this.selectedHint?"":" CodeMirror-hint-active");null!=cur.className&&(className=cur.className+" "+className),elt.className=className,cur.render?cur.render(elt,data,cur):elt.appendChild(ownerDocument.createTextNode(cur.displayText||getText(cur))),elt.hintId=i}var scrolls=completion.options.container||ownerDocument.body,pos=cm.cursorCoords(completion.options.alignWithWord?data.from:null),left=pos.left,top=pos.bottom,below=!0,offsetLeft=0,offsetTop=0;scrolls!==ownerDocument.body&&(winH=(height=-1!==["absolute","relative","fixed"].indexOf(parentWindow.getComputedStyle(scrolls).position)?scrolls:scrolls.offsetParent).getBoundingClientRect(),box=ownerDocument.body.getBoundingClientRect(),offsetLeft=winH.left-box.left-height.scrollLeft,offsetTop=winH.top-box.top-height.scrollTop),hints.style.left=left-offsetLeft+"px",hints.style.top=top-offsetTop+"px";var winW=parentWindow.innerWidth||Math.max(ownerDocument.body.offsetWidth,ownerDocument.documentElement.offsetWidth),winH=parentWindow.innerHeight||Math.max(ownerDocument.body.offsetHeight,ownerDocument.documentElement.offsetHeight);scrolls.appendChild(hints);var box=hints.getBoundingClientRect(),height=box.bottom-winH,scrolls=hints.scrollHeight>hints.clientHeight+1,startScroll=cm.getScrollInfo();0<height&&(height=box.bottom-box.top,0<pos.top-(pos.bottom-box.top)-height?(hints.style.top=(top=pos.top-height-offsetTop)+"px",below=!1):winH<height&&(hints.style.height=winH-5+"px",hints.style.top=(top=pos.bottom-box.top-offsetTop)+"px",overlapX=cm.getCursor(),data.from.ch!=overlapX.ch&&(pos=cm.cursorCoords(overlapX),hints.style.left=(left=pos.left-offsetLeft)+"px",box=hints.getBoundingClientRect())));var closingOnBlur,overlapX=box.right-winW;if(0<overlapX&&(box.right-box.left>winW&&(hints.style.width=winW-5+"px",overlapX-=box.right-box.left-winW),hints.style.left=(left=pos.left-overlapX-offsetLeft)+"px"),scrolls)for(var node=hints.firstChild;node;node=node.nextSibling)node.style.paddingRight=cm.display.nativeBarWidth+"px";return cm.addKeyMap(this.keyMap=function buildKeyMap(completion,handle){var baseMap={Up:function(){handle.moveFocus(-1)},Down:function(){handle.moveFocus(1)},PageUp:function(){handle.moveFocus(1-handle.menuSize(),!0)},PageDown:function(){handle.moveFocus(handle.menuSize()-1,!0)},Home:function(){handle.setFocus(0)},End:function(){handle.setFocus(handle.length-1)},Enter:handle.pick,Tab:handle.pick,Esc:handle.close};/Mac/.test(navigator.platform)&&(baseMap["Ctrl-P"]=function(){handle.moveFocus(-1)},baseMap["Ctrl-N"]=function(){handle.moveFocus(1)});var custom=completion.options.customKeys,ourMap=custom?{}:baseMap;function addBinding(key,val){var bound="string"!=typeof val?function(cm){return val(cm,handle)}:baseMap.hasOwnProperty(val)?baseMap[val]:val;ourMap[key]=bound}if(custom)for(var key in custom)custom.hasOwnProperty(key)&&addBinding(key,custom[key]);var extra=completion.options.extraKeys;if(extra)for(var key in extra)extra.hasOwnProperty(key)&&addBinding(key,extra[key]);return ourMap}(completion,{moveFocus:function(n,avoidWrap){widget.changeActive(widget.selectedHint+n,avoidWrap)},setFocus:function(n){widget.changeActive(n)},menuSize:function(){return widget.screenAmount()},length:completions.length,close:function(){completion.close()},pick:function(){widget.pick()},data:data})),completion.options.closeOnUnfocus&&(cm.on("blur",this.onBlur=function(){closingOnBlur=setTimeout(function(){completion.close()},100)}),cm.on("focus",this.onFocus=function(){clearTimeout(closingOnBlur)})),cm.on("scroll",this.onScroll=function(){var curScroll=cm.getScrollInfo(),editor=cm.getWrapperElement().getBoundingClientRect(),newTop=top+startScroll.top-curScroll.top,point=newTop-(parentWindow.pageYOffset||(ownerDocument.documentElement||ownerDocument.body).scrollTop);if(below||(point+=hints.offsetHeight),point<=editor.top||point>=editor.bottom)return completion.close();hints.style.top=newTop+"px",hints.style.left=left+startScroll.left-curScroll.left+"px"}),CodeMirror.on(hints,"dblclick",function(t){t=getHintElement(hints,t.target||t.srcElement);t&&null!=t.hintId&&(widget.changeActive(t.hintId),widget.pick())}),CodeMirror.on(hints,"click",function(t){t=getHintElement(hints,t.target||t.srcElement);t&&null!=t.hintId&&(widget.changeActive(t.hintId),completion.options.completeOnSingleClick&&widget.pick())}),CodeMirror.on(hints,"mousedown",function(){setTimeout(function(){cm.focus()},20)}),CodeMirror.signal(data,"select",completions[this.selectedHint],hints.childNodes[this.selectedHint]),!0}function fetchHints(hint,cm,result,callback){hint.async?hint(cm,callback,result):(result=hint(cm,result))&&result.then?result.then(callback):callback(result)}Completion.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&CodeMirror.signal(this.data,"close"),this.widget&&this.widget.close(),CodeMirror.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(data,completion){completion=data.list[completion];completion.hint?completion.hint(this.cm,data,completion):this.cm.replaceRange(getText(completion),completion.from||data.from,completion.to||data.to,"complete"),CodeMirror.signal(data,"pick",completion),this.close()},cursorActivity:function(){this.debounce&&(cancelAnimationFrame(this.debounce),this.debounce=0);var self,pos=this.cm.getCursor(),line=this.cm.getLine(pos.line);pos.line!=this.startPos.line||line.length-pos.ch!=this.startLen-this.startPos.ch||pos.ch<this.startPos.ch||this.cm.somethingSelected()||!pos.ch||this.options.closeCharacters.test(line.charAt(pos.ch-1))?this.close():((self=this).debounce=requestAnimationFrame(function(){self.update()}),this.widget&&this.widget.disable())},update:function(first){var self,myTick;null!=this.tick&&(myTick=++(self=this).tick,fetchHints(this.options.hint,this.cm,this.options,function(data){self.tick==myTick&&self.finishUpdate(data,first)}))},finishUpdate:function(data,picked){this.data&&CodeMirror.signal(this.data,"update");picked=this.widget&&this.widget.picked||picked&&this.options.completeSingle;this.widget&&this.widget.close(),(this.data=data)&&data.list.length&&(picked&&1==data.list.length?this.pick(data,0):(this.widget=new Widget(this,data),CodeMirror.signal(data,"shown")))}},Widget.prototype={close:function(){var cm;this.completion.widget==this&&(this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap),cm=this.completion.cm,this.completion.options.closeOnUnfocus&&(cm.off("blur",this.onBlur),cm.off("focus",this.onFocus)),cm.off("scroll",this.onScroll))},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var widget=this;this.keyMap={Enter:function(){widget.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,node){i>=this.data.list.length?i=node?this.data.list.length-1:0:i<0&&(i=node?0:this.data.list.length-1),this.selectedHint!=i&&((node=this.hints.childNodes[this.selectedHint])&&(node.className=node.className.replace(" CodeMirror-hint-active","")),(node=this.hints.childNodes[this.selectedHint=i]).className+=" CodeMirror-hint-active",node.offsetTop<this.hints.scrollTop?this.hints.scrollTop=node.offsetTop-3:node.offsetTop+node.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=node.offsetTop+node.offsetHeight-this.hints.clientHeight+3),CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],node))},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},CodeMirror.registerHelper("hint","auto",{resolve:function resolveAutoHints(cm,resolved){var words,helpers=cm.getHelpers(resolved,"hint");if(helpers.length){resolved=function(cm,callback,options){var app=function applicableHelpers(cm,helpers){if(!cm.somethingSelected())return helpers;for(var result=[],i=0;i<helpers.length;i++)helpers[i].supportsSelection&&result.push(helpers[i]);return result}(cm,helpers);!function run(i){if(i==app.length)return callback(null);fetchHints(app[i],cm,options,function(result){result&&0<result.list.length?callback(result):run(i+1)})}(0)};return resolved.async=!0,resolved.supportsSelection=!0,resolved}return(words=cm.getHelper(cm.getCursor(),"hintWords"))?function(cm){return CodeMirror.hint.fromList(cm,{words:words})}:CodeMirror.hint.anyword?function(cm,options){return CodeMirror.hint.anyword(cm,options)}:function(){}}}),CodeMirror.registerHelper("hint","fromList",function(to,options){var term,cur=to.getCursor(),token=to.getTokenAt(cur),from=CodeMirror.Pos(cur.line,token.start),to=cur;token.start<cur.ch&&/\w/.test(token.string.charAt(cur.ch-token.start-1))?term=token.string.substr(0,cur.ch-token.start):(term="",from=cur);for(var found=[],i=0;i<options.words.length;i++){var word=options.words[i];word.slice(0,term.length)==term&&found.push(word)}if(found.length)return{list:found,from:from,to:to}}),CodeMirror.commands.autocomplete=CodeMirror.showHint;var defaultOptions={hint:CodeMirror.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};CodeMirror.defineOption("hintOptions",null)}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/hint/anyword-hint",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var WORD=/[\w$]+/;CodeMirror.registerHelper("hint","anyword",function(editor,options){for(var word=options&&options.word||WORD,range=options&&options.range||500,cur=editor.getCursor(),curLine=editor.getLine(cur.line),end=cur.ch,start=end;start&&word.test(curLine.charAt(start-1));)--start;for(var curWord=start!=end&&curLine.slice(start,end),list=options&&options.list||[],seen={},re=new RegExp(word.source,"g"),dir=-1;dir<=1;dir+=2)for(var line=cur.line,endLine=Math.min(Math.max(line+dir*range,editor.firstLine()),editor.lastLine())+dir;line!=endLine;line+=dir)for(var m,text=editor.getLine(line);m=re.exec(text);)line==cur.line&&m[0]===curWord||curWord&&0!=m[0].lastIndexOf(curWord,0)||Object.prototype.hasOwnProperty.call(seen,m[0])||(seen[m[0]]=!0,list.push(m[0]));return{list:list,from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/display/placeholder",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){function clearPlaceholder(cm){cm.state.placeholder&&(cm.state.placeholder.parentNode.removeChild(cm.state.placeholder),cm.state.placeholder=null)}function setPlaceholder(cm){clearPlaceholder(cm);var elt=cm.state.placeholder=document.createElement("pre");elt.style.cssText="height: 0; overflow: visible",elt.style.direction=cm.getOption("direction"),elt.className="CodeMirror-placeholder CodeMirror-line-like";var placeHolder=cm.getOption("placeholder");"string"==typeof placeHolder&&(placeHolder=document.createTextNode(placeHolder)),elt.appendChild(placeHolder),cm.display.lineSpace.insertBefore(elt,cm.display.lineSpace.firstChild)}function onBlur(cm){isEmpty(cm)&&setPlaceholder(cm)}function onChange(cm){var wrapper=cm.getWrapperElement(),empty=isEmpty(cm);wrapper.className=wrapper.className.replace(" CodeMirror-empty","")+(empty?" CodeMirror-empty":""),(empty?setPlaceholder:clearPlaceholder)(cm)}function isEmpty(cm){return 1===cm.lineCount()&&""===cm.getLine(0)}CodeMirror.defineOption("placeholder","",function(cm,val,wrapper){wrapper=wrapper&&wrapper!=CodeMirror.Init;val&&!wrapper?(cm.on("blur",onBlur),cm.on("change",onChange),cm.on("swapDoc",onChange),onChange(cm)):!val&&wrapper&&(cm.off("blur",onBlur),cm.off("change",onChange),cm.off("swapDoc",onChange),clearPlaceholder(cm),(wrapper=cm.getWrapperElement()).className=wrapper.className.replace(" CodeMirror-empty","")),val&&!cm.hasFocus()&&onBlur(cm)})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/runmode/runmode",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.runMode=function(string,modespec,callback,options){var tabSize,node,col,mode=CodeMirror.getMode(CodeMirror.defaults,modespec),ie_lt9=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<9);callback.appendChild&&(tabSize=options&&options.tabSize||CodeMirror.defaults.tabSize,col=0,(node=callback).innerHTML="",callback=function(text,style){if("\n"==text)return node.appendChild(document.createTextNode(ie_lt9?"\r":text)),void(col=0);for(var sp,content="",pos=0;;){var idx=text.indexOf("\t",pos);if(-1==idx){content+=text.slice(pos),col+=text.length-pos;break}col+=idx-pos,content+=text.slice(pos,idx);var size=tabSize-col%tabSize;col+=size;for(var i=0;i<size;++i)content+=" ";pos=idx+1}style?((sp=node.appendChild(document.createElement("span"))).className="cm-"+style.replace(/ +/g," cm-"),sp.appendChild(document.createTextNode(content))):node.appendChild(document.createTextNode(content))});for(var lines=CodeMirror.splitLines(string),state=options&&options.state||CodeMirror.startState(mode),i=0,e=lines.length;i<e;++i){i&&callback("\n");var stream=new CodeMirror.StringStream(lines[i]);for(!stream.string&&mode.blankLine&&mode.blankLine(state);!stream.eol();){var style=mode.token(stream,state);callback(stream.current(),style,i,stream.start,state),stream.start=stream.pos}}}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/search/searchcursor",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var doFold,noFold,Pos=CodeMirror.Pos;function ensureFlags(regexp,flags){for(var current=function regexpFlags(regexp){var flags=regexp.flags;return null!=flags?flags:(regexp.ignoreCase?"i":"")+(regexp.global?"g":"")+(regexp.multiline?"m":"")}(regexp),target=current,i=0;i<flags.length;i++)-1==target.indexOf(flags.charAt(i))&&(target+=flags.charAt(i));return current==target?regexp:new RegExp(regexp.source,target)}function searchRegexpForward(doc,regexp,start){regexp=ensureFlags(regexp,"g");for(var line=start.line,ch=start.ch,last=doc.lastLine();line<=last;line++,ch=0){regexp.lastIndex=ch;var match=doc.getLine(line),match=regexp.exec(match);if(match)return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}function lastMatchIn(string,regexp){for(var match,cutOff=0;;){regexp.lastIndex=cutOff;var newMatch=regexp.exec(string);if(!newMatch)return match;if((cutOff=(match=newMatch).index+(match[0].length||1))==string.length)return match}}function adjustPos(orig,folded,pos,foldFunc){if(orig.length==folded.length)return pos;for(var min=0,max=pos+Math.max(0,orig.length-folded.length);;){if(min==max)return min;var mid=min+max>>1,len=foldFunc(orig.slice(0,mid)).length;if(len==pos)return mid;pos<len?max=mid:min=1+mid}}function SearchCursor(doc,query,pos,options){var caseFold;this.atOccurrence=!1,this.doc=doc,pos=pos?doc.clipPos(pos):Pos(0,0),this.pos={from:pos,to:pos},"object"==typeof options?caseFold=options.caseFold:(caseFold=options,options=null),"string"==typeof query?(null==caseFold&&(caseFold=!1),this.matches=function(reverse,pos){return(reverse?function searchStringBackward(doc,query,start,caseFold){if(!query.length)return null;var fold=caseFold?doFold:noFold,lines=fold(query).split(/\r|\n\r?/);search:for(var line=start.line,ch=start.ch,first=doc.firstLine()-1+lines.length;first<=line;line--,ch=-1){var orig=doc.getLine(line),string=fold(orig=-1<ch?orig.slice(0,ch):orig);if(1==lines.length){var topString=string.lastIndexOf(lines[0]);if(-1!=topString)return{from:Pos(line,adjustPos(orig,string,topString,fold)),to:Pos(line,adjustPos(orig,string,topString+lines[0].length,fold))}}else{var lastLine=lines[lines.length-1];if(string.slice(0,lastLine.length)==lastLine){for(var i=1,start=line-lines.length+1;i<lines.length-1;i++)if(fold(doc.getLine(start+i))!=lines[i])continue search;var top=doc.getLine(line+1-lines.length),topString=fold(top);if(topString.slice(topString.length-lines[0].length)==lines[0])return{from:Pos(line+1-lines.length,adjustPos(top,topString,top.length-lines[0].length,fold)),to:Pos(line,adjustPos(orig,string,lastLine.length,fold))}}}}}:function searchStringForward(doc,query,start,caseFold){if(!query.length)return null;var fold=caseFold?doFold:noFold,lines=fold(query).split(/\r|\n\r?/);search:for(var line=start.line,ch=start.ch,last=doc.lastLine()+1-lines.length;line<=last;line++,ch=0){var orig=doc.getLine(line).slice(ch),string=fold(orig);if(1==lines.length){var lastLine=string.indexOf(lines[0]);if(-1!=lastLine){start=adjustPos(orig,string,lastLine,fold)+ch;return{from:Pos(line,adjustPos(orig,string,lastLine,fold)+ch),to:Pos(line,adjustPos(orig,string,lastLine+lines[0].length,fold)+ch)}}}else{var cutFrom=string.length-lines[0].length;if(string.slice(cutFrom)==lines[0]){for(var i=1;i<lines.length-1;i++)if(fold(doc.getLine(line+i))!=lines[i])continue search;var end=doc.getLine(line+lines.length-1),endString=fold(end),lastLine=lines[lines.length-1];if(endString.slice(0,lastLine.length)==lastLine)return{from:Pos(line,adjustPos(orig,string,cutFrom,fold)+ch),to:Pos(line+lines.length-1,adjustPos(end,endString,lastLine.length,fold))}}}}})(doc,query,pos,caseFold)}):(query=ensureFlags(query,"gm"),options&&!1===options.multiline?this.matches=function(reverse,pos){return(reverse?function searchRegexpBackward(doc,regexp,start){regexp=ensureFlags(regexp,"g");for(var line=start.line,ch=start.ch,first=doc.firstLine();first<=line;line--,ch=-1){var match=doc.getLine(line),match=lastMatchIn(match=-1<ch?match.slice(0,ch):match,regexp);if(match)return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}:searchRegexpForward)(doc,query,pos)}:this.matches=function(reverse,pos){return(reverse?function searchRegexpBackwardMultiline(doc,regexp,start){regexp=ensureFlags(regexp,"gm");for(var chunk=1,line=start.line,first=doc.firstLine();first<=line;){for(var i=0;i<chunk;i++)var curLine=doc.getLine(line--),string=null==string?curLine.slice(0,start.ch):curLine+"\n"+string;chunk*=2;var match=lastMatchIn(string,regexp);if(match){var startCh=string.slice(0,match.index).split("\n"),inside=match[0].split("\n"),startLine=line+startCh.length,startCh=startCh[startCh.length-1].length;return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,1==inside.length?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}}:function searchRegexpForwardMultiline(doc,regexp,start){if(!function maybeMultiline(regexp){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(regexp.source)}(regexp))return searchRegexpForward(doc,regexp,start);regexp=ensureFlags(regexp,"gm");for(var chunk=1,line=start.line,last=doc.lastLine();line<=last;){for(var i=0;i<chunk&&!(last<line);i++)var curLine=doc.getLine(line++),string=null==string?curLine:string+"\n"+curLine;chunk*=2,regexp.lastIndex=start.ch;var match=regexp.exec(string);if(match){var startCh=string.slice(0,match.index).split("\n"),inside=match[0].split("\n"),startLine=start.line+startCh.length-1,startCh=startCh[startCh.length-1].length;return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,1==inside.length?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}})(doc,query,pos)})}noFold=String.prototype.normalize?(doFold=function(str){return str.normalize("NFD").toLowerCase()},function(str){return str.normalize("NFD")}):(doFold=function(str){return str.toLowerCase()},function(str){return str}),SearchCursor.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(reverse){for(var result=this.matches(reverse,this.doc.clipPos(reverse?this.pos.from:this.pos.to));result&&0==CodeMirror.cmpPos(result.from,result.to);)reverse?result.from.ch?result.from=Pos(result.from.line,result.from.ch-1):result=result.from.line==this.doc.firstLine()?null:this.matches(reverse,this.doc.clipPos(Pos(result.from.line-1))):result.to.ch<this.doc.getLine(result.to.line).length?result.to=Pos(result.to.line,result.to.ch+1):result=result.to.line==this.doc.lastLine()?null:this.matches(reverse,Pos(result.to.line+1,0));if(result)return this.pos=result,this.atOccurrence=!0,this.pos.match||!0;var end=Pos(reverse?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:end,to:end},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(lines,origin){this.atOccurrence&&(lines=CodeMirror.splitLines(lines),this.doc.replaceRange(lines,this.pos.from,this.pos.to,origin),this.pos.to=Pos(this.pos.from.line+lines.length-1,lines[lines.length-1].length+(1==lines.length?this.pos.from.ch:0)))}},CodeMirror.defineExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this.doc,query,pos,caseFold)}),CodeMirror.defineDocExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this,query,pos,caseFold)}),CodeMirror.defineExtension("selectMatches",function(query,caseFold){for(var ranges=[],cur=this.getSearchCursor(query,this.getCursor("from"),caseFold);cur.findNext()&&!(0<CodeMirror.cmpPos(cur.to(),this.getCursor("to")));)ranges.push({anchor:cur.from(),head:cur.to()});ranges.length&&this.setSelections(ranges,0)})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/dialog/dialog",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){function dialogDiv(dialog,template,bottom){var wrap=dialog.getWrapperElement(),dialog=wrap.appendChild(document.createElement("div"));return dialog.className=bottom?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof template?dialog.innerHTML=template:dialog.appendChild(template),CodeMirror.addClass(wrap,"dialog-opened"),dialog}function closeNotification(cm,newVal){cm.state.currentNotificationClose&&cm.state.currentNotificationClose(),cm.state.currentNotificationClose=newVal}CodeMirror.defineExtension("openDialog",function(button,callback,options){options=options||{},closeNotification(this,null);var dialog=dialogDiv(this,button,options.bottom),closed=!1,me=this;function close(newVal){"string"==typeof newVal?inp.value=newVal:closed||(closed=!0,CodeMirror.rmClass(dialog.parentNode,"dialog-opened"),dialog.parentNode.removeChild(dialog),me.focus(),options.onClose&&options.onClose(dialog))}var inp=dialog.getElementsByTagName("input")[0];return inp?(inp.focus(),options.value&&(inp.value=options.value,!1!==options.selectValueOnOpen&&inp.select()),options.onInput&&CodeMirror.on(inp,"input",function(e){options.onInput(e,inp.value,close)}),options.onKeyUp&&CodeMirror.on(inp,"keyup",function(e){options.onKeyUp(e,inp.value,close)}),CodeMirror.on(inp,"keydown",function(e){options&&options.onKeyDown&&options.onKeyDown(e,inp.value,close)||((27==e.keyCode||!1!==options.closeOnEnter&&13==e.keyCode)&&(inp.blur(),CodeMirror.e_stop(e),close()),13==e.keyCode&&callback(inp.value,e))}),!1!==options.closeOnBlur&&CodeMirror.on(inp,"blur",close)):(button=dialog.getElementsByTagName("button")[0])&&(CodeMirror.on(button,"click",function(){close(),me.focus()}),!1!==options.closeOnBlur&&CodeMirror.on(button,"blur",close),button.focus()),close}),CodeMirror.defineExtension("openConfirm",function(template,callbacks,options){closeNotification(this,null);var dialog=dialogDiv(this,template,options&&options.bottom),buttons=dialog.getElementsByTagName("button"),closed=!1,me=this,blurring=1;function close(){closed||(closed=!0,CodeMirror.rmClass(dialog.parentNode,"dialog-opened"),dialog.parentNode.removeChild(dialog),me.focus())}buttons[0].focus();for(var i=0;i<buttons.length;++i){var b=buttons[i];!function(callback){CodeMirror.on(b,"click",function(e){CodeMirror.e_preventDefault(e),close(),callback&&callback(me)})}(callbacks[i]),CodeMirror.on(b,"blur",function(){--blurring,setTimeout(function(){blurring<=0&&close()},200)}),CodeMirror.on(b,"focus",function(){++blurring})}}),CodeMirror.defineExtension("openNotification",function(template,duration){closeNotification(this,close);var doneTimer,dialog=dialogDiv(this,template,duration&&duration.bottom),closed=!1,duration=duration&&void 0!==duration.duration?duration.duration:5e3;function close(){closed||(closed=!0,clearTimeout(doneTimer),CodeMirror.rmClass(dialog.parentNode,"dialog-opened"),dialog.parentNode.removeChild(dialog))}return CodeMirror.on(dialog,"click",function(e){CodeMirror.e_preventDefault(e),close()}),duration&&(doneTimer=setTimeout(close,duration)),close})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("cm/addon/search/search",["../../lib/codemirror","./searchcursor","../dialog/dialog"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";function SearchState(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}function getSearchState(cm){return cm.state.search||(cm.state.search=new SearchState)}function queryCaseInsensitive(query){return"string"==typeof query&&query==query.toLowerCase()}function getSearchCursor(cm,query,pos){return cm.getSearchCursor(query,pos,{caseFold:queryCaseInsensitive(query),multiline:!0})}function dialog(cm,text,shortText,deflt,f){cm.openDialog?cm.openDialog(text,f,{value:deflt,selectValueOnOpen:!0}):f(prompt(shortText,deflt))}function parseString(string){return string.replace(/\\([nrt\\])/g,function(match,ch){return"n"==ch?"\n":"r"==ch?"\r":"t"==ch?"\t":"\\"==ch?"\\":match})}function parseQuery(query){var isRE=query.match(/^\/(.*)\/([a-z]*)$/);if(isRE)try{query=new RegExp(isRE[1],-1==isRE[2].indexOf("i")?"":"i")}catch(e){}else query=parseString(query);return query=("string"==typeof query?""==query:query.test(""))?/x^/:query}function startSearch(cm,state,query){state.queryText=query,state.query=parseQuery(query),cm.removeOverlay(state.overlay,queryCaseInsensitive(state.query)),state.overlay=function searchOverlay(query,caseInsensitive){return"string"==typeof query?query=new RegExp(query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),caseInsensitive?"gi":"g"):query.global||(query=new RegExp(query.source,query.ignoreCase?"gi":"g")),{token:function(stream){query.lastIndex=stream.pos;var match=query.exec(stream.string);if(match&&match.index==stream.pos)return stream.pos+=match[0].length||1,"searching";match?stream.pos=match.index:stream.skipToEnd()}}}(state.query,queryCaseInsensitive(state.query)),cm.addOverlay(state.overlay),cm.showMatchesOnScrollbar&&(state.annotate&&(state.annotate.clear(),state.annotate=null),state.annotate=cm.showMatchesOnScrollbar(state.query,queryCaseInsensitive(state.query)))}function doSearch(cm,rev,persistent,immediate){var state=getSearchState(cm);if(state.query)return findNext(cm,rev);var hiding,searchNext,q=cm.getSelection()||state.lastQuery;q instanceof RegExp&&"x^"==q.source&&(q=null),persistent&&cm.openDialog?(hiding=null,searchNext=function(query,event){CodeMirror.e_stop(event),query&&(query!=state.queryText&&(startSearch(cm,state,query),state.posFrom=state.posTo=cm.getCursor()),hiding&&(hiding.style.opacity=1),findNext(cm,event.shiftKey,function(_,to){var dialog;to.line<3&&document.querySelector&&(dialog=cm.display.wrapper.querySelector(".CodeMirror-dialog"))&&dialog.getBoundingClientRect().bottom-4>cm.cursorCoords(to,"window").top&&((hiding=dialog).style.opacity=.4)}))},function persistentDialog(cm,text,deflt,onEnter,onKeyDown){cm.openDialog(text,onEnter,{value:deflt,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){clearSearch(cm)},onKeyDown:onKeyDown})}(cm,getQueryDialog(cm),q,searchNext,function(event,query){var cmd=CodeMirror.keyName(event),extra=cm.getOption("extraKeys"),cmd=extra&&extra[cmd]||CodeMirror.keyMap[cm.getOption("keyMap")][cmd];"findNext"==cmd||"findPrev"==cmd||"findPersistentNext"==cmd||"findPersistentPrev"==cmd?(CodeMirror.e_stop(event),startSearch(cm,getSearchState(cm),query),cm.execCommand(cmd)):"find"!=cmd&&"findPersistent"!=cmd||(CodeMirror.e_stop(event),searchNext(query,event))}),immediate&&q&&(startSearch(cm,state,q),findNext(cm,rev))):dialog(cm,getQueryDialog(cm),"Search for:",q,function(query){query&&!state.query&&cm.operation(function(){startSearch(cm,state,query),state.posFrom=state.posTo=cm.getCursor(),findNext(cm,rev)})})}function findNext(cm,rev,callback){cm.operation(function(){var state=getSearchState(cm),cursor=getSearchCursor(cm,state.query,rev?state.posFrom:state.posTo);(cursor.find(rev)||(cursor=getSearchCursor(cm,state.query,rev?CodeMirror.Pos(cm.lastLine()):CodeMirror.Pos(cm.firstLine(),0))).find(rev))&&(cm.setSelection(cursor.from(),cursor.to()),cm.scrollIntoView({from:cursor.from(),to:cursor.to()},20),state.posFrom=cursor.from(),state.posTo=cursor.to(),callback&&callback(cursor.from(),cursor.to()))})}function clearSearch(cm){cm.operation(function(){var state=getSearchState(cm);state.lastQuery=state.query,state.query&&(state.query=state.queryText=null,cm.removeOverlay(state.overlay),state.annotate&&(state.annotate.clear(),state.annotate=null))})}function getQueryDialog(cm){return'<span class="CodeMirror-search-label">'+cm.phrase("Search:")+'</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">'+cm.phrase("(Use /re/ syntax for regexp search)")+"</span>"}function replaceAll(cm,query,text){cm.operation(function(){for(var match,cursor=getSearchCursor(cm,query);cursor.findNext();)"string"!=typeof query?(match=cm.getRange(cursor.from(),cursor.to()).match(query),cursor.replace(text.replace(/\$(\d)/g,function(_,i){return match[i]}))):cursor.replace(text)})}function replace(cm,all){var query,dialogText;cm.getOption("readOnly")||(query=cm.getSelection()||getSearchState(cm).lastQuery,dialogText='<span class="CodeMirror-search-label">'+(all?cm.phrase("Replace all:"):cm.phrase("Replace:"))+"</span>",dialog(cm,dialogText+function getReplaceQueryDialog(cm){return' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">'+cm.phrase("(Use /re/ syntax for regexp search)")+"</span>"}(cm),dialogText,query,function(query){query&&(query=parseQuery(query),dialog(cm,function getReplacementQueryDialog(cm){return'<span class="CodeMirror-search-label">'+cm.phrase("With:")+'</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/>'}(cm),cm.phrase("Replace with:"),"",function(text){var cursor,advance,doReplace;text=parseString(text),all?replaceAll(cm,query,text):(clearSearch(cm),cursor=getSearchCursor(cm,query,cm.getCursor("from")),advance=function(){var match,start=cursor.from();!(match=cursor.findNext())&&(cursor=getSearchCursor(cm,query),!(match=cursor.findNext())||start&&cursor.from().line==start.line&&cursor.from().ch==start.ch)||(cm.setSelection(cursor.from(),cursor.to()),cm.scrollIntoView({from:cursor.from(),to:cursor.to()}),function confirmDialog(cm,text,shortText,fs){cm.openConfirm?cm.openConfirm(text,fs):confirm(shortText)&&fs[0]()}(cm,function getDoReplaceConfirm(cm){return'<span class="CodeMirror-search-label">'+cm.phrase("Replace?")+"</span> <button>"+cm.phrase("Yes")+"</button> <button>"+cm.phrase("No")+"</button> <button>"+cm.phrase("All")+"</button> <button>"+cm.phrase("Stop")+"</button> "}(cm),cm.phrase("Replace?"),[function(){doReplace(match)},advance,function(){replaceAll(cm,query,text)}]))},doReplace=function(match){cursor.replace("string"==typeof query?text:text.replace(/\$(\d)/g,function(_,i){return match[i]})),advance()},advance())}))}))}CodeMirror.commands.find=function(cm){clearSearch(cm),doSearch(cm)},CodeMirror.commands.findPersistent=function(cm){clearSearch(cm),doSearch(cm,!1,!0)},CodeMirror.commands.findPersistentNext=function(cm){doSearch(cm,!1,!0,!0)},CodeMirror.commands.findPersistentPrev=function(cm){doSearch(cm,!0,!0,!0)},CodeMirror.commands.findNext=doSearch,CodeMirror.commands.findPrev=function(cm){doSearch(cm,!0)},CodeMirror.commands.clearSearch=clearSearch,CodeMirror.commands.replace=replace,CodeMirror.commands.replaceAll=function(cm){replace(cm,!0)}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("cm/addon/search/jump-to-line",["../../lib/codemirror","../dialog/dialog"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";function interpretLine(cm,string){var num=Number(string);return/^[-+]/.test(string)?cm.getCursor().line+num:num-1}CodeMirror.commands.jumpToLine=function(cm){var cur=cm.getCursor();!function dialog(cm,text,shortText,deflt,f){cm.openDialog?cm.openDialog(text,f,{value:deflt,selectValueOnOpen:!0}):f(prompt(shortText,deflt))}(cm,function getJumpDialog(cm){return cm.phrase("Jump to line:")+' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">'+cm.phrase("(Use line:column or scroll% syntax)")+"</span>"}(cm),cm.phrase("Jump to line:"),cur.line+1+":"+cur.ch,function(posStr){var match,line;posStr&&((match=/^\s*([\+\-]?\d+)\s*\:\s*(\d+)\s*$/.exec(posStr))?cm.setCursor(interpretLine(cm,match[1]),Number(match[2])):(match=/^\s*([\+\-]?\d+(\.\d+)?)\%\s*/.exec(posStr))?(line=Math.round(cm.lineCount()*Number(match[1])/100),/^[-+]/.test(match[1])&&(line=cur.line+line+1),cm.setCursor(line-1,cur.ch)):(match=/^\s*\:?\s*([\+\-]?\d+)\s*/.exec(posStr))&&cm.setCursor(interpretLine(cm,match[1]),cur.ch))})},CodeMirror.keyMap.default["Alt-G"]="jumpToLine"}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/hover/text-hover",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";function rm(elt){elt.parentNode&&elt.parentNode.removeChild(elt)}function showTooltipFor(e,content,node,state,cm){var tooltip=function showTooltip(e,content){var tt=document.createElement("div");function position(e){if(!tt.parentNode)return CodeMirror.off(document,"mousemove",position);tt.style.top=Math.max(0,e.clientY-tt.offsetHeight-5)+"px",tt.style.left=e.clientX+5+"px"}return tt.className="CodeMirror-hover-tooltip","string"==typeof content&&(content=document.createTextNode(content)),tt.appendChild(content),document.body.appendChild(tt),CodeMirror.on(document,"mousemove",position),position(e),null!=tt.style.opacity&&(tt.style.opacity=1),tt}(e,content);function hide(){CodeMirror.off(node,"mouseout",hide),CodeMirror.off(node,"click",hide),node.className=node.className.replace(HOVER_CLASS,""),tooltip&&(function hideTooltip(tt){tt.parentNode&&(null==tt.style.opacity&&rm(tt),tt.style.opacity=0,setTimeout(function(){rm(tt)},600))}(tooltip),tooltip=null),cm.removeKeyMap(state.keyMap)}var poll=setInterval(function(){if(tooltip)for(var n=node;;n=n.parentNode){if(n==document.body)return;if(!n){hide();break}}if(!tooltip)return clearInterval(poll)},400);CodeMirror.on(node,"mouseout",hide),CodeMirror.on(node,"click",hide),state.keyMap={Esc:hide},cm.addKeyMap(state.keyMap)}function TextHoverState(cm,options){this.options=options,this.timeout=null,options.delay?this.onMouseOver=function(e){!function onMouseOverWithDelay(cm,e){var newE,state=cm.state.textHover,delay=state.options.delay;clearTimeout(state.timeout),e.srcElement&&(newE={srcElement:e.srcElement,clientX:e.clientX,clientY:e.clientY},e=newE),state.timeout=setTimeout(function(){onMouseOver(cm,e)},delay)}(cm,e)}:this.onMouseOver=function(e){onMouseOver(cm,e)},this.keyMap=null}function onMouseOver(cm,e){var state,data,content,node=e.target||e.srcElement;node&&(state=cm.state.textHover,data=function getTokenAndPosAt(cm,e){for(var node=e.target||e.srcElement,text=node.innerText||node.textContent,i=0;i<nearby.length;i+=2){var pos=cm.coordsChar({left:e.clientX+nearby[i],top:e.clientY+nearby[i+1]}),token=cm.getTokenAt(pos);if(token&&token.string===text)return{token:token,pos:pos}}}(cm,e),(content=state.options.getTextHover(cm,data,e))&&(node.className+=HOVER_CLASS,"function"==typeof content?content(showTooltipFor,data,e,node,state,cm):showTooltipFor(e,content,node,state,cm)))}var HOVER_CLASS,nearby;HOVER_CLASS=" CodeMirror-hover",nearby=[0,0,0,5,0,-5,5,0,-5,0],CodeMirror.defineOption("textHover",!1,function optionHandler(cm,state,old){old&&old!=CodeMirror.Init&&(CodeMirror.off(cm.getWrapperElement(),"mouseover",cm.state.textHover.onMouseOver),delete cm.state.textHover),state&&(state=cm.state.textHover=new TextHoverState(cm,function parseOptions(cm,options){if(options instanceof Function)return{getTextHover:options};if((options=!options||!0===options?{}:options).getTextHover||(options.getTextHover=cm.getHelper(CodeMirror.Pos(0,0),"textHover")),!options.getTextHover)throw new Error("Required option 'getTextHover' missing (text-hover addon)");return options}(cm,state)),CodeMirror.on(cm.getWrapperElement(),"mouseover",state.onMouseOver))})}),define("cm/addon/hover/prolog-hover",["../../lib/codemirror","jquery","laconic"],function(CodeMirror,$){"use strict";var pathTranslations={},tokenHelp={goal_built_in:function(data,cm){return data?$.el.div(predName(data),cm.tokenInfo(data)):"Built-in predicate"},goal_global:function(data,cm){return data?$.el.div(predName(data),cm.tokenInfo(data)):"Global predicate"},goal_autoload:function(data,cm){return data?$.el.div(predName(data)," (autoload from ",fileName(data),"): ",cm.tokenInfo(data)):"Autoloaded predicate"},goal_imported:function(data,cm){return data?$.el.div(predName(data)," (imported from ",fileName(data),"): ",cm.tokenInfo(data)):"Imported predicate"},goal_recursion:"Recursive call",goal_dynamic:"Dynamic predicate",goal_undefined:"Undefined predicate",goal_local:function(data,cm){return localDef("predicate",data)},goal_constraint:function(data,cm){return localDef("CHR constraint",data)},head_unreferenced:"Predicate is not called",unused_import:"Imported predicate is not used",undefined_import:"Imported predicate is not defined",head_constraint:"CHR constraint",file:function(data,cm){return data?(addFileTranslation(0,data.text,data.path),$.el.div("File: ",$.el.span({class:"file-path"},data.path))):"File name"},file_no_depends:function(data,cm){return data?(addFileTranslation(0,data.text,data.path),$.el.div("File: ",$.el.span({class:"file-path"},data.path),$.el.div({class:"hover-remark"},"does not resolve any dependencies"))):"File name (does not resolve any dependencies)"},error:function(data,cm){return data&&data.expected?$.el.div("error: ",$.el.strong(data.expected)," expected"):"error"},singleton:"Variable appearing only once",codes:"List of Unicode code points (integers)",chars:"List of one-character atoms",string:"Packed string (SWI7, use `text` for a list of codes)",qatom:"Quoted atom",uatom:"Uppercase atom due to var_prefix flag",tag:"Tag of a SWI7 dict",ext_quant:"Existential quantification operator",instantiation_error:"No variable allowed here",function:"Arithmetic function",no_function:"Undefined arithmetic function",string_terminal:"Terminal (DCG)",format_string:"Format string",html:"HTML element",html_attribute:"HTML element attribute",html_call:"Call HTML rule",html_raw:"Include raw HTML",head:null,control:null,fullstop:null,var:null,int:null,float:null,number:null,atom:null,functor:null,comment:null,neck:null,operator:null,sep:null,list_open:null,list_close:null,dict_open:null,dict_close:null};function predName(data){return $.el.span({class:"pred-name"},data.text+"/"+data.arity)}function addFileTranslation(cm,text,path){pathTranslations[path]=text}function fileName(data){var last;return pathTranslations[data.file]||((last=data.file.lastIndexOf("/"))?data.file.substring(last+1):data.file)}function localDef(type,data){return data&&data.file?$.el.div(capitalizeFirstLetter(type)+" included from ",$.el.span({class:"file-path"},data.file)):data&&data.line?capitalizeFirstLetter(type)+" defined in line "+data.line:"Locally defined "+type}function capitalizeFirstLetter(string){return string[0].toUpperCase()+string.slice(1)}CodeMirror.registerHelper("textHover","prolog",function(r,et,node){if(et){var token=et.token,help=tokenHelp[token.type];if(void 0===help)return(et=r.getEnrichedToken(token))?et.summary&&"ask"===et.info?$.el.div(et.summary,r.tokenInfo(et)):et.summary?$.el.div(et.summary):$.el.div(token.type):$.el.div(token.type);if("function"==typeof help){r=help(r.getEnrichedToken(token),r);return"string"==typeof r?$.el.div(r):r}if("string"==typeof help)return $.el.div(help)}return null})}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/addon/hint/show-context-info",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){var contextInfo=null;CodeMirror.attachContextInfo=function(data){CodeMirror.on(data,"select",function(box,hints){hints=hints.parentNode;var information=null;(information=box.info?box.info(box):information)?(box=hints.getBoundingClientRect(),null==contextInfo&&((contextInfo=document.createElement("div")).className="CodeMirror-hints-contextInfo",document.body.appendChild(contextInfo)),contextInfo.innerHTML="",contextInfo.style.top=hints.style.top,contextInfo.style.left=box.right+"px","string"==typeof information?contextInfo.innerHTML=information:contextInfo.appendChild(information),contextInfo.style.display="block"):null!=contextInfo&&(contextInfo.innerHTML="",contextInfo.style.display="none")}),CodeMirror.on(data,"close",function(){null!=contextInfo&&contextInfo.parentNode.removeChild(contextInfo),contextInfo=null})},CodeMirror.showContextInfo=function(getHints){return function(cm,showHints,data){data=getHints(cm,data=data||showHints);return CodeMirror.attachContextInfo(data),data}}}),function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../lib/codemirror")):"function"==typeof define&&define.amd?define("cm/keymap/emacs",["../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var Pos=CodeMirror.Pos;function posEq(a,b){return a.line==b.line&&a.ch==b.ch}var killRing=[];function addToRing(str){killRing.push(str),50<killRing.length&&killRing.shift()}function getFromRing(n){return killRing[killRing.length-(n?Math.min(n,1):1)]||""}var lastKill=null;function kill(cm,from,to,ring,text){null==text&&(text=cm.getRange(from,to)),"grow"==ring&&lastKill&&lastKill.cm==cm&&posEq(from,lastKill.pos)&&cm.isClean(lastKill.gen)?function growRingTop(str){killRing.length?killRing[killRing.length-1]+=str:addToRing(str)}(text):!1!==ring&&addToRing(text),cm.replaceRange("",from,to,"+delete"),lastKill="grow"==ring?{cm:cm,pos:from,gen:cm.changeGeneration()}:null}function byChar(cm,pos,dir){return cm.findPosH(pos,dir,"char",!0)}function byWord(cm,pos,dir){return cm.findPosH(pos,dir,"word",!0)}function byLine(cm,pos,dir){return cm.findPosV(pos,dir,"line",cm.doc.sel.goalColumn)}function byPage(cm,pos,dir){return cm.findPosV(pos,dir,"page",cm.doc.sel.goalColumn)}function byParagraph(cm,pos,dir){for(var no=pos.line,line=cm.getLine(no),sawText=/\S/.test(dir<0?line.slice(0,pos.ch):line.slice(pos.ch)),fst=cm.firstLine(),lst=cm.lastLine();;){if((no+=dir)<fst||lst<no)return cm.clipPos(Pos(no-dir,dir<0?0:null));line=cm.getLine(no);if(/\S/.test(line))sawText=!0;else if(sawText)return Pos(no,0)}}function bySentence(cm,pos,dir){for(var line=pos.line,ch=pos.ch,text=cm.getLine(pos.line),sawWord=!1;;){var next=text.charAt(ch+(dir<0?-1:0));if(next){if(sawWord&&/[!?.]/.test(next))return Pos(line,ch+(0<dir?1:0));sawWord=sawWord||/\w/.test(next),ch+=dir}else{if(line==(dir<0?cm.firstLine():cm.lastLine()))return Pos(line,ch);if(text=cm.getLine(line+dir),!/\S/.test(text))return Pos(line,ch);line+=dir,ch=dir<0?text.length:0}}}function byExpr(cm,pos,dir){var wrap;if(cm.findMatchingBracket&&(wrap=cm.findMatchingBracket(pos,{strict:!0}))&&wrap.match&&(wrap.forward?1:-1)==dir)return 0<dir?Pos(wrap.to.line,wrap.to.ch+1):wrap.to;for(var first=!0;;first=!1){var newPos=cm.getTokenAt(pos),after=Pos(pos.line,dir<0?newPos.start:newPos.end);if(!(first&&0<dir&&newPos.end==pos.ch)&&/\w/.test(newPos.string))return after;newPos=cm.findPosH(after,dir,"char");if(posEq(after,newPos))return pos;pos=newPos}}function getPrefix(cm,precise){var digits=cm.state.emacsPrefix;return digits?(clearPrefix(cm),"-"==digits?-1:Number(digits)):precise?null:1}function repeated(cmd){var f="string"==typeof cmd?function(cm){cm.execCommand(cmd)}:cmd;return function(cm){var prefix=getPrefix(cm);f(cm);for(var i=1;i<prefix;++i)f(cm)}}function findEnd(cm,pos,by,dir){var prefix=getPrefix(cm);prefix<0&&(dir=-dir,prefix=-prefix);for(var i=0;i<prefix;++i){var newPos=by(cm,pos,dir);if(posEq(newPos,pos))break;pos=newPos}return pos}function move(by,dir){function f(cm){cm.extendSelection(findEnd(cm,cm.getCursor(),by,dir))}return f.motion=!0,f}function killTo(cm,by,dir,ring){for(var cursor,selections=cm.listSelections(),i=selections.length;i--;)kill(cm,cursor=selections[i].head,findEnd(cm,cursor,by,dir),ring)}function killRegion(cm,ring){if(cm.somethingSelected()){for(var selection,selections=cm.listSelections(),i=selections.length;i--;)kill(cm,(selection=selections[i]).anchor,selection.head,ring);return!0}}function addPrefix(cm,digit){cm.state.emacsPrefix?"-"!=digit&&(cm.state.emacsPrefix+=digit):(cm.state.emacsPrefix=digit,cm.on("keyHandled",maybeClearPrefix),cm.on("inputRead",maybeDuplicateInput))}var prefixPreservingKeys={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function maybeClearPrefix(cm,arg){cm.state.emacsPrefixMap||prefixPreservingKeys.hasOwnProperty(arg)||clearPrefix(cm)}function clearPrefix(cm){cm.state.emacsPrefix=null,cm.off("keyHandled",maybeClearPrefix),cm.off("inputRead",maybeDuplicateInput)}function maybeDuplicateInput(cm,event){var dup=getPrefix(cm);if(1<dup&&"+input"==event.origin){for(var one=event.text.join("\n"),txt="",i=1;i<dup;++i)txt+=one;cm.replaceSelection(txt)}}function maybeRemovePrefixMap(cm,arg){"string"==typeof arg&&(/^\d$/.test(arg)||"Ctrl-U"==arg)||(cm.removeKeyMap(prefixMap),cm.state.emacsPrefixMap=!1,cm.off("keyHandled",maybeRemovePrefixMap),cm.off("inputRead",maybeRemovePrefixMap))}function setMark(cm){cm.setCursor(cm.getCursor()),cm.setExtending(!cm.getExtending()),cm.on("change",function(){cm.setExtending(!1)})}function clearMark(cm){cm.setExtending(!1),cm.setCursor(cm.getCursor())}function operateOnWord(cm,op){var start=cm.getCursor(),end=cm.findPosH(start,1,"word");cm.replaceRange(op(cm.getRange(start,end)),start,end),cm.setCursor(end)}CodeMirror.emacs={kill:kill,killRegion:killRegion,repeated:repeated};var keyMap=CodeMirror.keyMap.emacs=CodeMirror.normalizeKeyMap({"Ctrl-W":function(cm){kill(cm,cm.getCursor("start"),cm.getCursor("end"),!0)},"Ctrl-K":repeated(function(cm){var start=cm.getCursor(),end=cm.clipPos(Pos(start.line)),text=cm.getRange(start,end);/\S/.test(text)||(text+="\n",end=Pos(start.line+1,0)),kill(cm,start,end,"grow",text)}),"Alt-W":function(cm){addToRing(cm.getSelection()),clearMark(cm)},"Ctrl-Y":function(cm){var start=cm.getCursor();cm.replaceRange(getFromRing(getPrefix(cm)),start,start,"paste"),cm.setSelection(start,cm.getCursor())},"Alt-Y":function(cm){cm.replaceSelection(function popFromRing(){return 1<killRing.length&&killRing.pop(),getFromRing()}(),"around","paste")},"Ctrl-Space":setMark,"Ctrl-Shift-2":setMark,"Ctrl-F":move(byChar,1),"Ctrl-B":move(byChar,-1),Right:move(byChar,1),Left:move(byChar,-1),"Ctrl-D":function(cm){killTo(cm,byChar,1,!1)},Delete:function(cm){killRegion(cm,!1)||killTo(cm,byChar,1,!1)},"Ctrl-H":function(cm){killTo(cm,byChar,-1,!1)},Backspace:function(cm){killRegion(cm,!1)||killTo(cm,byChar,-1,!1)},"Alt-F":move(byWord,1),"Alt-B":move(byWord,-1),"Alt-Right":move(byWord,1),"Alt-Left":move(byWord,-1),"Alt-D":function(cm){killTo(cm,byWord,1,"grow")},"Alt-Backspace":function(cm){killTo(cm,byWord,-1,"grow")},"Ctrl-N":move(byLine,1),"Ctrl-P":move(byLine,-1),Down:move(byLine,1),Up:move(byLine,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":move(byPage,-1),"Ctrl-V":move(byPage,1),PageUp:move(byPage,-1),PageDown:move(byPage,1),"Ctrl-Up":move(byParagraph,-1),"Ctrl-Down":move(byParagraph,1),"Alt-A":move(bySentence,-1),"Alt-E":move(bySentence,1),"Alt-K":function(cm){killTo(cm,bySentence,1,"grow")},"Ctrl-Alt-K":function(cm){killTo(cm,byExpr,1,"grow")},"Ctrl-Alt-Backspace":function(cm){killTo(cm,byExpr,-1,"grow")},"Ctrl-Alt-F":move(byExpr,1),"Ctrl-Alt-B":move(byExpr,-1),"Shift-Ctrl-Alt-2":function(cm){var cursor=cm.getCursor();cm.setSelection(findEnd(cm,cursor,byExpr,1),cursor)},"Ctrl-Alt-T":function(cm){var leftStart=byExpr(cm,cm.getCursor(),-1),leftEnd=byExpr(cm,leftStart,1),rightEnd=byExpr(cm,leftEnd,1),rightStart=byExpr(cm,rightEnd,-1);cm.replaceRange(cm.getRange(rightStart,rightEnd)+cm.getRange(leftEnd,rightStart)+cm.getRange(leftStart,leftEnd),leftStart,rightEnd)},"Ctrl-Alt-U":repeated(function toEnclosingExpr(cm){for(var pos=cm.getCursor(),line=pos.line,ch=pos.ch,stack=[];line>=cm.firstLine();){for(var text=cm.getLine(line),i=null==ch?text.length:ch;0<i;)if(")"==(ch=text.charAt(--i)))stack.push("(");else if("]"==ch)stack.push("[");else if("}"==ch)stack.push("{");else if(/[\(\{\[]/.test(ch)&&(!stack.length||stack.pop()!=ch))return cm.extendSelection(Pos(line,i));--line,ch=null}}),"Alt-Space":function(cm){for(var pos=cm.getCursor(),from=pos.ch,to=pos.ch,text=cm.getLine(pos.line);from&&/\s/.test(text.charAt(from-1));)--from;for(;to<text.length&&/\s/.test(text.charAt(to));)++to;cm.replaceRange(" ",Pos(pos.line,from),Pos(pos.line,to))},"Ctrl-O":repeated(function(cm){cm.replaceSelection("\n","start")}),"Ctrl-T":repeated(function(cm){cm.execCommand("transposeChars")}),"Alt-C":repeated(function(cm){operateOnWord(cm,function(w){var letter=w.search(/\w/);return-1==letter?w:w.slice(0,letter)+w.charAt(letter).toUpperCase()+w.slice(letter+1).toLowerCase()})}),"Alt-U":repeated(function(cm){operateOnWord(cm,function(w){return w.toUpperCase()})}),"Alt-L":repeated(function(cm){operateOnWord(cm,function(w){return w.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":repeated("undo"),"Shift-Ctrl--":repeated("undo"),"Ctrl-Z":repeated("undo"),"Cmd-Z":repeated("undo"),"Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":function quit(cm){cm.execCommand("clearSearch"),clearMark(cm)},"Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":repeated(function(cm){cm.replaceSelection("\n","end")}),Tab:"indentAuto","Alt-G G":function(cm){var prefix=getPrefix(cm,!0);if(null!=prefix&&0<prefix)return cm.setCursor(prefix-1);!function getInput(cm,msg,f){cm.openDialog?cm.openDialog(msg+': <input type="text" style="width: 10em"/>',f,{bottom:!0}):f(prompt(msg,""))}(cm,"Goto line",function(str){var num;str&&!isNaN(num=Number(str))&&num==(0|num)&&0<num&&cm.setCursor(num-1)})},"Ctrl-X Tab":function(cm){cm.indentSelection(getPrefix(cm,!0)||cm.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(cm){cm.setSelection(cm.getCursor("head"),cm.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":repeated("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(cm){kill(cm,cm.getCursor(),bySentence(cm,cm.getCursor(),1),"grow")},"Ctrl-X H":"selectAll","Ctrl-Q Tab":repeated("insertTab"),"Ctrl-U":function addPrefixMap(cm){cm.state.emacsPrefixMap=!0,cm.addKeyMap(prefixMap),cm.on("keyHandled",maybeRemovePrefixMap),cm.on("inputRead",maybeRemovePrefixMap)}}),prefixMap={"Ctrl-G":clearPrefix};function regPrefix(d){prefixMap[d]=function(cm){addPrefix(cm,d)},keyMap["Ctrl-"+d]=function(cm){addPrefix(cm,d)},prefixPreservingKeys["Ctrl-"+d]=!0}for(var i=0;i<10;++i)regPrefix(String(i));regPrefix("-")}),define("editor",["cm/lib/codemirror","config","preferences","form","cm/mode/prolog/prolog-template-hint","modal","tabbed","prolog","backend","storage","cm/mode/prolog/prolog","cm/mode/prolog/prolog_keys","cm/mode/prolog/prolog_query","cm/mode/prolog/prolog_server","cm/mode/markdown/markdown","cm/addon/edit/matchbrackets","cm/addon/comment/continuecomment","cm/addon/comment/comment","cm/addon/hint/show-hint","cm/addon/hint/anyword-hint","cm/addon/display/placeholder","cm/addon/runmode/runmode","cm/addon/search/search","cm/addon/search/searchcursor","cm/addon/search/jump-to-line","cm/addon/dialog/dialog","cm/addon/hover/text-hover","cm/addon/hover/prolog-hover","cm/addon/hint/templates-hint","cm/addon/hint/show-context-info","jquery","laconic","cm/keymap/emacs"],function(CodeMirror,config,preferences,form,templateHint,modal,tabbed,prolog,backend){function loadStyleExtensions(style,prefix){var sname,parts=[];for(sname in prefix=prefix||"",parts.push("<style>\n"),style)if(style.hasOwnProperty(sname)){var a,attrs=style[sname];for(a in parts.push(prefix,sname,"{"),attrs)attrs.hasOwnProperty(a)&&parts.push(a,":",attrs[a],";");parts.push("}\n")}parts.push("</style>\n"),$("body").append(parts.join(""))}!function($){var lastEditor,pluginName="prologEditor",modeDefaults={prolog:{mode:"prolog",role:"source",placeholder:"Your Prolog rules and facts go here ...",lineNumbers:!0,autoCurrent:!0,save:!1,theme:"prolog",matchBrackets:!0,textHover:!0,prologKeys:!0,extraKeys:{"Ctrl-Space":"autocomplete","Alt-/":"autocomplete"},hintOptions:{hint:templateHint.getHints,completeSingle:!1}},markdown:{mode:"markdown",placeholder:"Your markdown block goes here ...",lineWrapping:!0,save:!1}},roleDefaults={query:{mode:"prolog",role:"query",placeholder:"Your query goes here ...",lineNumbers:!1,lineWrapping:!0,save:!1}},methods={_init:function(opts){return this.each(function(){var ta,elem=$(this),storage={},data={};(opts=opts||{}).mode=opts.mode||"prolog";var options=$.extend({},modeDefaults[opts.mode]);function moveLongClick(ev){var dy=data.long_click,dx=ev.clientX-dy.clientX,dy=ev.clientY-dy.clientY;5<Math.sqrt(dx*dx+dy*dy)&&cancelLongClick()}function cancelLongClick(){elem.off("mousemove",moveLongClick);var lc=data.long_click;lc.timeout&&(clearTimeout(lc.timeout),lc.target=void 0,lc.timeout=void 0)}function copyData(name){var value=$(ta).data(name);value&&(storage[name]=value)}opts.role&&roleDefaults[opts.role]&&(options=$.extend(options,roleDefaults[opts.role])),options=$.extend(options,opts),preferences.getVal("emacs-keybinding")&&(options.keyMap="emacs"),"prolog"==options.mode&&(data.role=options.role,options.getSource&&(data.getSource=options.getSource),config.http.locations.cm_highlight&&(options.prologHighlightServer={url:config.http.locations.cm_highlight,role:options.role,enabled:preferences.getVal("semantic-highlighting")},options.sourceID&&(options.prologHighlightServer.sourceID=options.sourceID),options.extraKeys["Ctrl-R"]="refreshHighlight"),"source"==options.role&&(options.continueComments="Enter",options.gutters=["Prolog-breakpoints"]),data.long_click={},elem.on("mousedown",".CodeMirror-code",function(ev){var lc=data.long_click;lc.clientX=ev.clientX,lc.clientY=ev.clientY,elem.on("mousemove",moveLongClick),data.long_click.timeout=setTimeout(function(){cancelLongClick(),elem.prologEditor("contextAction")},500)}),elem.on("mouseup",function(ev){cancelLongClick()})),(ta=elem.children("textarea")[0])?(copyData("file"),copyData("url"),copyData("title"),copyData("meta"),copyData("st_type"),copyData("chats"),"browser"==$(ta).data("download")&&storage.url?(options.placeHolder="Downloading data ...",data.cm=CodeMirror.fromTextArea(ta,options),backend.ajax({url:storage.url,dataType:"text",success:function(data){elem.prologEditor("setSource",{data:data,url:storage.url,noHistory:!0},!1),elem.storage("update_tab_title")},error:function(jqXHDR){modal.ajaxError(jqXHDR)}})):data.cm=CodeMirror.fromTextArea(ta,options)):(options.value||(options.value=elem.text()),data.cm=CodeMirror(elem[0],options)),elem.data(pluginName,data),elem.prologEditor("loadMode",options.mode),elem.addClass("swish-event-receiver"),elem.addClass("prolog-editor"),elem.on("editor",function(ev,action,...args){args.unshift(ev,action),elem.prologEditor.apply(this,args)}),elem.on("preference",function(ev,pref){elem.prologEditor("preference",pref)}),elem.hasClass("printable")&&elem.on("print",function(){"query"!=data.role&&elem.prologEditor("print")}),elem.on("clearMessages",function(ev){elem.prologEditor("clearMessages")}),elem.on("edit-command",function(ev,command){elem.prologEditor("execCommand",command)}),data.cm.on("blur",function(ev){elem.prologEditor("execCommand","prepare")}),options.save&&(storage.typeName=options.typeName||"program",elem.prologEditor("setupStorage",storage)),elem.on("activate-tab",function(ev){data.cm.refresh()}),"prolog"==options.mode&&"source"==data.role&&(elem.on("activate-tab",function(ev){options.autoCurrent&&elem.prologEditor("makeCurrent")}),elem.on("source-error",function(ev,error){elem.prologEditor("highlightError",error)}),elem.on("pengine-died",function(ev,id){var i;!data.pengines||0<=(i=data.pengines.indexOf(id))&&data.pengines.splice(i,1),data.traceMark&&data.traceMark.pengine==id&&(data.traceMark.clear(),data.traceMark=null)}),options.save&&elem.on("addExample",function(ev,query){elem.prologEditor("addExample",query)}),data.cm.on("gutterClick",function(cm,n){cm.lineInfo(n).gutterMarkers?cm.setGutterMarker(n,"Prolog-breakpoints",null):cm.setGutterMarker(n,"Prolog-breakpoints",function makeMarker(){return $('<span class="breakpoint-marker">&#9679;</span>')[0]}())})),data.cm.on("change",function(cm,change){var clean;clean="setValue"==change.origin||(clean=(elem.data("storage")||data).cleanGeneration,data.cm.isClean(clean)),elem.prologEditor("markClean",clean)})})},getOption:function(opt){return this.data(pluginName)[opt]},setKeybinding:function(schema){schema=schema||"default",this.data(pluginName).cm.options.keyMap=schema},loadMode:function(mode){var data=this.data(pluginName);return CodeMirror.modes[mode]?mode!=data.mode&&data.cm.setOption("mode",mode):require(["cm/mode/"+mode+"/"+mode],function(){data.cm.setOption("mode",mode)}),this},isPengineSource:function(){var storageData=$(this).data(pluginName);if(storageData&&"source"==storageData.role){storageData=$(this).data("storage");if(storageData&&storageData.meta&&(storageData.meta.loaded||storageData.meta.module))return!1}return this},getBreakpoints:function(pengineID){var result=[];return this.each(function(){for(var file,store=$(this).data(pluginName),breakpoints=[],cm=store.cm,line=cm.firstLine(),last=cm.lastLine();line<last;line++)cm.lineInfo(line).gutterMarkers&&breakpoints.push(0+line+1);0<breakpoints.length&&(store.pengines&&0<=store.pengines.indexOf(pengineID)?file="pengine://"+pengineID+"/src":(store=$(this).data("storage"))&&(file="swish://"+store.file),file&&result.push({file:file,breakpoints:breakpoints}))}),result},getSource:function(role,direct){var src=[];return this.each(function(){var mysrc;!$(this).prologEditor("isPengineSource")||(mysrc=$(this).data(pluginName))&&(role&&role!=mysrc.role||(mysrc="function"!=typeof mysrc.getSource||direct?mysrc.cm.getValue():mysrc.getSource(),src.push(mysrc)))}),src.join("\n\n")},getSourceEx:function(){var obj={value:this.data(pluginName).cm.getValue()},bps=this.prologEditor("getBreakpoints");return 0<bps.length&&(obj.breakpoints=bps),obj},docid:function(){var st;return this.hasClass("storage")?this.storage("docid"):(st=this.closest(".storage"))&&0<st.length&&(stdoc=st.storage("docid"),stdoc)?stdoc+"#"+this.closest(".nb-cell").attr("name"):void 0},getSourceID:function(){var ids=[];return this.each(function(){var data=$(this).data(pluginName);data&&data.cm&&data.cm.state.prologHighlightServer?ids.push(data.cm.state.prologHighlightServer.uuid):ids.push(null)}),ids},setSource:function(source,data){return"string"==typeof source&&(source={data:source}),this.data("storage")&&1!=data?this.storage("setSource",source):((data=this.data(pluginName)).cm.setValue(source.data),(source.line||source.prompt)&&(data.cm.refresh(),source.line?this.prologEditor("gotoLine",source.line,source):this.prologEditor("showTracePort",source.prompt)),"source"!=data.role||source.noHistory||$(".swish-event-receiver").trigger("program-loaded",{editor:this,query:source.query})),this},makeCurrent:function(options){return options&&options.noHistory||$(".swish-event-receiver").trigger("current-program",this),this},focus:function(){var data=this.data(pluginName);return data&&data.cm.focus(),this},markClean:function(clean){var data=this.data(pluginName);data.clean_signalled!=clean&&(data.clean_signalled=clean,this.trigger("data-is-clean",clean))},setIsClean:function(){return this.each(function(){var data=$(this).data(pluginName);data.cleanGeneration=data.cm.changeGeneration(),data.clean_signalled=!0})},pengine:function(options){var data=this.data(pluginName);if(data)return options.add?(data.pengines=data.pengines||[],data.pengines.indexOf(options.add)<0&&data.pengines.push(options.add),this):options.has?data.pengines&&0<=data.pengines.indexOf(options.has):void 0},print:function(src){var pre=$.el.pre({class:"cm-s-prolog"});return src=src||this.prologEditor("getSource"),CodeMirror.runMode(src,"prolog",pre),backend.ajax({url:config.http.locations.swish+"js/codemirror/theme/prolog.css",dataType:"text",success:function(data){!function printWithIframe(elem){var iframe=$.el.iframe({src:"about:blank"});$("body").append(iframe),$("body",iframe.contentWindow.document).append(elem),iframe.contentWindow.print()}($.el.div($.el.style(data),pre))},error:function(jqXHDR){modal.ajaxError(jqXHDR)}}),this},preference:function(pref){var data=this.data(pluginName);return"semantic-highlighting"==pref.name&&data.cm.setOption("prologHighlightServer",{enabled:pref.value}),"emacs-keybinding"==pref.name&&(1==pref.value?data.cm.setOption("keyMap","emacs"):data.cm.setOption("keyMap","default")),this},highlightError:function(error,data){var elem,widget;return(1==data||error.location.file&&(1==error.location.file||this.prologEditor("isMyFile",error.location.file)))&&(data=this.data(pluginName),error.location.ch&&(left=data.cm.charCoords({line:error.location.line-1,ch:error.location.ch-1},"local").left,elem=$.el.div({class:"source-msg-charmark"},$.el.span({class:"glyphicon glyphicon-chevron-up"})),$(elem).css("padding-left",left+"px")),elem=$.el.div({class:"source-msg error error-context",title:"Error message.  Click to remove"},elem,$(error.data)[0],$.el.span({class:"glyphicon glyphicon-remove-circle"})),widget=data.cm.addLineWidget(error.location.line-1,elem),error.error_context&&$(elem).data("error_context",error.error_context),$(elem).on("click",function(ev){error.error_handler&&0==error.error_handler(ev)||widget.clear()}),$(elem).data("cm-widget",widget)),this},refreshHighlight:function(){return this.data(pluginName).cm.serverAssistedHighlight(!0),this},refresh:function(){var data=this.data(pluginName);return data&&data.cm.refresh(),this},clearMessages:function(){return this.find(".source-msg").each(function(){$(this).data("cm-widget").clear()}),this.prologEditor("showTracePort",null),this},execCommand:function(command){return"prepare"==command?lastEditor=this[0]:lastEditor==this[0]&&(elem=$(lastEditor),elem.data(pluginName).cm.execCommand(command),elem.find(".Codemirror-dialog input").focus()),this},isMyFile:function(file){if(file.startsWith("pengine://")){var store=this.data(pluginName);if(store.pengines&&(id=file.split("/")[2])&&0<=store.pengines.indexOf(id))return!0}if(file.startsWith("swish://")){store=this.data("storage");if(store&&file.slice("swish://".length)==store.file)return!0}return!1},showTracePort:function(prompt){if(0==this.length)return this;var data=this.data(pluginName);if(data.traceMark&&(data.traceMark.clear(),data.traceMark=null),!(prompt&&prompt.source&&prompt.source.file))return this;var from,to=prompt.source.file;return this.prologEditor("isMyFile",to)?(prompt.source.from&&prompt.source.to&&(from=data.cm.charOffsetToPos(prompt.source.from),to=data.cm.charOffsetToPos(prompt.source.to),this.is(":visible")||this.storage("expose","trace"),from&&to&&(data.traceMark=data.cm.markText(from,to,{className:"trace "+prompt.port}),data.traceMark.pengine=prompt.pengine,data.cm.scrollIntoView(from,50))),this):void 0},getSelection:function(){var selection=[];return this.each(function(){var cell_name=$(this),data=cell_name.data(pluginName);if(1==data.cm.somethingSelected()){var sel=data.cm.listSelections(),esel={selections:[]},cell_name=cell_name.closest(".nb-cell").attr("name");cell_name&&(esel.cell=cell_name);for(var i=0;i<sel.length;i++){var s=sel[i],sr={};function cppos(pos){return{line:pos.line,ch:pos.ch}}switch(function cmploc(l1,l2){return l1.line<l2.line?-1:l1.line>l2.line?1:l1.ch<l2.ch?-1:l1.ch>l2.ch?1:0}(s.anchor,s.head)){case-1:sr.from=cppos(s.anchor),sr.to=cppos(s.head);break;case 1:sr.to=cppos(s.anchor),sr.from=cppos(s.head);break;case 0:continue}sr.string=data.cm.getRange(sr.from,sr.to),sr.context=data.cm.getRange(function sol(pos){return{line:pos.line,ch:0}}(sr.from),function eol(pos){return{line:pos.line,ch:data.cm.getLine(pos.line).length}}(sr.to)),esel.selections.push(sr)}selection.push(esel)}}),0<selection.length?selection:null},restoreSelection:function(selection){function restoreEditorSelection(ed,sel){var cm=ed.data(pluginName).cm,cmsel=[],loffset="";function findsel(s){if(cm.getRange(s.from,s.to)==s.string)return{anchor:s.from,head:s.to};var start=cm.firstLine(),end=cm.lastLine(),offset=0,goffset=1;function poff(p,l,ch){return ch=ch||0,{line:p.line+l,ch:p.ch+ch}}for(;s.from.line+offset>=start&&s.to.line+offset<=end;){if(function contextMatch(l0,s){for(var lines=s.split("\n"),i=0;i<lines.length;i++)if(cm.getLine(l0+i)!=lines[i])return;return 1}(s.from.line+offset,s.context))return{anchor:poff(s.from,offset),head:poff(s.to,offset),offset:offset};if(0<=(toff=function stringMatch(l0,s){for(var lines=s.split("\n"),i=0;i<lines.length;i++){var choff,cml=cm.getLine(l0),l=lines[i];if(0==i){if(i==lines.length-1)return cml.indexOf(l);if(!(0<=(choff=cml.indexOf(l))&&l.length+choff==cml.length))return-1}else if(i==lines.length-1){if(0!=cml.indexOf(l))return-1}else if(cm.getLine(l0+i)!=lines[i])return-1}return choff}(s.from.line+offset,s.string))){var soff=toff-s.from.ch,toff=s.to.line!=s.from.line?0:soff;return{anchor:poff(s.from,offset,soff),head:poff(s.to,offset,toff),offset:offset}}goffset++,offset=Math.floor(goffset/2),goffset%2==1&&(offset=-offset)}}for(var msg,i=0;i<sel.length;i++){var r=findsel(sel[i]);r&&(cmsel.push(r),r.offset&&(""!=loffset&&(loffset+=";"),loffset+=r.offset))}0<cmsel.length&&cm.setSelections(cmsel,0),(""!=loffset||cmsel.length<sel.length)&&(msg=cmsel.length==sel.length?"Found selections at offset "+loffset:""==loffset?"Could not restore all selections":"Only found some selections at offsets "+loffset,modal.feedback({html:msg,owner:ed}))}if(selection[0].cell)for(var editors=this,i=0;i<selection.length;i++){var s=selection[i];var ed=function findEditor(name){for(var i=0;i<editors.length;i++)if($(editors[i]).closest(".nb-cell").attr("name")==name)return $(editors[i])}(s.cell);ed&&restoreEditorSelection(ed,s.selections)}else restoreEditorSelection(this,selection);return this},getExamples:function(src,inComment){var comments,source=src||this.prologEditor("getSource"),exlist=[];if(""==$.trim(source))return null;if(comments=0==inComment?[src]:source.match(/\/\*\* *<?examples>?[\s\S]*?\*\//gim))for(var i=0;i<comments.length;i++){var exl=comments[i].match(/^ *\?-[\s\S]*?[^-#$&*+./:<=>?@\\^~]\.\s/gm);if(exl)for(var j=0;j<exl.length;j++){var ex=exl[j].replace(/^ *\?-\s*/,"").replace(/\s*$/,"");exlist.push(ex)}}return exlist},addExample:function(query){var cm=this.data(pluginName).cm,source=this.prologEditor("getSource"),start=this.prologEditor("search",/\/\*\* *<?examples>?/gim,{dir:-1,max:1}),line=this.prologEditor("search",/\*\//,{start:start.line,max:1});if(1==start.length){var line=this.prologEditor("search",/\*\//,{start:start[0].line,max:1}),lineno=this.prologEditor("getExamples",source);if(lineno&&-1!=lineno.indexOf(query))return modal.alert("Query is already in examples"),this;if(1!=line.length)return modal.alert("/** <examples> block is not terminated with */"),this;query=query.split("\n").join("\n   "),cm.setSelection({line:line[0].line-1,ch:0}),cm.replaceSelection("?- "+query+"\n")}else{lineno=cm.lastLine(),line=cm.getLine(lineno);cm.replaceRange("\n\n/** <examples>\n?- "+query+"\n*/\n",{line:lineno,ch:line.length})}return this},search:function(re,options){var tmp,cm=this.data(pluginName).cm,dir=options.dir||1,start=null==options.start?cm.firstLine():options.start,end=null==options.end?cm.lastLine():options.end,matches=[];if((-1==dir&&start<end||1==dir&&end<start)&&(tmp=start,start=end,end=tmp),0<dir&&end<start||dir<0&&start<end)return matches;end+=dir;for(var i=start;i!=end;i+=dir){var line=cm.getLine(i);if(0<=line.search(re)&&(matches.push({line:i+1,text:line}),options.max&&options.max===matches.length))return matches}return matches},gotoLine:function(line,options){var re,cm=this.data(pluginName).cm,coords=0;function clearSearchMarkers(cm){if(void 0!==cm._searchMarkers){for(var i=0;i<cm._searchMarkers.length;i++)cm._searchMarkers[i].clear();cm.off("cursorActivity",clearSearchMarkers)}cm._searchMarkers=[]}clearSearchMarkers(cm),line-=1,(re=(options=options||{}).regex)&&(coords=cm.getLine(line).search(re))<0&&(coords=0),cm.setCursor({line:line,ch:coords});var myHeight=cm.getScrollInfo().clientHeight,coords=cm.charCoords({line:line,ch:0},"local");if(cm.scrollTo(null,(coords.top+coords.bottom-myHeight)/2),re){function markMatches(line,className){for(var match;match=re.exec(cm.getLine(line));)cm._searchMarkers.push(cm.markText({line:line,ch:match.index},{line:line,ch:match.index+match[0].length},{className:className,clearOnEnter:!0,clearWhenEmpty:!0,title:"Search match"}))}if(markMatches(line,"CodeMirror-search-match"),options.showAllMatches)for(var vp=cm.getViewport(),i=vp.from;i<vp.to;i++)i!=line&&markMatches(i,"CodeMirror-search-alt-match");0<cm._searchMarkers.length&&cm.on("cursorActivity",clearSearchMarkers)}else cm._searchMarkers.push(cm.markText({line:line,ch:0},{line:line,ch:cm.getLine(line).length},{className:"CodeMirror-search-match",clearOnEnter:!0,clearWhenEmpty:!0,title:"Target line"}));return this},changeGen:function(){return this.data(pluginName).cm.changeGeneration()},isClean:function(gen){return this.data(pluginName).cm.isClean(gen)},setupStorage:function(storage){var data=this.data(pluginName),elem=this;return storage.setValue=function(source){elem.prologEditor("setSource",source,!0)},storage.getValue=function(){return data.cm.getValue()},storage.changeGen=function(){return data.cm.changeGeneration()},storage.isClean=function(generation){return data.cm.isClean(generation)},storage.markClean=function(clean){elem.prologEditor("markClean",clean)},storage.cleanGeneration=data.cm.changeGeneration(),storage.cleanData=data.cm.getValue(),storage.cleanCheckpoint="load",this.storage(storage),this},contextAction:function(){var elem=this,data=this.data(pluginName),coord=data.cm.getCursor(),select=data.cm.getTokenAt(coord,!0),coord=data.cm.getEnrichedToken(select),locations=data.cm.getTokenReferences(coord);if(locations&&0<locations.length){for(var ul=$.el.ul(),select=$.el.div({class:"goto-source"},$.el.div("Go to"),ul),modalel=$.el.div({class:"edit-modal"},$.el.div({class:"mask"}),select),i=0;i<locations.length;i++){var loc=locations[i];$(ul).append($.el.li($.el.a({"data-locindex":i},loc.title)))}coord=data.cm.cursorCoords(!0);$(select).css({top:coord.bottom,left:coord.left}),$("body").append(modalel),$(modalel).on("click",function(loc){var editor,loc=$(loc.target).data("locindex");$(modalel).remove(),void 0!==loc&&((loc=locations[loc]).file?elem.closest(".swish").swish("playFile",loc):("query"==data.role?(editor=elem.closest(".prolog-query-editor").queryEditor("getProgramEditor"))[0]||modal.alert("No related program editor"):editor=elem,editor&&editor[0]&&editor.prologEditor("gotoLine",loc.line,loc).focus()))}),$(modalel).show()}return this},variables:function(query,options){var qspan=$.el.span({class:"query cm-s-prolog"}),vars=[];function addVars(selector){var incl=!0,use_proj=!1;$(qspan).find(selector).each(function(){var elem=$(this),name=elem.text();elem.hasClass("cm-functor")?"projection"==name?use_proj=!0:use_proj&&(incl=!1):incl&&vars.indexOf(name)<0&&vars.push(name)})}return options=options||{},CodeMirror.runMode(query,"prolog",qspan),options.projection?addVars("span.cm-var,span.cm-var-2,span.cm-functor"):(addVars("span.cm-var"),options.anon&&addVars("span.cm-var-2")),vars},wrapSolution:function(wrapper){var query=prolog.trimFullStop(this.prologEditor("getSource","query")),that=this,vars=this.prologEditor("variables",query);function wrapQuery(pre,post){return that.prologEditor("setSource",pre+"("+query+")"+post+".").focus(),that}switch(wrapper){case"Aggregate (count all)":return wrapQuery("aggregate_all(count, ",", Count)");case"Projection":return function prefixQuery(pre){return that.prologEditor("setSource",pre+query+".").focus(),that}("projection(["+vars.join(",")+"]),\n");case"Order by":return wrapQuery("order_by(["+function order(){for(var order=[],i=0;i<vars.length;i++)order.push("asc("+vars[i]+")");return order.join(",")}()+"], ",")");case"Distinct":return wrapQuery("distinct(["+vars.join(",")+"], ",")");case"Limit":return wrapQuery("limit(10, ",")");case"Time":return wrapQuery("time(",")");case"Debug (trace)":return wrapQuery("trace, ","");default:alert('Unknown wrapper: "'+wrapper+'"')}}};if(tabbed.tabTypes.program={dataType:"pl",typeName:"program",label:"Program",contentType:"text/x-prolog",order:100,create:function(dom,options){$(dom).addClass("prolog-editor").prologEditor($.extend({save:!0},options)).prologEditor("makeCurrent",options)}},config.swish.tab_types)for(var editDefaults={save:!0,lineNumbers:!0},i=0;i<config.swish.tab_types.length;i++){var options,tabType=config.swish.tab_types[i];tabType.editor&&(options=$.extend({typeName:tabType.typeName},editDefaults,tabType.editor),tabType.create=function(dom){$(dom).addClass("prolog-editor").prologEditor(options)},tabbed.tabTypes[tabType.typeName]=tabType)}$.fn.prologEditor=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)},$.fn.prologEditor.methods=methods}(jQuery),CodeMirror.prototype.charOffsetToPos=function(offset){for(var line=this.firstLine(),last=this.lastLine(),charno=0;line<last;line++){var text=this.getLine(line);if(charno<=offset&&charno+text.length>=offset)return{line:line,ch:offset-charno};charno+=text.length+1}},CodeMirror.keyMap.emacs.Enter="newlineAndIndent",config.swish.cm_style&&loadStyleExtensions(config.swish.cm_style,".cm-s-prolog span.cm-"),config.swish.cm_hover_style&&loadStyleExtensions(config.swish.cm_hover_style,".CodeMirror-hover-tooltip ")}),define("answer",["jquery","preferences","laconic"],function($,preferences){!function($){var pluginName="prologAnswer",methods={_init:function(answer){return this.each(function(){var row,elem=$(this);answerHasOutput(answer)?elem.is("table")?(row=$.el.tr(),elem.append(row),row.innerHTML=renderTabledAnswer(answer,elem),evalScripts($(row)),$(row).find(".render-multi").renderMulti()):(elem[0].innerHTML=renderAnswer(answer),evalScripts(elem),elem.find(".render-multi").renderMulti(),preferences.getVal("auto-binding-layout")&&elem.find(".pl-adaptive.pl-level-0").pl_term("layout",{layout:"auto",propagate:!0}).closest(".pl-embrace").pl_term("fit_parenthesis")):elem.append($.el.span({class:"prolog-true"},"true"))})}};function answerHasOutput(answer){return 0<answer.variables.length||answer.residuals||answer.wfs_residual_program||answer.scasp_model||answer.scasp_justification}function renderSubstitutions(substs,html){html.push(', <span class="pl-comment">% where</span><br/>');for(var s=0;s<substs.length;s++)html.push('<span class="where-binding">',"<span class='pl-var'>",substs[s].var+"</span> = ",substs[s].value,"</span>"),s<substs.length-1&&html.push(",<br/>")}function renderAnswer(answer){var html=[],bindings=answer.variables;answer.wfs_residual_program&&html.push('<div class="wfs-residual-program">','<div class="wfs-title">',"WFS residual program (",'<a href="',"http://www.swi-prolog.org/pldoc/man?section=WFS",'">',"help","</a>",")</div>",answer.wfs_residual_program,"</div>");for(var residuals,i=0;i<bindings.length;i++){for(var vars=bindings[i].variables,v=0;v<vars.length-1;v++)html.push("<span class='pl-ovar'>",vars[v],"</span> = ","<span class='pl-var'>",vars[v+1],"</span>, ");html.push("<span class='pl-binding pl-adaptive'>","<span class='pl-ovar pl-trigger'>",vars[vars.length-1],"</span> = <span class='pl-binding-value'>",bindings[i].value,"</span></span>"),bindings[i].substitutions&&renderSubstitutions(bindings[i].substitutions,html),(i<bindings.length-1||answer.residuals)&&html.push(",<br/>")}if(residuals=answer.residuals)for(i=0;i<residuals.length;i++)html.push(residuals[i]),i<residuals.length-1&&html.push(",<br/>");return(answer.scasp_model||answer.scasp_justification)&&html.push("<div class='scasp-answer'>\n",answer.scasp_model||"",answer.scasp_justification||"","</div>\n","<script>\n","$.ajaxScript.parent().find('div.scasp-answer').sCASP('swish_answer');\n","<\/script>\n"),html.join("")}function renderTabledAnswer(answer,table){var html=[];for(var residuals,i=0;i<answer.projection.length;i++){var vname=answer.projection[i],binding=function findBinding(name){for(var bindings=answer.variables,i=0;i<bindings.length;i++)for(var vars=bindings[i].variables,v=0;v<vars.length;v++)if(vars[v]==name)return bindings[i];return null}(vname);html.push("<td>"),binding?(html.push(binding.value),binding.substitutions&&renderSubstitutions(binding.substitutions,html)):html.push("<span class='pl-var'>",vname,"</span>"),html.push("</td>")}if(residuals=answer.residuals){!function ensureResidualColumn(){0==table.find("tr.projection th.residuals").length&&($("<th class='residuals'>Residual goals</th>").insertBefore(table.find("tr.projection th.answer-nth")),$("<td></td>").insertBefore(table.find("tr td.answer-nth")))}(),html.push("<td>");for(i=0;i<residuals.length;i++)html.push(residuals[i]),i<residuals.length-1&&html.push(",<br/>");html.push("</td>")}return answer.nth&&html.push("<td class='answer-nth'>",answer.nth,"</td>"),html.join("")}function evalScripts(elem){elem.find("script").each(function(){var type=this.getAttribute("type")||"text/javascript";"text/javascript"==type&&($.ajaxScript=$(this),eval(this.textContent))}),$.ajaxScript&&delete $.ajaxScript}$.fn.prologAnswer=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery),function($){var timeout=0,hovering=!1,methods={_init:function(options){return this.each(function(){var elem=$(this),data={current:0},display=[],selector=$.el.div({class:"render-multi-active"}),i=0;elem.children().each(function(){var how=$(this).css("display");display.push(how),0==i++?(elem.css("display",how),$(this).attr("draggable",!1)):$(this).hide()}),data.display=display,elem.append(selector),$(selector).hover(function(ev){elem.renderMulti("showSelect",ev)},function(ev){elem.renderMulti("hideSelect",ev)}),elem.attr("draggable",!0).bind("dragstart",dragStart),elem.data("renderMulti",data)})},selectMenu:function(){var data=this.data("renderMulti"),select=["<label>View as</label><br>"],children=this.children();for(var i=0,i=0;i<data.display.length;i++){var name=(name=$(children[i]).attr("data-render"))||(0==i?"Default rendered":"Alt rendered ["+(i+1)+"]");select.push("<div class='render-item'>",function downloadButton(i,glyph){var title,glyph="Prolog term"==glyph?(title="Copy","copy"):(title="Download","download");return btn='<a href="#" class="btn btn-style btn-sm" data-nr="'+i+'" data-action="'+glyph+'" title="'+title+'"><span class="glyphicon glyphicon-'+glyph+'"></span></a>',btn}(i,name),"<input type='radio' name='render' value='",i,"'"),i==data.current&&select.push(" checked"),select.push("> ",name,"</div>")}return select.push("</form"),select.join("")},showSelect:function(ev){var target,menu=selectMenu(),pos=this.offset();hovering=!0,timeout&&(clearTimeout(timeout),timeout=0),(target=menu.data("target"))&&target.removeClass("render-selecting"),menu.data("target",this),menu.html(this.renderMulti("selectMenu")),menu.css({top:pos.top+5+"px",left:pos.left+5+"px"}).show(400),this.addClass("render-selecting")},hideSelect:function(ev){resetHover()},select:function(i){var child,how,data=this.data("renderMulti");data.current!=i&&(child=this.children(),how=data.display[i],$(child[data.current]).hide(400),$(child[i]).show(400,function(){$(this).css("display",how)}),this.css("display",how),$(child[i]).is("span.render-as-prolog")?this.attr("draggable",!1):this.attr("draggable",!0),data.current=i),closeSelectMenu()},copy:function(i){var child=this.children(),old=this.data("renderMulti").current;this.renderMulti("select",i),function selectElementText(selection){var range=document.createRange();range.selectNodeContents(selection),(selection=window.getSelection()).removeAllRanges(),selection.addRange(range)}(child[i]);try{document.execCommand("copy")}catch(e){alert("Sorry, cannot copy text with this browser")}return this.renderMulti("select",old),this},download:function(btn){var svg,filename=this.children(),filename=$(filename[btn]),btn="html";filename.hasClass("export-dom")?(svg={},filename=filename.trigger("export-dom",svg),svg.element?(href=svg.element.outerHTML,btn=svg.extension||"html",type=svg.contentType||"text/html"):alert("Failed to export rendered result")):type=1==filename.find("svg").length?((svg=filename.find("svg")).attr("xmlns")||svg.attr("xmlns","http://www.w3.org/2000/svg"),href=svg[0].outerHTML,btn="svg","image/svg+xml"):(href=filename.html(),"text/html"),function aSupportsDownload(){return null!=$("<a>")[0].download}()||(type="application/octet-stream"),console.log(type);var a,input,filename=new Blob([href],{type:type}),href=URL.createObjectURL(filename),filename="swish-rendered."+btn,span=$.el.div({class:"download"},btn=$.el.button({type:"button",class:"close"}),a=$.el.a({href:href,target:"_blank",download:filename},"Right click me to download as "),$.el.br(),input=$.el.input({value:filename}));return this.append(span),$(btn).html("&times;").on("click",function(ev){$(span).remove()}),$(input).on("change keyup paste",function(ev){return $(a).attr("download",$(input).val()),ev.preventDefault(),!1}),this},prologText:function(){return this.find("span.render-as-prolog").text()}};function selectMenu(){var menu=$("#render-select");return menu[0]||((menu=$($.el.form({id:"render-select",style:"display:none"}))).on("click","a",function(i){var a=$(i.target).closest("a"),i=a.data("nr");return menu.data("target").renderMulti(a.data("action"),i),!1}),menu.on("click",function(){var r=$("input[name=render]:checked",$(this)).val();menu.data("target").renderMulti("select",parseInt(r))}),menu.hover(function(){hovering=!0,startMenuTimeout()},function(){resetHover()}),$("body").append(menu)),menu}function closeSelectMenu(){var menu,target;hovering||((target=(menu=selectMenu()).data("target"))&&(target.removeClass("render-selecting"),menu.data("target",null)),menu.hide(400))}function startMenuTimeout(){timeout=setTimeout(function(){closeSelectMenu()},400)}function resetHover(){hovering=!1,startMenuTimeout()}function dragStart(ev){return ev.originalEvent.dataTransfer.setData("Text",$(ev.target).renderMulti("prologText")),!0}$.fn.renderMulti=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.renderMulti"):methods._init.apply(this,arguments)}}(jQuery)}),function(document,Math){var factory;factory=function($){"use strict";var SPFormat,clipval,quartile,normalizeValue,normalizeValues,remove,isNumber,all,addCSS,ensureArray,formatNumber,RangeMap,MouseHandler,Tooltip,line,bar,tristate,discrete,bullet,pie,box,VShape,VCanvas_canvas,VCanvas_vml,pending,UNSET_OPTION={},shapeCount=0,VCanvas_base=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:void 0,normalRangeMax:void 0,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:void 0,chartRangeMax:void 0,chartRangeMinX:void 0,chartRangeMaxX:void 0,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:void 0,nullColor:void 0,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,colorMap:void 0,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:void 0,thresholdValue:0,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,tooltipFormat:new SPFormat("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:void 0,tooltipFormat:new SPFormat("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:void 0,targetColor:"#4a2",chartRangeMax:void 0,chartRangeMin:void 0,tooltipFormat:new SPFormat("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},createClass=function(){var args,Class=function(){this.init.apply(this,arguments)};return 1<arguments.length?(arguments[0]?(Class.prototype=$.extend(new arguments[0],arguments[arguments.length-1]),Class._super=arguments[0].prototype):Class.prototype=arguments[arguments.length-1],2<arguments.length&&((args=Array.prototype.slice.call(arguments,1,-1)).unshift(Class.prototype),$.extend.apply($,args))):Class.prototype=arguments[0],Class.prototype.cls=Class};$.SPFormatClass=SPFormat=createClass({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(format,fclass){this.format=format,this.fclass=fclass},render:function(fieldset,lookups,options){var match,lookupkey,fieldvalue,prec,self=this,fields=fieldset;return this.format.replace(this.fre,function(){return fieldvalue=arguments[1],lookupkey=arguments[3],(match=self.precre.exec(fieldvalue))?(prec=match[2],fieldvalue=match[1]):prec=!1,void 0===(fieldvalue=fields[fieldvalue])?"":lookupkey&&lookups&&lookups[lookupkey]?lookups[lookupkey].get?lookups[lookupkey].get(fieldvalue)||fieldvalue:lookups[lookupkey][fieldvalue]||fieldvalue:fieldvalue=isNumber(fieldvalue)?options.get("numberFormatter")?options.get("numberFormatter")(fieldvalue):formatNumber(fieldvalue,prec,options.get("numberDigitGroupCount"),options.get("numberDigitGroupSep"),options.get("numberDecimalMark")):fieldvalue})}}),$.spformat=function(format,fclass){return new SPFormat(format,fclass)},clipval=function(val,min,max){return val<min?min:max<val?max:val},quartile=function(values,q){var vl;return 2===q?(vl=Math.floor(values.length/2),values.length%2?values[vl]:(values[vl-1]+values[vl])/2):values.length%2?(vl=(values.length*q+q)/4)%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1]:(vl=(values.length*q+2)/4)%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1]},normalizeValue=function(val){var nf;switch(val){case"undefined":val=void 0;break;case"null":val=null;break;case"true":val=!0;break;case"false":val=!1;break;default:val==(nf=parseFloat(val))&&(val=nf)}return val},normalizeValues=function(vals){for(var result=[],i=vals.length;i--;)result[i]=normalizeValue(vals[i]);return result},remove=function(vals,filter){for(var result=[],i=0,vl=vals.length;i<vl;i++)vals[i]!==filter&&result.push(vals[i]);return result},isNumber=function(num){return!isNaN(parseFloat(num))&&isFinite(num)},formatNumber=function(num,p,groupsize,groupsep,decsep){var i;for(num=(!1===p?parseFloat(num).toString():num.toFixed(p)).split(""),(p=(p=$.inArray(".",num))<0?num.length:p)<num.length&&(num[p]=decsep),i=p-groupsize;0<i;i-=groupsize)num.splice(i,0,groupsep);return num.join("")},all=function(val,arr,ignoreNull){for(var i=arr.length;i--;)if((!ignoreNull||null!==arr[i])&&arr[i]!==val)return!1;return!0},ensureArray=function(val){return $.isArray(val)?val:[val]},addCSS=function(css){var tag;document.createStyleSheet?document.createStyleSheet().cssText=css:((tag=document.createElement("style")).type="text/css",document.getElementsByTagName("head")[0].appendChild(tag),tag["string"==typeof document.body.style.WebkitAppearance?"innerText":"innerHTML"]=css)},$.fn.simpledraw=function(width,height,el,mhandler){var target;if(el&&(target=this.data("_jqs_vcanvas")))return target;if(!1===$.fn.sparkline.canvas)return!1;if(void 0===$.fn.sparkline.canvas){el=document.createElement("canvas");if(el.getContext&&el.getContext("2d"))$.fn.sparkline.canvas=function(width,height,target,interact){return new VCanvas_canvas(width,height,target,interact)};else{if(!document.namespaces||document.namespaces.v)return $.fn.sparkline.canvas=!1;document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),$.fn.sparkline.canvas=function(width,height,target,interact){return new VCanvas_vml(width,height,target)}}}return void 0===width&&(width=$(this).innerWidth()),void 0===height&&(height=$(this).innerHeight()),target=$.fn.sparkline.canvas(width,height,this,mhandler),(mhandler=$(this).data("_jqs_mhandler"))&&mhandler.registerCanvas(target),target},$.fn.cleardraw=function(){var target=this.data("_jqs_vcanvas");target&&target.reset()},$.RangeMapClass=RangeMap=createClass({init:function(map){var key,range,rangelist=[];for(key in map)map.hasOwnProperty(key)&&"string"==typeof key&&-1<key.indexOf(":")&&((range=key.split(":"))[0]=0===range[0].length?-1/0:parseFloat(range[0]),range[1]=0===range[1].length?1/0:parseFloat(range[1]),range[2]=map[key],rangelist.push(range));this.map=map,this.rangelist=rangelist||!1},get:function(value){var i,range,result,rangelist=this.rangelist;if(void 0!==(result=this.map[value]))return result;if(rangelist)for(i=rangelist.length;i--;)if((range=rangelist[i])[0]<=value&&range[1]>=value)return range[2]}}),$.range_map=function(map){return new RangeMap(map)},MouseHandler=createClass({init:function(el,options){var $el=$(el);this.$el=$el,this.options=options,this.currentPageX=0,this.currentPageY=0,this.el=el,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!options.get("disableTooltips"),this.highlightEnabled=!options.get("disableHighlight")},registerSparkline:function(sp){this.splist.push(sp),this.over&&this.updateDisplay()},registerCanvas:function(canvas){var $canvas=$(canvas.canvas);this.canvas=canvas,(this.$canvas=$canvas).mouseenter($.proxy(this.mouseenter,this)),$canvas.mouseleave($.proxy(this.mouseleave,this)),$canvas.click($.proxy(this.mouseclick,this))},reset:function(removeTooltip){this.splist=[],this.tooltip&&removeTooltip&&(this.tooltip.remove(),this.tooltip=void 0)},mouseclick:function(e){var clickEvent=$.Event("sparklineClick");clickEvent.originalEvent=e,clickEvent.sparklines=this.splist,this.$el.trigger(clickEvent)},mouseenter:function(e){$(document.body).unbind("mousemove.jqs"),$(document.body).bind("mousemove.jqs",$.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new Tooltip(this.options),this.tooltip.updatePosition(e.pageX,e.pageY)),this.updateDisplay()},mouseleave:function(){$(document.body).unbind("mousemove.jqs");var i,splist=this.splist,spcount=splist.length,needsRefresh=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),i=0;i<spcount;i++)splist[i].clearRegionHighlight()&&(needsRefresh=!0);needsRefresh&&this.canvas.render()},mousemove:function(e){this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,this.tooltip&&this.tooltip.updatePosition(e.pageX,e.pageY),this.updateDisplay()},updateDisplay:function(){var tooltiphtml,i,result,splist=this.splist,spcount=splist.length,needsRefresh=!1,changeEvent=this.$canvas.offset(),localX=this.currentPageX-changeEvent.left,localY=this.currentPageY-changeEvent.top;if(this.over){for(i=0;i<spcount;i++)(result=splist[i].setRegionHighlight(this.currentEl,localX,localY))&&(needsRefresh=!0);if(needsRefresh){if((changeEvent=$.Event("sparklineRegionChange")).sparklines=this.splist,this.$el.trigger(changeEvent),this.tooltip){for(tooltiphtml="",i=0;i<spcount;i++)tooltiphtml+=splist[i].getCurrentRegionTooltip();this.tooltip.setContent(tooltiphtml)}this.disableHighlight||this.canvas.render()}null===result&&this.mouseleave()}}}),Tooltip=createClass({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(options){var offset=options.get("tooltipClassname","jqstooltip"),sizetipStyle=this.sizeStyle;this.container=options.get("tooltipContainer")||document.body,this.tooltipOffsetX=options.get("tooltipOffsetX",10),this.tooltipOffsetY=options.get("tooltipOffsetY",12),$("#jqssizetip").remove(),$("#jqstooltip").remove(),this.sizetip=$("<div/>",{id:"jqssizetip",style:sizetipStyle,class:offset}),this.tooltip=$("<div/>",{id:"jqstooltip",class:offset}).appendTo(this.container),offset=this.tooltip.offset(),this.offsetLeft=offset.left,this.offsetTop=offset.top,this.hidden=!0,$(window).unbind("resize.jqs scroll.jqs"),$(window).bind("resize.jqs scroll.jqs",$.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=$(window).scrollTop(),this.scrollLeft=$(window).scrollLeft(),this.scrollRight=this.scrollLeft+$(window).width(),this.updatePosition()},getSize:function(content){this.sizetip.html(content).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(content){if(!content)return this.tooltip.css("visibility","hidden"),void(this.hidden=!0);this.getSize(content),this.tooltip.html(content).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(x,y){if(void 0===x){if(void 0===this.mousex)return;x=this.mousex-this.offsetLeft,y=this.mousey-this.offsetTop}else this.mousex=x-=this.offsetLeft,this.mousey=y-=this.offsetTop;this.height&&this.width&&!this.hidden&&(y-=this.height+this.tooltipOffsetY,x+=this.tooltipOffsetX,y<this.scrollTop&&(y=this.scrollTop),x<this.scrollLeft?x=this.scrollLeft:x+this.width>this.scrollRight&&(x=this.scrollRight-this.width),this.tooltip.css({left:x,top:y}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=void 0,$(window).unbind("resize.jqs scroll.jqs")}}),$(function(){addCSS('.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}')}),pending=[],$.fn.sparkline=function(userValues,userOptions){return this.each(function(){var i,options=new $.fn.sparkline.options(this,userOptions),$this=$(this),render=function(){var mhandler,sp,tmp,values="html"===userValues||void 0===userValues?(tmp=null==(tmp=this.getAttribute(options.get("tagValuesAttribute")))?$this.html():tmp).replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(","):userValues,width="auto"===options.get("width")?values.length*options.get("defaultPixelsPerValue"):options.get("width");"auto"===options.get("height")?options.get("composite")&&$.data(this,"_jqs_vcanvas")||((tmp=document.createElement("span")).innerHTML="a",$this.html(tmp),sp=$(tmp).innerHeight()||$(tmp).height(),$(tmp).remove(),tmp=null):sp=options.get("height"),options.get("disableInteraction")?mhandler=!1:(mhandler=$.data(this,"_jqs_mhandler"))?options.get("composite")||mhandler.reset():(mhandler=new MouseHandler(this,options),$.data(this,"_jqs_mhandler",mhandler)),!options.get("composite")||$.data(this,"_jqs_vcanvas")?((sp=new $.fn.sparkline[options.get("type")](this,values,options,width,sp)).render(),mhandler&&mhandler.registerSparkline(sp)):$.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),$.data(this,"_jqs_errnotify",!0))};if($(this).html()&&!options.get("disableHiddenCheck")&&$(this).is(":hidden")||!$(this).parents("body").length){if(!options.get("composite")&&$.data(this,"_jqs_pending"))for(i=pending.length;i;i--)pending[i-1][0]==this&&pending.splice(i-1,1);pending.push([this,render]),$.data(this,"_jqs_pending",!0)}else render.call(this)})},$.fn.sparkline.defaults=VCanvas_base(),$.sparkline_display_visible=function(){for(var el,done=[],i=0,pl=pending.length;i<pl;i++)el=pending[i][0],$(el).is(":visible")&&!$(el).parents().is(":hidden")?(pending[i][1].call(el),$.data(pending[i][0],"_jqs_pending",!1),done.push(i)):$(el).closest("html").length||$.data(el,"_jqs_pending")||($.data(pending[i][0],"_jqs_pending",!1),done.push(i));for(i=done.length;i;i--)pending.splice(done[i-1],1)},$.fn.sparkline.options=createClass({init:function(extendedOptions,userOptions){var defaults,base;this.userOptions=userOptions=userOptions||{},this.tag=extendedOptions,this.tagValCache={},base=(defaults=$.fn.sparkline.defaults).common,this.tagOptionsPrefix=userOptions.enableTagOptions&&(userOptions.tagOptionsPrefix||base.tagOptionsPrefix),extendedOptions=(extendedOptions=this.getTagSetting("type"))===UNSET_OPTION?defaults[userOptions.type||base.type]:defaults[extendedOptions],this.mergedOptions=$.extend({},base,extendedOptions,userOptions)},getTagSetting:function(key){var val,i,pairs,keyval,prefix=this.tagOptionsPrefix;if(!1===prefix||void 0===prefix)return UNSET_OPTION;if(this.tagValCache.hasOwnProperty(key))val=this.tagValCache.key;else{if(null==(val=this.tag.getAttribute(prefix+key)))val=UNSET_OPTION;else if("["===val.substr(0,1))for(i=(val=val.substr(1,val.length-2).split(",")).length;i--;)val[i]=normalizeValue(val[i].replace(/(^\s*)|(\s*$)/g,""));else if("{"===val.substr(0,1))for(pairs=val.substr(1,val.length-2).split(","),val={},i=pairs.length;i--;)val[(keyval=pairs[i].split(":",2))[0].replace(/(^\s*)|(\s*$)/g,"")]=normalizeValue(keyval[1].replace(/(^\s*)|(\s*$)/g,""));else val=normalizeValue(val);this.tagValCache.key=val}return val},get:function(result,defaultval){var tagOption=this.getTagSetting(result);return tagOption!==UNSET_OPTION?tagOption:void 0===(result=this.mergedOptions[result])?defaultval:result}}),$.fn.sparkline._base=createClass({disabled:!1,init:function(el,values,options,width,height){this.el=el,this.$el=$(el),this.values=values,this.options=options,this.width=width,this.height=height,this.currentRegion=void 0},initTarget:function(){var interactive=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),interactive))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(x,y){},setRegionHighlight:function(el,x,newRegion){var currentRegion=this.currentRegion,highlightEnabled=!this.options.get("disableHighlight");return x>this.canvasWidth||newRegion>this.canvasHeight||x<0||newRegion<0?null:currentRegion!==(newRegion=this.getRegion(el,x,newRegion))&&(void 0!==currentRegion&&highlightEnabled&&this.removeHighlight(),void 0!==(this.currentRegion=newRegion)&&highlightEnabled&&this.renderHighlight(),!0)},clearRegionHighlight:function(){return void 0!==this.currentRegion&&(this.removeHighlight(),!(this.currentRegion=void 0))},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(highlight){},getCurrentRegionTooltip:function(){var fields,formats,formatlen,fclass,text,i,showFields,showFieldsKey,newFields,fv,formatter,format,fieldlen,j,options=this.options,header="",entries=[];if(void 0===this.currentRegion)return"";if(fields=this.getCurrentRegionFields(),formatter=options.get("tooltipFormatter"))return formatter(this,options,fields);if(options.get("tooltipChartTitle")&&(header+='<div class="jqs jqstitle">'+options.get("tooltipChartTitle")+"</div>\n"),!(formats=this.options.get("tooltipFormat")))return"";if($.isArray(formats)||(formats=[formats]),$.isArray(fields)||(fields=[fields]),showFields=this.options.get("tooltipFormatFieldlist"),showFieldsKey=this.options.get("tooltipFormatFieldlistKey"),showFields&&showFieldsKey){for(newFields=[],i=fields.length;i--;)fv=fields[i][showFieldsKey],-1!=(j=$.inArray(fv,showFields))&&(newFields[j]=fields[i]);fields=newFields}for(formatlen=formats.length,fieldlen=fields.length,i=0;i<formatlen;i++)for(fclass=(format="string"==typeof(format=formats[i])?new SPFormat(format):format).fclass||"jqsfield",j=0;j<fieldlen;j++)fields[j].isNull&&options.get("tooltipSkipNull")||($.extend(fields[j],{prefix:options.get("tooltipPrefix"),suffix:options.get("tooltipSuffix")}),text=format.render(fields[j],options.get("tooltipValueLookups"),options),entries.push('<div class="'+fclass+'">'+text+"</div>"));return entries.length?header+entries.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(color,options){var parse,mult,rgbnew,i,highlightColor=options.get("highlightColor"),lighten=options.get("highlightLighten");if(highlightColor)return highlightColor;if(lighten&&(parse=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(color)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(color))){for(rgbnew=[],mult=4===color.length?16:1,i=0;i<3;i++)rgbnew[i]=clipval(Math.round(parseInt(parse[i+1],16)*mult*lighten),0,255);return"rgb("+rgbnew.join(",")+")"}return color}}),VCanvas_base={changeHighlight:function(newShapes){var currentRegion=this.currentRegion,target=this.target,shapeids=this.regionShapes[currentRegion];shapeids&&(newShapes=this.renderRegion(currentRegion,newShapes),$.isArray(newShapes)||$.isArray(shapeids)?(target.replaceWithShapes(shapeids,newShapes),this.regionShapes[currentRegion]=$.map(newShapes,function(newShape){return newShape.id})):(target.replaceWithShape(shapeids,newShapes),this.regionShapes[currentRegion]=newShapes.id))},render:function(){var shapes,ids,i,j,values=this.values,target=this.target,regionShapes=this.regionShapes;if(this.cls._super.render.call(this)){for(i=values.length;i--;)if(shapes=this.renderRegion(i))if($.isArray(shapes)){for(ids=[],j=shapes.length;j--;)shapes[j].append(),ids.push(shapes[j].id);regionShapes[i]=ids}else shapes.append(),regionShapes[i]=shapes.id;else regionShapes[i]=null;target.render()}}},$.fn.sparkline.line=line=createClass($.fn.sparkline._base,{type:"line",init:function(el,values,options,width,height){line._super.init.call(this,el,values,options,width,height),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(el,x,y){for(var regionMap=this.regionMap,i=regionMap.length;i--;)if(null!==regionMap[i]&&x>=regionMap[i][0]&&x<=regionMap[i][1])return regionMap[i][2]},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:null===this.yvalues[currentRegion],x:this.xvalues[currentRegion],y:this.yvalues[currentRegion],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:currentRegion}},renderHighlight:function(){var highlightSpot=this.currentRegion,target=this.target,vertex=this.vertices[highlightSpot],highlightLine=this.options,spotRadius=highlightLine.get("spotRadius"),highlightSpot=highlightLine.get("highlightSpotColor"),highlightLine=highlightLine.get("highlightLineColor");vertex&&(spotRadius&&highlightSpot&&(highlightSpot=target.drawCircle(vertex[0],vertex[1],spotRadius,void 0,highlightSpot),this.highlightSpotId=highlightSpot.id,target.insertAfterShape(this.lastShapeId,highlightSpot)),highlightLine&&(highlightLine=target.drawLine(vertex[0],this.canvasTop,vertex[0],this.canvasTop+this.canvasHeight,highlightLine),this.highlightLineId=highlightLine.id,target.insertAfterShape(this.lastShapeId,highlightLine)))},removeHighlight:function(){var target=this.target;this.highlightSpotId&&(target.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(target.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){for(var val,isStr,isArray,sp,values=this.values,valcount=values.length,xvalues=this.xvalues,yvalues=this.yvalues,yminmax=this.yminmax,i=0;i<valcount;i++)val=values[i],isStr="string"==typeof values[i],isArray="object"==typeof values[i]&&values[i]instanceof Array,sp=isStr&&values[i].split(":"),isStr&&2===sp.length?(xvalues.push(Number(sp[0])),yvalues.push(Number(sp[1])),yminmax.push(Number(sp[1]))):isArray?(xvalues.push(val[0]),yvalues.push(val[1]),yminmax.push(val[1])):(xvalues.push(i),null===values[i]||"null"===values[i]?yvalues.push(null):(yvalues.push(Number(val)),yminmax.push(Number(val))));this.options.get("xvalues")&&(xvalues=this.options.get("xvalues")),this.maxy=this.maxyorg=Math.max.apply(Math,yminmax),this.miny=this.minyorg=Math.min.apply(Math,yminmax),this.maxx=Math.max.apply(Math,xvalues),this.minx=Math.min.apply(Math,xvalues),this.xvalues=xvalues,this.yvalues=yvalues,this.yminmax=yminmax},processRangeOptions:function(){var options=this.options,normalRangeMin=options.get("normalRangeMin"),normalRangeMax=options.get("normalRangeMax");void 0!==normalRangeMin&&(normalRangeMin<this.miny&&(this.miny=normalRangeMin),normalRangeMax>this.maxy&&(this.maxy=normalRangeMax)),void 0!==options.get("chartRangeMin")&&(options.get("chartRangeClip")||options.get("chartRangeMin")<this.miny)&&(this.miny=options.get("chartRangeMin")),void 0!==options.get("chartRangeMax")&&(options.get("chartRangeClip")||options.get("chartRangeMax")>this.maxy)&&(this.maxy=options.get("chartRangeMax")),void 0!==options.get("chartRangeMinX")&&(options.get("chartRangeClipX")||options.get("chartRangeMinX")<this.minx)&&(this.minx=options.get("chartRangeMinX")),void 0!==options.get("chartRangeMaxX")&&(options.get("chartRangeClipX")||options.get("chartRangeMaxX")>this.maxx)&&(this.maxx=options.get("chartRangeMaxX"))},drawNormalRange:function(canvasLeft,ytop,canvasHeight,canvasWidth,height){var normalRangeMin=this.options.get("normalRangeMin"),normalRangeMax=this.options.get("normalRangeMax"),ytop=ytop+Math.round(canvasHeight-canvasHeight*((normalRangeMax-this.miny)/height)),height=Math.round(canvasHeight*(normalRangeMax-normalRangeMin)/height);this.target.drawRect(canvasLeft,ytop,canvasWidth,height,void 0,this.options.get("normalRangeColor")).append()},render:function(){var rangex,rangey,yvallast,canvasTop,canvasLeft,path,paths,x,vertex,xnext,xpos,last,next,yvalcount,lineShapes,fillShapes,plen,valueSpots,hlSpotsEnabled,color,xvalues,yvalues,i,options=this.options,target=this.target,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,vertices=this.vertices,spotRadius=options.get("spotRadius"),regionMap=this.regionMap;if(line._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),xvalues=this.xvalues,yvalues=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(canvasTop=canvasLeft=0,rangex=this.maxx-this.minx==0?1:this.maxx-this.minx,rangey=this.maxy-this.miny==0?1:this.maxy-this.miny,yvallast=this.yvalues.length-1,(spotRadius=spotRadius&&(canvasWidth<4*spotRadius||canvasHeight<4*spotRadius)?0:spotRadius)&&(((hlSpotsEnabled=options.get("highlightSpotColor")&&!options.get("disableInteraction"))||options.get("minSpotColor")||options.get("spotColor")&&yvalues[yvallast]===this.miny)&&(canvasHeight-=Math.ceil(spotRadius)),(hlSpotsEnabled||options.get("maxSpotColor")||options.get("spotColor")&&yvalues[yvallast]===this.maxy)&&(canvasHeight-=Math.ceil(spotRadius),canvasTop+=Math.ceil(spotRadius)),!hlSpotsEnabled&&(!options.get("minSpotColor")&&!options.get("maxSpotColor")||yvalues[0]!==this.miny&&yvalues[0]!==this.maxy)||(canvasLeft+=Math.ceil(spotRadius),canvasWidth-=Math.ceil(spotRadius)),(hlSpotsEnabled||options.get("spotColor")||options.get("minSpotColor")||options.get("maxSpotColor")&&(yvalues[yvallast]===this.miny||yvalues[yvallast]===this.maxy))&&(canvasWidth-=Math.ceil(spotRadius))),canvasHeight--,void 0===options.get("normalRangeMin")||options.get("drawNormalOnTop")||this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey),paths=[path=[]],last=null,yvalcount=yvalues.length,i=0;i<yvalcount;i++)x=xvalues[i],xnext=xvalues[i+1],vertex=yvalues[i],next=(xpos=canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)))+((i<yvalcount-1?canvasLeft+Math.round((xnext-this.minx)*(canvasWidth/rangex)):canvasWidth)-xpos)/2,regionMap[i]=[last||0,next,i],last=next,null===vertex?i&&(null!==yvalues[i-1]&&(path=[],paths.push(path)),vertices.push(null)):((vertex=vertex<this.miny?this.miny:vertex)>this.maxy&&(vertex=this.maxy),path.length||path.push([xpos,canvasTop+canvasHeight]),vertex=[xpos,canvasTop+Math.round(canvasHeight-canvasHeight*((vertex-this.miny)/rangey))],path.push(vertex),vertices.push(vertex));for(lineShapes=[],fillShapes=[],plen=paths.length,i=0;i<plen;i++)(path=paths[i]).length&&(options.get("fillColor")&&(path.push([path[path.length-1][0],canvasTop+canvasHeight]),fillShapes.push(path.slice(0)),path.pop()),2<path.length&&(path[0]=[path[0][0],path[1][1]]),lineShapes.push(path));for(plen=fillShapes.length,i=0;i<plen;i++)target.drawShape(fillShapes[i],options.get("fillColor"),options.get("fillColor")).append();for(void 0!==options.get("normalRangeMin")&&options.get("drawNormalOnTop")&&this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey),plen=lineShapes.length,i=0;i<plen;i++)target.drawShape(lineShapes[i],options.get("lineColor"),void 0,options.get("lineWidth")).append();if(spotRadius&&options.get("valueSpots"))for(void 0===(valueSpots=options.get("valueSpots")).get&&(valueSpots=new RangeMap(valueSpots)),i=0;i<yvalcount;i++)(color=valueSpots.get(yvalues[i]))&&target.drawCircle(canvasLeft+Math.round((xvalues[i]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[i]-this.miny)/rangey)),spotRadius,void 0,color).append();spotRadius&&options.get("spotColor")&&null!==yvalues[yvallast]&&target.drawCircle(canvasLeft+Math.round((xvalues[xvalues.length-1]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[yvallast]-this.miny)/rangey)),spotRadius,void 0,options.get("spotColor")).append(),this.maxy!==this.minyorg&&(spotRadius&&options.get("minSpotColor")&&(x=xvalues[$.inArray(this.minyorg,yvalues)],target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.minyorg-this.miny)/rangey)),spotRadius,void 0,options.get("minSpotColor")).append()),spotRadius&&options.get("maxSpotColor")&&(x=xvalues[$.inArray(this.maxyorg,yvalues)],target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.maxyorg-this.miny)/rangey)),spotRadius,void 0,options.get("maxSpotColor")).append())),this.lastShapeId=target.getLastShapeId(),this.canvasTop=canvasTop,target.render()}}}),$.fn.sparkline.bar=bar=createClass($.fn.sparkline._base,VCanvas_base,{type:"bar",init:function(el,values,options,zeroAxis,height){var groupMax,clipMin,clipMax,stacked,vlist,j,slen,svals,val,yoffset,max=parseInt(options.get("barWidth"),10),min=parseInt(options.get("barSpacing"),10),xaxisOffset=options.get("chartRangeMin"),range=options.get("chartRangeMax"),chartRangeClip=options.get("chartRangeClip"),stackMin=1/0,stackMax=-1/0;for(bar._super.init.call(this,el,values,options,zeroAxis,height),i=0,vlen=values.length;i<vlen;i++)((groupMax="string"==typeof(val=values[i])&&-1<val.indexOf(":"))||$.isArray(val))&&(stacked=!0,groupMax&&(val=values[i]=normalizeValues(val.split(":"))),val=remove(val,null),(groupMax=Math.min.apply(Math,val))<stackMin&&(stackMin=groupMax),stackMax<(groupMax=Math.max.apply(Math,val))&&(stackMax=groupMax));this.stacked=stacked,this.regionShapes={},this.barWidth=max,this.barSpacing=min,this.totalBarWidth=max+min,this.width=zeroAxis=values.length*max+(values.length-1)*min,this.initTarget(),chartRangeClip&&(clipMin=void 0===xaxisOffset?-1/0:xaxisOffset,clipMax=void 0===range?1/0:range);for(var numValues=[],stackRanges=stacked?[]:numValues,stackTotals=[],stackRangesNeg=[],i=0,vlen=values.length;i<vlen;i++)if(stacked)for(vlist=values[i],values[i]=svals=[],stackTotals[i]=0,j=stackRanges[i]=stackRangesNeg[i]=0,slen=vlist.length;j<slen;j++)null!==(val=svals[j]=chartRangeClip?clipval(vlist[j],clipMin,clipMax):vlist[j])&&(0<val&&(stackTotals[i]+=val),stackMin<0&&0<stackMax?val<0?stackRangesNeg[i]+=Math.abs(val):stackRanges[i]+=val:stackRanges[i]+=Math.abs(val-(val<0?stackMax:stackMin)),numValues.push(val));else val=chartRangeClip?clipval(values[i],clipMin,clipMax):values[i],null!==(val=values[i]=normalizeValue(val))&&numValues.push(val);this.max=max=Math.max.apply(Math,numValues),this.min=min=Math.min.apply(Math,numValues),this.stackMax=stackMax=stacked?Math.max.apply(Math,stackTotals):max,this.stackMin=stackMin=stacked?Math.min.apply(Math,numValues):min,void 0!==options.get("chartRangeMin")&&(options.get("chartRangeClip")||options.get("chartRangeMin")<min)&&(min=options.get("chartRangeMin")),void 0!==options.get("chartRangeMax")&&(options.get("chartRangeClip")||options.get("chartRangeMax")>max)&&(max=options.get("chartRangeMax")),this.zeroAxis=zeroAxis=options.get("zeroAxis",!0),xaxisOffset=min<=0&&0<=max&&zeroAxis?0:0==zeroAxis||0<min?min:max,this.xaxisOffset=xaxisOffset,range=stacked?Math.max.apply(Math,stackRanges)+Math.max.apply(Math,stackRangesNeg):max-min,this.canvasHeightEf=zeroAxis&&min<0?this.canvasHeight-2:this.canvasHeight-1,min<xaxisOffset?(yoffset=((stacked&&0<=max?stackMax:max)-xaxisOffset)/range*this.canvasHeight)!==Math.ceil(yoffset)&&(this.canvasHeightEf-=2,yoffset=Math.ceil(yoffset)):yoffset=this.canvasHeight,this.yoffset=yoffset,$.isArray(options.get("colorMap"))?(this.colorMapByIndex=options.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=options.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new RangeMap(this.colorMapByValue))),this.range=range},getRegion:function(el,result,y){result=Math.floor(result/this.totalBarWidth);return result<0||result>=this.values.length?void 0:result},getCurrentRegionFields:function(){for(var value,currentRegion=this.currentRegion,values=ensureArray(this.values[currentRegion]),result=[],i=values.length;i--;)value=values[i],result.push({isNull:null===value,value:value,color:this.calcColor(i,value,currentRegion),offset:currentRegion});return result},calcColor:function(stacknum,value,valuenum){var newColor,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,options=this.options,color=this.stacked?options.get("stackedBarColor"):value<0?options.get("negBarColor"):options.get("barColor");return 0===value&&void 0!==options.get("zeroColor")&&(color=options.get("zeroColor")),colorMapByValue&&(newColor=colorMapByValue.get(value))?color=newColor:colorMapByIndex&&colorMapByIndex.length>valuenum&&(color=colorMapByIndex[valuenum]),$.isArray(color)?color[stacknum%color.length]:color},renderRegion:function(valuenum,highlight){var y,height,color,yoffsetNeg,i,minPlotted,vals=this.values[valuenum],options=this.options,xaxisOffset=this.xaxisOffset,result=[],range=this.range,stacked=this.stacked,target=this.target,x=valuenum*this.totalBarWidth,canvasHeightEf=this.canvasHeightEf,yoffset=this.yoffset,valcount=(vals=$.isArray(vals)?vals:[vals]).length,val=vals[0],isNull=all(null,vals),allMin=all(xaxisOffset,vals,!0);if(isNull)return options.get("nullColor")?(color=highlight?options.get("nullColor"):this.calcHighlightColor(options.get("nullColor"),options),y=0<yoffset?yoffset-1:yoffset,target.drawRect(x,y,this.barWidth-1,0,color,color)):void 0;for(yoffsetNeg=yoffset,i=0;i<valcount;i++){if(val=vals[i],stacked&&val===xaxisOffset){if(!allMin||minPlotted)continue;minPlotted=!0}height=0<range?Math.floor(canvasHeightEf*(Math.abs(val-xaxisOffset)/range))+1:1,val<xaxisOffset||val===xaxisOffset&&0===yoffset?(y=yoffsetNeg,yoffsetNeg+=height):(y=yoffset-height,yoffset-=height),color=this.calcColor(i,val,valuenum),highlight&&(color=this.calcHighlightColor(color,options)),result.push(target.drawRect(x,y,this.barWidth-1,height-1,color,color))}return 1===result.length?result[0]:result}}),$.fn.sparkline.tristate=tristate=createClass($.fn.sparkline._base,VCanvas_base,{type:"tristate",init:function(el,values,options,width,height){var barWidth=parseInt(options.get("barWidth"),10),barSpacing=parseInt(options.get("barSpacing"),10);tristate._super.init.call(this,el,values,options,width,height),this.regionShapes={},this.barWidth=barWidth,this.barSpacing=barSpacing,this.totalBarWidth=barWidth+barSpacing,this.values=$.map(values,Number),this.width=width=values.length*barWidth+(values.length-1)*barSpacing,$.isArray(options.get("colorMap"))?(this.colorMapByIndex=options.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=options.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new RangeMap(this.colorMapByValue))),this.initTarget()},getRegion:function(el,x,y){return Math.floor(x/this.totalBarWidth)},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:void 0===this.values[currentRegion],value:this.values[currentRegion],color:this.calcColor(this.values[currentRegion],currentRegion),offset:currentRegion}},calcColor:function(value,valuenum){var newColor,values=this.values,color=this.options,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,color=colorMapByValue&&(newColor=colorMapByValue.get(value))?newColor:colorMapByIndex&&colorMapByIndex.length>valuenum?colorMapByIndex[valuenum]:values[valuenum]<0?color.get("negBarColor"):0<values[valuenum]?color.get("posBarColor"):color.get("zeroBarColor");return color},renderRegion:function(color,highlight){var y,values=this.values,options=this.options,target=this.target,x=target.pixelHeight,height=Math.round(x/2),x=color*this.totalBarWidth,height=values[color]<0?(y=height)-1:0<values[color]?(y=0,height-1):(y=height-1,2),color=this.calcColor(values[color],color);if(null!==color)return highlight&&(color=this.calcHighlightColor(color,options)),target.drawRect(x,y,this.barWidth-1,height-1,color,color)}}),$.fn.sparkline.discrete=discrete=createClass($.fn.sparkline._base,VCanvas_base,{type:"discrete",init:function(el,values,options,width,height){discrete._super.init.call(this,el,values,options,width,height),this.regionShapes={},this.values=values=$.map(values,Number),this.min=Math.min.apply(Math,values),this.max=Math.max.apply(Math,values),this.range=this.max-this.min,this.width=width="auto"===options.get("width")?2*values.length:this.width,this.interval=Math.floor(width/values.length),this.itemWidth=width/values.length,void 0!==options.get("chartRangeMin")&&(options.get("chartRangeClip")||options.get("chartRangeMin")<this.min)&&(this.min=options.get("chartRangeMin")),void 0!==options.get("chartRangeMax")&&(options.get("chartRangeClip")||options.get("chartRangeMax")>this.max)&&(this.max=options.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===options.get("lineHeight")?Math.round(.3*this.canvasHeight):options.get("lineHeight"))},getRegion:function(el,x,y){return Math.floor(x/this.itemWidth)},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:void 0===this.values[currentRegion],value:this.values[currentRegion],offset:currentRegion}},renderRegion:function(valuenum,highlight){var values=this.values,options=this.options,min=this.min,color=this.max,range=this.range,x=this.interval,target=this.target,ytop=this.canvasHeight,lineHeight=this.lineHeight,ytop=ytop-lineHeight,color=clipval(values[valuenum],min,color),x=valuenum*x,ytop=Math.round(ytop-(color-min)/range*ytop),color=options.get("thresholdColor")&&color<options.get("thresholdValue")?options.get("thresholdColor"):options.get("lineColor");return highlight&&(color=this.calcHighlightColor(color,options)),target.drawLine(x,ytop,x,ytop+lineHeight,color)}}),$.fn.sparkline.bullet=bullet=createClass($.fn.sparkline._base,{type:"bullet",init:function(min,values,options,width,height){var max;bullet._super.init.call(this,min,values,options,width,height),this.values=values=normalizeValues(values),(max=values.slice())[0]=null===max[0]?max[2]:max[0],max[1]=null===values[1]?max[2]:max[1],min=Math.min.apply(Math,values),max=Math.max.apply(Math,values),min=void 0===options.get("base")?min<0?min:0:options.get("base"),this.min=min,this.max=max,this.range=max-min,this.shapes={},this.valueShapes={},this.regiondata={},this.width=width="auto"===options.get("width")?"4.0em":width,this.target=this.$el.simpledraw(width,height,options.get("composite")),values.length||(this.disabled=!0),this.initTarget()},getRegion:function(el,x,shapeid){shapeid=this.target.getShapeAt(el,x,shapeid);return void 0!==shapeid&&void 0!==this.shapes[shapeid]?this.shapes[shapeid]:void 0},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{fieldkey:currentRegion.substr(0,1),value:this.values[currentRegion.substr(1)],region:currentRegion}},changeHighlight:function(highlight){var shape,currentRegion=this.currentRegion,shapeid=this.valueShapes[currentRegion];switch(delete this.shapes[shapeid],currentRegion.substr(0,1)){case"r":shape=this.renderRange(currentRegion.substr(1),highlight);break;case"p":shape=this.renderPerformance(highlight);break;case"t":shape=this.renderTarget(highlight)}this.valueShapes[currentRegion]=shape.id,this.shapes[shape.id]=currentRegion,this.target.replaceWithShape(shapeid,shape)},renderRange:function(color,highlight){var rangewidth=this.values[color],rangewidth=Math.round(this.canvasWidth*((rangewidth-this.min)/this.range)),color=this.options.get("rangeColors")[color-2];return highlight&&(color=this.calcHighlightColor(color,this.options)),this.target.drawRect(0,0,rangewidth-1,this.canvasHeight-1,color,color)},renderPerformance:function(highlight){var color=this.values[1],perfwidth=Math.round(this.canvasWidth*((color-this.min)/this.range)),color=this.options.get("performanceColor");return highlight&&(color=this.calcHighlightColor(color,this.options)),this.target.drawRect(0,Math.round(.3*this.canvasHeight),perfwidth-1,Math.round(.4*this.canvasHeight)-1,color,color)},renderTarget:function(highlight){var color=this.values[0],x=Math.round(this.canvasWidth*((color-this.min)/this.range)-this.options.get("targetWidth")/2),targettop=Math.round(.1*this.canvasHeight),targetheight=this.canvasHeight-2*targettop,color=this.options.get("targetColor");return highlight&&(color=this.calcHighlightColor(color,this.options)),this.target.drawRect(x,targettop,this.options.get("targetWidth")-1,targetheight-1,color,color)},render:function(){var i,shape,vlen=this.values.length,target=this.target;if(bullet._super.render.call(this)){for(i=2;i<vlen;i++)shape=this.renderRange(i).append(),this.shapes[shape.id]="r"+i,this.valueShapes["r"+i]=shape.id;null!==this.values[1]&&(shape=this.renderPerformance().append(),this.shapes[shape.id]="p1",this.valueShapes.p1=shape.id),null!==this.values[0]&&(shape=this.renderTarget().append(),this.shapes[shape.id]="t0",this.valueShapes.t0=shape.id),target.render()}}}),$.fn.sparkline.pie=pie=createClass($.fn.sparkline._base,{type:"pie",init:function(el,values,options,width,height){var i,total=0;if(pie._super.init.call(this,el,values,options,width,height),this.shapes={},this.valueShapes={},this.values=values=$.map(values,Number),"auto"===options.get("width")&&(this.width=this.height),0<values.length)for(i=values.length;i--;)total+=values[i];this.total=total,this.initTarget(),this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(el,x,shapeid){shapeid=this.target.getShapeAt(el,x,shapeid);return void 0!==shapeid&&void 0!==this.shapes[shapeid]?this.shapes[shapeid]:void 0},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:void 0===this.values[currentRegion],value:this.values[currentRegion],percent:this.values[currentRegion]/this.total*100,color:this.options.get("sliceColors")[currentRegion%this.options.get("sliceColors").length],offset:currentRegion}},changeHighlight:function(shapeid){var currentRegion=this.currentRegion,newslice=this.renderSlice(currentRegion,shapeid),shapeid=this.valueShapes[currentRegion];delete this.shapes[shapeid],this.target.replaceWithShape(shapeid,newslice),this.valueShapes[currentRegion]=newslice.id,this.shapes[newslice.id]=currentRegion},renderSlice:function(valuenum,highlight){for(var start,end,color,target=this.target,options=this.options,radius=this.radius,borderWidth=options.get("borderWidth"),offset=options.get("offset"),circle=2*Math.PI,values=this.values,total=this.total,next=offset?2*Math.PI*(offset/360):0,vlen=values.length,i=0;i<vlen;i++){if(end=start=next,0<total&&(end=next+circle*(values[i]/total)),valuenum===i)return color=options.get("sliceColors")[i%options.get("sliceColors").length],highlight&&(color=this.calcHighlightColor(color,options)),target.drawPieSlice(radius,radius,radius-borderWidth,start,end,void 0,color);next=end}},render:function(){var shape,i,target=this.target,values=this.values,options=this.options,radius=this.radius,borderWidth=options.get("borderWidth");if(pie._super.render.call(this)){for(borderWidth&&target.drawCircle(radius,radius,Math.floor(radius-borderWidth/2),options.get("borderColor"),void 0,borderWidth).append(),i=values.length;i--;)values[i]&&(shape=this.renderSlice(i).append(),this.valueShapes[i]=shape.id,this.shapes[shape.id]=i);target.render()}}}),$.fn.sparkline.box=box=createClass($.fn.sparkline._base,{type:"box",init:function(el,values,options,width,height){box._super.init.call(this,el,values,options,width,height),this.values=$.map(values,Number),this.width="auto"===options.get("width")?"4.0em":width,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var result=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return void 0!==this.loutlier&&result.push({field:"lo",value:this.loutlier}),void 0!==this.routlier&&result.push({field:"ro",value:this.routlier}),void 0!==this.lwhisker&&result.push({field:"lw",value:this.lwhisker}),void 0!==this.rwhisker&&result.push({field:"rw",value:this.rwhisker}),result},render:function(){var lwhisker,loutlier,iqr,q1,q3,rwhisker,routlier,i,size,unitSize,target=this.target,values=this.values,vlen=values.length,options=this.options,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,minValue=void 0===options.get("chartRangeMin")?Math.min.apply(Math,values):options.get("chartRangeMin"),maxValue=void 0===options.get("chartRangeMax")?Math.max.apply(Math,values):options.get("chartRangeMax"),canvasLeft=0;if(box._super.render.call(this)){if(options.get("raw"))options.get("showOutliers")&&5<values.length?(loutlier=values[0],lwhisker=values[1],q1=values[2],size=values[3],q3=values[4],rwhisker=values[5],routlier=values[6]):(lwhisker=values[0],q1=values[1],size=values[2],q3=values[3],rwhisker=values[4]);else if(values.sort(function(a,b){return a-b}),q1=quartile(values,1),size=quartile(values,2),iqr=(q3=quartile(values,3))-q1,options.get("showOutliers")){for(lwhisker=rwhisker=void 0,i=0;i<vlen;i++)void 0===lwhisker&&values[i]>q1-iqr*options.get("outlierIQR")&&(lwhisker=values[i]),values[i]<q3+iqr*options.get("outlierIQR")&&(rwhisker=values[i]);loutlier=values[0],routlier=values[vlen-1]}else lwhisker=values[0],rwhisker=values[vlen-1];this.quartiles=[q1,size,q3],this.lwhisker=lwhisker,this.rwhisker=rwhisker,this.loutlier=loutlier,this.routlier=routlier,unitSize=canvasWidth/(maxValue-minValue+1),options.get("showOutliers")&&(canvasLeft=Math.ceil(options.get("spotRadius")),unitSize=(canvasWidth-=2*Math.ceil(options.get("spotRadius")))/(maxValue-minValue+1),loutlier<lwhisker&&target.drawCircle((loutlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get("spotRadius"),options.get("outlierLineColor"),options.get("outlierFillColor")).append(),rwhisker<routlier&&target.drawCircle((routlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get("spotRadius"),options.get("outlierLineColor"),options.get("outlierFillColor")).append()),target.drawRect(Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(.1*canvasHeight),Math.round((q3-q1)*unitSize),Math.round(.8*canvasHeight),options.get("boxLineColor"),options.get("boxFillColor")).append(),target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get("lineColor")).append(),target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get("whiskerColor")).append(),target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q3-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get("lineColor")).append(),target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get("whiskerColor")).append(),target.drawLine(Math.round((size-minValue)*unitSize+canvasLeft),Math.round(.1*canvasHeight),Math.round((size-minValue)*unitSize+canvasLeft),Math.round(.9*canvasHeight),options.get("medianColor")).append(),options.get("target")&&(size=Math.ceil(options.get("spotRadius")),target.drawLine(Math.round((options.get("target")-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2-size),Math.round((options.get("target")-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2+size),options.get("targetColor")).append(),target.drawLine(Math.round((options.get("target")-minValue)*unitSize+canvasLeft-size),Math.round(canvasHeight/2),Math.round((options.get("target")-minValue)*unitSize+canvasLeft+size),Math.round(canvasHeight/2),options.get("targetColor")).append()),target.render()}}}),VShape=createClass({init:function(target,id,type,args){this.target=target,this.id=id,this.type=type,this.args=args},append:function(){return this.target.appendShape(this),this}}),VCanvas_base=createClass({_pxregex:/(\d+)(px)?\s*$/i,init:function(width,height,target){width&&(this.width=width,this.height=height,this.target=target,this.lastShapeId=null,target[0]&&(target=target[0]),$.data(target,"_jqs_vcanvas",this))},drawLine:function(x1,y1,x2,y2,lineColor,lineWidth){return this.drawShape([[x1,y1],[x2,y2]],lineColor,lineWidth)},drawShape:function(path,lineColor,fillColor,lineWidth){return this._genShape("Shape",[path,lineColor,fillColor,lineWidth])},drawCircle:function(x,y,radius,lineColor,fillColor,lineWidth){return this._genShape("Circle",[x,y,radius,lineColor,fillColor,lineWidth])},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){return this._genShape("PieSlice",[x,y,radius,startAngle,endAngle,lineColor,fillColor])},drawRect:function(x,y,width,height,lineColor,fillColor){return this._genShape("Rect",[x,y,width,height,lineColor,fillColor])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(el,target){$(target).html(el)},_calculatePixelDims:function(width,match,canvas){match=this._pxregex.exec(match);this.pixelHeight=match?match[1]:$(canvas).height(),match=this._pxregex.exec(width),this.pixelWidth=match?match[1]:$(canvas).width()},_genShape:function(shapetype,shapeargs){var id=shapeCount++;return shapeargs.unshift(id),new VShape(this,id,shapetype,shapeargs)},appendShape:function(shape){alert("appendShape not implemented")},replaceWithShape:function(shapeid,shape){alert("replaceWithShape not implemented")},insertAfterShape:function(shapeid,shape){alert("insertAfterShape not implemented")},removeShapeId:function(shapeid){alert("removeShapeId not implemented")},getShapeAt:function(el,x,y){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),VCanvas_canvas=createClass(VCanvas_base,{init:function(width,height,target,interact){VCanvas_canvas._super.init.call(this,width,height,target),this.canvas=document.createElement("canvas"),target[0]&&(target=target[0]),$.data(target,"_jqs_vcanvas",this),$(this.canvas).css({display:"inline-block",width:width,height:height,verticalAlign:"top"}),this._insert(this.canvas,target),this._calculatePixelDims(width,height,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=interact,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0,$(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(lineColor,fillColor,lineWidth){var context=this.canvas.getContext("2d");return void 0!==lineColor&&(context.strokeStyle=lineColor),context.lineWidth=void 0===lineWidth?1:lineWidth,void 0!==fillColor&&(context.fillStyle=fillColor),context},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0},_drawShape:function(shapeid,path,lineColor,fillColor,lineWidth){var i,plen,context=this._getContext(lineColor,fillColor,lineWidth);for(context.beginPath(),context.moveTo(path[0][0]+.5,path[0][1]+.5),i=1,plen=path.length;i<plen;i++)context.lineTo(path[i][0]+.5,path[i][1]+.5);void 0!==lineColor&&context.stroke(),void 0!==fillColor&&context.fill(),void 0!==this.targetX&&void 0!==this.targetY&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid)},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,context){context=this._getContext(lineColor,fillColor,context);context.beginPath(),context.arc(x,y,radius,0,2*Math.PI,!1),void 0!==this.targetX&&void 0!==this.targetY&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid),void 0!==lineColor&&context.stroke(),void 0!==fillColor&&context.fill()},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);context.beginPath(),context.moveTo(x,y),context.arc(x,y,radius,startAngle,endAngle,!1),context.lineTo(x,y),context.closePath(),void 0!==lineColor&&context.stroke(),fillColor&&context.fill(),void 0!==this.targetX&&void 0!==this.targetY&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid)},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x+width,y],[x+width,y+height],[x,y+height],[x,y]],lineColor,fillColor)},appendShape:function(shape){return this.shapes[shape.id]=shape,this.shapeseq.push(shape.id),this.lastShapeId=shape.id,shape.id},replaceWithShape:function(shapeid,shape){var i,shapeseq=this.shapeseq;for(this.shapes[shape.id]=shape,i=shapeseq.length;i--;)shapeseq[i]==shapeid&&(shapeseq[i]=shape.id);delete this.shapes[shapeid]},replaceWithShapes:function(shapeids,shapes){for(var sid,first,shapeseq=this.shapeseq,shapemap={},i=shapeids.length;i--;)shapemap[shapeids[i]]=!0;for(i=shapeseq.length;i--;)shapemap[sid=shapeseq[i]]&&(shapeseq.splice(i,1),delete this.shapes[sid],first=i);for(i=shapes.length;i--;)shapeseq.splice(first,0,shapes[i].id),this.shapes[shapes[i].id]=shapes[i]},insertAfterShape:function(shapeid,shape){for(var shapeseq=this.shapeseq,i=shapeseq.length;i--;)if(shapeseq[i]===shapeid)return shapeseq.splice(i+1,0,shape.id),void(this.shapes[shape.id]=shape)},removeShapeId:function(shapeid){for(var shapeseq=this.shapeseq,i=shapeseq.length;i--;)if(shapeseq[i]===shapeid){shapeseq.splice(i,1);break}delete this.shapes[shapeid]},getShapeAt:function(el,x,y){return this.targetX=x,this.targetY=y,this.render(),this.currentTargetShapeId},render:function(){var shape,i,shapeseq=this.shapeseq,shapes=this.shapes,shapeCount=shapeseq.length;for(this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),i=0;i<shapeCount;i++)this["_draw"+(shape=shapes[shapeseq[i]]).type].apply(this,shape.args);this.interact||(this.shapes={},this.shapeseq=[])}}),VCanvas_vml=createClass(VCanvas_base,{init:function(width,groupel,target){VCanvas_vml._super.init.call(this,width,groupel,target),target[0]&&(target=target[0]),$.data(target,"_jqs_vcanvas",this),this.canvas=document.createElement("span"),$(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:width,height:groupel,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,target),this._calculatePixelDims(width,groupel,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,groupel='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",groupel),this.group=$(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(shapeid,path,fill,closed,stroke){for(var initial,vpath=[],i=0,plen=path.length;i<plen;i++)vpath[i]=path[i][0]+","+path[i][1];return initial=vpath.splice(0,1),stroke=void 0===stroke?1:stroke,stroke=void 0===fill?' stroked="false" ':' strokeWeight="'+stroke+'px" strokeColor="'+fill+'" ',fill=void 0===closed?' filled="false"':' fillColor="'+closed+'" filled="true" ',closed=vpath[0]===vpath[vpath.length-1]?"x ":"",'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+shapeid+'" '+stroke+fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+initial+" l "+vpath.join(", ")+" "+closed+'e"> </v:shape>'},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,lineWidth){return'<v:oval  id="jqsshape'+shapeid+'" '+(void 0===lineColor?' stroked="false" ':' strokeWeight="'+lineWidth+'px" strokeColor="'+lineColor+'" ')+(void 0===fillColor?' filled="false"':' fillColor="'+fillColor+'" filled="true" ')+' style="position:absolute;top:'+(y-=radius)+"px; left:"+(x-=radius)+"px; width:"+2*radius+"px; height:"+2*radius+'px"></v:oval>'},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,stroke,fill){var startx,starty,endx,vpath;if(startAngle===endAngle)return"";if(endAngle-startAngle==2*Math.PI&&(startAngle=0,endAngle=2*Math.PI),startx=x+Math.round(Math.cos(startAngle)*radius),starty=y+Math.round(Math.sin(startAngle)*radius),endx=x+Math.round(Math.cos(endAngle)*radius),vpath=y+Math.round(Math.sin(endAngle)*radius),startx===endx&&starty===vpath){if(endAngle-startAngle<Math.PI)return"";startx=endx=x+radius,starty=vpath=y}return startx===endx&&starty===vpath&&endAngle-startAngle<Math.PI?"":(vpath=[x-radius,y-radius,x+radius,y+radius,startx,starty,endx,vpath],stroke=void 0===stroke?' stroked="false" ':' strokeWeight="1px" strokeColor="'+stroke+'" ',fill=void 0===fill?' filled="false"':' fillColor="'+fill+'" filled="true" ','<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+shapeid+'" '+stroke+fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+x+","+y+" wa "+vpath.join(", ")+' x e"> </v:shape>')},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x,y+height],[x+width,y+height],[x+width,y],[x,y]],lineColor,fillColor)},reset:function(){this.group.innerHTML=""},appendShape:function(shape){var vel=this["_draw"+shape.type].apply(this,shape.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",vel):this.prerender+=vel,this.lastShapeId=shape.id,shape.id},replaceWithShape:function(existing,vel){existing=$("#jqsshape"+existing),vel=this["_draw"+vel.type].apply(this,vel.args);existing[0].outerHTML=vel},replaceWithShapes:function(shapeids,shapes){for(var existing=$("#jqsshape"+shapeids[0]),replace="",slen=shapes.length,i=0;i<slen;i++)replace+=this["_draw"+shapes[i].type].apply(this,shapes[i].args);for(existing[0].outerHTML=replace,i=1;i<shapeids.length;i++)$("#jqsshape"+shapeids[i]).remove()},insertAfterShape:function(existing,vel){existing=$("#jqsshape"+existing),vel=this["_draw"+vel.type].apply(this,vel.args);existing[0].insertAdjacentHTML("afterEnd",vel)},removeShapeId:function(existing){existing=$("#jqsshape"+existing);this.group.removeChild(existing[0])},getShapeAt:function(el,x,y){return el.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})},"function"==typeof define&&define.amd?define("sparkline",["jquery"],factory):jQuery&&!jQuery.fn.sparkline&&factory(jQuery)}(document,Math),define("download",["jquery","config","laconic"],function($,config){!function($){var methods={_init:function(options){return this.each(function(){var elem=$(this),href=options.uuid,type=options.content_type||"application/octet-stream",name=options.filename||"swish-download.dat";(function aSupportsDownload(){return null!=$("<a>")[0].download})()&&type||(type="application/octet-stream");href=config.http.locations.download+"/"+encodeURIComponent(name)+"?content_type="+encodeURIComponent(type)+"&uuid="+href;elem.attr("download",name),elem.attr("href",href),elem.attr("title","Download (use menu for save link as)"),elem.text(name),elem.addClass("btn btn-primary download"),elem.append($.el.span({class:"glyphicon glyphicon-download"}))})}};$.fn.downloader=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.downloader"):methods._init.apply(this,arguments)}}(jQuery)}),define("runner",["jquery","config","preferences","utils","cm/lib/codemirror","form","prolog","links","modal","backend","answer","laconic","sparkline","download","search"],function($,config,preferences,utils,CodeMirror,form,prolog,links,modal,backend){function glyphButton(glyph,title){return $.el.a({href:"#",class:"close btn btn-link btn-sm",title:title},$.el.span({class:"glyphicon glyphicon-"+glyph}))}!function($){var methods={_init:function(options){return this.each(function(){var elem=$(this),data={};data.stretch=$($.el.div({class:"stretch"})),data.inner=$($.el.div({class:"inner"})),elem.append(function runnerMenu(){var icon=$.el.span({class:"glyphicon glyphicon-menu-hamburger"}),actions={"Collapse all":function(){this.find(".prolog-runner").prologRunner("toggleIconic",!0)},"Expand all":function(){this.find(".prolog-runner").prologRunner("toggleIconic",!1)},"Stop all":function(){this.find(".prolog-runner").prologRunner("stop")},Clear:function(){this.prologRunners("clear")}};return config.swish.tasks&&config.swish.tasks.enabled&&(actions["--"]="divider",actions["List detached tasks"]=function(){this.prologRunners("list_tasks")},actions["Re-attach all"]=function(){this.prologRunners("reattach")}),form.widgets.dropdownButton(icon,{divClass:"runners-menu btn-transparent",ulClass:"pull-right",client:elem,actions:actions})}()),elem.append(data.stretch),elem.append(data.inner),elem.on("pane.resize",function(){elem.prologRunners("scrollToBottom",!0)}),elem.on("scroll-to-bottom",function(ev,arg){elem.prologRunners("scrollToBottom",arg)}),elem.data("prologRunners",data)})},run:function(query){var data=this.data("prologRunners");query.iconifyLast&&this.prologRunners("iconifyLast");var runner=$.el.div({class:"prolog-runner"});return data.inner.append(runner),$(runner).prologRunner(query),this.trigger("scroll-to-bottom"),this},clear:function(){this.find(".prolog-runner").prologRunner("close")},list_tasks:function(){var runners=this;return form.showDialog({title:"Detached tasks",body:function listTasks(){var content=this;!function refresh(){backend.ajax({url:config.http.locations.pengines+"/list?application=swish",type:"GET",success:function(reply){if(content.empty(),reply.pengines&&0<reply.pengines.length){var table;content.append(table=$.el.table({class:"table table-striped table-condensed task-list"})),$(table).append($.el.tr($.el.th("Query"),$.el.th("Started"),$.el.th("Detached"),$.el.th("CPU"),$.el.th("Events")));for(var i=0;i<reply.pengines.length;i++)!function addRow(table,pengine){var info=pengine.detached||{},times=(pengine.stats||{}).time||{},eye=form.widgets.glyphIconButton("eye-open",{title:"Attach",class:"btn-primary btn-xs"});table.append($.el.tr($.el.td(info.query||"?"),$.el.td(utils.ago(times.epoch)),$.el.td(utils.ago(info.time)),$.el.td(times.cpu.toFixed(3)),$.el.td(pengine.queued),$.el.td(eye))),$(eye).on("click",function(ev){runners.prologRunners("attach",pengine),$(ev.target).closest("tr").remove()})}($(table),reply.pengines[i]);var btn=form.widgets.glyphIconButton("refresh",{title:"Refresh list",class:"btn-primary"});content.append(btn),$(btn).on("click",function(){content.find("table").addClass("refreshing"),refresh()})}else content.append($.el.div("No detached tasks"))},error:function(jqXHR){modal.ajaxError(jqXHR)}})}()}}),this},reattach:function(){var that=this;backend.ajax({url:config.http.locations.pengines+"/list?application=swish",type:"GET",success:function(reply){if(reply.pengines)for(var i=0;i<reply.pengines.length;i++)that.prologRunners("attach",reply.pengines[i])},error:function(jqXHR){modal.ajaxError(jqXHR)}})},attach:function(pengine){var data=this.data("prologRunners"),runner=$.el.div({class:"prolog-runner"}),info=pengine.detached||{};return data.inner.append(runner),$(runner).prologRunner({id:pengine.id,query:info.query||"Detached",state:info.state}),this.trigger("scroll-to-bottom"),this},iconifyLast:function(){var runner=$(this.inner).children().last();return 1==runner.length&&((runner=runner.prologRunner()).alive()||runner.toggleIconic(!0)),this},scrollToBottom:function(onlydown){return this.each(function(){var elem=$(this),data=elem.data("prologRunners"),height=data.inner.height(),room=elem.height()-height-4-2;(0<room||!0!==onlydown)&&(data.stretch.height(0<room?room:0),elem.scrollTop(height))}),this}};$.fn.prologRunners=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.prologRunners"):methods._init.apply(this,arguments)}}(jQuery),function($){var pluginName="prologRunner",keyBindings={59:"next",186:"next",32:"next",190:"stop",13:"stop",65:"stopOrAbort",27:"stopOrAbort",46:"close",112:"help"},methods={_init:function(query){return this.each(function(){var qspan,elem=$(this),data={};function titleBarButton(btn,title,action,display){btn=$.el.button({title:title,class:"rtb-"+action},$.el.span({class:"glyphicon glyphicon-"+btn}));return $(btn).on("click",function(){elem.prologRunner(action)}),0==display&&$(btn).hide(),btn}return elem.addClass("prolog-runner panel panel-default"),query.tabled&&elem.addClass("tabled"),0!=query.title?(qspan=$.el.span({class:"query cm-s-prolog"}),CodeMirror.runMode(query.query,"prolog",qspan),elem.append($.el.div({class:"runner-title panel-heading"},titleBarButton("remove-circle","Close","close"),titleBarButton("minus","Iconify","toggleIconic"),titleBarButton("download","Download CSV","downloadCSV"),titleBarButton("link","Permalink","permalink",!1),function stateButton(){var icon=$.el.span({class:"runner-state show-state idle"});return form.widgets.dropdownButton(icon)}(),qspan,$.el.br({clear:"all"})))):elem.append($.el.div({class:"runner-title runner-button-group"},titleBarButton("remove-circle","Close","close"),titleBarButton("minus","Iconify","toggleIconic"),titleBarButton("download","Download CSV","downloadCSV"),titleBarButton("link","Permalink","permalink",!1))),query.chunk&&(data.chunk=query.chunk),elem.append($.el.div({class:"runner-results panel-body"})),elem.append(function controllerDiv(){function abort(){data.prolog.abort()}function detach(){elem.prologRunner("detach")}function button(action,btn){btn=$.el.button(btn);return $(btn).on("click",action),btn}var inp=function input(){var inp=$.el.input({class:"prolog-input"}),btn=$.el.button("Send");return $(inp).keypress(function(ev){return 13==ev.which&&elem.prologRunner("respond",$(inp).val())?($(inp).val(""),ev.preventDefault(),!1):void("Esc"!=ev.key&&ev.stopPropagation())}),$(btn).on("click",function(){elem.prologRunner("respond",$(inp).val())}),{input:inp,button:btn}}();return $.el.div({class:"controller show-state"},$.el.span({class:"running"},button(abort,"Abort"),function detach_button(){if(config.swish.tasks&&config.swish.tasks.enabled)return button(detach,"Detach")}()),$.el.span({class:"wait-next"},button(function next(){elem.prologRunner("next",1)},"Next"),button(function next10(){elem.prologRunner("next",10)},"10"),button(function next100(){elem.prologRunner("next",100)},"100"),button(function next1000(){elem.prologRunner("next",1e3)},"1,000")," ",button(function stop(){data.prolog.stop()},"Stop")),$.el.span({class:"wait-input"},button(abort,"Abort"),inp.button,$.el.span(inp.input)),function statusChart(){return $.el.span({class:"sparklines"},"")}())}()),elem.data("prologRunner",data),elem.prologRunner("populateActionMenu"),elem.keydown(function(ev){"wait-input"==elem.prologRunner("getState")||$(ev.target).is("input")||ev.ctrlKey||ev.altKey||keyBindings[ev.which]&&(ev.preventDefault(),elem.prologRunner(keyBindings[ev.which]))}),elem.on("click","a",links.followLink),data.savedFocus=document.activeElement,elem.attr("tabindex",-1),elem.focus(),data.query=query,data.answers=0,elem.prologRunner("setScreenDimensions"),require([config.http.locations.pengines+"/pengines.js"],function(){var pdata={server:backend.url+config.http.locations.pengines,runner:elem,application:"swish",src:query.source,destroy:!1,format:"json-html",collate:.01,oncreate:handleCreate,onsuccess:handleSuccess,onfailure:handleFailure,onstop:handleStop,onprompt:handlePrompt,onoutput:handleOutput,onping:handlePing,onerror:handleError,onabort:handleAbort,ondetach:handleDetach};query.id&&(pdata.id=query.id),data.prolog=new Pengine(pdata),data.prolog.state="idle",query.state&&elem.prologRunner("setState",query.state),config.swish.ping&&null!=data.prolog.ping&&data.prolog.ping(1e3*config.swish.ping)}),this})},setScreenDimensions:function(){var sh,data=this.data(pluginName),pre=$.el.pre({class:"measure"},"xxxxxxxxxx"),sw=this.width(),ch=this.closest(".prolog-runners");(ch=0==ch.length?this.closest(".nb-view"):ch).length&&(sh=ch.height()),this.append(pre);var cw=$(pre).width()/10,ch=$(pre).height();$(pre).remove(),data.screen={width:sw,cols:Math.floor(sw/cw)},void 0!==sh&&(data.screen.height=sh,data.screen.rows=Math.floor(sh/ch))},renderAnswer:function(answer){var div=this.data("prologRunner"),even=++div.answers%2==0,table=function removeSpecialBindings(answer){for(var obj={},bindings=answer.variables,projection=answer.projection,i=0;i<bindings.length;i++)for(var name,vars=bindings[i].variables,v=0;v<vars.length;v++)vars[v].startsWith("_swish__")&&(name=vars[v].replace("_swish__",""),obj[name]=bindings[i].value,bindings.splice(i,1),i--);if(projection)for(i=0;i<projection.length;i++)projection[i].startsWith("_swish__")&&(projection.splice(i,1),i--);return obj}(answer);if(table.permahash&&(div.permahash=$(table.permahash).text().replace(/'/g,""),this.find(".rtb-permalink").show({duration:400})),div.query.tabled){if(1!=div.answers)return answer.projection=div.projection,answer.nth=div.answers,$(div.table).prologAnswer(answer),this;if(answer.projection&&0<answer.projection.length){table=answerTable(answer.projection);return addAnswer(this,table),div.table=table,div.projection=answer.projection,answer.nth=div.answers,$(div.table).prologAnswer(answer),this}}div=$.el.div({class:"answer "+(even?"even":"odd")},$.el.span({class:"answer-no"},div.answers));addAnswer(this,div),$(div).prologAnswer(answer)},outputHTML:function(data){var span=$.el.span({class:"output"});return addAnswer(this,span),span.innerHTML=data,runScripts(span),span},downloadButton:function(obj){var button=$.el.a({class:"download"});addAnswer(this,button),$(button).downloader(obj)},syntaxError:function(options){var data=this.data(pluginName);return options.data='<pre class="output msg-error">'+options.message+"</pre>",options.location.file=!0,$(data.query.query_editor).prologEditor("highlightError",options),this},error:function(options){var msg,m,el=!1;if("object"==typeof options){if("died"==options.code)return addAnswer(this,$.el.div({class:"RIP",title:"Remote pengine timed out"})),this;"syntax_error"!=options.code||(m=(msg=options.message||options.data).match(/^HTTP:DATA:(\d+):(\d+):\s*(.*)/))&&4==m.length&&(this.prologRunner("syntaxError",{location:{line:parseInt(m[1])-1,ch:parseInt(m[2])},message:m[3]}),msg="Cannot run query due to a syntax error (check query window)"),msg||(options.html?(msg=options.html,el=!0):msg=options.message)}else msg=options,options={};return el?(el=$.el.pre({class:"prolog-message msg-error"},""),$(el).append(msg),addAnswer(this,el),options.econtext&&$(el).addClass("error-context").on("click",gotoError).data("error_context",options.econtext)):addAnswer(this,$.el.pre({class:"prolog-message msg-error"},msg)),this},trace:function(data){var goal=$.el.span({class:"goal"}),prompt=data.data;function button(btn,action,context){btn=$.el.button({class:action,title:btn},$.el.span(btn));return $(btn).on("click",function(ev){void 0!==context&&(action+="("+Pengine.stringify(context(ev))+")"),data.pengine.respond(action),$(ev.target).parent().remove()}),btn}$(goal).html(prompt.goal),addAnswer(this,$.el.div({class:"prolog-trace"},$.el.span({class:"depth",style:"width:"+(5*prompt.depth-1)+"px"},"Â "),$.el.span({class:"port "+prompt.port},function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}(prompt.port),":"),goal)),"exception"==prompt.port&&addAnswer(this,$.el.div({class:"prolog-exception"},prompt.exception.message)),addAnswer(this,$.el.div({class:"trace-buttons"},button("Continue","nodebug",function(ev){return breakpoints($(ev.target).closest(".prolog-runner"))}),button("Step into","continue"),button("Step over","skip"),button("Step out","up"),button("Retry","retry"),button("Abort","abort"))),this.closest(".swish").find(".tabbed").trigger("trace-location",prompt),this.prologRunner("setState","wait-debug")},setPrompt:function(p){this.find(".controller input").attr("placeholder",p)},jQuery:function(prompt){var receiver,result=prompt.data;if(console.log(result),"string"==typeof result.selector)receiver=$(result.selector);else if("object"==typeof result.selector){switch(result.selector.root){case"this":root=this;break;case"cell":root=this.closest(".nb-cell");break;case"notebook":root=this.closest(".notebook");break;case"swish":root=this.closest(".swish")}receiver=""==result.selector.sub?root:root.find(result.selector.sub)}console.log(receiver);result=receiver[result.method].apply(receiver,result.arguments);console.log(result),prompt.pengine.respond(Pengine.stringify(result))},form:function(prompt){var data=this.data("prologRunner");modal.show({title:"Please enter parameters",body:function(){this.html(prompt.data.html),this.find("[data-search-in]").search({search:!1}),this.on("click","button[data-action]",function(ev){var s,button=$(ev.target).closest("button"),action=button.data("action");return"run"==action?(s=$(ev.target).closest("form"),s=form.serializeAsObject(s,!0),s=Pengine.stringify(s),data.prolog.respond(s)):"cancel"==action&&data.prolog.respond("cancel"),button.closest(".modal").modal("hide"),ev.preventDefault(),!1})}})},respond:function(text){var data=this.data("prologRunner");if("term"==data.wait_for){if(s=termNoFullStop(text),""==s)return null}else s=Pengine.stringify(text+"\n");return addAnswer(this,$.el.div({class:"response"},text)),data.prolog.respond(s),this},stop:function(){return this.each(function(){$(this).data("prologRunner").prolog.stop()})},stopOrAbort:function(){return this.each(function(){var elem=$(this),data=elem.data("prologRunner");switch(elem.prologRunner("getState")){case"running":case"wait-input":data.prolog.abort();break;case"wait-next":data.prolog.stop()}})},next:function(chunk){return this.each(function(){var elem=$(this);elem.data("prologRunner").prolog.next(chunk),elem.prologRunner("setState","running")})},detach:function(){return this.each(function(){var data=$(this).data("prologRunner");data.prolog.detach({query:data.query.query,state:data.prolog.state})})},abort:function(){return this.each(function(){$(this).data("prologRunner").prolog.abort()})},close:function(){var parents;return this.length&&(parents=this.parent(),this.each(function(){var elem=$(this),data=elem.data("prologRunner");elem.prologRunner("alive")&&($(".prolog-editor").trigger("pengine-died",data.prolog.id),"detached"!=data.prolog.state&&(data.prolog.abort(),elem.prologRunner("setState","aborted")))}),this.remove(),parents.trigger("scroll-to-bottom",!0)),this},help:function(){$(".swish-event-receiver").trigger("help",{file:"runner.html"})},toggleIconic:function(on){return null==on?this.toggleClass("iconic"):on?this.addClass("iconic"):this.removeClass("iconic"),this.trigger("scroll-to-bottom",!0),this},populateActionMenu:function(actions){var menu=this.find(".runner-title .btn-group.dropdown");return actions=$.extend({"Re-run":function(){console.log("Re-Run ",this)}},actions),form.widgets.populateMenu(menu,this,actions),this},downloadCSV:function(options){var data=this.data("prologRunner"),query=termNoFullStop(data.query.query);return prolog.downloadCSV(query,data.query.source,options),this},permalink:function(){var href,profile,author,runner=this,data=this.data("prologRunner");return data.permahash?(href=config.http.locations.permalink+data.permahash,href=location.protocol+"//"+location.host+href,profile=$("#login").login("get_profile",["display_name","avatar","email","identity"]),author=profile.display_name,form.showDialog({title:"Save permalink",body:function savePermalink(){this.append($.el.form({class:"form-horizontal"},form.fields.hidden("identity",profile.identity),profile.identity?void 0:form.fields.hidden("avatar",profile.avatar),form.fields.link(href),form.fields.fileName(null,!1),form.fields.title(),form.fields.description(),form.fields.tags([]),form.fields.author(author,profile.identity),form.fields.buttons({label:"Save permalink",action:function(ev,as){return runner.prologRunner("save_permalink",as),!1}})))}})):modal.alert("No permahash"),this},save_permalink:function(post){var runner=this,post={data:this.data("prologRunner").permahash,type:"lnk",meta:post};return delete post.meta.link,backend.ajax({url:config.http.locations.web_storage,dataType:"json",contentType:"application/json",type:"POST",data:JSON.stringify(post),success:function(reply){reply.error?modal.alert(errorString("Could not save",reply)):modal.feedback({html:"Saved",owner:runner})},error:function(jqXHR,textStatus,errorThrown){403==jqXHR.status?modal.alert("Permission denied.  Please try a different name"):alert("Save failed: "+textStatus)}}),this},setState:function(state){var stateful,query,data=this.data("prologRunner");if(data){data.prolog.state!=state&&(stateful=this.find(".show-state"),query=data.query,stateful.removeClass(data.prolog.state).addClass(state),!aliveState(data.prolog.state=state)&&data.savedFocus?($(data.savedFocus).focus(),data.savedFocus=null):"wait-input"==state&&this.find("input").focus(),"true"==state&&query.success&&query.success.call(this,data.prolog),!aliveState(state)&&query.complete&&query.complete.call(this,data.prolog));var elem;RS(this);return aliveState(state)?"wait-next"==state||"true"==state?(elem=this,setTimeout(function(){elem.trigger("scroll-to-bottom")},100)):this.trigger("scroll-to-bottom"):(elem=this,$(".prolog-editor").trigger("pengine-died",data.prolog.id),data.prolog.destroy(),setTimeout(function(){elem.trigger("scroll-to-bottom")},100)),this}},getState:function(){var data=this.data("prologRunner");return data.prolog?data.prolog.state:"idle"},alive:function(){return aliveState(this.prologRunner("getState"))},ping:function(stats){var data=this.data("prologRunner");if(data&&data.prolog&&"running"==data.prolog.state){var spark=this.find(".sparklines"),stacks=["global","local","trail"],colors=["red","blue","green"],names=["Global ","Local ","Trail "];for(data.stacks||(data.stacks={global:{usage:[]},local:{usage:[]},trail:{usage:[]}}),i=0;i<stacks.length;i++){var s=stacks[i],limit=stats.stacks[s].limit||stats.stacks.total.limit,u=stats.stacks[s].usage,u=Math.log10(u/limit*1e4);function toBytes(limit,n){return function numberWithCommas(x){x=x.toString();for(var pattern=/(-?\d+)(\d{3})/;pattern.test(x);)x=x.replace(pattern,"$1,$2");return x}(Math.round(Math.pow(10,n)/1e4*limit))}data.stacks[s].limit=limit,10<=data.stacks[s].usage.length&&(data.stacks[s].usage=data.stacks[s].usage.slice(1)),data.stacks[s].usage.push(u),spark.sparkline(data.stacks[s].usage,{height:"2em",composite:0<i,chartRangeMin:0,chartRangeMax:4,lineColor:colors[i],tooltipPrefix:names[i],tooltipSuffix:" bytes",tooltipChartTitle:0==i?"Stack usage":void 0,numberFormatter:function(n){return toBytes(limit,n)}})}}}};function RS(from){return $(from).closest(".prolog-runners")}function addAnswer(runner,html){return runner.find(".runner-results").append(html),this}function aliveState(state){switch(state){case"running":case"detached":case"wait-next":case"wait-input":case"wait-debug":return!0;default:return!1}}function answerTable(projection){var tds=[{class:"projection"}];for(i=0;i<projection.length;i++)tds.push($.el.th({class:"pl-pvar"},projection[i]));return tds.push($.el.th({class:"answer-nth"},"")),$.el.table({class:"prolog-answers"},$.el.tbody($.el.tr.apply(this,tds)))}var node_id=1;function runScripts(elem){var scripts=[];if(elem=$(elem),elem.find("script").each(function(){"text/javascript"==(this.getAttribute("type")||"text/javascript")&&scripts.push(this.textContent)}),0<scripts.length){var script="(function(node){"+scripts.join("\n")+"})",node=new Node({node:elem[0]});try{eval(script)(node)}catch(e){alert(e)}}}function Node(options){this.my_node=options.node}function breakpoints(runner){var data=runner.data(pluginName);return $(runner).parents(".swish").swish("breakpoints",data.prolog.id)}function registerSources(pengine){var data=pengine.options.runner.data(pluginName);data.query.editor&&$(data.query.editor).prologEditor("pengine",{add:pengine.id})}function handleCreate(){var options,bps,resvar,hashvar,wfsresvar,modelvar,treevar,elem=this.pengine.options.runner,data=elem.data(pluginName);function askvar(v){return v?", "+v:""}null==data?this.pengine.destroy():(options=$.extend({},data.screen),resvar=config.swish.residuals_var||"Residuals",hashvar=askvar(config.swish.permahash_var),wfsresvar=askvar(config.swish.wfs_residual_program_var),modelvar=askvar(config.swish.scasp_model_var),treevar=askvar(config.swish.scasp_justification_var),registerSources(this.pengine),(bps=breakpoints(elem))&&(options.breakpoints=Pengine.stringify(bps)),data.chunk&&(options.chunk=data.chunk),data.query.tabled&&(options.tabled=!0),this.pengine.ask("'$swish wrapper'((\n"+termNoFullStop(data.query.query)+"\n), ["+resvar+hashvar+wfsresvar+modelvar+treevar+"])",options),elem.prologRunner("setState","running"))}function handleSuccess(){var elem=this.pengine.options.runner;if(null==elem.data(pluginName))this.pengine.destroy();else{for(var i=0;i<this.data.length;i++){var answer=this.data[i];this.projection&&(answer.projection=this.projection),function specialBindings(answer){for(var vl=[],i=0;i<answer.variables.length;i++){var v=answer.variables[i];function unescapeHTML(string_with_html){return JSON.parse($("<div></div>").html(string_with_html).text())}v.variables[0]==config.swish.scasp_model_var?answer.scasp_model=unescapeHTML(v.value):v.variables[0]==config.swish.scasp_justification_var?answer.scasp_justification=unescapeHTML(v.value):vl.push(v)}answer.variables=vl}(answer),elem.prologRunner("renderAnswer",answer)}.1<this.time&&addAnswer(elem,$.el.div({class:"cputime"},$.el.span(this.time.toFixed(3)," seconds cpu time"))),elem.prologRunner("setState",this.more?"wait-next":"true")}}function handleFailure(){var elem=this.pengine.options.runner;addAnswer(elem,$.el.span({class:"prolog-false"},"false")),elem.prologRunner("setState","false")}function handleStop(){this.pengine.options.runner.prologRunner("setState","stopped")}function handlePrompt(){var elem=this.pengine.options.runner,data=elem.data("prologRunner"),prompt=this.data||"Please enter a Prolog term";if(data.wait_for="term","object"==typeof prompt){if("trace"==prompt.type)return elem.prologRunner("trace",this);if("form"==prompt.type)return elem.prologRunner("form",this);if("jQuery"==prompt.type)return elem.prologRunner("jQuery",this);"console"==prompt.type?(prompt=prompt.prompt||"console> ",data.wait_for="line"):prompt=JSON.stringify(prompt)}elem.prologRunner("setPrompt",prompt),elem.prologRunner("setState","wait-input")}function clickableLocations(msg,editor){var pattern1=/pengine:\/\/[-0-9a-f]{36}\/src:(\d+)/;return msg.replace(/pengine:\/\/[-0-9a-f]{36}\/src:(\d+)/g,function(matched){return"<a class='goto-error' title='Goto location'><span class='glyphicon glyphicon-hand-right'></span> <b>line <span class='line'>"+matched.match(pattern1)[1]+"</span></b></a>"})}function gotoError(ev){var file=$(ev.target).closest("a.goto-error"),ctx=$(ev.target).closest(".error-context"),econtext=ctx.data("error_context");if(file[0]){var line=parseInt(file.find("span.line").text()),file=file.find("span.file").text();return ev.preventDefault(),file?ctx.closest("body.swish").swish("playFile",{file:file,line:line}):$(econtext.editor).prologEditor("gotoLine",line),!1}econtext&&econtext.location.file?ctx.closest("body.swish").swish("playFile",econtext.location):$(econtext.editor).prologEditor("gotoLine",econtext.location.line)}function handleOutput(msg){var econtext,loc,file,span,elem=msg.pengine.options.runner,data=elem.data(pluginName);function clickableError(){var str=loc.file+":"+loc.line+":";loc.ch&&(str+=loc.ch+":"),str+="\\s*",msg.data=clickableLocations(msg.data.replace(new RegExp(str,"g"),""),econtext.editor),span=elem.prologRunner("outputHTML",msg.data),$(span).addClass("error-context"),$(span).append($.el.span({class:"glyphicon glyphicon-hand-right"})),$(span).attr("title","Error in program.  Click to show in context"),$(span).on("click",gotoError),$(span).data("error_context",econtext)}data&&("string"==typeof msg.data?(econtext={editor:data.query.editor},msg.data=msg.data.replace(/'[-0-9a-f]{36}':/g,""),msg.location?((loc=msg.location).file.startsWith("swish://")?(file=loc.file.slice("swish://".length),econtext.location={file:file,line:loc.line},clickableError()):loc.file.startsWith("pengine://")&&(econtext.location={line:loc.line},clickableError(data.query.editor)),registerSources(msg.pengine),msg.error_context=econtext,msg.error_handler=gotoError,$(".swish-event-receiver").trigger("source-error",msg)):(span=elem.prologRunner("outputHTML",clickableLocations(msg.data,econtext.editor)),$(span).on("click",gotoError),$(span).data("error_context",econtext))):"object"==typeof msg.data?elem.prologRunner(msg.data.action,msg.data):console.log(msg.data),elem.trigger("scroll-to-bottom"))}function handleError(){var econtext,msg,elem=this.pengine.options.runner;"too_many_pengines"==this.code?this.message="Too many open queries.  Please complete some\nqueries by using |Next|, |Stop| or by\nclosing some queries.":"string"==typeof this.data?(econtext={editor:elem.data(pluginName).query.editor},msg=(msg=clickableLocations(msg=utils.htmlEncode(this.data),econtext.editor)).replace(new RegExp("'"+this.pengine.id+"':","g"),""),this.html=msg,this.econtext=econtext):this.message="Unknown error",elem.prologRunner("error",this),elem.prologRunner("setState","error")}function handleAbort(){var elem=this.pengine.options.runner;elem.data("prologRunner")?(elem.prologRunner("error","** Execution aborted **"),elem.prologRunner("setState","aborted")):this.pengine.destroy()}function handleDetach(){var elem=this.pengine.options.runner;elem.data("prologRunner")?(elem.prologRunner("outputHTML","Detached query"),elem.prologRunner("setState","detached")):this.pengine.destroy()}function handlePing(){this.pengine.options.runner.prologRunner("ping",this.data)}function termNoFullStop(s){return String($.trim(s)).replace(/\.$/,"")}Node.prototype.node=function(){return $(this.my_node)},Node.prototype.unique_id=function(){return this.uid||(this.uid=node_id++),this.uid},$.fn.prologRunner=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery)}),function(){"use strict";var root="object"==typeof window?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS&&(root=global);var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD="function"==typeof define&&define.amd,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(outputType){return function(message){return new Sha1(!0).update(message)[outputType]()}},createMethod=function(){var method=createOutputMethod("hex");(method=NODE_JS?nodeWrap(method):method).create=function(){return new Sha1},method.update=function(message){return method.create().update(message)};for(var i=0;i<OUTPUT_TYPES.length;++i){var type=OUTPUT_TYPES[i];method[type]=createOutputMethod(type)}return method},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(message){if("string"==typeof message)return crypto.createHash("sha1").update(message,"utf8").digest("hex");if(message.constructor===ArrayBuffer)message=new Uint8Array(message);else if(void 0===message.length)return method(message);return crypto.createHash("sha1").update(new Buffer(message)).digest("hex")};return nodeMethod};function Sha1(sharedMemory){sharedMemory?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(message){if(!this.finalized){for(var code,i,notString="string"!=typeof message,index=0,length=(message=notString&&message.constructor===root.ArrayBuffer?new Uint8Array(message):message).length||0,blocks=this.blocks;index<length;){if(this.hashed&&(this.hashed=!1,blocks[0]=this.block,blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0),notString)for(i=this.start;index<length&&i<64;++index)blocks[i>>2]|=message[index]<<SHIFT[3&i++];else for(i=this.start;index<length&&i<64;++index)(code=message.charCodeAt(index))<128?blocks[i>>2]|=code<<SHIFT[3&i++]:(code<2048?blocks[i>>2]|=(192|code>>6)<<SHIFT[3&i++]:(code<55296||57344<=code?blocks[i>>2]|=(224|code>>12)<<SHIFT[3&i++]:(code=65536+((1023&code)<<10|1023&message.charCodeAt(++index)),blocks[i>>2]|=(240|code>>18)<<SHIFT[3&i++],blocks[i>>2]|=(128|code>>12&63)<<SHIFT[3&i++]),blocks[i>>2]|=(128|code>>6&63)<<SHIFT[3&i++]),blocks[i>>2]|=(128|63&code)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,64<=i?(this.block=blocks[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){var blocks,i;this.finalized||(this.finalized=!0,blocks=this.blocks,i=this.lastByteIndex,blocks[16]=this.block,blocks[i>>2]|=EXTRA[3&i],this.block=blocks[16],56<=i&&(this.hashed||this.hash(),blocks[0]=this.block,blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0),blocks[14]=this.hBytes<<3|this.bytes>>>29,blocks[15]=this.bytes<<3,this.hash())},Sha1.prototype.hash=function(){for(var t,a=this.h0,b=this.h1,c=this.h2,d=this.h3,e=this.h4,blocks=this.blocks,j=16;j<80;++j)t=blocks[j-3]^blocks[j-8]^blocks[j-14]^blocks[j-16],blocks[j]=t<<1|t>>>31;for(j=0;j<20;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b&c|~b&d)+e+1518500249+blocks[j]<<0)<<5|e>>>27)+(a&(b=b<<30|b>>>2)|~a&c)+d+1518500249+blocks[j+1]<<0)<<5|d>>>27)+(e&(a=a<<30|a>>>2)|~e&b)+c+1518500249+blocks[j+2]<<0)<<5|c>>>27)+(d&(e=e<<30|e>>>2)|~d&a)+b+1518500249+blocks[j+3]<<0)<<5|b>>>27)+(c&(d=d<<30|d>>>2)|~c&e)+a+1518500249+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<40;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b^c^d)+e+1859775393+blocks[j]<<0)<<5|e>>>27)+(a^(b=b<<30|b>>>2)^c)+d+1859775393+blocks[j+1]<<0)<<5|d>>>27)+(e^(a=a<<30|a>>>2)^b)+c+1859775393+blocks[j+2]<<0)<<5|c>>>27)+(d^(e=e<<30|e>>>2)^a)+b+1859775393+blocks[j+3]<<0)<<5|b>>>27)+(c^(d=d<<30|d>>>2)^e)+a+1859775393+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<60;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b&c|b&d|c&d)+e-1894007588+blocks[j]<<0)<<5|e>>>27)+(a&(b=b<<30|b>>>2)|a&c|b&c)+d-1894007588+blocks[j+1]<<0)<<5|d>>>27)+(e&(a=a<<30|a>>>2)|e&b|a&b)+c-1894007588+blocks[j+2]<<0)<<5|c>>>27)+(d&(e=e<<30|e>>>2)|d&a|e&a)+b-1894007588+blocks[j+3]<<0)<<5|b>>>27)+(c&(d=d<<30|d>>>2)|c&e|d&e)+a-1894007588+blocks[j+4]<<0,c=c<<30|c>>>2;for(;j<80;j+=5)a=(t=(b=(t=(c=(t=(d=(t=(e=(t=a<<5|a>>>27)+(b^c^d)+e-899497514+blocks[j]<<0)<<5|e>>>27)+(a^(b=b<<30|b>>>2)^c)+d-899497514+blocks[j+1]<<0)<<5|d>>>27)+(e^(a=a<<30|a>>>2)^b)+c-899497514+blocks[j+2]<<0)<<5|c>>>27)+(d^(e=e<<30|e>>>2)^a)+b-899497514+blocks[j+3]<<0)<<5|b>>>27)+(c^(d=d<<30|d>>>2)^e)+a-899497514+blocks[j+4]<<0,c=c<<30|c>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+b<<0,this.h2=this.h2+c<<0,this.h3=this.h3+d<<0,this.h4=this.h4+e<<0},Sha1.prototype.hex=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return HEX_CHARS[h0>>28&15]+HEX_CHARS[h0>>24&15]+HEX_CHARS[h0>>20&15]+HEX_CHARS[h0>>16&15]+HEX_CHARS[h0>>12&15]+HEX_CHARS[h0>>8&15]+HEX_CHARS[h0>>4&15]+HEX_CHARS[15&h0]+HEX_CHARS[h1>>28&15]+HEX_CHARS[h1>>24&15]+HEX_CHARS[h1>>20&15]+HEX_CHARS[h1>>16&15]+HEX_CHARS[h1>>12&15]+HEX_CHARS[h1>>8&15]+HEX_CHARS[h1>>4&15]+HEX_CHARS[15&h1]+HEX_CHARS[h2>>28&15]+HEX_CHARS[h2>>24&15]+HEX_CHARS[h2>>20&15]+HEX_CHARS[h2>>16&15]+HEX_CHARS[h2>>12&15]+HEX_CHARS[h2>>8&15]+HEX_CHARS[h2>>4&15]+HEX_CHARS[15&h2]+HEX_CHARS[h3>>28&15]+HEX_CHARS[h3>>24&15]+HEX_CHARS[h3>>20&15]+HEX_CHARS[h3>>16&15]+HEX_CHARS[h3>>12&15]+HEX_CHARS[h3>>8&15]+HEX_CHARS[h3>>4&15]+HEX_CHARS[15&h3]+HEX_CHARS[h4>>28&15]+HEX_CHARS[h4>>24&15]+HEX_CHARS[h4>>20&15]+HEX_CHARS[h4>>16&15]+HEX_CHARS[h4>>12&15]+HEX_CHARS[h4>>8&15]+HEX_CHARS[h4>>4&15]+HEX_CHARS[15&h4]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var h0=this.h0,h1=this.h1,h2=this.h2,h3=this.h3,h4=this.h4;return[h0>>24&255,h0>>16&255,h0>>8&255,255&h0,h1>>24&255,h1>>16&255,h1>>8&255,255&h1,h2>>24&255,h2>>16&255,h2>>8&255,255&h2,h3>>24&255,h3>>16&255,h3>>8&255,255&h3,h4>>24&255,h4>>16&255,h4>>8&255,255&h4]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var buffer=new ArrayBuffer(20),dataView=new DataView(buffer);return dataView.setUint32(0,this.h0),dataView.setUint32(4,this.h1),dataView.setUint32(8,this.h2),dataView.setUint32(12,this.h3),dataView.setUint32(16,this.h4),buffer};var exports=createMethod();COMMON_JS?module.exports=exports:(root.sha1=exports,AMD&&define("sha1",[],function(){return exports}))}(),function($){function appendContent($el,content){content&&$el.append(content.jquery?content.clone():content)}function appendBody($body,$element,opt){var $content=$element.clone(opt.formValues);opt.formValues&&function copyValues(origin,clone,elementSelector){var $originalElements=origin.find(elementSelector);clone.find(elementSelector).each(function(index,item){$(item).val($originalElements.eq(index).val())})}($element,$content,"select, textarea"),opt.removeScripts&&$content.find("script").remove(),opt.printContainer?$content.appendTo($body):$content.each(function(){$(this).children().appendTo($body)})}var opt;$.fn.printThis=function(printI){opt=$.extend({},$.fn.printThis.defaults,printI);var iframeSrc,$element=this instanceof jQuery?this:$(this),strFrameName="printThis-"+(new Date).getTime();window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)?(iframeSrc='javascript:document.write("<head><script>document.domain=\\"'+document.domain+'\\";<\/script></head><body></body>")',(printI=document.createElement("iframe")).name="printIframe",printI.id=strFrameName,printI.className="MSIE",document.body.appendChild(printI),printI.src=iframeSrc):$("<iframe id='"+strFrameName+"' name='printIframe' />").appendTo("body");var $iframe=$("#"+strFrameName);opt.debug||$iframe.css({position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"}),"function"==typeof opt.beforePrint&&opt.beforePrint(),setTimeout(function(){opt.doctypeString&&function setDocType(doc,doctype){(doc=(doc=(doc=doc.get(0)).contentWindow||doc.contentDocument||doc).document||doc.contentDocument||doc).open(),doc.write(doctype),doc.close()}($iframe,opt.doctypeString);var $doc=$iframe.contents(),$head=$doc.find("head"),$body=$doc.find("body"),selector=$("base"),tag=!0===opt.base&&0<selector.length?selector.attr("href"):"string"==typeof opt.base?opt.base:document.location.protocol+"//"+document.location.host;$head.append('<base href="'+tag+'">'),opt.importCSS&&$("link[rel=stylesheet]").each(function(){var media,href=$(this).attr("href");href&&(media=$(this).attr("media")||"all",$head.append("<link type='text/css' rel='stylesheet' href='"+href+"' media='"+media+"'>"))}),opt.importStyle&&$("style").each(function(){$head.append(this.outerHTML)}),opt.pageTitle&&$head.append("<title>"+opt.pageTitle+"</title>"),opt.loadCSS&&($.isArray(opt.loadCSS)?jQuery.each(opt.loadCSS,function(index,value){$head.append("<link type='text/css' rel='stylesheet' href='"+this+"'>")}):$head.append("<link type='text/css' rel='stylesheet' href='"+opt.loadCSS+"'>"));selector=$("html")[0];$doc.find("html").prop("style",selector.style.cssText);var canvasId,tag=opt.copyTagClasses;tag&&(-1!==(tag=!0===tag?"bh":tag).indexOf("b")&&$body.addClass($("body")[0].className),-1!==tag.indexOf("h")&&$doc.find("html").addClass(selector.className)),appendContent($body,opt.header),opt.canvas&&(canvasId=0,$element.find("canvas").addBack("canvas").each(function(){$(this).attr("data-printthis",canvasId++)})),appendBody($body,$element,opt),opt.canvas&&$body.find("canvas").each(function(){var $src=$(this).data("printthis"),$src=$('[data-printthis="'+$src+'"]');this.getContext("2d").drawImage($src[0],0,0),$.isFunction($.fn.removeAttr)?$src.removeAttr("data-printthis"):$.each($src,function(i,el){el.removeAttribute("data-printthis")})}),opt.removeInline&&(selector=opt.removeInlineSelector||"*",$.isFunction($.removeAttr)?$body.find(selector).removeAttr("style"):$body.find(selector).attr("style","")),appendContent($body,opt.footer),function attachOnBeforePrintEvent(win,beforePrintHandler){win=(win=win.get(0)).contentWindow||win.contentDocument||win,"function"==typeof beforePrintHandler&&("matchMedia"in win?win.matchMedia("print").addListener(function(mql){mql.matches&&beforePrintHandler()}):win.onbeforeprint=beforePrintHandler)}($iframe,opt.beforePrintEvent),setTimeout(function(){$iframe.hasClass("MSIE")?(window.frames.printIframe.focus(),$head.append("<script>  window.print(); <\/script>")):document.queryCommandSupported("print")?$iframe[0].contentWindow.document.execCommand("print",!1,null):($iframe[0].contentWindow.focus(),$iframe[0].contentWindow.print()),opt.debug||setTimeout(function(){$iframe.remove()},1e3),"function"==typeof opt.afterPrint&&opt.afterPrint()},opt.printDelay)},333)},$.fn.printThis.defaults={debug:!1,importCSS:!0,importStyle:!1,printContainer:!0,loadCSS:"",pageTitle:"",removeInline:!1,removeInlineSelector:"*",printDelay:333,header:null,footer:null,base:!1,formValues:!0,canvas:!1,doctypeString:"<!DOCTYPE html>",removeScripts:!1,copyTagClasses:!1,beforePrintEvent:null,beforePrint:null,afterPrint:null}}(jQuery),define("printThis",function(){}),define("notebook",["jquery","config","tabbed","form","preferences","modal","prolog","links","utils","cm/lib/codemirror","backend","editor","laconic","runner","storage","sha1","printThis"],function($,config,tabbed,form,preferences,modal,prolog,links,utils,CodeMirror,backend){var cellTypes={program:{label:"Program",prefix:"p"},query:{label:"Query",prefix:"q"},markdown:{label:"Markdown",prefix:"md"},html:{label:"HTML",prefix:"htm"}};function glyphButton(glyph,action,title,style,size){return size=size||"sm",$.el.a({href:"#",class:"btn btn-"+style+" btn-"+size+" action-"+action,title:title,"data-action":action},$.el.span({class:"glyphicon glyphicon-"+glyph}))}function imageButton(action,title,size){return size=size||"sm",$.el.a({href:"#",class:"btn btn-default btn-image btn-"+size+" action-"+action,title:title,"data-action":action},$.el.span({class:"image-icon"}))}function glyphButtonGlyph(elem,action,glyph){elem.find("a[data-action="+action+"] > span.glyphicon").removeClass(function(i,s){return s.match(/glyphicon-[-a-z]*/g).join(" ")}).addClass("glyphicon-"+glyph)}function sep(){return $.el.span({class:"menu-space"}," ")}function notebook_menu(){return $.el.div({class:"nb-menu"},$.el.div({class:"nb-menu-sense"},$.el.div({class:"nb-menu-line"})))}function cell_type_select_div(){var g,k,div=$.el.div({class:"nb-type-select"},$.el.label("Create a "),g=$.el.div({class:"btn-group",role:"group"}),$.el.label("cell here"));for(k in cellTypes)cellTypes.hasOwnProperty(k)&&$(g).append($.el.button({type:"button",class:"btn btn-default","data-type":k},cellTypes[k].label));return $(div)}function Notebook(options){this.my_cell=options.cell}CodeMirror.modes.eval=CodeMirror.modes.prolog,function($){var clipboard=null,methods={_init:function(options){return options=options||{},this.each(function(){var elem=$(this),storage={},data={};elem.addClass("notebook"),elem.addClass("swish-event-receiver"),elem.append(fullscreen=$.el.div({class:"nb-toolbar"},glyphButton("trash","delete","Delete cell","warning"),sep(),glyphButton("copy","copy","Copy cell","default"),glyphButton("paste","paste","Paste cell below","default"),sep(),glyphButton("chevron-up","up","Move cell up","default"),glyphButton("chevron-down","down","Move cell down","default"),sep(),glyphButton("plus","insertBelow","Insert cell below","primary"),sep(),glyphButton("erase","clear_all","Clear all query output","warning"),glyphButton("play","run_all","Run all queries","primary"),glyphButton("wrench","settings","Settings","default"),glyphButton("fullscreen","fullscreen","Full screen","default"))),elem.append(function notebookMenu(){var icon=$.el.span({class:"glyphicon glyphicon-menu-hamburger"});return form.widgets.dropdownButton(icon,{divClass:"notebook-menu btn-transparent",ulClass:"pull-right",client:elem,actions:{"Delete cell":function(){this.notebook("delete")},"Copy cell":function(){this.notebook("copy")},"Paste cell":function(){this.notebook("paste")},"Move cell up":function(){this.notebook("up")},"Move cell down":function(){this.notebook("down")},"Insert cell":function(){this.notebook("insertBelow")},"--":"Overall options","Clear all":function(){this.notebook("clear_all")},Play:function(){this.notebook("run_all")},Settings:function(){this.notebook("settings")},"---":"Notebook actions","Exit fullscreen":function(){this.notebook("fullscreen",!1)}}})}()),elem.append($.el.div({class:"nb-view",tabIndex:"-1"},content=$.el.div({class:"nb-content"}),$.el.div({class:"nb-bottom"}))),$(fullscreen).on("click","a.btn",function(ev){var action=$(ev.target).closest("a").data("action");return elem.notebook(action),ev.preventDefault(),!1}),$(content).on("click",".nb-cell-buttons a.btn",function(ev){var action=$(ev.target).closest("a"),cell=action.closest(".nb-cell"),action=action.data("action");return cell.nbCell(action),ev.preventDefault(),!1}),$(content).on("mouseenter mouseleave",".nb-menu-sense",function(ev){var select,mdiv=$(ev.target).closest(".nb-menu");function removeSelector(){select.remove(),mdiv.find(".nb-menu-line").css("background-color","#fff"),data.menu_state="idle"}"mouseenter"==ev.type?(select=cell_type_select_div(),mdiv.find(".nb-menu-line").css("background-color","#333"),select.hide(),mdiv.append(select),data.menu_state="waiting",setTimeout(function(){0<mdiv.find(":hover").length?(data.menu_state="showing",select.on("mouseleave",removeSelector),select.fadeIn(400)):removeSelector()},250)):"showing"!=data.menu_state&&mdiv.find(".nb-menu-line").css("background-color","#fff")}),$(content).on("click",".nb-menu .btn",function(cell){cell.preventDefault();var type=$(cell.target).data("type"),mdiv=$(cell.target).closest(".nb-menu"),nb=mdiv.closest(".notebook"),cell=$.el.div({class:"nb-cell"});return mdiv.parent().hasClass("nb-placeholder")?nb.find(".nb-content").empty().append(cell):(mdiv.find(".nb-type-select").remove(),mdiv.after(cell)),$(cell).nbCell({type:type}),nb.notebook("organize"),nb.notebook("active",$(cell),!0),!1}),elem.focusin(function(ev){var cell=$(ev.target).closest(".nb-cell");0<cell.length?elem.notebook("active",cell):0<$(ev.target).closest(".nb-view").length&&elem.find(".nb-content").children(".nb-cell.active").nbCell("active",!1)}),elem.focusout(function(ev){$(ev.target).closest(".notebook")[0]!=elem[0]&&elem.find(".nb-content").children(".nb-cell.active").nbCell("active",!1)}),elem.on("activate-tab",function(ev){var nc;ev.target==elem[0]&&((nc=(nc=elem.find(".nb-content").children(".nb-cell.program")).filter(".active")[0]||nc[0])&&$(nc).find(".prolog-editor").prologEditor("makeCurrent"),ev.stopPropagation())}),elem.on("scroll-to-bottom",function(ev,arg){1!=arg&&$(ev.target).closest(".nb-cell").nbCell("ensure_in_view","bottom")}),elem.data("notebook",data);var docid,fullscreen,content=elem.find(".notebook-data");function copyData(name){var value=content.data(name);value&&(storage[name]=value)}options.value?elem.notebook("value",options.value):0<content.length?(copyData("file"),copyData("url"),copyData("title"),copyData("meta"),copyData("st_type"),copyData("chats"),docid=elem.storage("docid",void 0,storage),fullscreen=preferences.getDocVal(docid,"fullscreen",config.swish.notebook.fullscreen),elem.notebook("value",content.text(),{fullscreen:fullscreen}),content.remove()):elem.notebook("placeHolder"),elem.notebook("setupStorage",storage),elem.on("data-is-clean",function(ev,clean){if($(ev.target).hasClass("prolog-editor"))return elem.notebook("checkModified"),ev.stopPropagation(),!1}),elem.on("fullscreen",function(ev,val){preferences.setDocVal(docid,"fullscreen",val)}),elem.on("print",function(ev){$(ev.target).hasClass("notebook")&&$(ev.target).is(":visible")&&elem.notebook("print"),ev.stopPropagation()})})},delete:function(cell){return(cell=cell||currentCell(this))&&(this.notebook("active",cell.nbCell("next")||cell.nbCell("prev")),cell.nbCell("close"),this.notebook("updatePlaceHolder")),this.notebook("checkModified"),this},copy:function(cell){var dom;(cell=cell||currentCell(this))&&(dom=$.el.div({class:"notebook"}),$(dom).append($(cell).nbCell("saveDOM")),$(dom).find(".nb-cell").removeAttr("name"),clipboard=stringifyNotebookDOM(dom))},paste:function(text){var nb=this;if(text=text||clipboard){var dom=$.el.div();if($(dom).html(text),0<$(dom).find(".nb-cell").length)return $(dom).find(".nb-cell").each(function(){nb.notebook("insert",{where:"below",restore:$(this)})}),this;modal.alert("Not a SWISH notebook")}else modal.alert("Clipboard is empty")},up:function(cell){return(cell=cell||currentCell(this))&&(cell.insertBefore(cell.nbCell("prev")),this.notebook("checkModified")),this},down:function(cell){return(cell=cell||currentCell(this))&&(cell.insertAfter(cell.nbCell("next")),this.notebook("checkModified")),this},insertAbove:function(){return this.notebook("insert",{where:"above"})},insertBelow:function(){return 0==this.notebook("insert",{where:"below",if_visible:!0})&&modal.alert("<p>New cell would appear outside the visible area of the notebook.<p>Please select the cell below which you want the new cell to appear or scroll to the bottom of the notebook."),this},getSettings:function(){return{open_fullscreen:this.hasClass("open-fullscreen"),hide_navbar:this.hasClass("hide-navbar")}},settings:function(){var that=this,current=this.notebook("getSettings");form.showDialog({title:"Set options for notebook",body:function notebookSettingsBody(){this.append($.el.form({class:"form-horizontal"},form.fields.checkboxes([{name:"open_fullscreen",label:"open in fullscreen mode",value:current.open_fullscreen,title:"Open in fullscreen mode"}],{col:3,label:"Initial view"}),form.fields.checkboxes([{name:"hide_navbar",label:"hide navigation bar",value:current.hide_navbar,title:"Hide navigation bar"}],{col:3,label:"Full screen options"}),form.fields.buttons({label:"Apply",offset:3,action:function(ev,values){function update(field,cls){values[field]!=current[field]&&(values[field]?that.addClass(cls):that.removeClass(cls))}update("hide_navbar","hide-navbar"),update("open_fullscreen","open-fullscreen"),that.notebook("checkModified")}})))}})},run:function(cell){(cell=cell||currentCell(this))&&cell.nbCell("run")},fullscreen:function(node,hide_navbar){return null==node&&(node=!this.hasClass("fullscreen")),null==hide_navbar&&(hide_navbar=this.hasClass("hide-navbar")),node?(node=1==(node=this.closest(".chat-container")).length?node:this,$("body.swish").swish("fullscreen",node,this,hide_navbar)):$("body.swish").swish("exitFullscreen"),this},cellType:function(cell,type){(cell=cell||currentCell(this))&&cell.nbCell("type",type)},getSelection:function(){return this.notebook("assignCellNames").find(".prolog-editor").prologEditor("getSelection")},restoreSelection:function(sel){return this.notebook("assignCellNames").find(".prolog-editor").prologEditor("restoreSelection",sel)},checkModified:function(){return this.each(function(){var nb=$(this),clean=nb.data("storage").cleanGeneration==nb.notebook("changeGen");nb.notebook("markClean",clean),nb.notebook("organize")})},markClean:function(clean){return this.each(function(){var nb=$(this),data=nb.data("notebook");data.clean_signalled!=clean&&(data.clean_signalled=clean,nb.trigger("data-is-clean",clean)),clean&&nb.find(".prolog-editor").prologEditor("setIsClean")})},print:function(){return $(this).find(".nb-content").printThis({printDelay:2e3}),this},active:function(cell,editors){function removeNotForQuery(elem){elem.find(".nb-content .nb-cell.not-for-query").removeClass("not-for-query")}var current;cell&&(current=this.find(".nb-content .nb-cell.active"),1==cell.length?1==current.length&&cell[0]==current[0]||(removeNotForQuery(this),current.nbCell("active",!1),cell.nbCell("active",!0),editors&&(0<(editors=cell.find(".prolog-editor")).length?editors.prologEditor("focus"):cell.focus())):(removeNotForQuery(this),current.nbCell("active",!1)))},insert:function(options){options=options||{};var viewrect,content=currentCell(this),cell=options.cell||$.el.div({class:"nb-cell"}),view=this.find(".nb-view");if(options.if_visible&&0<view.find(".nb-content > div.nb-cell").length&&(viewrect=view[0].getBoundingClientRect()),content)if("above"==options.where){if(viewrect)if(content[0].getBoundingClientRect().top<viewrect.top)return!1;$(cell).insertBefore(content)}else{if(viewrect)if(content[0].getBoundingClientRect().bottom>viewrect.bottom-20)return!1;$(cell).insertAfter(content)}else{content=this.find(".nb-content");if(viewrect)if(content[0].getBoundingClientRect().bottom>viewrect.bottom-20)return!1;content.append(cell)}return options.cell||$(cell).nbCell(options.restore),$(cell).nbCell("assignName"),this.notebook("updatePlaceHolder"),this.notebook("active",$(cell)),this.notebook("checkModified"),this},organize:function(){var content=this.find(".nb-content");content.children(".nb-cell").each(function(){var cell=$(this);cell.prev().hasClass("nb-menu")||cell.before(notebook_menu()),cell.next().hasClass("nb-menu")||cell.after(notebook_menu())}),content.children(".nb-menu").each(function(){var menu=$(this);menu.next().hasClass("nb-menu")&&menu.remove()})},setupStorage:function(storage){var notebook=this;return storage=$.extend(storage,{getValue:function(){return notebook.notebook("value")},setValue:function(source){return notebook.notebook("setSource",source)},changeGen:function(){return notebook.notebook("changeGen")},isClean:function(gen){return gen==notebook.notebook("changeGen")},markClean:function(clean){notebook.notebook("markClean",clean)},cleanGeneration:this.notebook("changeGen"),cleanData:this.notebook("value"),cleanCheckpoint:"load",typeName:"notebook"}),this.storage(storage)},setSource:function(source){"string"==typeof source&&(source={data:source}),this.notebook("value",source.data)},value:function(outer_div,options){if(options=options||{},null==outer_div){var isnew=this.notebook("getClasses");isnew.unshift("notebook");var dom=$.el.div({class:isnew.join(" ")});return this.notebook("assignCellNames",!1),this.find(".nb-cell").each(function(){cell=$(this),options.skipEmpty&&cell.nbCell("isEmpty")||$(dom).append(cell.nbCell("saveDOM"))}),stringifyNotebookDOM(dom)}var content=this.find(".nb-content"),dom=$.el.div(),isnew=0==content.children(".nb-cell").length;content.html(""),dom.innerHTML=outer_div;outer_div=$(dom).find("div.notebook");this.removeClass("fullscreen hide-navbar"),outer_div.hasClass("open-fullscreen")?(options.fullscreen=!0,this.addClass("open-fullscreen")):outer_div.hasClass("fullscreen")&&(options.fullscreen=!0,this.removeClass("fullscreen")),outer_div.hasClass("hide-navbar")&&(options.hide_navbar=!0,this.addClass("hide-navbar")),isnew&&options.fullscreen&&this.notebook("fullscreen",!0,options.hide_navbar),$(dom).find(".nb-cell").each(function(){var cell=$.el.div({class:"nb-cell"});content.append(cell),$(cell).nbCell($(this))}),this.find(".nb-cell").nbCell("onload"),this.notebook("run_all","onload"),this.notebook("updatePlaceHolder"),this.notebook("assignCellNames",!1),this.notebook("organize")},getClasses:function(){for(var found=this.attr("class").split(" "),classes=[],allowed=["open-fullscreen","hide-navbar"],i=0;i<found.length;i++)0<=allowed.indexOf(found[i])&&classes.push(found[i]);return classes.sort()},changeGen:function(){var list=this.notebook("getClasses");return this.find(".nb-cell").each(function(){var cg=$(this).nbCell("changeGen");list.push(cg)}),sha1(list.join())},assignCellNames:function(check){return this.find(".nb-cell").nbCell("assignName"),0!=check&&this.notebook("checkModified"),this},updatePlaceHolder:function(){0==this.find(".nb-content").find(".nb-cell").length?this.notebook("placeHolder"):this.find(".nb-placeholder").remove()},placeHolder:function(){var a=notebook_menu(),select=cell_type_select_div(),placeholder=$.el.div({class:"nb-placeholder"});return $(a).append(select),placeholder.append(a,$.el.div({class:"nb-help"},"New here?  See the notebook ",a=$.el.a("help page"),".")),$(a).on("click",function(){$(".swish-event-receiver").trigger("help",{file:"notebook.html"})}),this.find(".nb-content").append(placeholder),this},run_all:function(why){var complete,queries=[];why=why||"all",this.notebook("clear_all"),this.find(".nb-cell.query").each(function(){"all"!=why&&$(this).data("run")!=why||queries.push(this)}),0<queries.length&&(queries.current=0,complete=function(pengine){(function cont(pengine){switch(pengine.state){case"error":case"aborted":return}return 1})(pengine)&&++queries.current<queries.length&&$(queries[queries.current]).nbCell("run",{complete:complete})},$(queries[0]).nbCell("run",{complete:complete}))},clear_all:function(){this.find(".prolog-runner").prologRunner("close")}};function currentCell(active){active=$(active).find(".nb-cell.active");return 1==active.length?active.first():null}function stringifyNotebookDOM(html){var html=$($.el.div(html)).html(),nest=[];return html.replace(/(<div [^>]*>|<\/div>)/g,function(t){var is_cell;return"</div>"==t?(is_cell=nest.pop())?"\n"+t+"\n":t:(is_cell=null!=t.match(/(nb-cell|notebook)/),nest.push(is_cell),is_cell?"\n"+function orderAttrs(s){if(attrs=s.match(/[-a-z]+="[^"]*"/g),attrs){for(var start=s.match(/^<[a-z]* /),i=0;i<attrs.length;i++){var l=attrs[i].split(/=(.*)/);attrs[i]=l[0].toLowerCase()+"="+l[1]}return start[0]+attrs.sort().join(" ")+">"}return s}(t)+"\n":t)}).slice(1)}tabbed.tabTypes.notebook={dataType:"swinb",typeName:"notebook",label:"Notebook",contentType:"text/x-prolog-notebook",order:200,create:function(dom,options){$(dom).notebook(options)}},$.fn.notebook=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.notebook"):methods._init.apply(this,arguments)}}(jQuery),function($){var pluginName="nbCell",id=0,methods={_init:function(options){return this.each(function(){var select,elem=$(this);elem.data(pluginName,{}),elem.attr("tabIndex",-1),elem.attr("id","nbc"+id++),options instanceof jQuery?elem.nbCell("restoreDOM",options):options&&options.type?elem.nbCell("type",options.type):(select=glyphButton("remove-circle","close","Close","default","xs"),elem.append(select),$(select).addClass("close-select"),$(select).on("click",function(){elem.nbCell("close")}),select=cell_type_select_div(),elem.append(select),select.find(".btn-group").on("click",".btn",function(ev){elem.nbCell("type",$(ev.target).data("type"))}),elem.append($.el.div({class:"nb-type-more"},typeMore(),typeLess($.el.label("Insert notebook from local file "),fileInsertInput()[0]))))})},active:function(val){return this.each(function(){var elem=$(this),data=elem.data(pluginName);if(val)switch(elem.addClass("active"),data.type){case"program":elem.find(".editor").prologEditor("makeCurrent");break;case"query":var prevprog=elem.nbCell("prev",".program");prevprog&&prevprog.find(".editor").prologEditor("makeCurrent"),elem.closest(".notebook").find(".nb-cell.program").not(elem.nbCell("program_cells")).addClass("not-for-query")}else if(0<elem.length)switch(elem.removeClass("active"),data.type){case"markdown":case"html":elem.hasClass("runnable")&&elem.nbCell("run")}})},next:function(next){next=this.nextAll(".nb-cell"+(next||"")).first();return next.length?next:null},prev:function(prev){prev=this.prevAll(".nb-cell"+(prev||"")).first();return prev.length?prev:null},ensure_in_view:function(where){var top=this.position().top,view=this.closest(".nb-view"),stop=view.scrollTop(),vh=view.height();stop<top&&top+this.height()<stop+vh||("top"!=where&&(top=top+this.height()-vh+40),this.nbCell("active",!0),view.scrollTop(top))},type:function(type){var data=this.data(pluginName);return data.type!=type&&(methods.type[type].apply(this),data.type=type,this.addClass(type),this.removeAttr("name"),this.nbCell("assignName")),this},assignName:function(){return this.each(function(){var cell=$(this);if(!cell.attr("name")){var data=cell.data(pluginName);if(data.type){var prefix=cellTypes[data.type].prefix,nb=cell.closest(".notebook");for(i=1;;i++){var name=prefix+i;if(0==nb.find("*[name="+name+"]").length){cell.attr("name",name);break}}}}})},run:function(){var args=arguments;return this.each(function(){var cell=$(this);if(cell.hasClass("runnable")){var data=cell.data(pluginName);return methods.run[data.type].apply(cell,args)}console.log("Cell is not runnable: ",cell)})},runTabled:function(){return this.nbCell("run",{tabled:!0})},onload:function(){var args=arguments;return this.each(function(){var cell=$(this),data=cell.data(pluginName);methods.onload[data.type]&&methods.onload[data.type].apply(cell,args)}),this.nbCell("refresh")},close:function(){return this.find(".prolog-runner").prologRunner("close"),this.remove()},refresh:function(){return this.hasClass("program")&&this.find("a[data-action='background']").attr("title",this.hasClass("background")?"Used for all queries in this notebook":"Used for queries below this cell"),this},getSettings:function(){return{tabled:"true"==this.data("tabled"),run:"onload"==this.data("run"),chunk:parseInt(this.data("chunk")||"1"),name:this.attr("name")}},settings:function(){var elem=this,current=this.nbCell("getSettings");form.showDialog({title:"Set options for query",body:function querySettingsBody(){this.append($.el.form({class:"form-horizontal"},form.fields.checkboxes([{name:"tabled",label:"table results",value:current.tabled,title:"Table results"},{name:"run",label:"run on page load",value:current.run,title:"Run when document is loaded"}],{col:3}),form.fields.chunk(current.chunk),form.fields.name(current.name||""),form.fields.buttons({label:"Apply",offset:3,action:function(ev,name){name.tabled!=current.tabled&&(name.tabled?elem.data("tabled","true"):elem.removeData("tabled")),name.run!=current.run&&(name.run?elem.data("run","onload"):elem.removeData("run")),name.chunk!=current.chunk&&(1!=name.chunk?elem.data("chunk",""+name.chunk):elem.removeData("chunk"));name=name.name?name.name.trim():"";name!=current.name&&(name?elem.attr("name",name):elem.attr("name",null)),elem.closest(".notebook").notebook("checkModified")}})))}})},singleline:function(){return this.toggleClass("singleline"),this.find(".editor").prologEditor("refresh"),glyphButtonGlyph(this,"singleline",this.hasClass("singleline")?"triangle-left":"triangle-bottom"),this.find("a[data-action=singleline]").blur(),this},background:function(){return this.toggleClass("background"),this.find("a[data-action=background]").blur(),this.closest(".notebook").notebook("checkModified"),this.nbCell("refresh"),this},program_cells:function(){this.data(pluginName);var programs=this.closest(".notebook").find(".nb-cell.program.background");return this.hasClass("program")?this.hasClass("background")||(programs=programs.add(this)):programs=programs.add(this.nbCell("prev",".program")),programs},programs:function(){return this.nbCell("program_cells").find(".editor")},isEmpty:function(){return methods.isEmpty[this.data(pluginName).type].call(this)},saveDOM:function(){return methods.saveDOM[this.data(pluginName).type].call(this)},restoreDOM:function(dom){var data=this.data(pluginName);data.type=function domCellType(dom){for(var k in cellTypes)if(cellTypes.hasOwnProperty(k)&&dom.hasClass(k))return k}(dom),methods.restoreDOM[data.type].apply(this,arguments),this.addClass(data.type)},changeGen:function(){var type=this.data(pluginName).type;return type?methods.changeGen[type].call(this):0},text:function(){return cellText(this)}};function cellText(cell){return cell.find(".editor").prologEditor("getSource",void 0,!0)}function fileInsertInput(){var form=$('<input type="file" name="file">');return form.on("change",function(ev){var reader=new FileReader;return reader.onload=function(theFile){var cell=$(ev.target).closest(".nb-cell");cell.closest(".notebook").notebook("paste",reader.result)&&cell.remove()},reader.readAsText(ev.target.files[0]),ev.preventDefault(),!1}),form}function typeMore(){var div=$('<div class="form-more"> <a href="#">more<a></div>');return div.find("a").on("click",function(more){more=$(more.target).closest(".form-more");more.hide(400),more.next().show(400)}),div[0]}function typeLess(){for(var div=$('<div class="form-less" style="display:none"> <div><a href="#" class="less">less<a></div></div>'),i=0;i<arguments.length;i++)div.append(arguments[i]);return div.find("a.less").on("click",function(less){less=$(less.target).closest(".form-less");less.hide(400),less.prev().show(400)}),div[0]}methods.type.markdown=function(options){var editor,cell=this;(options=options||{}).mode="markdown",options.fencedCodeBlockHighlighting=!0,function setAttr(name){null!=options[name]&&(cell.attr(name,""+options[name]),delete options[name])}("name"),this.html(""),this.append(editor=$.el.div({class:"editor"})),$(editor).prologEditor(options),this.addClass("runnable")},methods.type.html=function(options){var editor,cell=this;(options=options||{}).mode="htmlmixed",function setAttr(name){null!=options[name]&&(cell.attr(name,""+options[name]),delete options[name])}("name"),this.html(""),this.append(editor=$.el.div({class:"editor"})),$(editor).prologEditor(options),this.addClass("runnable")},methods.type.program=function(options){var cell=this;(options=options||{}).autoCurrent=!1,options.getSource=function(){return cell.nbCell("programs").prologEditor("getSource","source",!0)},this.html("");var editor=$.el.div({class:"btn-group nb-cell-buttons",role:"group"},glyphButton("triangle-bottom","singleline","Show only first line","default","xs"),imageButton("background","Use as background program","xs"));this.append(editor,editor=$.el.div({class:"editor with-buttons"})),options.background&&this.addClass("background"),options.singleline&&this.nbCell("singleline"),$(editor).prologEditor(options)},methods.type.query=function(options){var cell=this;function setData(name){null!=options[name]&&(cell.data(name,""+options[name]),delete options[name])}this.html(""),null==(options=options||{}).tabled&&(options.tabled=preferences.getVal("tabled_results")),setData("tabled"),setData("chunk"),setData("run"),function setAttr(name){null!=options[name]&&(cell.attr(name,""+options[name]),delete options[name])}("name"),options=$.extend({},options,{role:"query",sourceID:function(){return cell.nbCell("programs").prologEditor("getSourceID")},prologQuery:function(q){cell.nbCell("run")}});var buttons=$.el.div({class:"btn-group nb-cell-buttons",role:"group"},glyphButton("wrench","settings","Settings","default","xs"),glyphButton("play","run","Run query","primary","xs"));function wrapSolution(a){this.find(".editor.query").prologEditor("wrapSolution",$(a).text())}var editor=form.widgets.dropdownButton($.el.span({class:"glyphicon glyphicon-menu-hamburger"}),{client:cell,divClass:"nb-query-menu",actions:{"Aggregate (count all)":wrapSolution,"--":null,Projection:wrapSolution,"Order by":wrapSolution,Distinct:wrapSolution,Limit:wrapSolution}});this.append(buttons,$.el.div({class:"query with-buttons"},editor,$.el.span({class:"prolog-prompt"},"?-"),editor=$.el.div({class:"editor query"}))),$(editor).prologEditor(options),this.addClass("runnable")},methods.run.markdown=function(markdownText){var cell=this;function makeEditable(text){var cell=$(text.target).closest(".nb-cell"),text=cell.data("markdownText");cell.removeData("markdownText"),methods.type.markdown.call(cell,{value:text}),cell.off("dblclick",makeEditable),cell.off("click",links.followLink)}function setHTML(data){cell.html(data),cell.removeClass("runnable"),cell.data("markdownText",markdownText),cell.on("dblclick",makeEditable),cell.on("click","a",links.followLink);var nbdata=cell.closest(".notebook").data("notebook");if(nbdata&&nbdata.markdown_post_renderer)for(var i=0;i<nbdata.markdown_post_renderer.length;i++)nbdata.markdown_post_renderer[i].call(cell)}""!=(markdownText=markdownText||cellText(this)).trim()?backend.ajax({type:"POST",url:config.http.locations.markdown,data:markdownText,contentType:"text/plain; charset=UTF-8",success:setHTML}):setHTML("<div class='nb-empty-markdown'>Empty markdown cell.  Double click to edit</div>")},methods.run.html=function(htmlText,options){var cell=this;function makeEditable(text){var cell;$(text.target).is("input")||$(text.target).is("textarea")||(text=(cell=$(text.target).closest(".nb-cell")).data("htmlText"),cell.removeData("htmlText"),methods.type.html.call(cell,{value:text}),cell.off("dblclick",makeEditable),cell.off("click",links.followLink))}function runScripts(){if(1==config.swish.notebook.eval_script&&0!=options.eval_script){var scripts=[];if(cell.find("script").each(function(){"text/javascript"==(this.getAttribute("type")||"text/javascript")&&scripts.push(this.textContent)}),0<scripts.length){var script="(function(notebook){"+scripts.join("\n")+"})",nb=new Notebook({cell:cell[0]});try{eval(script)(nb)}catch(e){alert(e)}}}}function runHTML(data){cell[0].innerHTML=data,runScripts()}function setHTML(data){runHTML(data),cell.removeClass("runnable"),cell.data("htmlText",htmlText),cell.on("dblclick",makeEditable),cell.on("click","a",links.followLink)}options=options||{},0!=options.html?(htmlText=(htmlText||cellText(this)).trim(),setHTML(""!=htmlText?htmlText:"<div class='nb-placeholder'>Empty HTML cell.  Double click to edit</div>")):runScripts()},methods.run.program=function(){modal.alert("Please define a query to run this program")},methods.run.query=function(options){var runner=this.nbCell("programs"),query=this.nbCell("getSettings"),text=cellText(this);if((options=options||{}).bindings){var pretext="";if("string"==typeof options.bindings)pretext=options.bindings;else for(var k in options.bindings)options.bindings.hasOwnProperty(k)&&(pretext&&(pretext+=", "),pretext+=k+" = "+Pengine.stringify(options.bindings[k]));pretext&&(text=pretext+", ("+prolog.trimFullStop(text)+")")}query={source:runner.prologEditor("getSource","source",!0),query:text,tabled:query.tabled||!1,chunk:query.chunk,title:!1,query_editor:this.find(".prolog-editor.query")};runner[0]&&(query.editor=runner[0]),options.success&&(query.success=options.success),options.complete&&(query.complete=options.complete);runner=$.el.div({class:"prolog-runner"});this.find(".prolog-runner").prologRunner("close"),this.append(runner),$(runner).prologRunner(query)},methods.onload.html=function(){return methods.run.html.call(this,void 0,{html:!1,eval_script:!0})},methods.saveDOM.markdown=function(){var text=this.data("markdownText")||cellText(this),dom=$.el.div({class:"nb-cell markdown"},text);return function copyAttr(name){var value;(value=cell.attr(name))&&value&&$(dom).attr(name,value)}("name"),dom},methods.saveDOM.html=function(){var text=this.data("htmlText")||cellText(this),dom=$.el.div({class:"nb-cell html"});return $(dom).html(text),function copyAttr(name){var value;(value=cell.attr(name))&&value&&$(dom).attr(name,value)}("name"),dom},methods.saveDOM.program=function(){var cell=this,dom=$.el.div({class:"nb-cell program"},cellText(this));function copyClassAttr(name){cell.hasClass(name)&&$(dom).attr("data-"+name,!0)}return copyClassAttr("background"),copyClassAttr("singleline"),function copyAttr(name){var value;(value=cell.attr(name))&&value&&$(dom).attr(name,value)}("name"),dom},methods.saveDOM.query=function(){var cell=this,dom=$.el.div({class:"nb-cell query"},cellText(this));function copyData(name){var value;(value=cell.data(name))&&!function isDefault(name,value){return!("tabled"!=name||value&&"false"!=value)}(name,value)&&$(dom).attr("data-"+name,value)}return copyData("tabled"),copyData("chunk"),copyData("run"),function copyAttr(name){var value;(value=cell.attr(name))&&value&&$(dom).attr(name,value)}("name"),dom},methods.restoreDOM.markdown=function(dom){var cell=this,text=dom.text().trim();cell.data("markdownText",text),function copyAttr(name){var value;(value=dom.attr(name))&&value&&cell.attr(name,value)}("name"),methods.run.markdown.call(this,text)},methods.restoreDOM.html=function(dom){var cell=this;!function copyAttr(name){var value;(value=dom.attr(name))&&value&&cell.attr(name,value)}("name"),methods.run.html.call(this,dom.html(),{eval_script:!1})},methods.restoreDOM.program=function(dom){var cell=this,opts={value:dom.text().trim()};function getAttr(name){var value;(value=dom.data(name))&&(opts[name]=value)}getAttr("background"),getAttr("singleline"),function copyAttr(name){var value;(value=dom.attr(name))&&value&&cell.attr(name,value)}("name"),methods.type.program.call(this,opts)},methods.restoreDOM.query=function(dom){var opts={value:dom.text().trim()};function getData(name){var value;(value=dom.data(name))&&("chunk"==name?opts.chunk=parseInt(value):opts[name]=value)}getData("tabled"),getData("chunk"),getData("run"),function getAttr(name){var value;(value=dom.attr(name))&&(opts[name]=value)}("name"),null==opts.tabled&&(opts.tabled=!1),methods.type.query.call(this,opts)},methods.changeGen.markdown=function(){var text=this.data("markdownText")||cellText(this);return sha1("M"+text.trim())},methods.changeGen.html=function(){var text=this.data("htmlText")||cellText(this);return sha1("H"+text.trim())},methods.changeGen.program=function(){var text="P",cell=this;function addClassAttr(name,key){cell.hasClass(name)&&(text+=key)}return addClassAttr("background","B"),addClassAttr("singleline","S"),text+="V"+cellText(this).trim(),sha1(text)},methods.changeGen.query=function(){var text="Q",cell=this;function addData(value,key){(value=cell.data(value))&&(text+=key+value)}return addData("tabled","T"),addData("chunk","C"),addData("run","R"),function addAttr(value,key){(value=cell.attr(value))&&(text+=key+value)}("name","N"),text+="V"+cellText(this).trim(),sha1(text)},methods.isEmpty.markdown=function(){return""==(this.data("markdownText")||cellText(this)).trim()},methods.isEmpty.html=function(){return""==(this.data("htmlText")||cellText(this)).trim()},methods.isEmpty.program=function(){return""==cellText(this).trim()},methods.isEmpty.query=function(){return""==cellText(this).trim()},$.fn.nbCell=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery),Notebook.prototype.swish=function(options){var source=this.cell().nbCell("programs").prologEditor("getSource","source",!0);return source&&(options.src=source),$.swish(options)},Notebook.prototype.cell=function(name){return name?this.notebook().find('.nb-cell[name="'+name+'"]'):$(this.my_cell)},Notebook.prototype.notebook=function(){return $(this.my_cell).closest(".notebook")},Notebook.prototype.run=function(cell,bindings){var options={};bindings&&(options.bindings=bindings),this.cell(cell).nbCell("run",options)},Notebook.prototype.submit=function(data,options){var formel=this.$(data),data=form.serializeAsObject(formel);form.formError(formel,null),this.swish({ask:options.predicate+"(("+Pengine.stringify(data)+"))",onerror:function(data){form.formError(formel,data)},onsuccess:options.onsuccess})},Notebook.prototype.bindQuery=function(a1,a2){var q,that=this,func="function"==typeof a1&&null==a2?(q=this.cell().nbCell("next",".query"),a1):(q=this.cell(a1),a2);0<q.length?q.find(".action-run").off("click").on("click",function(ev){var query={run:function(bindings){q.nbCell("run",{bindings:bindings})}};return func.call(that,query),ev.preventDefault(),!1}):alert("No query named '"+cell+"'")},Notebook.prototype.hideQuery=function(cell,on){var q=this.cell(cell);null==on&&(on=!0),0<q.length?1==on?(q.find(".nb-cell-buttons").hide(),q.find(".query").hide()):(q.find(".nb-cell-buttons").show(),q.find(".query").show()):alert("No query named '"+cell+"'")},Notebook.prototype.$=function(selector){return this.cell().find(selector)},Notebook.prototype.loadCSS=function(url){return utils.loadCSS(url)},Notebook.prototype.markdown_post_renderer=function(f){var data=this.notebook().data("notebook");data&&(null!=data.markdown_post_renderer?data.markdown_post_renderer.push(f):data.markdown_post_renderer=[f])}}),define("navbar",["jquery","preferences","form","laconic"],function($,preferences,form){!function($){var methods={_init:function(actions){return this.each(function(){var p,elem=$(this);for(p in actions)actions.hasOwnProperty(p)&&(elem.navbar("appendDropdown",p),elem.navbar("populateDropdown",p,actions[p]));elem.on("click","a",function(ev){!function runMenu(a,ev){if(!$(a).hasClass("trigger")){var action=$(a).data("navbar-action")||$(a).parents("ul").data("navbar-action");return function clickNotSubMenu(ev){var root=$(this).closest(".dropdown");root.find(".left-caret").toggleClass("right-caret left-caret"),root.find(".sub-menu:visible").hide()}.call(a,ev),action?(ev.preventDefault(),action.call(a,ev)):$(a).hasClass("trigger")&&clickSubMenu.call(a,ev)}clickSubMenu.call(a,ev)}(this,ev)})})},appendDropdown:function(label){var ul1=this.children(".nav.navbar-nav.menubar"),li=$.el.ul({name:label,class:"dropdown-menu"}),li=$.el.li({class:"dropdown"},$.el.a({class:"dropdown-toggle","data-toggle":"dropdown"},label,$.el.b({class:"caret"})),li);return ul1.append(li),this},populateDropdown:function(name,actions){if("function"==typeof actions)actions(this,name);else{var p,ul=dropDownUL(this,name);for(p in actions)actions.hasOwnProperty(p)&&appendDropdown(ul,p,actions[p])}},clearDropdown:function(ul,item){ul=dropDownUL(this,ul);return null==item?ul.html(""):dropDownLI(ul,item).remove(),this},extendDropdown:function(name,label,onclick){appendDropdown(dropDownUL(this,name),label,onclick)},insertMenu:function(dropdown,menu,action){return this}};function appendDropdown(dropdown,label,options){function glyph(name){if(name)return $.el.span({class:"dropdown-icon glyphicon glyphicon-"+name})}if(null!=options)if("--"==options)dropdown.append($.el.li({class:"divider"}));else if("function"==typeof options){li=options.typeIcon?$.el.a(form.widgets.typeIcon(options.typeIcon),label):options.glyph?$.el.a(glyph(options.glyph),label):0<(i=label.indexOf("("))?(li=label.substr(i),$.el.a({class:"accelerated"},label.substr(0,i).trim(),$.el.span({class:"accell-spacer"},li),$.el.span({class:"accell-text"},li))):$.el.a(label),$(li).data("navbar-action",options),options.name&&$(li).attr("id",options.name);var before,li=$.el.li(li);void 0!==options.after?null==options.after?dropdown.prepend(li):(before=dropDownLI(dropdown,options.after),$(li).insertAfter(before)):options.before?(before=dropDownLI(dropdown,options.before),$(li).insertBefore(before)):dropdown.append(li)}else if("checkbox"==options.type){var cb=$($.el.input({type:"checkbox"}));void 0!==options.preference?(cb.addClass("swish-event-receiver"),preferences.getVal(options.preference)&&cb.prop("checked",!0),cb.on("click",function(){preferences.setVal(options.preference,$(this).prop("checked"))}),cb.on("preference",function(pref){pref.name==options.preference&&cb.prop("checked",pref.value)})):(options.checked&&cb.prop("checked",options.checked),cb.on("click",function(){options.action($(this).prop("checked"))})),dropdown.append($.el.li({class:"checkbox"},cb[0],$.el.span(label)))}else if("submenu"==options.type){var submenu=$.el.ul({class:"dropdown-menu sub-menu"});if(dropdown.append($.el.li($.el.a({class:"trigger right-caret"},glyph(options.glyph),label),submenu)),options.action&&$(submenu).data("navbar-action",options.action),options.items)for(var i=0;i<options.items.length;i++)$(submenu).append($.el.li($.el.a(options.items[i])));options.update&&$(submenu).on("update",function(ev){options.update.call(ev.target)})}else alert("Unknown navbar item")}function dropDownUL(nb,name){return nb.find(".dropdown-menu").filter(function(){return $(this).attr("name")==name})}function dropDownLI(ul,label){return ul.find(`a:contains(${label})`).closest("li")}function clickSubMenu(ev){var current=$(this).next(),grandparent=$(this).parent().parent();($(this).hasClass("left-caret")||$(this).hasClass("right-caret"))&&$(this).toggleClass("right-caret left-caret"),grandparent.find(".left-caret").not(this).toggleClass("right-caret left-caret"),grandparent.find(".sub-menu:visible").not(current).hide(),current.trigger("update"),current.toggle(),ev.stopPropagation()}$.fn.navbar=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.navbar"):methods._init.apply(this,arguments)}}(jQuery)}),define("query",["jquery","config","preferences","cm/lib/codemirror","modal","utils","laconic","editor"],function($,config,preferences,CodeMirror,modal,utils){!function($){var pluginName="queryEditor",defaults={maxHistoryLength:50},methods={_init:function(options){return this.each(function(){var elem=$(this),data=$.extend({},defaults,options),qediv=$.el.div({class:"query"}),tabled=function tableCheckbox(options){var input=preferences.getVal("tabled_results"),checkbox={type:"checkbox",name:"table"};void 0===input&&(input=config.swish.tabled_results);input&&(checkbox.checked="checked");input=$.el.input(checkbox),checkbox=$.el.span({class:"run-chk-table"},input," table results");return $(input).on("change",function(ev){preferences.setVal("tabled_results",$(ev.target).prop("checked"))}),checkbox}();elem.addClass("prolog-query-editor swish-event-receiver reactive-size unloadable"),elem.append(qediv,$.el.div({class:"prolog-prompt"},"?-"),$.el.div({class:"query-buttons"},$.el.span({class:"buttons-left"},function examplesButton(options){var el=dropup("examples","Examples"),ul=$(el).find("ul");if("function"==typeof options.examples)$(el).mousedown(function(ev){1==ev.which&&function updateExamples(list){(list=$(list.target).closest(".prolog-query-editor").data(pluginName))&&"function"==typeof list.examples&&(list=list.examples(),$.isArray(list)&&Q(el).queryEditor("setExamples",list,!0))}(ev)});else if(options.examples)for(var list=options.examples,i=0;i<list.length;i++)ul.append($.el.li($.el.a(list[i])));return el}(data),function historyButton(options){var menu=dropup("history","History");return $(menu).on("mouseenter","li",function(a){a=$(a.target).closest("li").find("a");a.attr("title",utils.ago(a.data("time")))}),$(menu).mouseup(function(ev){setTimeout(function(){var ul=$(menu).find("ul.history"),h=ul.prop("scrollHeight");console.log(h),ul.animate({scrollTop:h})},100)}),menu}(data),function aggregateButton(dropup){for(var ul,list=dropup.aggregates||["Aggregate (count all)","--","Projection","Order by","Distinct","Limit","--","Time","Debug (trace)"],dropup=$.el.div({class:"btn-group dropup"},$.el.button({class:"btn btn-default btn-xs dropdown-toggle aggregate","data-toggle":"dropdown"},"Solutions",$.el.span({class:"caret"})),ul=$.el.ul({class:"dropdown-menu aggregate"})),i=0;i<list.length;i++){var wrap=list[i];"--"==wrap?$(ul).append($.el.li({class:"divider"})):$(ul).append($.el.li($.el.a(wrap)))}return $(dropup).on("click","a",function(){Q(this).find(".query").prologEditor("wrapSolution",$(this).text())}),dropup}(data)),$.el.span({class:"buttons-right"},tabled,runButton()))),$(qediv).append(elem.children("textarea")).prologEditor({role:"query",sourceID:function(){return data.sourceID()},prologQuery:function(q){elem.queryEditor("run",q,function tableSelected(){return $(tabled).find("input").prop("checked")}())}}),elem.data(pluginName,data),$(qediv).prologEditor("getSource","query")||("object"==typeof data.examples?data.examples[0]&&$(qediv).prologEditor("setSource",data.examples[0]):elem.queryEditor("setProgramEditor",$(data.editor),!0)),elem.on("current-program",function(ev,editor){elem.queryEditor("setProgramEditor",$(editor))}),elem.on("program-loaded",function(ev,exl){var query=exl.query;null!=query&&(null==query&&$(data.editor).data("prologEditor")==$(exl.editor).data("prologEditor")&&(query=(exl=data.examples())&&exl[0]?exl[0]:""),elem.queryEditor("setQuery",query))}),elem.on("unload",function(ev,rc){var state;!elem.closest(".swish").swish("preserve_state")||(state=elem.queryEditor("getState"))&&localStorage.setItem("query",JSON.stringify(state))}),elem.on("restore",function(ev,rc){if(""==elem.queryEditor("getQuery")){var state;try{var str=localStorage.getItem("query");str&&(state=JSON.parse(str))}catch(err){}state&&"object"==typeof state&&elem.queryEditor("setState",state)}}),elem.on("preference",function(ev,pref){"preserve-state"==pref.name&&0==pref.value&&localStorage.removeItem("query")})})},setProgramEditor:function(editor,exl){var data=this.data(pluginName);if(data.editor==editor[0]&&!exl)return this;data.editor=editor[0],data.editor?(data.examples=function(){var exl=editor.prologEditor("getExamples")||[],global=editor.parents(".swish").swish("examples",!0)||[];return $.isArray(global)&&exl.concat(global),exl},editor.prologEditor("isPengineSource")?data.source=function(){var src=editor.prologEditor("getSource","source"),bg=$(".background.prolog.source").text();return bg&&(src+="\n%@background@\n"+bg),src}:data.source="",data.sourceID=function(){return editor.prologEditor("getSourceID")},(exl=data.examples())&&exl[0]&&this.queryEditor("isClean")?this.queryEditor("setQuery",exl[0]):editor.prologEditor("refreshHighlight")):data.examples=""},getProgramEditor:function(){var data=this.data(pluginName);return data.editor?$(data.editor):$()},setExamples:function(list,clear){var ul=this.find("ul.examples");if(list=list||[],(clear=void 0===clear?!0:clear)&&function sameExamples(exs){var ex0;if((ex0=ul.data("examples"))&&ex0.length==exs.length){for(var i=0;i<ex0.length;i++)if(ex0[i]!=exs[i])return!1;return!0}return!1}(list))return this;!0===clear&&ul.html(""),ul.find("li.add-example, li.divider").remove();for(var i=0;i<list.length;i++)ul.append($.el.li($.el.a(list[i])));return ul.data("examples",list.slice(0)),ul.append($.el.li({class:"divider"})),ul.append($.el.li({class:"add-example"},$.el.a("Add current query to examples"))),this},addExample:function(){return""!=this.find(".query").prologEditor("getSource").trim()?$(".swish-event-receiver:visible").trigger("addExample",this.find(".query").prologEditor("getSource")):modal.alert("The query window is empty"),this},addHistory:function(query){var li,ul=this.find("ul.history"),a=this.data("queryEditor");return query&&((li=function findInHistory(){return ul.children().filter(function(){return $(this).text()==query})}())&&li.remove(),ul.children().length>=a.maxHistoryLength&&ul.children().first().remove(),ul.append($.el.li(a=$.el.a(query))),$(a).data("time",(new Date).getTime()/1e3)),this},getHistory:function(){var ul=this.find("ul.history"),h=[];return ul.children().each(function(){var a=$(this).find("a");h.push({query:a.text(),time:a.data("time")})}),h},restoreHistory:function(h){var ul=this.find("ul.history");ul.html("");for(var a,i=0;i<h.length;i++)ul.append($.el.li(a=$.el.a(h[i].query))),$(a).data("time",h[i].time)},setQuery:function(query){return this.data(pluginName).cleanGen=this.find(".query").prologEditor("setSource",query).focus().prologEditor("changeGen"),this},isClean:function(){var data=this.data(pluginName);return!this.queryEditor("getQuery")||data.cleanGen&&this.find(".query").prologEditor("isClean",data.cleanGen)},getQuery:function(){return this.find(".query").prologEditor("getSource","query")},getState:function(){return{query:this.queryEditor("getQuery"),history:this.queryEditor("getHistory")}},setState:function(state){this.queryEditor("restoreHistory",state.history||[]),this.queryEditor("setQuery",state.query||"")},run:function(q,tabled){var data=this.data("queryEditor");if(void 0===q&&(q=this.queryEditor("getQuery")),!(q=$.trim(q)))return $(".swish-event-receiver").trigger("help",{file:"query.html"}),this;$(".swish-event-receiver").trigger("clearMessages");var query={query:q,editor:data.editor,query_editor:this.find(".query")};return"function"==typeof data.source?query.source=data.source(q):"string"==typeof data.source&&(query.source=data.source),tabled&&(query.tabled=!0),this.queryEditor("addHistory",q),data.runner.prologRunners("run",query),this}};function Q(from){return $(from).closest(".prolog-query-editor")}function dropup(dropup,label){dropup=$.el.div({class:"btn-group dropup"},$.el.button({class:"btn btn-default btn-xs dropdown-toggle "+dropup,"data-toggle":"dropdown"},label,$.el.span({class:"caret"})),$.el.ul({class:"dropdown-menu "+dropup}));return $(dropup).on("click","a",function(){$(this).closest("li").hasClass("add-example")?Q(this).queryEditor("addExample"):Q(this).queryEditor("setQuery",$(this).text())}),dropup}function runButton(){var button=$.el.button({class:"btn btn-default btn-primary btn-xs"},"Run!");return $(button).on("click",function(){Q(this).queryEditor("run",void 0,function tableSelected(from){return $(from).parent().find("input").prop("checked")}(this))}),button}$.fn.queryEditor=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery)}),define("term",["jquery"],function($){!function($){var pluginName="pl_term",themenu=null,prepared=!1,methods={_init:function(options){return prepared||(function prepare(el){var active="span.pl-trigger";el.on("click",active,function(){themenu||$(this)[pluginName]("menu")}),el.on("mouseover",active,function(e){$(this).parent()[pluginName]("activate",!0),e.stopPropagation()}),el.on("mouseout",active,function(e){$(this).parent()[pluginName]("activate",!1)})}(this),prepared=!0),this.each(function(){})},fold:function(options){return this.each(function(){var el=$(this);el.removeClass("vertical"),el.addClass("fold"),el.children(".pl-ellipsis").length||(el.hasClass("pl-compound")?el.children(".pl-functor").after('<span class="pl-ellipsis">...)</span>'):el.hasClass("pl-list")?el.children(".pl-list-open").after('<span class="pl-ellipsis">...</span>'):el.hasClass("pl-dict")&&el.children(".pl-dict-open").after('<span class="pl-ellipsis">...}</span>'))})},unfold:function(options){return this.each(function(){var el=$(this);el.hasClass("fold")&&(el.removeClass("fold"),el.children(".pl-ellipsis").remove())})},getLayout:function(){return el=$(this),el.hasClass("fold")?"ellipsis":el.hasClass("vertical")?"vertical":"horizontal"},layout:function(options){return null==(options="string"==typeof options?{layout:options}:options||{}).propagate&&"horizontal"==options.layout&&(options.propagate=!0),this.each(function(){var opts,el=$(this);options.propagated&&!options.no_ellipsis&&"ellipsis"==el[pluginName]("getLayout")||("vertical"==options.layout?(el[pluginName]("unfold"),el.addClass("vertical")):"horizontal"==options.layout?(el[pluginName]("unfold"),el.removeClass("vertical")):"ellipsis"==options.layout?el[pluginName]("fold"):"auto"==options.layout&&(el[pluginName]("layout","horizontal"),function autoLayout(el,options){let rc=!1;el.children().each(function(){rc=rc&&autoLayout($(this),options)});if(el.is(".pl-adaptive")){let layout;return(layout=el.data("layout"))?el[pluginName]("layout",layout):el.width()>(options.width||400)&&(el[pluginName]("layout","vertical"),layout="vertical"),"vertical"==layout}return!1}(el,options)&&el.addClass("vertical")),options.propagate&&(opts=$.extend({},options,{propagate:!1,propagated:!0}),el.find(".pl-adaptive")[pluginName]("layout",opts)))})},menu:function(options){var funct=$(this),el=funct.closest(".pl-adaptive");function item(icon,action,title){return"<li data-action='"+action+"'><span class='glyphicon glyphicon-"+icon+"'></span>"+title+"</li>"}el.hasClass("pl-compound")?offset=el.data("name")+"/"+el.data("arity"):el.hasClass("pl-list")?(offset=el.data("length")+" elements",el.data("partial")&&(offset+=" (partial)")):el.hasClass("pl-dict")?offset="Dict":el.hasClass("pl-binding")&&(offset="Binding");var menu=$("<ul class='pl-compound-menu'><li><span class='pl-title'>"+offset+"</span></li>"+item("heart","auto","Smart")+item("triangle-right","horizontal","Horizontal")+item("triangle-bottom","vertical","Vertical")+item("option-horizontal","ellipsis","Ellipsis")+item("copy","copy","Copy")+"</ul>");$(document).on("click",function clickHandler(text){if(text.stopPropagation(),$(text.target).closest(".pl-compound-menu").length){var action=$(text.target).data("action");let on=el;on.hasClass("pl-binding")&&(on=on.children(".pl-binding-value"),"ellipsis"==action?on.addClass("fold"):on.removeClass("fold"),"copy"!=action&&(on=on.find(".pl-adaptive.pl-level-0"))),"copy"==action?(text=on.clone(!1)[pluginName]("layout",{layout:"horizontal",no_ellipsis:!0,propagate:!0}).text(),navigator.clipboard.writeText(text)):(on[pluginName]("layout",action),on[pluginName]("fit"))}menu.remove(),themenu=null,$(document).off("click",clickHandler)});var offset=funct.offset();offset.top+=funct.height(),$("body").append(menu),menu.offset(offset),themenu=menu},activate:function(act){act?this.addClass("pl-active"):this.removeClass("pl-active")},fit:function(){const el=$(this),adapt=el.closest(".pl-adaptive.pl-level-0"),paren=adapt.closest(".pl-embrace");paren[pluginName]("fit_parenthesis")},fit_parenthesis:function(){return this.each(function(){var el=$(this);el.children(".pl-parenthesis");el.children(".pl-embraced").find(".vertical").length?el.addClass("vertical"):el.removeClass("vertical")})}};$.fn.pl_term=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery."+pluginName):methods._init.apply(this,arguments)}}(jQuery),$(document).pl_term()}),define("login",["jquery","modal","config","form","backend","laconic"],function($,modal,config,form,backend){var DEFAULT_USER_FIELDS=["display_name","email","avatar"];!function($){var methods={_init:function(options){return this.each(function(){var elem=$(this),data={};data.url=elem.attr("href"),elem.removeAttr("href"),elem.on("click",function(ev){elem.hasClass("login")&&elem.login("login",ev)}),elem.data("login",data),elem.login("update","startup")})},update:function(why){var elem=$(this);config.http.locations.user_info?backend.ajax({url:config.http.locations.user_info,data:{reason:why},success:function(icon){var span;icon?(config.swish.user=icon,elem.removeClass("login").addClass("logout"),span=elem.find("span.logout span.value"),icon=icon.avatar?$.el.img({class:"profile-picture",src:icon.avatar}):$.el.span({class:"glyphicon glyphicon-user"}),icon=$.el.span(icon,$.el.b({class:"caret"})),span.html(""),span.append(form.widgets.dropdownButton(icon,{divClass:"user-menu btn-transparent",ulClass:"pull-right",client:elem,actions:{Logout:elem.hasClass("no-logout")?void 0:function(){this.login("logout")},Profile:function(){this.login("profile")}}})),"logout_by_http"==why&&modal.alert("Failed to logout from HTTP login.  Logout from HTTP is known not to work for Chrome.  For some browsers there is a plugin to logout.  Otherwise stopping your browser completely (all pages) and restarting is the only way to logout.  HTTP logout does work for FireFox and IE.")):(delete config.swish.user,elem.removeClass("logout").addClass("login")),$(".sourcelist").trigger("login")},error:function(jqXHR){modal.ajaxError(jqXHR)},dataType:"json"}):$(".sourcelist").trigger("login")},login:function(frame){var elem=$(this),server=this.data("login"),frame=$(frame.target),url=server.url,server=frame.closest("[data-server]").data("server"),frame=frame.closest("[data-frame]").data("frame")||"iframe";server&&(url+="?server="+encodeURIComponent(server)),"popup"==frame?function openPopup(uri,name,options,closeCallback){var win=window.open(uri,name,options),interval=window.setInterval(function(){try{null!=win&&!win.closed||(window.clearInterval(interval),closeCallback(win))}catch(e){}},1e3);window.focus&&win.focus()}(url,"_blank","location=true,status=true,height=400,width=800",function(){elem.login("logged_in")}):modal.show({title:"Login",body:function(){var button=$.el.button({name:"ok",class:"btn btn-primary login-cont","data-dismiss":"modal"},"Continue");this.append($.el.iframe({class:"login",src:url}),button)},onclose:function(){elem.login("logged_in")}})},logged_in:function(){this.login("update","login")},profile:function(){var login=$(this);modal.server_form({title:"User profile",url:config.swish.user.swish_profile_url||config.http.locations.user_profile,onreply:function(){login.login("update","profile")}})},get_profile:function(fields){var info={},obj=config.swish.user||{};function set_from_chat(key,chat_key){var v=$("#chat");1!=v.length||(v=v.chat("self",[chat_key]))[chat_key]&&(info[key]=v[chat_key])}fields=fields||DEFAULT_USER_FIELDS;for(var i=0;i<fields.length;i++){var key=fields[i];obj[key]?info[key]=obj[key]:"display_name"==key?obj.name?info.display_name=obj.name:obj.given_name&&obj.family_name?info.display_name=obj.given_name+" "+obj.family_name:obj.family_name?info.display_name=obj.family_name:obj.given_name?info.display_name=obj.given_name:obj.nick_name?info.display_name=obj.nick_name:set_from_chat("display_name","name"):"identity"==key?obj.external_identity&&obj.identity_provider&&(info.identity=obj.identity_provider+":"+obj.external_identity):"avatar"==key&&set_from_chat("avatar","avatar")}return info},logout:function(){var user=config.swish.user,elem=$(this);user&&(user.logout_url?backend.ajax({url:user.logout_url,success:function(){elem.login("update","logout_by_url")},error:function(jqXHDR){modal.ajaxError(jqXHDR)}}):"basic"==user.auth_method||"digest"==user.auth_method?function clearAuthenticationCache(page,method,oncomplete){page=page||".force_logout";try{var xmlhttp,agt=navigator.userAgent.toLowerCase();-1!=agt.indexOf("msie")?document.execCommand("ClearAuthenticationCache"):-1!=agt.indexOf("webkit")&&"basic"==method?(xmlhttp=createXMLObject(oncomplete))&&(xmlhttp.open("GET",page,!0),xmlhttp.setRequestHeader("Authorization","Basic logout"),xmlhttp.send()):(xmlhttp=createXMLObject(oncomplete))&&(xmlhttp.open("GET",page,!0,"logout","logout"),xmlhttp.send(""),xmlhttp.abort())}catch(e){return}}(config.http.locations.http_logout,config.swish.user.auth_method,function(){elem.login("update","logout_by_http")}):alert("Don't know how to logout"))}};function createXMLObject(oncomplete){var xmlhttp;try{window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:window.ActiveXObject&&(xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")),oncomplete&&(xmlhttp.addEventListener("load",oncomplete),xmlhttp.addEventListener("error",oncomplete),xmlhttp.addEventListener("abort",oncomplete))}catch(e){}return xmlhttp}$.fn.login=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.login"):methods._init.apply(this,arguments)}}(jQuery)}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define("d3",["exports"],factory):factory((global=global||self).d3=global.d3||{})}(this,function(exports){"use strict";function ascending(a,b){return a<b?-1:b<a?1:b<=a?0:NaN}function bisector(compare){return 1===compare.length&&(compare=function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}(compare)),{left:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=1+mid:hi=mid}return lo},right:function(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;0<compare(a[mid],x)?hi=mid:lo=1+mid}return lo}}}var diamond=bisector(ascending),bisectRight=diamond.right,bisectLeft=diamond.left;function pair(a,b){return[a,b]}function number(x){return null===x?NaN:+x}function variance(values,valueof){var value,delta,n=values.length,m=0,i=-1,mean=0,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||(sum+=(delta=value-mean)*(value-(mean+=delta/++m)));if(1<m)return sum/(m-1)}function deviation(array,v){v=variance(array,v);return v&&Math.sqrt(v)}function extent(values,valueof){var value,min,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value<=value)for(min=max=value;++i<n;)null!=(value=values[i])&&(value<min&&(min=value),max<value&&(max=value))}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value<=value)for(min=max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&(value<min&&(min=value),max<value&&(max=value));return[min,max]}var catmullRomOpen=Array.prototype,slice=catmullRomOpen.slice,map=catmullRomOpen.map;function constant(x){return function(){return x}}function identity(x){return x}function sequence(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)===(stop=+stop)&&0<count)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(0<step)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(start=Math.floor(start*step),stop=Math.ceil(stop*step),ticks=new Array(n=Math.ceil(start-stop+1));++i<n;)ticks[i]=(start-i)/step;return reverse&&ticks.reverse(),ticks}function tickIncrement(error,stop,power){error=(stop-error)/Math.max(0,power),power=Math.floor(Math.log(error)/Math.LN10),error/=Math.pow(10,power);return 0<=power?(e10<=error?10:e5<=error?5:e2<=error?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(e10<=error?10:e5<=error?5:e2<=error?2:1)}function tickStep(start,stop,step1){var error=Math.abs(stop-start)/Math.max(0,step1),step1=Math.pow(10,Math.floor(Math.log(error)/Math.LN10)),error=error/step1;return e10<=error?step1*=10:e5<=error?step1*=5:e2<=error&&(step1*=2),stop<start?-step1:step1}function thresholdSturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function threshold(values,value0,valueof){if(null==valueof&&(valueof=number),i0=values.length){if((value0=+value0)<=0||i0<2)return+valueof(values[0],0,values);if(1<=value0)return+valueof(values[i0-1],i0-1,values);var i=(i0-1)*value0,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}}function max(values,valueof){var value,max,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value<=value)for(max=value;++i<n;)null!=(value=values[i])&&max<value&&(max=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value<=value)for(max=value;++i<n;)null!=(value=valueof(values[i],i,values))&&max<value&&(max=value);return max}function merge(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);0<=--n;)for(m=(array=arrays[n]).length;0<=--m;)merged[--j]=array[m];return merged}function min(values,valueof){var value,min,n=values.length,i=-1;if(null==valueof){for(;++i<n;)if(null!=(value=values[i])&&value<=value)for(min=value;++i<n;)null!=(value=values[i])&&value<min&&(min=value)}else for(;++i<n;)if(null!=(value=valueof(values[i],i,values))&&value<=value)for(min=value;++i<n;)null!=(value=valueof(values[i],i,values))&&value<min&&(min=value);return min}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min(matrix,length),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose}function length(d){return d.length}var slice$1=Array.prototype.slice;function identity$1(x){return x}var top=1,right=2,bottom=3,left=4,epsilon=1e-6;function translateX(x){return"translate("+(x+.5)+",0)"}function translateY(y){return"translate(0,"+(y+.5)+")"}function entering(){return!this.__axis}function axis(orient,scale){var tickArguments=[],tickValues=null,tickFormat=null,tickSizeInner=6,tickSizeOuter=6,tickPadding=3,k=orient===top||orient===left?-1:1,x=orient===left||orient===right?"x":"y",transform=orient===top||orient===bottom?translateX:translateY;function axis(context){var text=null==tickValues?scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain():tickValues,format=null==tickFormat?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):identity$1:tickFormat,spacing=Math.max(tickSizeInner,0)+tickPadding,line=scale.range(),range0=+line[0]+.5,range1=+line[line.length-1]+.5,position=(scale.bandwidth?function center(scale){var offset=Math.max(0,scale.bandwidth()-1)/2;return scale.round()&&(offset=Math.round(offset)),function(d){return+scale(d)+offset}}:function number$1(scale){return function(d){return+scale(d)}})(scale.copy()),selection=context.selection?context.selection():context,path=selection.selectAll(".domain").data([null]),tickExit=(tick=selection.selectAll(".tick").data(text,scale).order()).exit(),tickEnter=tick.enter().append("g").attr("class","tick"),line=tick.select("line"),text=tick.select("text"),path=path.merge(path.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),tick=tick.merge(tickEnter),line=line.merge(tickEnter.append("line").attr("stroke","currentColor").attr(x+"2",k*tickSizeInner)),text=text.merge(tickEnter.append("text").attr("fill","currentColor").attr(x,k*spacing).attr("dy",orient===top?"0em":orient===bottom?"0.71em":"0.32em"));context!==selection&&(path=path.transition(context),tick=tick.transition(context),line=line.transition(context),text=text.transition(context),tickExit=tickExit.transition(context).attr("opacity",epsilon).attr("transform",function(d){return isFinite(d=position(d))?transform(d):this.getAttribute("transform")}),tickEnter.attr("opacity",epsilon).attr("transform",function(d){var p=this.parentNode.__axis;return transform(p&&isFinite(p=p(d))?p:position(d))})),tickExit.remove(),path.attr("d",orient===left||orient==right?tickSizeOuter?"M"+k*tickSizeOuter+","+range0+"H0.5V"+range1+"H"+k*tickSizeOuter:"M0.5,"+range0+"V"+range1:tickSizeOuter?"M"+range0+","+k*tickSizeOuter+"V0.5H"+range1+"V"+k*tickSizeOuter:"M"+range0+",0.5H"+range1),tick.attr("opacity",1).attr("transform",function(d){return transform(position(d))}),line.attr(x+"2",k*tickSizeInner),text.attr(x,k*spacing).text(format),selection.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",orient===right?"start":orient===left?"end":"middle"),selection.each(function(){this.__axis=position})}return axis.scale=function(_){return arguments.length?(scale=_,axis):scale},axis.ticks=function(){return tickArguments=slice$1.call(arguments),axis},axis.tickArguments=function(_){return arguments.length?(tickArguments=null==_?[]:slice$1.call(_),axis):tickArguments.slice()},axis.tickValues=function(_){return arguments.length?(tickValues=null==_?null:slice$1.call(_),axis):tickValues&&tickValues.slice()},axis.tickFormat=function(_){return arguments.length?(tickFormat=_,axis):tickFormat},axis.tickSize=function(_){return arguments.length?(tickSizeInner=tickSizeOuter=+_,axis):tickSizeInner},axis.tickSizeInner=function(_){return arguments.length?(tickSizeInner=+_,axis):tickSizeInner},axis.tickSizeOuter=function(_){return arguments.length?(tickSizeOuter=+_,axis):tickSizeOuter},axis.tickPadding=function(_){return arguments.length?(tickPadding=+_,axis):tickPadding},axis}var noop={value:function(){}};function dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _||/[\s.]/.test(t))throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function set(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=noop,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name:name,value:callback}),type}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(typename,callback){var t,_=this._,T=function parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(0<=i&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=set(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=set(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=function get(type,name){for(var c,i=0,n=type.length;i<n;++i)if((c=type[i]).name===name)return c.value}(_[t],typename.name)))return t},copy:function(){var t,copy={},_=this._;for(t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function(type,that){if(0<(n=arguments.length-2))for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}};var xhtml="http://www.w3.org/1999/xhtml",namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(name){var prefix=name+="",i=prefix.indexOf(":");return 0<=i&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name}function creator(fullname){fullname=namespace(fullname);return(fullname.local?function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}:function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}})(fullname)}function none(){}function selector(selector){return null==selector?none:function(){return this.querySelector(selector)}}function empty(){return[]}function selectorAll(selector){return null==selector?empty:function(){return this.querySelectorAll(selector)}}function matcher(selector){return function(){return this.matches(selector)}}function sparse(update){return new Array(update.length)}function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument,this.namespaceURI=parent.namespaceURI,this._next=null,this._parent=parent,this.__data__=datum}EnterNode.prototype={constructor:EnterNode,appendChild:function(child){return this._parent.insertBefore(child,this._next)},insertBefore:function(child,next){return this._parent.insertBefore(child,next)},querySelector:function(selector){return this._parent.querySelector(selector)},querySelectorAll:function(selector){return this._parent.querySelectorAll(selector)}};var keyPrefix="$";function bindIndex(parent,group,enter,update,exit,data){for(var node,i=0,groupLength=group.length,dataLength=data.length;i<dataLength;++i)(node=group[i])?(node.__data__=data[i],update[i]=node):enter[i]=new EnterNode(parent,data[i]);for(;i<groupLength;++i)(node=group[i])&&(exit[i]=node)}function bindKey(parent,group,enter,update,exit,data,key){for(var node,keyValue,nodeByKeyValue={},groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength),i=0;i<groupLength;++i)(node=group[i])&&(keyValues[i]=keyValue=keyPrefix+key.call(node,node.__data__,i,group),keyValue in nodeByKeyValue?exit[i]=node:nodeByKeyValue[keyValue]=node);for(i=0;i<dataLength;++i)(node=nodeByKeyValue[keyValue=keyPrefix+key.call(parent,data[i],i,data)])?((update[i]=node).__data__=data[i],nodeByKeyValue[keyValue]=null):enter[i]=new EnterNode(parent,data[i]);for(i=0;i<groupLength;++i)(node=group[i])&&nodeByKeyValue[keyValues[i]]===node&&(exit[i]=node)}function ascending$1(a,b){return a<b?-1:b<a?1:b<=a?0:NaN}function defaultView(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView}function styleValue(node,name){return node.style.getPropertyValue(name)||defaultView(node).getComputedStyle(node,null).getPropertyValue(name)}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node,this._names=classArray(node.getAttribute("class")||"")}function classedAdd(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.add(names[i])}function classedRemove(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.remove(names[i])}function textRemove(){this.textContent=""}function htmlRemove(){this.innerHTML=""}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function constantNull(){return null}function remove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function selection_cloneShallow(){var clone=this.cloneNode(!1),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}function selection_cloneDeep(){var clone=this.cloneNode(!0),parent=this.parentNode;return parent?parent.insertBefore(clone,this.nextSibling):clone}ClassList.prototype={add:function(name){this._names.indexOf(name)<0&&(this._names.push(name),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){i=this._names.indexOf(i);0<=i&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(name){return 0<=this._names.indexOf(name)}};var filterEvents={};function filterContextListener(listener,index,group){return listener=contextListener(listener,index,group),function(event){var related=event.relatedTarget;related&&(related===this||8&related.compareDocumentPosition(this))||listener.call(this,event)}}function contextListener(listener,index,group){return function(event1){var event0=exports.event;exports.event=event1;try{listener.call(this,this.__data__,index,group)}finally{exports.event=event0}}}function onRemove(typename){return function(){var on=this.__on;if(on){for(var o,j=0,i=-1,m=on.length;j<m;++j)o=on[j],typename.type&&o.type!==typename.type||o.name!==typename.name?on[++i]=o:this.removeEventListener(o.type,o.listener,o.capture);++i?on.length=i:delete this.__on}}}function onAdd(typename,value,capture){var wrap=filterEvents.hasOwnProperty(typename.type)?filterContextListener:contextListener;return function(d,i,group){var o,on=this.__on,listener=wrap(value,i,group);if(on)for(var j=0,m=on.length;j<m;++j)if((o=on[j]).type===typename.type&&o.name===typename.name)return this.removeEventListener(o.type,o.listener,o.capture),this.addEventListener(o.type,o.listener=listener,o.capture=capture),void(o.value=value);this.addEventListener(typename.type,listener,capture),o={type:typename.type,name:typename.name,value:value,listener:listener,capture:capture},on?on.push(o):this.__on=[o]}}function customEvent(event1,listener,that,args){var event0=exports.event;event1.sourceEvent=exports.event,exports.event=event1;try{return listener.apply(that,args)}finally{exports.event=event0}}function dispatchEvent(node,type,params){var window=defaultView(node),event=window.CustomEvent;"function"==typeof event?event=new event(type,params):(event=window.document.createEvent("Event"),params?(event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail):event.initEvent(type,!1,!1)),node.dispatchEvent(event)}exports.event=null,"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"}));var root=[null];function Selection(groups,parents){this._groups=groups,this._parents=parents}function selection(){return new Selection([[document.documentElement]],root)}function select(selector){return"string"==typeof selector?new Selection([[document.querySelector(selector)]],[document.documentElement]):new Selection([[selector]],root)}Selection.prototype=selection.prototype={constructor:Selection,select:function selection_select(select){"function"!=typeof select&&(select=selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode);return new Selection(subgroups,this._parents)},selectAll:function selection_selectAll(select){"function"!=typeof select&&(select=selectorAll(select));for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&(subgroups.push(select.call(node,node.__data__,i,group)),parents.push(node));return new Selection(subgroups,parents)},filter:function selection_filter(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new Selection(subgroups,this._parents)},data:function selection_data(value,key){if(!value)return data=new Array(this.size()),j=-1,this.each(function(d){data[++j]=d}),data;var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;"function"!=typeof value&&(value=function constant$1(x){return function(){return x}}(value));for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=value.call(parent,parent&&parent.__data__,j,parents),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength);bind(parent,group,enterGroup,updateGroup,exit[j]=new Array(groupLength),data,key);for(var previous,next,i0=0,i1=0;i0<dataLength;++i0)if(previous=enterGroup[i0]){for(i1<=i0&&(i1=i0+1);!(next=updateGroup[i1])&&++i1<dataLength;);previous._next=next||null}}return(update=new Selection(update,parents))._enter=enter,update._exit=exit,update},enter:function selection_enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)},exit:function selection_exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)},join:function selection_join(onenter,onupdate,onexit){var enter=this.enter(),update=this,exit=this.exit(),enter="function"==typeof onenter?onenter(enter):enter.append(onenter+"");return null!=onupdate&&(update=onupdate(update)),null==onexit?exit.remove():onexit(exit),enter&&update?enter.merge(update).order():update},merge:function selection_merge(m1){for(var groups0=this._groups,groups1=m1._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Selection(merges,this._parents)},order:function selection_order(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;)for(var node,group=groups[j],i=group.length-1,next=group[i];0<=--i;)(node=group[i])&&(next&&4^node.compareDocumentPosition(next)&&next.parentNode.insertBefore(node,next),next=node);return this},sort:function selection_sort(compare){function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}compare=compare||ascending$1;for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var node,group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(sortgroup[i]=node);sortgroup.sort(compareNode)}return new Selection(sortgroups,this._parents).order()},call:function selection_call(){var callback=arguments[0];return arguments[0]=this,callback.apply(null,arguments),this},nodes:function selection_nodes(){var nodes=new Array(this.size()),i=-1;return this.each(function(){nodes[++i]=this}),nodes},node:function selection_node(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}return null},size:function selection_size(){var size=0;return this.each(function(){++size}),size},empty:function selection_empty(){return!this.node()},each:function selection_each(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var node,group=groups[j],i=0,n=group.length;i<n;++i)(node=group[i])&&callback.call(node,node.__data__,i,group);return this},attr:function selection_attr(node,value){var fullname=namespace(node);if(arguments.length<2){node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((null==value?fullname.local?function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}:function attrRemove(name){return function(){this.removeAttribute(name)}}:"function"==typeof value?fullname.local?function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttributeNS(fullname.space,fullname.local):this.setAttributeNS(fullname.space,fullname.local,v)}}:function attrFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttribute(name):this.setAttribute(name,v)}}:fullname.local?function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}:function attrConstant(name,value){return function(){this.setAttribute(name,value)}})(fullname,value))},style:function selection_style(name,value,priority){return 1<arguments.length?this.each((null==value?function styleRemove(name){return function(){this.style.removeProperty(name)}}:"function"==typeof value?function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);null==v?this.style.removeProperty(name):this.style.setProperty(name,v,priority)}}:function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}})(name,value,null==priority?"":priority)):styleValue(this.node(),name)},property:function selection_property(name,value){return 1<arguments.length?this.each((null==value?function propertyRemove(name){return function(){delete this[name]}}:"function"==typeof value?function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?delete this[name]:this[name]=v}}:function propertyConstant(name,value){return function(){this[name]=value}})(name,value)):this.node()[name]},classed:function selection_classed(name,value){var names=classArray(name+"");if(arguments.length<2){for(var list=classList(this.node()),i=-1,n=names.length;++i<n;)if(!list.contains(names[i]))return!1;return!0}return this.each(("function"==typeof value?function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}:value?function classedTrue(names){return function(){classedAdd(this,names)}}:function classedFalse(names){return function(){classedRemove(this,names)}})(names,value))},text:function selection_text(value){return arguments.length?this.each(null==value?textRemove:("function"==typeof value?function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}}:function textConstant(value){return function(){this.textContent=value}})(value)):this.node().textContent},html:function selection_html(value){return arguments.length?this.each(null==value?htmlRemove:("function"==typeof value?function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}}:function htmlConstant(value){return function(){this.innerHTML=value}})(value)):this.node().innerHTML},raise:function selection_raise(){return this.each(raise)},lower:function selection_lower(){return this.each(lower)},append:function selection_append(name){var create="function"==typeof name?name:creator(name);return this.select(function(){return this.appendChild(create.apply(this,arguments))})},insert:function selection_insert(name,before){var create="function"==typeof name?name:creator(name),select=null==before?constantNull:"function"==typeof before?before:selector(before);return this.select(function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)})},remove:function selection_remove(){return this.each(remove)},clone:function selection_clone(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)},datum:function selection_datum(value){return arguments.length?this.property("__data__",value):this.node().__data__},on:function selection_on(typename,value,capture){var i,t,typenames=function parseTypenames$1(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");return 0<=i&&(name=t.slice(i+1),t=t.slice(0,i)),{type:t,name:name}})}(typename+""),n=typenames.length;if(!(arguments.length<2)){for(on=value?onAdd:onRemove,null==capture&&(capture=!1),i=0;i<n;++i)this.each(on(typenames[i],value,capture));return this}var on=this.node().__on;if(on)for(var o,j=0,m=on.length;j<m;++j)for(i=0,o=on[j];i<n;++i)if((t=typenames[i]).type===o.type&&t.name===o.name)return o.value},dispatch:function selection_dispatch(type,params){return this.each(("function"==typeof params?function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}:function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}})(type,params))}};var nextId=0;function local(){return new Local}function Local(){this._="@"+(++nextId).toString(36)}function sourceEvent(){for(var source,current=exports.event;source=current.sourceEvent;)current=source;return current}function point(node,event){var svg=node.ownerSVGElement||node;if(svg.createSVGPoint){var rect=svg.createSVGPoint();return rect.x=event.clientX,rect.y=event.clientY,[(rect=rect.matrixTransform(node.getScreenCTM().inverse())).x,rect.y]}rect=node.getBoundingClientRect();return[event.clientX-rect.left-node.clientLeft,event.clientY-rect.top-node.clientTop]}function mouse(node){var event=sourceEvent();return point(node,event=event.changedTouches?event.changedTouches[0]:event)}function touch(node,touches,identifier){arguments.length<3&&(identifier=touches,touches=sourceEvent().changedTouches);for(var touch,i=0,n=touches?touches.length:0;i<n;++i)if((touch=touches[i]).identifier===identifier)return point(node,touch);return null}function nopropagation(){exports.event.stopImmediatePropagation()}function noevent(){exports.event.preventDefault(),exports.event.stopImmediatePropagation()}function dragDisable(selection){var root=selection.document.documentElement,selection=select(selection).on("dragstart.drag",noevent,!0);"onselectstart"in root?selection.on("selectstart.drag",noevent,!0):(root.__noselect=root.style.MozUserSelect,root.style.MozUserSelect="none")}function yesdrag(view,noclick){var root=view.document.documentElement,selection=select(view).on("dragstart.drag",null);noclick&&(selection.on("click.drag",noevent,!0),setTimeout(function(){selection.on("click.drag",null)},0)),"onselectstart"in root?selection.on("selectstart.drag",null):(root.style.MozUserSelect=root.__noselect,delete root.__noselect)}function constant$2(x){return function(){return x}}function DragEvent(target,type,subject,id,active,x,y,dx,dy,dispatch){this.target=target,this.type=type,this.subject=subject,this.identifier=id,this.active=active,this.x=x,this.y=y,this.dx=dx,this.dy=dy,this._=dispatch}function defaultFilter(){return!exports.event.ctrlKey&&!exports.event.button}function defaultContainer(){return this.parentNode}function defaultSubject(d){return null==d?{x:exports.event.x,y:exports.event.y}:d}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function define(constructor,factory,prototype){(constructor.prototype=factory.prototype=prototype).constructor=constructor}function extend(parent,definition){var key,prototype=Object.create(parent.prototype);for(key in definition)prototype[key]=definition[key];return prototype}function Color(){}Local.prototype=local.prototype={constructor:Local,get:function(node){for(var id=this._;!(id in node);)if(!(node=node.parentNode))return;return node[id]},set:function(node,value){return node[this._]=value},remove:function(node){return this._ in node&&delete node[this._]},toString:function(){return this._}},DragEvent.prototype.on=function(){var value=this._.on.apply(this._,arguments);return value===this._?this:value};var star="\\s*([+-]?\\d+)\\s*",triangle="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",square="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[star,star,star]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[square,square,square]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[star,star,star,triangle]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[square,square,square,triangle]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[triangle,square,square]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[triangle,square,square,triangle]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatRgb(){return this.rgb().formatRgb()}function color(format){var m,l;return format=(format+"").trim().toLowerCase(),(m=reHex.exec(format))?(l=m[1].length,m=parseInt(m[1],16),6===l?rgbn(m):3===l?new Rgb(m>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):8===l?new Rgb(m>>24&255,m>>16&255,m>>8&255,(255&m)/255):4===l?new Rgb(m>>12&15|m>>8&240,m>>8&15|m>>4&240,m>>4&15|240&m,((15&m)<<4|15&m)/255):null):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return new Rgb(r=a<=0?g=b=NaN:r,g,b,a)}function rgbConvert(o){return(o=o instanceof Color?o:color(o))?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}function hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||1<=l?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o=!(o instanceof Color)?color(o):o))return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=0<l&&l<1?0:h,new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return 1===arguments.length?hslConvert(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color,{copy:function(channels){return Object.assign(new this.constructor,this,channels)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:function color_formatHsl(){return hslConvert(this).formatHsl()},formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var h=this.h%360+360*(this.h<0),m2=isNaN(h)||isNaN(this.s)?0:this.s,m1=this.l,m2=m1+(m1<.5?m1:1-m1)*m2,m1=2*m1-m2;return new Rgb(hsl2rgb(240<=h?h-240:120+h,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?240+h:h-120,m1,m2),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===a?")":", "+a+")")}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl)return hcl2lab(o);var x,z,r=rgb2lrgb((o=!(o instanceof Rgb)?rgbConvert(o):o).r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t3<t?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t1<t?t*t*t:t2*(t-t0)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(0===(o=!(o instanceof Lab)?labConvert(o):o).a&&0===o.b)return new Hcl(NaN,0<o.l&&o.l<100?0:NaN,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?360+h:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}function hcl2lab(o){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}define(Lab,lab,extend(Color,{brighter:function(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=Xn*lab2xyz(x))-1.6168667*(y=Yn*lab2xyz(y))-.4906146*(z=Zn*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function(){return hcl2lab(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelix(h,s,l,opacity){return 1===arguments.length?function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);var h=(o=!(o instanceof Rgb)?rgbConvert(o):o).r/255,s=o.g/255,k=o.b/255,l=(BC_DA*k+ED*h-EB*s)/(BC_DA+ED-EB),k=(E*(s-l)-C*(h=k-l))/D,s=Math.sqrt(k*k+h*h)/(E*l*(1-l));return new Cubehelix((h=s?Math.atan2(k,h)*rad2deg-120:NaN)<0?h+360:h,s,l,o.opacity)}(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}function basis$1(values){var n=values.length-1;return function(t){var i=t<=0?t=0:1<=t?n-(t=1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=0<i?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}function basisClosed(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}function constant$3(x){return function(){return x}}function linear(a,d){return function(t){return a+t*d}}function hue(a,b){var d=b-a;return d?linear(a,180<d||d<-180?d-360*Math.round(d/360):d):constant$3(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):constant$3(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant$3(isNaN(a)?b:a)}define(Cubehelix,cubehelix,extend(Color,{brighter:function(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function(){var sinh=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(sinh),sinh=Math.sin(sinh);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+E*cosh*a),this.opacity)}}));var interpolateRgb=function rgbGamma(y){var color=gamma(y);function rgb$1(start,end){var r=color((start=rgb(start)).r,(end=rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb$1.gamma=rgbGamma,rgb$1}(1);function rgbSpline(spline){return function(colors){for(var color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n),i=0;i<n;++i)color=rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline(basis$1),rgbBasisClosed=rgbSpline(basisClosed);function array$1(a,b){for(var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb),i=0;i<na;++i)x[i]=interpolateValue(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}function date(a,b){var d=new Date;return b-=a=+a,function(t){return d.setTime(a+b*t),d}}function interpolateNumber(a,b){return b-=a=+a,function(t){return a+b*t}}function object(a,b){var k,i={},c={};for(k in null!==a&&"object"==typeof a||(a={}),b=null===b||"object"!=typeof b?{}:b)k in a?i[k]=interpolateValue(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function interpolateString(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:interpolateNumber(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function one(b){return function(t){return b(t)+""}}(q[0].x):function zero(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function interpolateValue(a,b){var c=typeof b;return null==b||"boolean"==c?constant$3(b):("number"==c?interpolateNumber:"string"==c?(c=color(b))?(b=c,interpolateRgb):interpolateString:b instanceof color?interpolateRgb:b instanceof Date?date:Array.isArray(b)?array$1:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?object:interpolateNumber)(a,b)}function interpolateRound(a,b){return b-=a=+a,function(t){return Math.round(a+b*t)}}var cssNode,cssRoot,cssView,svgNode,degrees=180/Math.PI,identity$2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function translate(xa,ya,xb,yb,s,q){var i;xa!==xb||ya!==yb?(i=s.push("translate(",null,pxComma,null,pxParen),q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})):(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function rotate(a,b,s,q){a!==b?(180<a-b?b+=360:180<b-a&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:interpolateNumber(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function skewX(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:interpolateNumber(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function scale(xa,ya,xb,yb,s,q){var i;xa!==xb||ya!==yb?(i=s.push(pop(s)+"scale(",null,",",null,")"),q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})):1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(function parseCss(value){return"none"===value?identity$2:(cssNode||(cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView),cssNode.style.transform=value,value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform"),cssRoot.removeChild(cssNode),decompose(+(value=value.slice(7,-1).split(","))[0],+value[1],+value[2],+value[3],+value[4],+value[5]))},"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(function parseSvg(value){return null==value?identity$2:((svgNode=svgNode||document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?decompose((value=value.matrix).a,value.b,value.c,value.d,value.e,value.f):identity$2)},", ",")",")"),rho=Math.SQRT2,rho2=2,rho4=4,epsilon2=1e-12;function cosh(x){return((x=Math.exp(x))+1/x)/2}function interpolateZoom(b0,w1){var d1,r0,S,i,ux0=b0[0],uy0=b0[1],w0=b0[2],d2=w1[0],b0=w1[1],w1=w1[2],dx=d2-ux0,dy=b0-uy0,d2=dx*dx+dy*dy;return(i=d2<epsilon2?(S=Math.log(w1/w0)/rho,function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(rho*t*S)]}):(d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+rho4*d2)/(2*w0*rho2*d1),i=(w1*w1-w0*w0-rho4*d2)/(2*w1*rho2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),S=(Math.log(Math.sqrt(i*i+1)-i)-r0)/rho,function(u){var s=u*S,coshr0=cosh(r0),u=w0/(rho2*d1)*(coshr0*function tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}(rho*s+r0)-function sinh(x){return((x=Math.exp(x))-1/x)/2}(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/cosh(rho*s+r0)]})).duration=1e3*S,i}function hsl$1(hue){return function(start,end){var h=hue((start=hsl(start)).h,(end=hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hsl$2=hsl$1(hue),hslLong=hsl$1(nogamma);function hcl$1(hue){return function(start,end){var h=hue((start=hcl(start)).h,(end=hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}var hcl$2=hcl$1(hue),hclLong=hcl$1(nogamma);function cubehelix$1(hue){return function cubehelixGamma(y){function cubehelix$1(start,end){var h=hue((start=cubehelix(start)).h,(end=cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix$1.gamma=cubehelixGamma,cubehelix$1}(1)}var cubehelix$2=cubehelix$1(hue),cubehelixLong=cubehelix$1(nogamma);var taskHead,taskTail,frame=0,timeout=0,interval=0,pokeDelay=1e3,clockLast=0,clockNow=0,clockSkew=0,clock="object"==typeof performance&&performance.now?performance:Date,setFrame="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function timerFlush(){now(),++frame;for(var e,t=taskHead;t;)0<=(e=clockNow-t._time)&&t._call.call(null,e),t=t._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,function nap(){for(var t0,t2,t1=taskHead,time=1/0;t1;)t1=t1._call?(time>t1._time&&(time=t1._time),(t0=t1)._next):(t2=t1._next,t1._next=null,t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;pokeDelay<delay&&(clockSkew-=delay,clockLast=now)}function sleep(time){frame||(timeout=timeout&&clearTimeout(timeout),24<time-clockNow?(time<1/0&&(timeout=setTimeout(wake,time-clock.now()-clockSkew)),interval=interval&&clearInterval(interval)):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake)))}function timeout$1(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart(function(elapsed){t.stop(),callback(elapsed+delay)},delay,time),t}Timer.prototype=timer.prototype={constructor:Timer,restart:function(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(node,name,id,index,group,timing){var schedules=node.__transition;if(schedules){if(id in schedules)return}else node.__transition={};!function create$1(node,id,self){var tween,schedules=node.__transition;function start(elapsed){var i,j,n,o;if(self.state!==SCHEDULED)return stop();for(i in schedules)if((o=schedules[i]).name===self.name){if(o.state===STARTED)return timeout$1(start);o.state===RUNNING?(o.state=ENDED,o.timer.stop(),o.on.call("interrupt",node,node.__data__,o.index,o.group),delete schedules[i]):+i<id&&(o.state=ENDED,o.timer.stop(),o.on.call("cancel",node,node.__data__,o.index,o.group),delete schedules[i])}if(timeout$1(function(){self.state===STARTED&&(self.state=RUNNING,self.timer.restart(tick,self.delay,self.time),tick(elapsed))}),self.state=STARTING,self.on.call("start",node,node.__data__,self.index,self.group),self.state===STARTING){for(self.state=STARTED,tween=new Array(n=self.tween.length),i=0,j=-1;i<n;++i)(o=self.tween[i].value.call(node,node.__data__,self.index,self.group))&&(tween[++j]=o);tween.length=j+1}}function tick(elapsed){for(var t=elapsed<self.duration?self.ease.call(null,elapsed/self.duration):(self.timer.restart(stop),self.state=ENDING,1),i=-1,n=tween.length;++i<n;)tween[i].call(node,t);self.state===ENDING&&(self.on.call("end",node,node.__data__,self.index,self.group),stop())}function stop(){for(var i in self.state=ENDED,self.timer.stop(),delete schedules[id],schedules)return;delete node.__transition}(schedules[id]=self).timer=timer(function schedule(elapsed){self.state=SCHEDULED,self.timer.restart(start,self.delay,self.time),self.delay<=elapsed&&start(elapsed-self.delay)},0,self.time)}(node,id,{name:name,index:index,group:group,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:CREATED})}function init(node,schedule){schedule=get$1(node,schedule);if(schedule.state>CREATED)throw new Error("too late; already scheduled");return schedule}function set$1(node,schedule){schedule=get$1(node,schedule);if(schedule.state>STARTED)throw new Error("too late; already running");return schedule}function get$1(schedule,id){schedule=schedule.__transition;if(!schedule||!(schedule=schedule[id]))throw new Error("transition not found");return schedule}function interrupt(node,name){var schedule,active,i,schedules=node.__transition,empty=!0;if(schedules){for(i in name=null==name?null:name+"",schedules)(schedule=schedules[i]).name===name?(active=schedule.state>STARTING&&schedule.state<ENDING,schedule.state=ENDED,schedule.timer.stop(),schedule.on.call(active?"interrupt":"cancel",node,node.__data__,schedule.index,schedule.group),delete schedules[i]):empty=!1;empty&&delete node.__transition}}function tweenValue(transition,name,value){var id=transition._id;return transition.each(function(){var schedule=set$1(this,id);(schedule.value||(schedule.value={}))[name]=value.apply(this,arguments)}),function(node){return get$1(node,id).value[name]}}function interpolate(a,b){var c;return("number"==typeof b?interpolateNumber:b instanceof color?interpolateRgb:(c=color(b))?(b=c,interpolateRgb):interpolateString)(a,b)}function attrTweenNS(fullname,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return t0=i!==i0?(i0=i)&&function attrInterpolateNS(fullname,i){return function(t){this.setAttributeNS(fullname.space,fullname.local,i.call(this,t))}}(fullname,i):t0}return tween._value=value,tween}function attrTween(name,value){var t0,i0;function tween(){var i=value.apply(this,arguments);return t0=i!==i0?(i0=i)&&function attrInterpolate(name,i){return function(t){this.setAttribute(name,i.call(this,t))}}(name,i):t0}return tween._value=value,tween}var Selection$1=selection.prototype.constructor;function styleRemove$1(name){return function(){this.style.removeProperty(name)}}function styleTween(name,value,priority){var t,i0;function tween(){var i=value.apply(this,arguments);return t=i!==i0?(i0=i)&&function styleInterpolate(name,i,priority){return function(t){this.style.setProperty(name,i.call(this,t),priority)}}(name,i,priority):t}return tween._value=value,tween}function textTween(value){var t0,i0;function tween(){var i=value.apply(this,arguments);return t0=i!==i0?(i0=i)&&function textInterpolate(i){return function(t){this.textContent=i.call(this,t)}}(i):t0}return tween._value=value,tween}var id=0;function Transition(groups,parents,name,id){this._groups=groups,this._parents=parents,this._name=name,this._id=id}function transition(name){return selection().transition(name)}function newId(){return++id}var wye=selection.prototype;function quadInOut(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}Transition.prototype=transition.prototype={constructor:Transition,select:function transition_select(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode,schedule(subgroup[i],name,id,i,subgroup,get$1(node,id)));return new Transition(subgroups,this._parents,name,id)},selectAll:function transition_selectAll(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=selectorAll(select));for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)if(node=group[i]){for(var child,children=select.call(node,node.__data__,i,group),inherit=get$1(node,id),k=0,l=children.length;k<l;++k)(child=children[k])&&schedule(child,name,id,k,children,inherit);subgroups.push(children),parents.push(node)}return new Transition(subgroups,parents,name,id)},filter:function transition_filter(match){"function"!=typeof match&&(match=matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new Transition(subgroups,this._parents,this._name,this._id)},merge:function transition_merge(m1){if(m1._id!==this._id)throw new Error;for(var groups0=this._groups,groups1=m1._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Transition(merges,this._parents,this._name,this._id)},selection:function transition_selection(){return new Selection$1(this._groups,this._parents)},transition:function transition_transition(){for(var name=this._name,id0=this._id,id1=++id,groups=this._groups,m=groups.length,j=0;j<m;++j)for(var inherit,group=groups[j],n=group.length,i=0;i<n;++i)(inherit=group[i])&&schedule(inherit,name,id1,i,group,{time:(inherit=get$1(inherit,id0)).time+inherit.delay+inherit.duration,delay:0,duration:inherit.duration,ease:inherit.ease});return new Transition(groups,this._parents,name,id1)},call:wye.call,nodes:wye.nodes,node:wye.node,size:wye.size,empty:wye.empty,each:wye.each,on:function transition_on(name,listener){var id=this._id;return arguments.length<2?get$1(this.node(),id).on.on(name):this.each(function onFunction(id,name,listener){var on0,on1,sit=function start(name){return(name+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");return!(t=0<=i?t.slice(0,i):t)||"start"===t})}(name)?init:set$1;return function(){var schedule=sit(this,id),on=schedule.on;on!==on0&&(on1=(on0=on).copy()).on(name,listener),schedule.on=on1}}(id,name,listener))},attr:function transition_attr(name,value){var fullname=namespace(name),i="transform"===fullname?interpolateTransformSvg:interpolate;return this.attrTween(name,"function"==typeof value?(fullname.local?function attrFunctionNS$1(fullname,interpolate,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttributeNS(fullname.space,fullname.local))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1));this.removeAttributeNS(fullname.space,fullname.local)}}:function attrFunction$1(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0,string1,value1=value(this);if(null!=value1)return(string0=this.getAttribute(name))===(string1=value1+"")?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1));this.removeAttribute(name)}})(fullname,i,tweenValue(this,"attr."+name,value)):null==value?(fullname.local?function attrRemoveNS$1(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}:function attrRemove$1(name){return function(){this.removeAttribute(name)}})(fullname):(fullname.local?function attrConstantNS$1(fullname,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttributeNS(fullname.space,fullname.local);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}:function attrConstant$1(name,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=this.getAttribute(name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}})(fullname,i,value))},attrTween:function transition_attrTween(fullname,value){var key="attr."+fullname;if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return fullname=namespace(fullname),this.tween(key,(fullname.local?attrTweenNS:attrTween)(fullname,value))},style:function transition_style(name,value,priority){var i="transform"==(name+="")?interpolateTransformCss:interpolate;return null==value?this.styleTween(name,function styleNull(name,interpolate){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),string1=(this.style.removeProperty(name),styleValue(this,name));return string0===string1?null:string0===string00&&string1===string10?interpolate0:interpolate0=interpolate(string00=string0,string10=string1)}}(name,i)).on("end.style."+name,styleRemove$1(name)):"function"==typeof value?this.styleTween(name,function styleFunction$1(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),value1=value(this),string1=value1+"";return null==value1&&(this.style.removeProperty(name),string1=value1=styleValue(this,name)),string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1))}}(name,i,tweenValue(this,"style."+name,value))).each(function styleMaybeRemove(id,name){var on0,on1,listener0,remove,key="style."+name,event="end."+key;return function(){var schedule=set$1(this,id),on=schedule.on,listener=null==schedule.value[key]?remove=remove||styleRemove$1(name):void 0;on===on0&&listener0===listener||(on1=(on0=on).copy()).on(event,listener0=listener),schedule.on=on1}}(this._id,name)):this.styleTween(name,function styleConstant$1(name,interpolate,value1){var string00,interpolate0,string1=value1+"";return function(){var string0=styleValue(this,name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}(name,i,value),priority).on("end.style."+name,null)},styleTween:function transition_styleTween(name,value,priority){var key="style."+(name+="");if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,styleTween(name,value,null==priority?"":priority))},text:function transition_text(value){return this.tween("text","function"==typeof value?function textFunction$1(value){return function(){var value1=value(this);this.textContent=null==value1?"":value1}}(tweenValue(this,"text",value)):function textConstant$1(value){return function(){this.textContent=value}}(null==value?"":value+""))},textTween:function transition_textTween(value){var key="text";if(arguments.length<1)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,textTween(value))},remove:function transition_remove(){return this.on("end.remove",function removeFunction(id){return function(){var i,parent=this.parentNode;for(i in this.__transition)if(+i!==id)return;parent&&parent.removeChild(this)}}(this._id))},tween:function transition_tween(name,value){var id=this._id;if(name+="",arguments.length<2){for(var t,tween=get$1(this.node(),id).tween,i=0,n=tween.length;i<n;++i)if((t=tween[i]).name===name)return t.value;return null}return this.each((null==value?function tweenRemove(id,name){var tween0,tween1;return function(){var schedule=set$1(this,id),tween=schedule.tween;if(tween!==tween0)for(var i=0,n=(tween1=tween0=tween).length;i<n;++i)if(tween1[i].name===name){(tween1=tween1.slice()).splice(i,1);break}schedule.tween=tween1}}:function tweenFunction(id,name,value){var tween0,tween1;if("function"!=typeof value)throw new Error;return function(){var schedule=set$1(this,id),tween=schedule.tween;if(tween!==tween0){tween1=(tween0=tween).slice();for(var t={name:name,value:value},i=0,n=tween1.length;i<n;++i)if(tween1[i].name===name){tween1[i]=t;break}i===n&&tween1.push(t)}schedule.tween=tween1}})(id,name,value))},delay:function transition_delay(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?function delayFunction(id,value){return function(){init(this,id).delay=+value.apply(this,arguments)}}:function delayConstant(id,value){return value=+value,function(){init(this,id).delay=value}})(id,value)):get$1(this.node(),id).delay},duration:function transition_duration(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?function durationFunction(id,value){return function(){set$1(this,id).duration=+value.apply(this,arguments)}}:function durationConstant(id,value){return value=+value,function(){set$1(this,id).duration=value}})(id,value)):get$1(this.node(),id).duration},ease:function transition_ease(value){var id=this._id;return arguments.length?this.each(function easeConstant(id,value){if("function"!=typeof value)throw new Error;return function(){set$1(this,id).ease=value}}(id,value)):get$1(this.node(),id).ease},end:function transition_end(){var on0,on1,that=this,id=that._id,size=that.size();return new Promise(function(resolve,reject){var cancel={value:reject},end={value:function(){0==--size&&resolve()}};that.each(function(){var schedule=set$1(this,id),on=schedule.on;on!==on0&&((on1=(on0=on).copy())._.cancel.push(cancel),on1._.interrupt.push(cancel),on1._.end.push(end)),schedule.on=on1})})}};var polyIn=function custom(e){function polyIn(t){return Math.pow(t,e)}return e=+e,polyIn.exponent=custom,polyIn}(3),polyOut=function custom(e){function polyOut(t){return 1-Math.pow(1-t,e)}return e=+e,polyOut.exponent=custom,polyOut}(3),polyInOut=function custom(e){function polyInOut(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,polyInOut.exponent=custom,polyInOut}(3),pi=Math.PI,halfPi=pi/2;function sinInOut(t){return(1-Math.cos(pi*t))/2}function expInOut(t){return((t*=2)<=1?Math.pow(2,10*t-10):2-Math.pow(2,10-10*t))/2}function circleInOut(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var b1=4/11,b2=6/11,b3=8/11,b4=.75,b5=9/11,b6=10/11,b7=.9375,b8=21/22,b9=63/64,b0=1/b1/b1;function bounceOut(t){return(t=+t)<b1?b0*t*t:t<b3?b0*(t-=b2)*t+b4:t<b6?b0*(t-=b5)*t+b7:b0*(t-=b8)*t+b9}var backIn=function custom(s){function backIn(t){return t*t*((s+1)*t-s)}return s=+s,backIn.overshoot=custom,backIn}(1.70158),backOut=function custom(s){function backOut(t){return--t*t*((s+1)*t+s)+1}return s=+s,backOut.overshoot=custom,backOut}(1.70158),backInOut=function custom(s){function backInOut(t){return((t*=2)<1?t*t*((s+1)*t-s):(t-=2)*t*((s+1)*t+s)+2)/2}return s=+s,backInOut.overshoot=custom,backInOut}(1.70158),tau=2*Math.PI,elasticIn=function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=tau);function elasticIn(t){return a*Math.pow(2,10*--t)*Math.sin((s-t)/p)}return elasticIn.amplitude=function(a){return custom(a,p*tau)},elasticIn.period=function(p){return custom(a,p)},elasticIn}(1,.3),elasticOut=function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=tau);function elasticOut(t){return 1-a*Math.pow(2,-10*(t=+t))*Math.sin((t+s)/p)}return elasticOut.amplitude=function(a){return custom(a,p*tau)},elasticOut.period=function(p){return custom(a,p)},elasticOut}(1,.3),elasticInOut=function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=tau);function elasticInOut(t){return((t=2*t-1)<0?a*Math.pow(2,10*t)*Math.sin((s-t)/p):2-a*Math.pow(2,-10*t)*Math.sin((s+t)/p))/2}return elasticInOut.amplitude=function(a){return custom(a,p*tau)},elasticInOut.period=function(p){return custom(a,p)},elasticInOut}(1,.3),defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};selection.prototype.interrupt=function selection_interrupt(name){return this.each(function(){interrupt(this,name)})},selection.prototype.transition=function selection_transition(name){var id,timing;name=name instanceof Transition?(id=name._id,name._name):(id=newId(),(timing=defaultTiming).time=now(),null==name?null:name+"");for(var groups=this._groups,m=groups.length,j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&schedule(node,name,id,i,group,timing||function inherit(node,id){for(var timing;!(timing=node.__transition)||!(timing=timing[id]);)if(!(node=node.parentNode))return defaultTiming.time=now(),defaultTiming;return timing}(node,id));return new Transition(groups,this._parents,name,id)};var root$1=[null];function constant$4(x){return function(){return x}}function BrushEvent(target,type,selection){this.target=target,this.type=type,this.selection=selection}function nopropagation$1(){exports.event.stopImmediatePropagation()}function noevent$1(){exports.event.preventDefault(),exports.event.stopImmediatePropagation()}var MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"};function number1(e){return[+e[0],+e[1]]}function number2(e){return[number1(e[0]),number1(e[1])]}var X={name:"x",handles:["w","e"].map(type),input:function(x,e){return null==x?null:[[+x[0],e[0][1]],[+x[1],e[1][1]]]},output:function(xy){return xy&&[xy[0][0],xy[1][0]]}},Y={name:"y",handles:["n","s"].map(type),input:function(y,e){return null==y?null:[[e[0][0],+y[0]],[e[1][0],+y[1]]]},output:function(xy){return xy&&[xy[0][1],xy[1][1]]}},XY={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(type),input:function(xy){return null==xy?null:number2(xy)},output:function(xy){return xy}},cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},signsX={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},signsY={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function type(t){return{type:t}}function defaultFilter$1(){return!exports.event.ctrlKey&&!exports.event.button}function defaultExtent(){var svg=this.ownerSVGElement||this;return svg.hasAttribute("viewBox")?[[(svg=svg.viewBox.baseVal).x,svg.y],[svg.x+svg.width,svg.y+svg.height]]:[[0,0],[svg.width.baseVal.value,svg.height.baseVal.value]]}function defaultTouchable$1(){return navigator.maxTouchPoints||"ontouchstart"in this}function local$1(node){for(;!node.__brush;)if(!(node=node.parentNode))return;return node.__brush}function brush$1(dim){var touchending,extent=defaultExtent,filter=defaultFilter$1,touchable=defaultTouchable$1,keys=!0,listeners=dispatch("start","brush","end"),handleSize=6;function brush(group){var handle=group.property("__brush",initialize).selectAll(".overlay").data([type("overlay")]);handle.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(handle).each(function(){var extent=local$1(this).extent;select(this).attr("x",extent[0][0]).attr("y",extent[0][1]).attr("width",extent[1][0]-extent[0][0]).attr("height",extent[1][1]-extent[0][1])}),group.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");handle=group.selectAll(".handle").data(dim.handles,function(d){return d.type});handle.exit().remove(),handle.enter().append("rect").attr("class",function(d){return"handle handle--"+d.type}).attr("cursor",function(d){return cursors[d.type]}),group.each(redraw).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",started).filter(touchable).on("touchstart.brush",started).on("touchmove.brush",touchmoved).on("touchend.brush touchcancel.brush",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function redraw(){var group=select(this),selection=local$1(this).selection;selection?(group.selectAll(".selection").style("display",null).attr("x",selection[0][0]).attr("y",selection[0][1]).attr("width",selection[1][0]-selection[0][0]).attr("height",selection[1][1]-selection[0][1]),group.selectAll(".handle").style("display",null).attr("x",function(d){return"e"===d.type[d.type.length-1]?selection[1][0]-handleSize/2:selection[0][0]-handleSize/2}).attr("y",function(d){return"s"===d.type[0]?selection[1][1]-handleSize/2:selection[0][1]-handleSize/2}).attr("width",function(d){return"n"===d.type||"s"===d.type?selection[1][0]-selection[0][0]+handleSize:handleSize}).attr("height",function(d){return"e"===d.type||"w"===d.type?selection[1][1]-selection[0][1]+handleSize:handleSize})):group.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function emitter(that,args,clean){return!clean&&that.__brush.emitter||new Emitter(that,args)}function Emitter(that,args){this.that=that,this.args=args,this.state=that.__brush,this.active=0}function started(){var that,type,mode,signX,signY,state,extent,selection,W,w0,N,n0,E,e0,S,s0,dx,dy,moving,shifting,lockX,lockY,pointer,point0,point,emit,w1,n1,e1,s1,group,overlay,view;function moved(){var point1=pointer(that);!shifting||lockX||lockY||(Math.abs(point1[0]-point[0])>Math.abs(point1[1]-point[1])?lockY=!0:lockX=!0),point=point1,moving=!0,noevent$1(),move()}function move(){var t;switch(dx=point[0]-point0[0],dy=point[1]-point0[1],mode){case MODE_SPACE:case MODE_DRAG:signX&&(dx=Math.max(W-w0,Math.min(E-e0,dx)),w1=w0+dx,e1=e0+dx),signY&&(dy=Math.max(N-n0,Math.min(S-s0,dy)),n1=n0+dy,s1=s0+dy);break;case MODE_HANDLE:signX<0?(dx=Math.max(W-w0,Math.min(E-w0,dx)),w1=w0+dx,e1=e0):0<signX&&(dx=Math.max(W-e0,Math.min(E-e0,dx)),w1=w0,e1=e0+dx),signY<0?(dy=Math.max(N-n0,Math.min(S-n0,dy)),n1=n0+dy,s1=s0):0<signY&&(dy=Math.max(N-s0,Math.min(S-s0,dy)),n1=n0,s1=s0+dy);break;case MODE_CENTER:signX&&(w1=Math.max(W,Math.min(E,w0-dx*signX)),e1=Math.max(W,Math.min(E,e0+dx*signX))),signY&&(n1=Math.max(N,Math.min(S,n0-dy*signY)),s1=Math.max(N,Math.min(S,s0+dy*signY)))}e1<w1&&(signX*=-1,t=w0,w0=e0,e0=t,t=w1,w1=e1,e1=t,type in flipX&&overlay.attr("cursor",cursors[type=flipX[type]])),s1<n1&&(signY*=-1,t=n0,n0=s0,s0=t,t=n1,n1=s1,s1=t,type in flipY&&overlay.attr("cursor",cursors[type=flipY[type]])),state.selection&&(selection=state.selection),lockX&&(w1=selection[0][0],e1=selection[1][0]),lockY&&(n1=selection[0][1],s1=selection[1][1]),selection[0][0]===w1&&selection[0][1]===n1&&selection[1][0]===e1&&selection[1][1]===s1||(state.selection=[[w1,n1],[e1,s1]],redraw.call(that),emit.brush())}function ended(){if(nopropagation$1(),exports.event.touches){if(exports.event.touches.length)return;touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},500)}else yesdrag(exports.event.view,moving),view.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);group.attr("pointer-events","all"),overlay.attr("cursor",cursors.overlay),function empty$1(extent){return extent[0][0]===extent[1][0]||extent[0][1]===extent[1][1]}(selection=state.selection?state.selection:selection)&&(state.selection=null,redraw.call(that)),emit.end()}touchending&&!exports.event.touches||filter.apply(this,arguments)&&(that=this,type=exports.event.target.__data__.type,mode="selection"===(keys&&exports.event.metaKey?type="overlay":type)?MODE_DRAG:keys&&exports.event.altKey?MODE_CENTER:MODE_HANDLE,signX=dim===Y?null:signsX[type],signY=dim===X?null:signsY[type],extent=(state=local$1(that)).extent,selection=state.selection,W=extent[0][0],N=extent[0][1],E=extent[1][0],S=extent[1][1],dy=dx=0,shifting=signX&&signY&&keys&&exports.event.shiftKey,pointer=exports.event.touches?function toucher(identifier){return function(target){return touch(target,exports.event.touches,identifier)}}(exports.event.changedTouches[0].identifier):mouse,point0=pointer(that),point=point0,emit=emitter(that,arguments,!0).beforestart(),"overlay"===type?(selection&&(moving=!0),state.selection=selection=[[w0=dim===Y?W:point0[0],n0=dim===X?N:point0[1]],[e0=dim===Y?E:w0,s0=dim===X?S:n0]]):(w0=selection[0][0],n0=selection[0][1],e0=selection[1][0],s0=selection[1][1]),w1=w0,n1=n0,e1=e0,s1=s0,group=select(that).attr("pointer-events","none"),overlay=group.selectAll(".overlay").attr("cursor",cursors[type]),exports.event.touches?(emit.moved=moved,emit.ended=ended):(view=select(exports.event.view).on("mousemove.brush",moved,!0).on("mouseup.brush",ended,!0),keys&&view.on("keydown.brush",function keydowned(){switch(exports.event.keyCode){case 16:shifting=signX&&signY;break;case 18:mode===MODE_HANDLE&&(signX&&(e0=e1-dx*signX,w0=w1+dx*signX),signY&&(s0=s1-dy*signY,n0=n1+dy*signY),mode=MODE_CENTER,move());break;case 32:mode!==MODE_HANDLE&&mode!==MODE_CENTER||(signX<0?e0=e1-dx:0<signX&&(w0=w1-dx),signY<0?s0=s1-dy:0<signY&&(n0=n1-dy),mode=MODE_SPACE,overlay.attr("cursor",cursors.selection),move());break;default:return}noevent$1()},!0).on("keyup.brush",function keyupped(){switch(exports.event.keyCode){case 16:shifting&&(lockX=lockY=shifting=!1,move());break;case 18:mode===MODE_CENTER&&(signX<0?e0=e1:0<signX&&(w0=w1),signY<0?s0=s1:0<signY&&(n0=n1),mode=MODE_HANDLE,move());break;case 32:mode===MODE_SPACE&&(mode=exports.event.altKey?(signX&&(e0=e1-dx*signX,w0=w1+dx*signX),signY&&(s0=s1-dy*signY,n0=n1+dy*signY),MODE_CENTER):(signX<0?e0=e1:0<signX&&(w0=w1),signY<0?s0=s1:0<signY&&(n0=n1),MODE_HANDLE),overlay.attr("cursor",cursors[type]),move());break;default:return}noevent$1()},!0),dragDisable(exports.event.view)),nopropagation$1(),interrupt(that),redraw.call(that),emit.start())}function touchmoved(){emitter(this,arguments).moved()}function touchended(){emitter(this,arguments).ended()}function initialize(){var state=this.__brush||{selection:null};return state.extent=number2(extent.apply(this,arguments)),state.dim=dim,state}return brush.move=function(group,selection){group.selection?group.on("start.brush",function(){emitter(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){emitter(this,arguments).end()}).tween("brush",function(){var that=this,state=that.__brush,emit=emitter(that,arguments),selection0=state.selection,selection1=dim.input("function"==typeof selection?selection.apply(this,arguments):selection,state.extent),i=interpolateValue(selection0,selection1);function tween(t){state.selection=1===t&&null===selection1?null:i(t),redraw.call(that),emit.brush()}return null!==selection0&&null!==selection1?tween:tween(1)}):group.each(function(){var emit=arguments,state=this.__brush,selection1=dim.input("function"==typeof selection?selection.apply(this,emit):selection,state.extent),emit=emitter(this,emit).beforestart();interrupt(this),state.selection=null===selection1?null:selection1,redraw.call(this),emit.start().brush().end()})},brush.clear=function(group){brush.move(group,null)},Emitter.prototype={beforestart:function(){return 1==++this.active&&((this.state.emitter=this).starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(type){customEvent(new BrushEvent(brush,type,dim.output(this.state.selection)),listeners.apply,listeners,[type,this.that,this.args])}},brush.extent=function(_){return arguments.length?(extent="function"==typeof _?_:constant$4(number2(_)),brush):extent},brush.filter=function(_){return arguments.length?(filter="function"==typeof _?_:constant$4(!!_),brush):filter},brush.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:constant$4(!!_),brush):touchable},brush.handleSize=function(_){return arguments.length?(handleSize=+_,brush):handleSize},brush.keyModifiers=function(_){return arguments.length?(keys=!!_,brush):keys},brush.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?brush:value},brush}var cos=Math.cos,sin=Math.sin,symbols=Math.PI,halfPi$1=symbols/2,tau$1=2*symbols,max$1=Math.max;var slice$2=Array.prototype.slice;function constant$5(x){return function(){return x}}var pi$2=Math.PI,tau$2=2*pi$2,tauEpsilon=tau$2-1e-6;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}function defaultSource(d){return d.source}function defaultTarget(d){return d.target}function defaultRadius(d){return d.radius}function defaultStartAngle(d){return d.startAngle}function defaultEndAngle(d){return d.endAngle}Path.prototype=path.prototype={constructor:Path,moveTo:function(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function(x1,y1,y20,t21,r){x1=+x1,y1=+y1,y20=+y20,t21=+t21,r=+r;var x20,l21_2,l=this._x1,t01=this._y1,x21=y20-x1,y21=t21-y1,x01=l-x1,y01=t01-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+(this._x1=x1)+","+(this._y1=y1):1e-6<l01_2&&(1e-6<Math.abs(y01*x21-y21*x01)&&r?(l21_2=x21*x21+y21*y21,l=(x20=y20-l)*x20+(y20=t21-t01)*y20,t21=Math.sqrt(l21_2),t01=Math.sqrt(l01_2),t01=(l=r*Math.tan((pi$2-Math.acos((l21_2+l01_2-l)/(2*t21*t01)))/2))/t01,t21=l/t21,1e-6<Math.abs(t01-1)&&(this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)),this._+="A"+r+","+r+",0,0,"+ +(x01*y20<y01*x20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)):this._+="L"+(this._x1=x1)+","+(this._y1=y1))},arc:function(x,y,r,da,a1,ccw){x=+x,y=+y,ccw=!!ccw;var dx=(r=+r)*Math.cos(da),dy=r*Math.sin(da),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?da-a1:a1-da;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+x0+","+y0:(1e-6<Math.abs(this._x1-x0)||1e-6<Math.abs(this._y1-y0))&&(this._+="L"+x0+","+y0),r&&(tauEpsilon<(da=da<0?da%tau$2+tau$2:da)?this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0):1e-6<da&&(this._+="A"+r+","+r+",0,"+ +(pi$2<=da)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))))},rect:function(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function(){return this._}};function Map(){}function map$1(object,f){var map=new Map;if(object instanceof Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(null==f)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map$1()}function setMap(map,key,value){map.set(key,value)}function Set(){}Map.prototype=map$1.prototype={constructor:Map,has:function(key){return"$"+key in this},get:function(key){return this["$"+key]},set:function(key,value){return this["$"+key]=value,this},remove:function(property){property="$"+property;return property in this&&delete this[property]},clear:function(){for(var property in this)"$"===property[0]&&delete this[property]},keys:function(){var property,keys=[];for(property in this)"$"===property[0]&&keys.push(property.slice(1));return keys},values:function(){var property,values=[];for(property in this)"$"===property[0]&&values.push(this[property]);return values},entries:function(){var property,entries=[];for(property in this)"$"===property[0]&&entries.push({key:property.slice(1),value:this[property]});return entries},size:function(){var property,size=0;for(property in this)"$"===property[0]&&++size;return size},empty:function(){for(var property in this)if("$"===property[0])return!1;return!0},each:function(f){for(var property in this)"$"===property[0]&&f(this[property],property.slice(1),this)}};var bundle=map$1.prototype;function set$2(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(null==f)for(;++i<n;)set.add(object[i]);else for(;++i<n;)set.add(f(object[i],i,object))}return set}Set.prototype=set$2.prototype={constructor:Set,has:bundle.has,add:function(value){return this["$"+(value+="")]=value,this},remove:bundle.remove,clear:bundle.clear,values:bundle.keys,size:bundle.size,empty:bundle.empty,each:bundle.each};var slice$3=Array.prototype.slice;function ascending$2(a,b){return a-b}function constant$6(x){return function(){return x}}function contains(ring,hole){for(var c,i=-1,n=hole.length;++i<n;)if(c=function ringContains(ring,point){for(var x=point[0],y=point[1],contains=-1,i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];if(function segmentContains(i,b,c){return function collinear(a,b,c){return(b[0]-a[0])*(c[1]-a[1])==(c[0]-a[0])*(b[1]-a[1])}(i,b,c)&&function within(p,q,r){return p<=q&&q<=r||r<=q&&q<=p}(i[i=+(i[0]===b[0])],c[i],b[i])}(pi,pj,point))return 0;y<yi!=y<yj&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(contains=-contains)}return contains}(ring,hole[i]))return c;return 0}function noop$1(){}var cases=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function contours(){var dx=1,dy=1,threshold=thresholdSturges,smooth=smoothLinear;function contours(values){var start,stop,tz=threshold(values);return(tz=Array.isArray(tz)?tz.slice().sort(ascending$2):(tz=tickStep(start=(stop=extent(values))[0],stop=stop[1],tz),sequence(Math.floor(start/tz)*tz,Math.floor(stop/tz)*tz,tz))).map(function(value){return contour(values,value)})}function contour(values,value){var polygons=[],holes=[];return function isorings(values,value,callback){var x,y,t0,t1,t2,t3,fragmentByStart=new Array,fragmentByEnd=new Array;for(x=y=-1,t1=values[0]>=value,cases[t1<<1].forEach(stitch);++x<dx-1;)t0=t1,t1=values[x+1]>=value,cases[t0|t1<<1].forEach(stitch);for(cases[t1<<0].forEach(stitch);++y<dy-1;){for(x=-1,t1=values[y*dx+dx]>=value,t2=values[y*dx]>=value,cases[t1<<1|t2<<2].forEach(stitch);++x<dx-1;)t0=t1,t1=values[y*dx+dx+x+1]>=value,t3=t2,t2=values[y*dx+x+1]>=value,cases[t0|t1<<1|t2<<2|t3<<3].forEach(stitch);cases[t1|t2<<3].forEach(stitch)}for(x=-1,t2=values[y*dx]>=value,cases[t2<<2].forEach(stitch);++x<dx-1;)t3=t2,t2=values[y*dx+x+1]>=value,cases[t2<<2|t3<<3].forEach(stitch);function stitch(f){var g,start=[f[0][0]+x,f[0][1]+y],end=[f[1][0]+x,f[1][1]+y],startIndex=index(start),endIndex=index(end);(f=fragmentByEnd[startIndex])?(g=fragmentByStart[endIndex])?(delete fragmentByEnd[f.end],delete fragmentByStart[g.start],f===g?(f.ring.push(end),callback(f.ring)):fragmentByStart[f.start]=fragmentByEnd[g.end]={start:f.start,end:g.end,ring:f.ring.concat(g.ring)}):(delete fragmentByEnd[f.end],f.ring.push(end),fragmentByEnd[f.end=endIndex]=f):(f=fragmentByStart[endIndex])?(g=fragmentByEnd[startIndex])?(delete fragmentByStart[f.start],delete fragmentByEnd[g.end],f===g?(f.ring.push(end),callback(f.ring)):fragmentByStart[g.start]=fragmentByEnd[f.end]={start:g.start,end:f.end,ring:g.ring.concat(f.ring)}):(delete fragmentByStart[f.start],f.ring.unshift(start),fragmentByStart[f.start=startIndex]=f):fragmentByStart[startIndex]=fragmentByEnd[endIndex]={start:startIndex,end:endIndex,ring:[start,end]}}cases[t2<<3].forEach(stitch)}(values,value,function(ring){smooth(ring,values,value),0<function area(ring){for(var i=0,n=ring.length,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];++i<n;)area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1];return area}(ring)?polygons.push([ring]):holes.push(ring)}),holes.forEach(function(hole){for(var polygon,i=0,n=polygons.length;i<n;++i)if(-1!==contains((polygon=polygons[i])[0],hole))return void polygon.push(hole)}),{type:"MultiPolygon",value:value,coordinates:polygons}}function index(point){return 2*point[0]+point[1]*(dx+1)*4}function smoothLinear(ring,values,value){ring.forEach(function(point){var v0,x=point[0],y=point[1],xt=0|x,yt=0|y,v1=values[yt*dx+xt];0<x&&x<dx&&xt===x&&(v0=values[yt*dx+xt-1],point[0]=x+(value-v0)/(v1-v0)-.5),0<y&&y<dy&&yt===y&&(v0=values[(yt-1)*dx+xt],point[1]=y+(value-v0)/(v1-v0)-.5)})}return contours.contour=contour,contours.size=function(_1){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_1[0]),_1=Math.ceil(_1[1]);if(!(0<_0&&0<_1))throw new Error("invalid size");return dx=_0,dy=_1,contours},contours.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant$6(slice$3.call(_)):constant$6(_),contours):threshold},contours.smooth=function(_){return arguments.length?(smooth=_?smoothLinear:noop$1,contours):smooth===smoothLinear},contours}function blurX(source,target,r){for(var n=source.width,m=source.height,w=1+(r<<1),j=0;j<m;++j)for(var i=0,sr=0;i<n+r;++i)i<n&&(sr+=source.data[i+j*n]),r<=i&&(w<=i&&(sr-=source.data[i-w+j*n]),target.data[i-r+j*n]=sr/Math.min(i+1,n-1+w-i,w))}function blurY(source,target,r){for(var n=source.width,m=source.height,w=1+(r<<1),i=0;i<n;++i)for(var j=0,sr=0;j<m+r;++j)j<m&&(sr+=source.data[i+j*n]),r<=j&&(w<=j&&(sr-=source.data[i+(j-w)*n]),target.data[i+(j-r)*n]=sr/Math.min(j+1,m-1+w-j,w))}function defaultX(d){return d[0]}function defaultY(d){return d[1]}function defaultWeight(){return 1}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(columns){return new Function("d","return {"+columns.map(function(name,i){return JSON.stringify(name)+": d["+i+'] || ""'}).join(",")+"}")}function inferColumns(rows){var columnSet=Object.create(null),columns=[];return rows.forEach(function(row){for(var column in row)column in columnSet||columns.push(columnSet[column]=column)}),columns}function pad(length,width){var s=length+"",length=s.length;return length<width?new Array(width-length+1).join(0)+s:s}function formatDate(date){var hours=date.getUTCHours(),minutes=date.getUTCMinutes(),seconds=date.getUTCSeconds(),milliseconds=date.getUTCMilliseconds();return isNaN(date)?"Invalid Date":function formatYear(year){return year<0?"-"+pad(-year,6):9999<year?"+"+pad(year,6):pad(year,4)}(date.getUTCFullYear())+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+(milliseconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"."+pad(milliseconds,3)+"Z":seconds?"T"+pad(hours,2)+":"+pad(minutes,2)+":"+pad(seconds,2)+"Z":minutes||hours?"T"+pad(hours,2)+":"+pad(minutes,2)+"Z":"")}function dsvFormat(delimiter){var reFormat=new RegExp('["'+delimiter+"\n\r]"),DELIMITER=delimiter.charCodeAt(0);function parseRows(text,f){var t,rows=[],N=text.length,I=0,n=0,eof=N<=0,eol=!1;function token(){if(eof)return EOF;if(eol)return eol=!1,EOL;var i,c,j=I;if(text.charCodeAt(j)===QUOTE){for(;I++<N&&text.charCodeAt(I)!==QUOTE||text.charCodeAt(++I)===QUOTE;);return(i=I)>=N?eof=!0:(c=text.charCodeAt(I++))===NEWLINE?eol=!0:c===RETURN&&(eol=!0,text.charCodeAt(I)===NEWLINE&&++I),text.slice(j+1,i-1).replace(/""/g,'"')}for(;I<N;){if((c=text.charCodeAt(i=I++))===NEWLINE)eol=!0;else if(c===RETURN)eol=!0,text.charCodeAt(I)===NEWLINE&&++I;else if(c!==DELIMITER)continue;return text.slice(j,i)}return eof=!0,text.slice(j,N)}for(text.charCodeAt(N-1)===NEWLINE&&--N,text.charCodeAt(N-1)===RETURN&&--N;(t=token())!==EOF;){for(var row=[];t!==EOL&&t!==EOF;)row.push(t),t=token();f&&null==(row=f(row,n++))||rows.push(row)}return rows}function preformatBody(rows,columns){return rows.map(function(row){return columns.map(function(column){return formatValue(row[column])}).join(delimiter)})}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(value){return null==value?"":value instanceof Date?formatDate(value):reFormat.test(value+="")?'"'+value.replace(/"/g,'""')+'"':value}return{parse:function parse(rows,f){var convert,columns;return(rows=parseRows(rows,function(row,i){return convert?convert(row,i-1):(columns=row,void(convert=f?function customConverter(columns,f){var object=objectConverter(columns);return function(row,i){return f(object(row),i,columns)}}(row,f):objectConverter(row)))})).columns=columns||[],rows},parseRows:parseRows,format:function format(rows,columns){return[(columns=null==columns?inferColumns(rows):columns).map(formatValue).join(delimiter)].concat(preformatBody(rows,columns)).join("\n")},formatBody:function formatBody(rows,columns){return preformatBody(rows,columns=null==columns?inferColumns(rows):columns).join("\n")},formatRows:function formatRows(rows){return rows.map(formatRow).join("\n")},formatRow:formatRow,formatValue:formatValue}}var cardinal=dsvFormat(","),csvParse=cardinal.parse,csvParseRows=cardinal.parseRows,csvFormat=cardinal.format,csvFormatBody=cardinal.formatBody,csvFormatRows=cardinal.formatRows,csvFormatRow=cardinal.formatRow,csvFormatValue=cardinal.formatValue,cardinalClosed=dsvFormat("\t"),tsvParse=cardinalClosed.parse,tsvParseRows=cardinalClosed.parseRows,tsvFormat=cardinalClosed.format,tsvFormatBody=cardinalClosed.formatBody,tsvFormatRows=cardinalClosed.formatRows,tsvFormatRow=cardinalClosed.formatRow,tsvFormatValue=cardinalClosed.formatValue;var fixtz=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function responseBlob(response){if(!response.ok)throw new Error(response.status+" "+response.statusText);return response.blob()}function responseArrayBuffer(response){if(!response.ok)throw new Error(response.status+" "+response.statusText);return response.arrayBuffer()}function responseText(response){if(!response.ok)throw new Error(response.status+" "+response.statusText);return response.text()}function text(input,init){return fetch(input,init).then(responseText)}function dsvParse(parse){return function(input,init,row){return 2===arguments.length&&"function"==typeof init&&(row=init,init=void 0),text(input,init).then(function(response){return parse(response,row)})}}var csv$1=dsvParse(csvParse),tsv$1=dsvParse(tsvParse);function responseJson(response){if(!response.ok)throw new Error(response.status+" "+response.statusText);return response.json()}function parser(type){return function(input,init){return text(input,init).then(function(text){return(new DOMParser).parseFromString(text,type)})}}var xml=parser("application/xml"),html=parser("text/html"),svg=parser("image/svg+xml");function constant$7(x){return function(){return x}}function jiggle(){return 1e-6*(Math.random()-.5)}function add(tree,x,y,d){if(isNaN(x)||isNaN(y))return tree;var parent,xm,ym,xp,yp,right,bottom,i,j,node=tree._root,leaf={data:d},x0=tree._x0,y0=tree._y0,x1=tree._x1,y1=tree._y1;if(!node)return tree._root=leaf,tree;for(;node.length;)if((right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,!(node=(parent=node)[i=bottom<<1|right]))return parent[i]=leaf,tree;if(xp=+tree._x.call(null,node.data),yp=+tree._y.call(null,node.data),x===xp&&y===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;for(;parent=parent?parent[i]=new Array(4):tree._root=new Array(4),(right=x>=(xm=(x0+x1)/2))?x0=xm:x1=xm,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,(i=bottom<<1|right)==(j=(ym<=yp)<<1|xm<=xp););return parent[j]=node,parent[i]=leaf,tree}function Quad(node,x0,y0,x1,y1){this.node=node,this.x0=x0,this.y0=y0,this.x1=x1,this.y1=y1}function defaultX$1(d){return d[0]}function defaultY$1(d){return d[1]}function quadtree(nodes,x,tree){tree=new Quadtree(null==x?defaultX$1:x,null==tree?defaultY$1:tree,NaN,NaN,NaN,NaN);return null==nodes?tree:tree.addAll(nodes)}function Quadtree(x,y,x0,y0,x1,y1){this._x=x,this._y=y,this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this._root=void 0}function leaf_copy(leaf){for(var copy={data:leaf.data},next=copy;leaf=leaf.next;)next=next.next={data:leaf.data};return copy}var cardinalOpen=quadtree.prototype=Quadtree.prototype;function x(d){return d.x+d.vx}function y(d){return d.y+d.vy}function index(d){return d.index}function find(node,nodeId){node=node.get(nodeId);if(!node)throw new Error("missing: "+nodeId);return node}function x$1(d){return d.x}function y$1(d){return d.y}cardinalOpen.copy=function(){var nodes,child,copy=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root;if(!node)return copy;if(!node.length)return copy._root=leaf_copy(node),copy;for(nodes=[{source:node,target:copy._root=new Array(4)}];node=nodes.pop();)for(var i=0;i<4;++i)(child=node.source[i])&&(child.length?nodes.push({source:child,target:node.target[i]=new Array(4)}):node.target[i]=leaf_copy(child));return copy},cardinalOpen.add=function tree_add(d){var x=+this._x.call(null,d),y=+this._y.call(null,d);return add(this.cover(x,y),x,y,d)},cardinalOpen.addAll=function addAll(data){for(var d,x,y,n=data.length,xz=new Array(n),yz=new Array(n),x0=1/0,y0=1/0,x1=-1/0,y1=-1/0,i=0;i<n;++i)isNaN(x=+this._x.call(null,d=data[i]))||isNaN(y=+this._y.call(null,d))||((xz[i]=x)<x0&&(x0=x),x1<x&&(x1=x),(yz[i]=y)<y0&&(y0=y),y1<y&&(y1=y));if(x1<x0||y1<y0)return this;for(this.cover(x0,y0).cover(x1,y1),i=0;i<n;++i)add(this,xz[i],yz[i],data[i]);return this},cardinalOpen.cover=function tree_cover(x,y){if(isNaN(x=+x)||isNaN(y=+y))return this;var x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(isNaN(x0))x1=(x0=Math.floor(x))+1,y1=(y0=Math.floor(y))+1;else{for(var parent,i,z=x1-x0,node=this._root;x<x0||x1<=x||y<y0||y1<=y;)switch(i=(y<y0)<<1|x<x0,(parent=new Array(4))[i]=node,node=parent,z*=2,i){case 0:x1=x0+z,y1=y0+z;break;case 1:x0=x1-z,y1=y0+z;break;case 2:x1=x0+z,y0=y1-z;break;case 3:x0=x1-z,y0=y1-z}this._root&&this._root.length&&(this._root=node)}return this._x0=x0,this._y0=y0,this._x1=x1,this._y1=y1,this},cardinalOpen.data=function tree_data(){var data=[];return this.visit(function(node){if(!node.length)for(;data.push(node.data),node=node.next;);}),data},cardinalOpen.extent=function tree_extent(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},cardinalOpen.find=function tree_find(x,y,radius){var x1,y1,x2,y2,i,ym,d,data,x0=this._x0,y0=this._y0,x3=this._x1,y3=this._y1,quads=[],node=this._root;for(node&&quads.push(new Quad(node,x0,y0,x3,y3)),null==radius?radius=1/0:(x0=x-radius,y0=y-radius,x3=x+radius,y3=y+radius,radius*=radius);d=quads.pop();)!(node=d.node)||(x1=d.x0)>x3||(y1=d.y0)>y3||(x2=d.x1)<x0||(y2=d.y1)<y0||(node.length?(i=(x1+x2)/2,ym=(y1+y2)/2,quads.push(new Quad(node[3],i,ym,x2,y2),new Quad(node[2],x1,ym,i,y2),new Quad(node[1],i,y1,x2,ym),new Quad(node[0],x1,y1,i,ym)),(i=(ym<=y)<<1|i<=x)&&(d=quads[quads.length-1],quads[quads.length-1]=quads[quads.length-1-i],quads[quads.length-1-i]=d)):(d=(d=x-+this._x.call(null,node.data))*d+(d=y-+this._y.call(null,node.data))*d)<radius&&(x0=x-(d=Math.sqrt(radius=d)),y0=y-d,x3=x+d,y3=y+d,data=node.data));return data},cardinalOpen.remove=function tree_remove(d){if(isNaN(x=+this._x.call(null,d))||isNaN(y=+this._y.call(null,d)))return this;var parent,retainer,previous,next,x,y,ym,right,bottom,i,j,node=this._root,x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(!node)return this;if(node.length)for(;;){if((right=x>=(bottom=(x0+x1)/2))?x0=bottom:x1=bottom,(bottom=y>=(ym=(y0+y1)/2))?y0=ym:y1=ym,!(node=(parent=node)[i=bottom<<1|right]))return this;if(!node.length)break;(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])&&(retainer=parent,j=i)}for(;node.data!==d;)if(!(node=(previous=node).next))return this;return(next=node.next)&&delete node.next,previous?next?previous.next=next:delete previous.next:parent?(next?parent[i]=next:delete parent[i],(node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length&&(retainer?retainer[j]=node:this._root=node)):this._root=next,this},cardinalOpen.removeAll=function removeAll(data){for(var i=0,n=data.length;i<n;++i)this.remove(data[i]);return this},cardinalOpen.root=function tree_root(){return this._root},cardinalOpen.size=function tree_size(){var size=0;return this.visit(function(node){if(!node.length)for(;++size,node=node.next;);}),size},cardinalOpen.visit=function tree_visit(callback){var child,x0,y0,x1,y1,xm,ym,quads=[],node=this._root;for(node&&quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));child=quads.pop();)!callback(node=child.node,x0=child.x0,y0=child.y0,x1=child.x1,y1=child.y1)&&node.length&&(xm=(x0+x1)/2,ym=(y0+y1)/2,(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym)));return this},cardinalOpen.visitAfter=function tree_visitAfter(callback){var q,quads=[],next=[];for(this._root&&quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));q=quads.pop();){var child,x0,y0,x1,y1,xm,ym,node=q.node;node.length&&(x0=q.x0,y0=q.y0,xm=(x0+(x1=q.x1))/2,ym=(y0+(y1=q.y1))/2,(child=node[0])&&quads.push(new Quad(child,x0,y0,xm,ym)),(child=node[1])&&quads.push(new Quad(child,xm,y0,x1,ym)),(child=node[2])&&quads.push(new Quad(child,x0,ym,xm,y1)),(child=node[3])&&quads.push(new Quad(child,xm,ym,x1,y1))),next.push(q)}for(;q=next.pop();)callback(q.node,q.x0,q.y0,q.x1,q.y1);return this},cardinalOpen.x=function tree_x(_){return arguments.length?(this._x=_,this):this._x},cardinalOpen.y=function tree_y(_){return arguments.length?(this._y=_,this):this._y};var initialAngle=Math.PI*(3-Math.sqrt(5));function formatDecimal(x,coefficient){if((i=(x=coefficient?x.toExponential(coefficient-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[1<coefficient.length?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent$1(x){return(x=formatDecimal(Math.abs(x)))?x[1]:NaN}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;return new FormatSpecifier({fill:match[1],align:match[2],sign:match[3],symbol:match[4],zero:match[5],width:match[6],comma:match[7],precision:match[8]&&match[8].slice(1),trim:match[9],type:match[10]})}function FormatSpecifier(specifier){this.fill=void 0===specifier.fill?" ":specifier.fill+"",this.align=void 0===specifier.align?">":specifier.align+"",this.sign=void 0===specifier.sign?"-":specifier.sign+"",this.symbol=void 0===specifier.symbol?"":specifier.symbol+"",this.zero=!!specifier.zero,this.width=void 0===specifier.width?void 0:+specifier.width,this.comma=!!specifier.comma,this.precision=void 0===specifier.precision?void 0:+specifier.precision,this.trim=!!specifier.trim,this.type=void 0===specifier.type?"":specifier.type+""}function formatRounded(coefficient,exponent){exponent=formatDecimal(coefficient,exponent);if(!exponent)return coefficient+"";coefficient=exponent[0],exponent=exponent[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var formatTypes={"%":function(x,p){return(100*x).toFixed(p)},b:function(x){return Math.round(x).toString(2)},c:function(x){return x+""},d:function(x){return Math.round(x).toString(10)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},g:function(x,p){return x.toPrecision(p)},o:function(x){return Math.round(x).toString(8)},p:function(x,p){return formatRounded(100*x,p)},r:formatRounded,s:function formatPrefixAuto(x,p){if(!(i=formatDecimal(x,p)))return x+"";var coefficient=i[0],i=(n=i[1])-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,n=coefficient.length;return i===n?coefficient:n<i?coefficient+new Array(i-n+1).join("0"):0<i?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]},X:function(x){return Math.round(x).toString(16).toUpperCase()},x:function(x){return Math.round(x).toString(16)}};function identity$3(x){return x}var locale,map$2=Array.prototype.map,prefixes=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(locale){var group=void 0===locale.grouping||void 0===locale.thousands?identity$3:function formatGroup(grouping,thousands){return function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;0<i&&0<g&&(width<length+g+1&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}}(map$2.call(locale.grouping,Number),locale.thousands+""),currencyPrefix=void 0===locale.currency?"":locale.currency[0]+"",currencySuffix=void 0===locale.currency?"":locale.currency[1]+"",decimal=void 0===locale.decimal?".":locale.decimal+"",numerals=void 0===locale.numerals?identity$3:function formatNumerals(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}}(map$2.call(locale.numerals,String)),percent=void 0===locale.percent?"%":locale.percent+"",minus=void 0===locale.minus?"-":locale.minus+"",nan=void 0===locale.nan?"NaN":locale.nan+"";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(void 0===precision&&(precision=12),trim=!0,type="g"),(zero||"0"===fill&&"="===align)&&(zero=!0,fill="0",align="=");var prefix="$"===symbol?currencyPrefix:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currencySuffix:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format(value){var i,n,c,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0;if(value=isNaN(value)?nan:formatType(Math.abs(value),precision),trim&&(value=function formatTrim(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(0<i0){if(!+s[i])break out;i0=0}}return 0<i0?s.slice(0,i0)+s.slice(i1+1):s}(value)),valuePrefix=((valueNegative=valueNegative&&0==+value?!1:valueNegative)?"("===sign?sign:minus:"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if((c=value.charCodeAt(i))<48||57<c){valueSuffix=(46===c?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero&&(value=group(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero&&(value=group(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=void 0===precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format.toString=function(){return specifier+""},format}return{format:newFormat,formatPrefix:function formatPrefix(specifier,e){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(exponent$1(e)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}}}function defaultLocale(definition){return locale=formatLocale(definition),exports.format=locale.format,exports.formatPrefix=locale.formatPrefix,locale}function precisionFixed(step){return Math.max(0,-exponent$1(Math.abs(step)))}function precisionPrefix(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent$1(value)/3)))-exponent$1(Math.abs(step)))}function precisionRound(step,max){return step=Math.abs(step),max=Math.abs(max)-step,Math.max(0,exponent$1(max)-exponent$1(step))+1}function adder(){return new Adder}function Adder(){this.reset()}defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Adder.prototype={constructor:Adder,reset:function(){this.s=this.t=0},add:function(y){add$1(temp,y,this.t),add$1(this,temp.s,this.s),this.s?this.t+=temp.t:this.s=temp.t},valueOf:function(){return this.s}};var temp=new Adder;function add$1(adder,a,b){var av=adder.s=a+b,bv=av-a,av=av-bv;adder.t=a-av+(b-bv)}var epsilon$2=1e-6,pi$3=Math.PI,halfPi$2=pi$3/2,quarterPi=pi$3/4,tau$3=2*pi$3,degrees$1=180/pi$3,radians=pi$3/180,abs=Math.abs,atan=Math.atan,atan2=Math.atan2,cos$1=Math.cos,ceil=Math.ceil,exp=Math.exp,log=Math.log,pow=Math.pow,sin$1=Math.sin,sign=Math.sign||function(x){return 0<x?1:x<0?-1:0},sqrt=Math.sqrt,tan=Math.tan;function acos(x){return 1<x?0:x<-1?pi$3:Math.acos(x)}function asin(x){return 1<x?halfPi$2:x<-1?-halfPi$2:Math.asin(x)}function haversin(x){return(x=sin$1(x/2))*x}function noop$2(){}function streamGeometry(geometry,stream){geometry&&streamGeometryType.hasOwnProperty(geometry.type)&&streamGeometryType[geometry.type](geometry,stream)}var streamObjectType={Feature:function(object,stream){streamGeometry(object.geometry,stream)},FeatureCollection:function(object,stream){for(var features=object.features,i=-1,n=features.length;++i<n;)streamGeometry(features[i].geometry,stream)}},streamGeometryType={Sphere:function(object,stream){stream.sphere()},Point:function(object,stream){object=object.coordinates,stream.point(object[0],object[1],object[2])},MultiPoint:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],stream.point(object[0],object[1],object[2])},LineString:function(object,stream){streamLine(object.coordinates,stream,0)},MultiLineString:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)streamLine(coordinates[i],stream,0)},Polygon:function(object,stream){streamPolygon(object.coordinates,stream)},MultiPolygon:function(object,stream){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)streamPolygon(coordinates[i],stream)},GeometryCollection:function(object,stream){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)streamGeometry(geometries[i],stream)}};function streamLine(coordinates,stream,closed){var coordinate,i=-1,n=coordinates.length-closed;for(stream.lineStart();++i<n;)coordinate=coordinates[i],stream.point(coordinate[0],coordinate[1],coordinate[2]);stream.lineEnd()}function streamPolygon(coordinates,stream){var i=-1,n=coordinates.length;for(stream.polygonStart();++i<n;)streamLine(coordinates[i],stream,1);stream.polygonEnd()}function geoStream(object,stream){object&&streamObjectType.hasOwnProperty(object.type)?streamObjectType[object.type](object,stream):streamGeometry(object,stream)}var lambda00,phi00,lambda0,cosPhi0,sinPhi0,areaRingSum=adder(),areaSum=adder(),areaStream={point:noop$2,lineStart:noop$2,lineEnd:noop$2,polygonStart:function(){areaRingSum.reset(),areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){var areaRing=+areaRingSum;areaSum.add(areaRing<0?tau$3+areaRing:areaRing),this.lineStart=this.lineEnd=this.point=noop$2},sphere:function(){areaSum.add(tau$3)}};function areaRingStart(){areaStream.point=areaPointFirst}function areaRingEnd(){areaPoint(lambda00,phi00)}function areaPointFirst(lambda,phi){areaStream.point=areaPoint,lambda00=lambda,phi00=phi,lambda0=lambda*=radians,cosPhi0=cos$1(phi=(phi*=radians)/2+quarterPi),sinPhi0=sin$1(phi)}function areaPoint(lambda,u){var k=(lambda*=radians)-lambda0,sdLambda=0<=k?1:-1,v=sdLambda*k,cosPhi=cos$1(u=(u*=radians)/2+quarterPi),sinPhi=sin$1(u),k=sinPhi0*sinPhi,u=cosPhi0*cosPhi+k*cos$1(v),v=k*sdLambda*sin$1(v);areaRingSum.add(atan2(v,u)),lambda0=lambda,cosPhi0=cosPhi,sinPhi0=sinPhi}function spherical(cartesian){return[atan2(cartesian[1],cartesian[0]),asin(cartesian[2])]}function cartesian(cosPhi){var lambda=cosPhi[0],phi=cosPhi[1],cosPhi=cos$1(phi);return[cosPhi*cos$1(lambda),cosPhi*sin$1(lambda),sin$1(phi)]}function cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function cartesianAddInPlace(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function cartesianNormalizeInPlace(d){var l=sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}var lambda0$1,phi0,lambda1,phi1,lambda2,lambda00$1,phi00$1,p0,ranges,range,W0,W1,X0,Y0,Z0,X1,Y1,Z1,X2,Y2,Z2,lambda00$2,phi00$2,x0,y0,z0,deltaSum=adder(),boundsStream={point:boundsPoint,lineStart:boundsLineStart,lineEnd:boundsLineEnd,polygonStart:function(){boundsStream.point=boundsRingPoint,boundsStream.lineStart=boundsRingStart,boundsStream.lineEnd=boundsRingEnd,deltaSum.reset(),areaStream.polygonStart()},polygonEnd:function(){areaStream.polygonEnd(),boundsStream.point=boundsPoint,boundsStream.lineStart=boundsLineStart,boundsStream.lineEnd=boundsLineEnd,areaRingSum<0?(lambda0$1=-(lambda1=180),phi0=-(phi1=90)):epsilon$2<deltaSum?phi1=90:deltaSum<-epsilon$2&&(phi0=-90),range[0]=lambda0$1,range[1]=lambda1},sphere:function(){lambda0$1=-(lambda1=180),phi0=-(phi1=90)}};function boundsPoint(lambda,phi){ranges.push(range=[lambda0$1=lambda,lambda1=lambda]),phi<phi0&&(phi0=phi),phi1<phi&&(phi1=phi)}function linePoint(lambda,phi){var inflection,sign,lambdai,phii,antimeridian,p=cartesian([lambda*radians,phi*radians]);p0?(lambdai=cartesianCross(p0,p),cartesianNormalizeInPlace(inflection=cartesianCross([lambdai[1],-lambdai[0],0],lambdai)),inflection=spherical(inflection),sign=0<(antimeridian=lambda-lambda2)?1:-1,lambdai=inflection[0]*degrees$1*sign,(antimeridian=180<abs(antimeridian))^(sign*lambda2<lambdai&&lambdai<sign*lambda)?(phii=inflection[1]*degrees$1,phi1<phii&&(phi1=phii)):antimeridian^(sign*lambda2<(lambdai=(lambdai+360)%360-180)&&lambdai<sign*lambda)?(phii=-inflection[1]*degrees$1)<phi0&&(phi0=phii):(phi<phi0&&(phi0=phi),phi1<phi&&(phi1=phi)),antimeridian?lambda<lambda2?angle(lambda0$1,lambda)>angle(lambda0$1,lambda1)&&(lambda1=lambda):angle(lambda,lambda1)>angle(lambda0$1,lambda1)&&(lambda0$1=lambda):lambda0$1<=lambda1?(lambda<lambda0$1&&(lambda0$1=lambda),lambda1<lambda&&(lambda1=lambda)):lambda2<lambda?angle(lambda0$1,lambda)>angle(lambda0$1,lambda1)&&(lambda1=lambda):angle(lambda,lambda1)>angle(lambda0$1,lambda1)&&(lambda0$1=lambda)):ranges.push(range=[lambda0$1=lambda,lambda1=lambda]),phi<phi0&&(phi0=phi),phi1<phi&&(phi1=phi),p0=p,lambda2=lambda}function boundsLineStart(){boundsStream.point=linePoint}function boundsLineEnd(){range[0]=lambda0$1,range[1]=lambda1,boundsStream.point=boundsPoint,p0=null}function boundsRingPoint(lambda,phi){var delta;p0?(delta=lambda-lambda2,deltaSum.add(180<abs(delta)?delta+(0<delta?360:-360):delta)):(lambda00$1=lambda,phi00$1=phi),areaStream.point(lambda,phi),linePoint(lambda,phi)}function boundsRingStart(){areaStream.lineStart()}function boundsRingEnd(){boundsRingPoint(lambda00$1,phi00$1),areaStream.lineEnd(),abs(deltaSum)>epsilon$2&&(lambda0$1=-(lambda1=180)),range[0]=lambda0$1,range[1]=lambda1,p0=null}function angle(lambda0,lambda1){return(lambda1-=lambda0)<0?lambda1+360:lambda1}function rangeCompare(a,b){return a[0]-b[0]}function rangeContains(range,x){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}var centroidStream={sphere:noop$2,point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd}};function centroidPoint(lambda,phi){lambda*=radians;var cosPhi=cos$1(phi*=radians);centroidPointCartesian(cosPhi*cos$1(lambda),cosPhi*sin$1(lambda),sin$1(phi))}function centroidPointCartesian(x,y,z){X0+=(x-X0)/++W0,Y0+=(y-Y0)/W0,Z0+=(z-Z0)/W0}function centroidLineStart(){centroidStream.point=centroidLinePointFirst}function centroidLinePointFirst(lambda,phi){lambda*=radians;var cosPhi=cos$1(phi*=radians);x0=cosPhi*cos$1(lambda),y0=cosPhi*sin$1(lambda),z0=sin$1(phi),centroidStream.point=centroidLinePoint,centroidPointCartesian(x0,y0,z0)}function centroidLinePoint(z,w){z*=radians;var y=cos$1(w*=radians),x=y*cos$1(z),y=y*sin$1(z),z=sin$1(w),w=atan2(sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);W1+=w,X1+=w*(x0+(x0=x)),Y1+=w*(y0+(y0=y)),Z1+=w*(z0+(z0=z)),centroidPointCartesian(x0,y0,z0)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidRingPointFirst}function centroidRingEnd(){centroidRingPoint(lambda00$2,phi00$2),centroidStream.point=centroidPoint}function centroidRingPointFirst(lambda,phi){lambda00$2=lambda,phi00$2=phi,lambda*=radians,phi*=radians,centroidStream.point=centroidRingPoint;var cosPhi=cos$1(phi);x0=cosPhi*cos$1(lambda),y0=cosPhi*sin$1(lambda),z0=sin$1(phi),centroidPointCartesian(x0,y0,z0)}function centroidRingPoint(v,w){v*=radians;var cz=cos$1(w*=radians),x=cz*cos$1(v),y=cz*sin$1(v),z=sin$1(w),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,v=sqrt(cx*cx+cy*cy+cz*cz),w=asin(v),v=v&&-w/v;X2+=v*cx,Y2+=v*cy,Z2+=v*cz,W1+=w,X1+=w*(x0+(x0=x)),Y1+=w*(y0+(y0=y)),Z1+=w*(z0+(z0=z)),centroidPointCartesian(x0,y0,z0)}function constant$8(x){return function(){return x}}function compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}return a.invert&&b.invert&&(compose.invert=function(x,y){return(x=b.invert(x,y))&&a.invert(x[0],x[1])}),compose}function rotationIdentity(lambda,phi){return[abs(lambda)>pi$3?lambda+Math.round(-lambda/tau$3)*tau$3:lambda,phi]}function rotateRadians(deltaLambda,deltaPhi,deltaGamma){return(deltaLambda%=tau$3)?deltaPhi||deltaGamma?compose(rotationLambda(deltaLambda),rotationPhiGamma(deltaPhi,deltaGamma)):rotationLambda(deltaLambda):deltaPhi||deltaGamma?rotationPhiGamma(deltaPhi,deltaGamma):rotationIdentity}function forwardRotationLambda(deltaLambda){return function(lambda,phi){return[pi$3<(lambda+=deltaLambda)?lambda-tau$3:lambda<-pi$3?lambda+tau$3:lambda,phi]}}function rotationLambda(deltaLambda){var rotation=forwardRotationLambda(deltaLambda);return rotation.invert=forwardRotationLambda(-deltaLambda),rotation}function rotationPhiGamma(deltaPhi,deltaGamma){var cosDeltaPhi=cos$1(deltaPhi),sinDeltaPhi=sin$1(deltaPhi),cosDeltaGamma=cos$1(deltaGamma),sinDeltaGamma=sin$1(deltaGamma);function rotation(y,k){var z=cos$1(k),x=cos$1(y)*z,y=sin$1(y)*z,z=sin$1(k),k=z*cosDeltaPhi+x*sinDeltaPhi;return[atan2(y*cosDeltaGamma-k*sinDeltaGamma,x*cosDeltaPhi-z*sinDeltaPhi),asin(k*cosDeltaGamma+y*sinDeltaGamma)]}return rotation.invert=function(y,k){var z=cos$1(k),x=cos$1(y)*z,y=sin$1(y)*z,z=sin$1(k),k=z*cosDeltaGamma-y*sinDeltaGamma;return[atan2(y*cosDeltaGamma+z*sinDeltaGamma,x*cosDeltaPhi+k*sinDeltaPhi),asin(k*cosDeltaPhi-x*sinDeltaPhi)]},rotation}function rotation(rotate){function forward(coordinates){return(coordinates=rotate(coordinates[0]*radians,coordinates[1]*radians))[0]*=degrees$1,coordinates[1]*=degrees$1,coordinates}return rotate=rotateRadians(rotate[0]*radians,rotate[1]*radians,2<rotate.length?rotate[2]*radians:0),forward.invert=function(coordinates){return(coordinates=rotate.invert(coordinates[0]*radians,coordinates[1]*radians))[0]*=degrees$1,coordinates[1]*=degrees$1,coordinates},forward}function circleStream(stream,radius,delta,direction,t0,t1){if(delta){var cosRadius=cos$1(radius),sinRadius=sin$1(radius),step=direction*delta;null==t0?(t0=radius+direction*tau$3,t1=radius-step/2):(t0=circleRadius(cosRadius,t0),t1=circleRadius(cosRadius,t1),(0<direction?t0<t1:t1<t0)&&(t0+=direction*tau$3));for(var point,t=t0;0<direction?t1<t:t<t1;t-=step)point=spherical([cosRadius,-sinRadius*cos$1(t),-sinRadius*sin$1(t)]),stream.point(point[0],point[1])}}function circleRadius(radius,point){(point=cartesian(point))[0]-=radius,cartesianNormalizeInPlace(point);radius=acos(-point[1]);return((-point[2]<0?-radius:radius)+tau$3-epsilon$2)%tau$3}function clipBuffer(){var line,lines=[];return{point:function(x,y){line.push([x,y])},lineStart:function(){lines.push(line=[])},lineEnd:noop$2,rejoin:function(){1<lines.length&&lines.push(lines.pop().concat(lines.shift()))},result:function(){var result=lines;return lines=[],line=null,result}}}function pointEqual(a,b){return abs(a[0]-b[0])<epsilon$2&&abs(a[1]-b[1])<epsilon$2}function Intersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function clipRejoin(segments,compareIntersection,startInside,interpolate,stream){var i,n,subject=[],clip=[];if(segments.forEach(function(segment){if(!((n=segment.length-1)<=0)){var n,x,p0=segment[0],p1=segment[n];if(pointEqual(p0,p1)){for(stream.lineStart(),i=0;i<n;++i)stream.point((p0=segment[i])[0],p0[1]);stream.lineEnd()}else subject.push(x=new Intersection(p0,segment,null,!0)),clip.push(x.o=new Intersection(p0,null,x,!1)),subject.push(x=new Intersection(p1,segment,null,!1)),clip.push(x.o=new Intersection(p1,null,x,!0))}}),subject.length){for(clip.sort(compareIntersection),link$1(subject),link$1(clip),i=0,n=clip.length;i<n;++i)clip[i].e=startInside=!startInside;for(var points,point,start=subject[0];;){for(var current=start,isSubject=!0;current.v;)if((current=current.n)===start)return;points=current.z,stream.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(i=0,n=points.length;i<n;++i)stream.point((point=points[i])[0],point[1]);else interpolate(current.x,current.n.x,1,stream);current=current.n}else{if(isSubject)for(points=current.p.z,i=points.length-1;0<=i;--i)stream.point((point=points[i])[0],point[1]);else interpolate(current.x,current.p.x,-1,stream);current=current.p}}while(points=(current=current.o).z,isSubject=!isSubject,!current.v);stream.lineEnd()}}}function link$1(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}rotationIdentity.invert=rotationIdentity;var sum$1=adder();function longitude(point){return abs(point[0])<=pi$3?point[0]:sign(point[0])*((abs(point[0])+pi$3)%tau$3-pi$3)}function polygonContains(polygon,sinPhi){var lambda=longitude(sinPhi),phi=sinPhi[1],sinPhi=sin$1(phi),normal=[sin$1(lambda),-cos$1(lambda),0],angle=0,winding=0;sum$1.reset(),1===sinPhi?phi=halfPi$2+epsilon$2:-1===sinPhi&&(phi=-halfPi$2-epsilon$2);for(var i=0,n=polygon.length;i<n;++i)if(m=(ring=polygon[i]).length)for(var ring,m,point0=ring[m-1],lambda0=longitude(point0),phi0=point0[1]/2+quarterPi,sinPhi0=sin$1(phi0),cosPhi0=cos$1(phi0),j=0;j<m;++j,lambda0=lambda1,sinPhi0=sinPhi1,cosPhi0=cosPhi1,point0=point1){var point1=ring[j],lambda1=longitude(point1),k=point1[1]/2+quarterPi,sinPhi1=sin$1(k),cosPhi1=cos$1(k),delta=lambda1-lambda0,phiArc=0<=delta?1:-1,arc=phiArc*delta,antimeridian=pi$3<arc,k=sinPhi0*sinPhi1;sum$1.add(atan2(k*phiArc*sin$1(arc),cosPhi0*cosPhi1+k*cos$1(arc))),angle+=antimeridian?delta+phiArc*tau$3:delta,antimeridian^lambda<=lambda0^lambda<=lambda1&&(cartesianNormalizeInPlace(arc=cartesianCross(cartesian(point0),cartesian(point1))),cartesianNormalizeInPlace(phiArc=cartesianCross(normal,arc)),((phiArc=(antimeridian^0<=delta?-1:1)*asin(phiArc[2]))<phi||phi===phiArc&&(arc[0]||arc[1]))&&(winding+=antimeridian^0<=delta?1:-1))}return(angle<-epsilon$2||angle<epsilon$2&&sum$1<-epsilon$2)^1&winding}function clip(pointVisible,clipLine,interpolate,start){return function(sink){var polygon,segments,ring,line=clipLine(sink),ringBuffer=clipBuffer(),ringSink=clipLine(ringBuffer),polygonStarted=!1,clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing,clip.lineStart=ringStart,clip.lineEnd=ringEnd,segments=[],polygon=[]},polygonEnd:function(){clip.point=point,clip.lineStart=lineStart,clip.lineEnd=lineEnd,segments=merge(segments);var startInside=polygonContains(polygon,start);segments.length?(polygonStarted||(sink.polygonStart(),polygonStarted=!0),clipRejoin(segments,compareIntersection,startInside,interpolate,sink)):startInside&&(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd()),polygonStarted&&(sink.polygonEnd(),polygonStarted=!1),segments=polygon=null},sphere:function(){sink.polygonStart(),sink.lineStart(),interpolate(null,null,1,sink),sink.lineEnd(),sink.polygonEnd()}};function point(lambda,phi){pointVisible(lambda,phi)&&sink.point(lambda,phi)}function pointLine(lambda,phi){line.point(lambda,phi)}function lineStart(){clip.point=pointLine,line.lineStart()}function lineEnd(){clip.point=point,line.lineEnd()}function pointRing(lambda,phi){ring.push([lambda,phi]),ringSink.point(lambda,phi)}function ringStart(){ringSink.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringSink.lineEnd();var i,m,segment,point,clean=ringSink.clean(),ringSegments=ringBuffer.result(),n=ringSegments.length;if(ring.pop(),polygon.push(ring),ring=null,n)if(1&clean){if(0<(m=(segment=ringSegments[0]).length-1)){for(polygonStarted||(sink.polygonStart(),polygonStarted=!0),sink.lineStart(),i=0;i<m;++i)sink.point((point=segment[i])[0],point[1]);sink.lineEnd()}}else 1<n&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(validSegment))}return clip}}function validSegment(segment){return 1<segment.length}function compareIntersection(a,b){return((a=a.x)[0]<0?a[1]-halfPi$2-epsilon$2:halfPi$2-a[1])-((b=b.x)[0]<0?b[1]-halfPi$2-epsilon$2:halfPi$2-b[1])}var clipAntimeridian=clip(function(){return 1},function clipAntimeridianLine(stream){var clean,lambda0=NaN,phi0=NaN,sign0=NaN;return{lineStart:function(){stream.lineStart(),clean=1},point:function(lambda1,phi1){var sign1=0<lambda1?pi$3:-pi$3,delta=abs(lambda1-lambda0);abs(delta-pi$3)<epsilon$2?(stream.point(lambda0,phi0=0<(phi0+phi1)/2?halfPi$2:-halfPi$2),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),stream.point(lambda1,phi0),clean=0):sign0!==sign1&&pi$3<=delta&&(abs(lambda0-sign0)<epsilon$2&&(lambda0-=sign0*epsilon$2),abs(lambda1-sign1)<epsilon$2&&(lambda1-=sign1*epsilon$2),phi0=function clipAntimeridianIntersect(lambda0,phi0,cosPhi0,phi1){var cosPhi1,sinLambda0Lambda1=sin$1(lambda0-cosPhi0);return abs(sinLambda0Lambda1)>epsilon$2?atan((sin$1(phi0)*(cosPhi1=cos$1(phi1))*sin$1(cosPhi0)-sin$1(phi1)*(cosPhi0=cos$1(phi0))*sin$1(lambda0))/(cosPhi0*cosPhi1*sinLambda0Lambda1)):(phi0+phi1)/2}(lambda0,phi0,lambda1,phi1),stream.point(sign0,phi0),stream.lineEnd(),stream.lineStart(),stream.point(sign1,phi0),clean=0),stream.point(lambda0=lambda1,phi0=phi1),sign0=sign1},lineEnd:function(){stream.lineEnd(),lambda0=phi0=NaN},clean:function(){return 2-clean}}},function clipAntimeridianInterpolate(lambda,to,direction,stream){var phi;null==lambda?(phi=direction*halfPi$2,stream.point(-pi$3,phi),stream.point(0,phi),stream.point(pi$3,phi),stream.point(pi$3,0),stream.point(pi$3,-phi),stream.point(0,-phi),stream.point(-pi$3,-phi),stream.point(-pi$3,0),stream.point(-pi$3,phi)):abs(lambda[0]-to[0])>epsilon$2?(lambda=lambda[0]<to[0]?pi$3:-pi$3,phi=direction*lambda/2,stream.point(-lambda,phi),stream.point(0,phi),stream.point(lambda,phi)):stream.point(to[0],to[1])},[-pi$3,-halfPi$2]);function clipCircle(radius){var cr=cos$1(radius),delta=6*radians,smallRadius=0<cr,notHemisphere=abs(cr)>epsilon$2;function visible(lambda,phi){return cos$1(lambda)*cos$1(phi)>cr}function intersect(delta,polar,phi1){var phi0=[1,0,0],q=cartesianCross(cartesian(delta),cartesian(polar)),u=cartesianDot(q,q),w=q[0],q1=u-w*w;if(!q1)return!phi1&&delta;var t=cr*u/q1,lambda0=-cr*w/q1,lambda1=cartesianCross(phi0,q),A=cartesianScale(phi0,t);cartesianAddInPlace(A,cartesianScale(q,lambda0));u=lambda1,w=cartesianDot(A,u),q1=cartesianDot(u,u),phi0=w*w-q1*(cartesianDot(A,A)-1);if(!(phi0<0)){t=sqrt(phi0),q=cartesianScale(u,(-w-t)/q1);if(cartesianAddInPlace(q,A),q=spherical(q),!phi1)return q;var z,lambda0=delta[0],lambda1=polar[0],phi0=delta[1],phi1=polar[1];lambda1<lambda0&&(z=lambda0,lambda0=lambda1,lambda1=z);delta=lambda1-lambda0,polar=abs(delta-pi$3)<epsilon$2;if(!polar&&phi1<phi0&&(z=phi0,phi0=phi1,phi1=z),polar||delta<epsilon$2?polar?0<phi0+phi1^q[1]<(abs(q[0]-lambda0)<epsilon$2?phi0:phi1):phi0<=q[1]&&q[1]<=phi1:pi$3<delta^(lambda0<=q[0]&&q[0]<=lambda1)){q1=cartesianScale(u,(-w+t)/q1);return cartesianAddInPlace(q1,A),[q,spherical(q1)]}}}function code(lambda,phi){var r=smallRadius?radius:pi$3-radius,code=0;return lambda<-r?code|=1:r<lambda&&(code|=2),phi<-r?code|=4:r<phi&&(code|=8),code}return clip(visible,function clipLine(stream){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(lambda,c){var point2,t,point1=[lambda,c],v=visible(lambda,c),c=smallRadius?v?0:code(lambda,c):v?code(lambda+(lambda<0?pi$3:-pi$3),c):0;!point0&&(v00=v0=v)&&stream.lineStart(),v!==v0&&((point2=intersect(point0,point1))&&!pointEqual(point0,point2)&&!pointEqual(point1,point2)||(point1[0]+=epsilon$2,point1[1]+=epsilon$2,v=visible(point1[0],point1[1]))),v!==v0?(clean=0,v?(stream.lineStart(),point2=intersect(point1,point0),stream.point(point2[0],point2[1])):(point2=intersect(point0,point1),stream.point(point2[0],point2[1]),stream.lineEnd()),point0=point2):notHemisphere&&point0&&smallRadius^v&&(c&c0||!(t=intersect(point1,point0,!0))||(clean=0,smallRadius?(stream.lineStart(),stream.point(t[0][0],t[0][1]),stream.point(t[1][0],t[1][1]),stream.lineEnd()):(stream.point(t[1][0],t[1][1]),stream.lineEnd(),stream.lineStart(),stream.point(t[0][0],t[0][1])))),!v||point0&&pointEqual(point0,point1)||stream.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&stream.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}},function interpolate(from,to,direction,stream){circleStream(stream,radius,delta,direction,from,to)},smallRadius?[0,-radius]:[-pi$3,radius-pi$3])}var clipMax=1e9,clipMin=-clipMax;function clipRectangle(x0,y0,x1,y1){function visible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function interpolate(from,to,direction,stream){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoint(from,to)<0^0<direction)for(;stream.point(0===a||3===a?x0:x1,1<a?y1:y0),(a=(a+direction+4)%4)!==a1;);else stream.point(to[0],to[1])}function corner(p,direction){return abs(p[0]-x0)<epsilon$2?0<direction?0:3:abs(p[0]-x1)<epsilon$2?0<direction?2:1:abs(p[1]-y0)<epsilon$2?0<direction?1:0:0<direction?3:2}function compareIntersection(a,b){return comparePoint(a.x,b.x)}function comparePoint(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}return function(stream){var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,activeStream=stream,bufferStream=clipBuffer(),clipStream={point:point,lineStart:function lineStart(){clipStream.point=linePoint,polygon&&polygon.push(ring=[]);first=!0,v_=!1,x_=y_=NaN},lineEnd:function lineEnd(){segments&&(linePoint(x__,y__),v__&&v_&&bufferStream.rejoin(),segments.push(bufferStream.result()));clipStream.point=point,v_&&activeStream.lineEnd()},polygonStart:function polygonStart(){activeStream=bufferStream,segments=[],polygon=[],clean=!0},polygonEnd:function polygonEnd(){var startInside=function polygonInside(){for(var winding=0,i=0,n=polygon.length;i<n;++i)for(var a0,a1,ring=polygon[i],j=1,m=ring.length,point=ring[0],b0=point[0],b1=point[1];j<m;++j)a0=b0,a1=b1,point=ring[j],b0=point[0],b1=point[1],a1<=y1?y1<b1&&(b1-a1)*(x0-a0)<(b0-a0)*(y1-a1)&&++winding:b1<=y1&&(b0-a0)*(y1-a1)<(b1-a1)*(x0-a0)&&--winding;return winding}(),cleanInside=clean&&startInside,visible=(segments=merge(segments)).length;(cleanInside||visible)&&(stream.polygonStart(),cleanInside&&(stream.lineStart(),interpolate(null,null,1,stream),stream.lineEnd()),visible&&clipRejoin(segments,compareIntersection,startInside,interpolate,stream),stream.polygonEnd());activeStream=stream,segments=polygon=ring=null}};function point(x,y){visible(x,y)&&activeStream.point(x,y)}function linePoint(x,y){var a,b,v=visible(x,y);polygon&&ring.push([x,y]),first?(x__=x,y__=y,first=!1,(v__=v)&&(activeStream.lineStart(),activeStream.point(x,y))):v&&v_?activeStream.point(x,y):!function clipLine(a,b,r,y0,x1,y1){var ax=a[0],ay=a[1],t0=0,t1=1,dx=b[0]-ax,dy=b[1]-ay,r=r-ax;if(dx||!(0<r)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dx){if(t1<r)return;t0<r&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dx){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(0<r)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dy){if(t1<r)return;t0<r&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dy){if(r<t0)return;r<t1&&(t1=r)}return 0<t0&&(a[0]=ax+t0*dx,a[1]=ay+t0*dy),t1<1&&(b[0]=ax+t1*dx,b[1]=ay+t1*dy),1}}}}}(a=[x_=Math.max(clipMin,Math.min(clipMax,x_)),y_=Math.max(clipMin,Math.min(clipMax,y_))],b=[x=Math.max(clipMin,Math.min(clipMax,x)),y=Math.max(clipMin,Math.min(clipMax,y))],x0,y0,x1,y1)?v&&(activeStream.lineStart(),activeStream.point(x,y),clean=!1):(v_||(activeStream.lineStart(),activeStream.point(a[0],a[1])),activeStream.point(b[0],b[1]),v||activeStream.lineEnd(),clean=!1),x_=x,y_=y,v_=v}return clipStream}}var lambda0$2,sinPhi0$1,cosPhi0$1,lengthSum=adder(),lengthStream={sphere:noop$2,point:noop$2,lineStart:function lengthLineStart(){lengthStream.point=lengthPointFirst,lengthStream.lineEnd=lengthLineEnd},lineEnd:noop$2,polygonStart:noop$2,polygonEnd:noop$2};function lengthLineEnd(){lengthStream.point=lengthStream.lineEnd=noop$2}function lengthPointFirst(lambda,phi){lambda0$2=lambda*=radians,sinPhi0$1=sin$1(phi*=radians),cosPhi0$1=cos$1(phi),lengthStream.point=lengthPoint}function lengthPoint(lambda,x){lambda*=radians;var sinPhi=sin$1(x*=radians),cosPhi=cos$1(x),y=abs(lambda-lambda0$2),z=cos$1(y),x=cosPhi*sin$1(y),y=cosPhi0$1*sinPhi-sinPhi0$1*cosPhi*z,z=sinPhi0$1*sinPhi+cosPhi0$1*cosPhi*z;lengthSum.add(atan2(sqrt(x*x+y*y),z)),lambda0$2=lambda,sinPhi0$1=sinPhi,cosPhi0$1=cosPhi}function length$1(object){return lengthSum.reset(),geoStream(object,lengthStream),+lengthSum}var coordinates=[null,null],object$1={type:"LineString",coordinates:coordinates};function distance(a,b){return coordinates[0]=a,coordinates[1]=b,length$1(object$1)}var containsObjectType={Feature:function(object,point){return containsGeometry(object.geometry,point)},FeatureCollection:function(object,point){for(var features=object.features,i=-1,n=features.length;++i<n;)if(containsGeometry(features[i].geometry,point))return!0;return!1}},containsGeometryType={Sphere:function(){return!0},Point:function(object,point){return containsPoint(object.coordinates,point)},MultiPoint:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsPoint(coordinates[i],point))return!0;return!1},LineString:function(object,point){return containsLine(object.coordinates,point)},MultiLineString:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsLine(coordinates[i],point))return!0;return!1},Polygon:function(object,point){return containsPolygon(object.coordinates,point)},MultiPolygon:function(object,point){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)if(containsPolygon(coordinates[i],point))return!0;return!1},GeometryCollection:function(object,point){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)if(containsGeometry(geometries[i],point))return!0;return!1}};function containsGeometry(geometry,point){return!(!geometry||!containsGeometryType.hasOwnProperty(geometry.type))&&containsGeometryType[geometry.type](geometry,point)}function containsPoint(coordinates,point){return 0===distance(coordinates,point)}function containsLine(coordinates,point){for(var ao,bo,ab,i=0,n=coordinates.length;i<n;i++){if(0===(bo=distance(coordinates[i],point)))return!0;if(0<i&&0<(ab=distance(coordinates[i],coordinates[i-1]))&&ao<=ab&&bo<=ab&&(ao+bo-ab)*(1-Math.pow((ao-bo)/ab,2))<1e-12*ab)return!0;ao=bo}return!1}function containsPolygon(coordinates,point){return!!polygonContains(coordinates.map(ringRadians),pointRadians(point))}function ringRadians(ring){return(ring=ring.map(pointRadians)).pop(),ring}function pointRadians(point){return[point[0]*radians,point[1]*radians]}function graticuleX(y0,y1,dy){var y=sequence(y0,y1-epsilon$2,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function graticuleY(x0,x1,dx){var x=sequence(x0,x1-epsilon$2,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function graticule(){var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return sequence(ceil(X0/DX)*DX,X1,DX).map(X).concat(sequence(ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(sequence(ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>epsilon$2}).map(x)).concat(sequence(ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>epsilon$2}).map(y))}return graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})},graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}},graticule.extent=function(_){return arguments.length?graticule.extentMajor(_).extentMinor(_):graticule.extentMinor()},graticule.extentMajor=function(_){return arguments.length?(X0=+_[0][0],X1=+_[1][0],Y0=+_[0][1],Y1=+_[1][1],X1<X0&&(_=X0,X0=X1,X1=_),Y1<Y0&&(_=Y0,Y0=Y1,Y1=_),graticule.precision(precision)):[[X0,Y0],[X1,Y1]]},graticule.extentMinor=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],x1<x0&&(_=x0,x0=x1,x1=_),y1<y0&&(_=y0,y0=y1,y1=_),graticule.precision(precision)):[[x0,y0],[x1,y1]]},graticule.step=function(_){return arguments.length?graticule.stepMajor(_).stepMinor(_):graticule.stepMinor()},graticule.stepMajor=function(_){return arguments.length?(DX=+_[0],DY=+_[1],graticule):[DX,DY]},graticule.stepMinor=function(_){return arguments.length?(dx=+_[0],dy=+_[1],graticule):[dx,dy]},graticule.precision=function(_){return arguments.length?(precision=+_,x=graticuleX(y0,y1,90),y=graticuleY(x0,x1,precision),X=graticuleX(Y0,Y1,90),Y=graticuleY(X0,X1,precision),graticule):precision},graticule.extentMajor([[-180,-90+epsilon$2],[180,90-epsilon$2]]).extentMinor([[-180,-80-epsilon$2],[180,80+epsilon$2]])}function identity$4(x){return x}var x00,y00,x0$1,y0$1,areaSum$1=adder(),areaRingSum$1=adder(),areaStream$1={point:noop$2,lineStart:noop$2,lineEnd:noop$2,polygonStart:function(){areaStream$1.lineStart=areaRingStart$1,areaStream$1.lineEnd=areaRingEnd$1},polygonEnd:function(){areaStream$1.lineStart=areaStream$1.lineEnd=areaStream$1.point=noop$2,areaSum$1.add(abs(areaRingSum$1)),areaRingSum$1.reset()},result:function(){var area=areaSum$1/2;return areaSum$1.reset(),area}};function areaRingStart$1(){areaStream$1.point=areaPointFirst$1}function areaPointFirst$1(x,y){areaStream$1.point=areaPoint$1,x00=x0$1=x,y00=y0$1=y}function areaPoint$1(x,y){areaRingSum$1.add(y0$1*x-x0$1*y),x0$1=x,y0$1=y}function areaRingEnd$1(){areaPoint$1(x00,y00)}var x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream$1={point:function boundsPoint$1(x,y){x<x0$2&&(x0$2=x);x1<x&&(x1=x);y<y0$2&&(y0$2=y);y1<y&&(y1=y)},lineStart:noop$2,lineEnd:noop$2,polygonStart:noop$2,polygonEnd:noop$2,result:function(){var bounds=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),bounds}};var x00$1,y00$1,x0$3,y0$3,X0$1=0,Y0$1=0,Z0$1=0,X1$1=0,Y1$1=0,Z1$1=0,X2$1=0,Y2$1=0,Z2$1=0,centroidStream$1={point:centroidPoint$1,lineStart:centroidLineStart$1,lineEnd:centroidLineEnd$1,polygonStart:function(){centroidStream$1.lineStart=centroidRingStart$1,centroidStream$1.lineEnd=centroidRingEnd$1},polygonEnd:function(){centroidStream$1.point=centroidPoint$1,centroidStream$1.lineStart=centroidLineStart$1,centroidStream$1.lineEnd=centroidLineEnd$1},result:function(){var centroid=Z2$1?[X2$1/Z2$1,Y2$1/Z2$1]:Z1$1?[X1$1/Z1$1,Y1$1/Z1$1]:Z0$1?[X0$1/Z0$1,Y0$1/Z0$1]:[NaN,NaN];return X0$1=Y0$1=Z0$1=X1$1=Y1$1=Z1$1=X2$1=Y2$1=Z2$1=0,centroid}};function centroidPoint$1(x,y){X0$1+=x,Y0$1+=y,++Z0$1}function centroidLineStart$1(){centroidStream$1.point=centroidPointFirstLine}function centroidPointFirstLine(x,y){centroidStream$1.point=centroidPointLine,centroidPoint$1(x0$3=x,y0$3=y)}function centroidPointLine(x,y){var dx=x-x0$3,z=y-y0$3,z=sqrt(dx*dx+z*z);X1$1+=z*(x0$3+x)/2,Y1$1+=z*(y0$3+y)/2,Z1$1+=z,centroidPoint$1(x0$3=x,y0$3=y)}function centroidLineEnd$1(){centroidStream$1.point=centroidPoint$1}function centroidRingStart$1(){centroidStream$1.point=centroidPointFirstRing}function centroidRingEnd$1(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(x,y){centroidStream$1.point=centroidPointRing,centroidPoint$1(x00$1=x0$3=x,y00$1=y0$3=y)}function centroidPointRing(x,y){var dx=x-x0$3,z=y-y0$3,z=sqrt(dx*dx+z*z);X1$1+=z*(x0$3+x)/2,Y1$1+=z*(y0$3+y)/2,Z1$1+=z,X2$1+=(z=y0$3*x-x0$3*y)*(x0$3+x),Y2$1+=z*(y0$3+y),Z2$1+=3*z,centroidPoint$1(x0$3=x,y0$3=y)}function PathContext(context){this._context=context}PathContext.prototype={_radius:4.5,pointRadius:function(_){return this._radius=_,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(x,y){switch(this._point){case 0:this._context.moveTo(x,y),this._point=1;break;case 1:this._context.lineTo(x,y);break;default:this._context.moveTo(x+this._radius,y),this._context.arc(x,y,this._radius,0,tau$3)}},result:noop$2};var lengthRing,x00$2,y00$2,x0$4,y0$4,lengthSum$1=adder(),lengthStream$1={point:noop$2,lineStart:function(){lengthStream$1.point=lengthPointFirst$1},lineEnd:function(){lengthRing&&lengthPoint$1(x00$2,y00$2),lengthStream$1.point=noop$2},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var length=+lengthSum$1;return lengthSum$1.reset(),length}};function lengthPointFirst$1(x,y){lengthStream$1.point=lengthPoint$1,x00$2=x0$4=x,y00$2=y0$4=y}function lengthPoint$1(x,y){x0$4-=x,y0$4-=y,lengthSum$1.add(sqrt(x0$4*x0$4+y0$4*y0$4)),x0$4=x,y0$4=y}function PathString(){this._string=[]}function circle$1(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}function transformer(methods){return function(stream){var key,s=new TransformStream;for(key in methods)s[key]=methods[key];return s.stream=stream,s}}function TransformStream(){}function fit(projection,fitBounds,object){var clip=projection.clipExtent&&projection.clipExtent();return projection.scale(150).translate([0,0]),null!=clip&&projection.clipExtent(null),geoStream(object,projection.stream(boundsStream$1)),fitBounds(boundsStream$1.result()),null!=clip&&projection.clipExtent(clip),projection}function fitExtent(projection,extent,object){return fit(projection,function(y){var x=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],k=Math.min(x/(y[1][0]-y[0][0]),h/(y[1][1]-y[0][1])),x=+extent[0][0]+(x-k*(y[1][0]+y[0][0]))/2,y=+extent[0][1]+(h-k*(y[1][1]+y[0][1]))/2;projection.scale(150*k).translate([x,y])},object)}function fitSize(projection,size,object){return fitExtent(projection,[[0,0],size],object)}function fitWidth(projection,width,object){return fit(projection,function(y){var x=+width,k=x/(y[1][0]-y[0][0]),x=(x-k*(y[1][0]+y[0][0]))/2,y=-k*y[0][1];projection.scale(150*k).translate([x,y])},object)}function fitHeight(projection,height,object){return fit(projection,function(y){var h=+height,k=h/(y[1][1]-y[0][1]),x=-k*y[0][0],y=(h-k*(y[1][1]+y[0][1]))/2;projection.scale(150*k).translate([x,y])},object)}PathString.prototype={_radius:4.5,_circle:circle$1(4.5),pointRadius:function(_){return(_=+_)!==this._radius&&(this._radius=_,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(x,y){switch(this._point){case 0:this._string.push("M",x,",",y),this._point=1;break;case 1:this._string.push("L",x,",",y);break;default:null==this._circle&&(this._circle=circle$1(this._radius)),this._string.push("M",x,",",y,this._circle)}},result:function(){if(this._string.length){var result=this._string.join("");return this._string=[],result}return null}},TransformStream.prototype={constructor:TransformStream,point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var maxDepth=16,cosMinDistance=cos$1(30*radians);function resample(project,delta2){return+delta2?function resample$1(project,delta2){function resampleLineTo(x0,y0,lambda0,a0,b0,c0,x1,y1,lambda1,a1,b1,c1,depth,stream){var a,b,c,m,lambda2,x2,y2,dx2,dy2,dz,dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;4*delta2<d2&&depth--&&(c=c0+c1,dy2=asin(c/=m=sqrt((a=a0+a1)*a+(b=b0+b1)*b+c*c)),lambda2=abs(abs(c)-1)<epsilon$2||abs(lambda0-lambda1)<epsilon$2?(lambda0+lambda1)/2:atan2(b,a),x2=(dz=project(lambda2,dy2))[0],y2=dz[1],(delta2<(dz=dy*(dx2=x2-x0)-dx*(dy2=y2-y0))*dz/d2||.3<abs((dx*dx2+dy*dy2)/d2-.5)||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,lambda0,a0,b0,c0,x2,y2,lambda2,a/=m,b/=m,c,depth,stream),stream.point(x2,y2),resampleLineTo(x2,y2,lambda2,a,b,c,x1,y1,lambda1,a1,b1,c1,depth,stream)))}return function(stream){var lambda00,x00,y00,a00,b00,c00,lambda0,x0,y0,a0,b0,c0,resampleStream={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart(),resampleStream.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resampleStream.lineStart=lineStart}};function point(x,y){x=project(x,y),stream.point(x[0],x[1])}function lineStart(){x0=NaN,resampleStream.point=linePoint,stream.lineStart()}function linePoint(lambda,p){var c=cartesian([lambda,p]),p=project(lambda,p);resampleLineTo(x0,y0,lambda0,a0,b0,c0,x0=p[0],y0=p[1],lambda0=lambda,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream),stream.point(x0,y0)}function lineEnd(){resampleStream.point=point,stream.lineEnd()}function ringStart(){lineStart(),resampleStream.point=ringPoint,resampleStream.lineEnd=ringEnd}function ringPoint(lambda,phi){linePoint(lambda00=lambda,phi),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resampleStream.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,lambda0,a0,b0,c0,x00,y00,lambda00,a00,b00,c00,maxDepth,stream),resampleStream.lineEnd=lineEnd,lineEnd()}return resampleStream}}(project,delta2):function resampleNone(project){return transformer({point:function(x,y){x=project(x,y),this.stream.point(x[0],x[1])}})}(project)}var transformRadians=transformer({point:function(x,y){this.stream.point(x*radians,y*radians)}});function scaleTranslateRotate(k,dx,dy,sinAlpha){var cosAlpha=cos$1(sinAlpha),sinAlpha=sin$1(sinAlpha),a=cosAlpha*k,b=sinAlpha*k,ai=cosAlpha/k,bi=sinAlpha/k,ci=(sinAlpha*dy-cosAlpha*dx)/k,fi=(sinAlpha*dx+cosAlpha*dy)/k;function transform(x,y){return[a*x-b*y+dx,dy-b*x-a*y]}return transform.invert=function(x,y){return[ai*x-bi*y+ci,fi-bi*x-ai*y]},transform}function projection(project){return projectionMutator(function(){return project})()}function projectionMutator(projectAt){var project,rotate,y0,x1,y1,projectResample,projectTransform,projectRotateTransform,cache,cacheStream,k=150,x=480,y=250,lambda=0,phi=0,deltaLambda=0,deltaPhi=0,deltaGamma=0,alpha=0,theta=null,preclip=clipAntimeridian,x0=null,postclip=identity$4,delta2=.5;function projection(point){return projectRotateTransform(point[0]*radians,point[1]*radians)}function invert(point){return(point=projectRotateTransform.invert(point[0],point[1]))&&[point[0]*degrees$1,point[1]*degrees$1]}function recenter(){var transform=scaleTranslateRotate(k,0,0,alpha).apply(null,project(lambda,phi)),transform=(alpha?scaleTranslateRotate:function scaleTranslate(k,dx,dy){function transform(x,y){return[dx+k*x,dy-k*y]}return transform.invert=function(x,y){return[(x-dx)/k,(dy-y)/k]},transform})(k,x-transform[0],y-transform[1],alpha);return rotate=rotateRadians(deltaLambda,deltaPhi,deltaGamma),projectTransform=compose(project,transform),projectRotateTransform=compose(rotate,projectTransform),projectResample=resample(projectTransform,delta2),reset()}function reset(){return cache=cacheStream=null,projection}return projection.stream=function(stream){return cache&&cacheStream===stream?cache:cache=transformRadians(function transformRotate(rotate){return transformer({point:function(x,r){r=rotate(x,r);return this.stream.point(r[0],r[1])}})}(rotate)(preclip(projectResample(postclip(cacheStream=stream)))))},projection.preclip=function(_){return arguments.length?(preclip=_,theta=void 0,reset()):preclip},projection.postclip=function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip},projection.clipAngle=function(_){return arguments.length?(preclip=+_?clipCircle(theta=_*radians):(theta=null,clipAntimeridian),reset()):theta*degrees$1},projection.clipExtent=function(_){return arguments.length?(postclip=null==_?(x0=y0=x1=y1=null,identity$4):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):null==x0?null:[[x0,y0],[x1,y1]]},projection.scale=function(_){return arguments.length?(k=+_,recenter()):k},projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],recenter()):[x,y]},projection.center=function(_){return arguments.length?(lambda=_[0]%360*radians,phi=_[1]%360*radians,recenter()):[lambda*degrees$1,phi*degrees$1]},projection.rotate=function(_){return arguments.length?(deltaLambda=_[0]%360*radians,deltaPhi=_[1]%360*radians,deltaGamma=2<_.length?_[2]%360*radians:0,recenter()):[deltaLambda*degrees$1,deltaPhi*degrees$1,deltaGamma*degrees$1]},projection.angle=function(_){return arguments.length?(alpha=_%360*radians,recenter()):alpha*degrees$1},projection.precision=function(_){return arguments.length?(projectResample=resample(projectTransform,delta2=_*_),reset()):sqrt(delta2)},projection.fitExtent=function(extent,object){return fitExtent(projection,extent,object)},projection.fitSize=function(size,object){return fitSize(projection,size,object)},projection.fitWidth=function(width,object){return fitWidth(projection,width,object)},projection.fitHeight=function(height,object){return fitHeight(projection,height,object)},function(){return project=projectAt.apply(this,arguments),projection.invert=project.invert&&invert,recenter()}}function conicProjection(p){var phi0=0,phi1=pi$3/3,m=projectionMutator(p),p=m(phi0,phi1);return p.parallels=function(_){return arguments.length?m(phi0=_[0]*radians,phi1=_[1]*radians):[phi0*degrees$1,phi1*degrees$1]},p}function conicEqualAreaRaw(y0,y1){var sy0=sin$1(y0),n=(sy0+sin$1(y1))/2;if(abs(n)<epsilon$2)return function cylindricalEqualAreaRaw(phi0){var cosPhi0=cos$1(phi0);function forward(lambda,phi){return[lambda*cosPhi0,sin$1(phi)/cosPhi0]}return forward.invert=function(x,y){return[x/cosPhi0,asin(y*cosPhi0)]},forward}(y0);var c=1+sy0*(2*n-sy0),r0=sqrt(c)/n;function project(x,r){r=sqrt(c-2*n*sin$1(r))/n;return[r*sin$1(x*=n),r0-r*cos$1(x)]}return project.invert=function(x,r0y){r0y=r0-r0y;return[atan2(x,abs(r0y))/n*sign(r0y),asin((c-(x*x+r0y*r0y)*n*n)/(2*n))]},project}function conicEqualArea(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])}function albers(){return conicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function azimuthalRaw(scale){return function(x,y){var k=cos$1(x),cy=cos$1(y),k=scale(k*cy);return[k*cy*sin$1(x),k*sin$1(y)]}}function azimuthalInvert(angle){return function(x,y){var z=sqrt(x*x+y*y),cc=angle(z),sc=sin$1(cc),cc=cos$1(cc);return[atan2(x*sc,z*cc),asin(z&&y*sc/z)]}}var azimuthalEqualAreaRaw=azimuthalRaw(function(cxcy){return sqrt(2/(1+cxcy))});azimuthalEqualAreaRaw.invert=azimuthalInvert(function(z){return 2*asin(z/2)});var azimuthalEquidistantRaw=azimuthalRaw(function(c){return(c=acos(c))&&c/sin$1(c)});function mercatorRaw(lambda,phi){return[lambda,log(tan((halfPi$2+phi)/2))]}function mercatorProjection(project){var y0,x1,y1,m=projection(project),center=m.center,scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,x0=null;function reclip(){var k=pi$3*scale(),t=m(rotation(m.rotate()).invert([0,0]));return clipExtent(null==x0?[[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]:project===mercatorRaw?[[Math.max(t[0]-k,x0),y0],[Math.min(t[0]+k,x1),y1]]:[[x0,Math.max(t[1]-k,y0)],[x1,Math.min(t[1]+k,y1)]])}return m.scale=function(_){return arguments.length?(scale(_),reclip()):scale()},m.translate=function(_){return arguments.length?(translate(_),reclip()):translate()},m.center=function(_){return arguments.length?(center(_),reclip()):center()},m.clipExtent=function(_){return arguments.length?(null==_?x0=y0=x1=y1=null:(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reclip()):null==x0?null:[[x0,y0],[x1,y1]]},reclip()}function tany(y){return tan((halfPi$2+y)/2)}function conicConformalRaw(y0,y1){var cy0=cos$1(y0),n=y0===y1?sin$1(y0):log(cy0/cos$1(y1))/log(tany(y1)/tany(y0)),f=cy0*pow(tany(y0),n)/n;return n?(project.invert=function(x,r){var fy=f-r,r=sign(n)*sqrt(x*x+fy*fy);return[atan2(x,abs(fy))/n*sign(fy),2*atan(pow(f/r,1/n))-halfPi$2]},project):mercatorRaw;function project(x,r){0<f?r<-halfPi$2+epsilon$2&&(r=-halfPi$2+epsilon$2):halfPi$2-epsilon$2<r&&(r=halfPi$2-epsilon$2);r=f/pow(tany(r),n);return[r*sin$1(n*x),f-r*cos$1(n*x)]}}function equirectangularRaw(lambda,phi){return[lambda,phi]}function conicEquidistantRaw(y0,y1){var cy0=cos$1(y0),n=y0===y1?sin$1(y0):(cy0-cos$1(y1))/(y1-y0),g=cy0/n+y0;return abs(n)<epsilon$2?equirectangularRaw:(project.invert=function(x,gy){gy=g-gy;return[atan2(x,abs(gy))/n*sign(gy),g-sign(n)*sqrt(x*x+gy*gy)]},project);function project(nx,gy){gy=g-gy,nx*=n;return[gy*sin$1(nx),g-gy*cos$1(nx)]}}azimuthalEquidistantRaw.invert=azimuthalInvert(function(z){return z}),mercatorRaw.invert=function(x,y){return[x,2*atan(exp(y))-halfPi$2]},equirectangularRaw.invert=equirectangularRaw;var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M=sqrt(3)/2;function equalEarthRaw(lambda,l6){var l=asin(M*sin$1(l6)),l2=l*l,l6=l2*l2*l2;return[lambda*cos$1(l)/(M*(A1+3*A2*l2+l6*(7*A3+9*A4*l2))),l*(A1+A2*l2+l6*(A3+A4*l2))]}function gnomonicRaw(x,y){var cy=cos$1(y),k=cos$1(x)*cy;return[cy*sin$1(x)/k,sin$1(y)/k]}function scaleTranslate$1(kx,ky,tx,ty){return 1===kx&&1===ky&&0===tx&&0===ty?identity$4:transformer({point:function(x,y){this.stream.point(x*kx+tx,y*ky+ty)}})}function naturalEarth1Raw(lambda,phi){var phi2=phi*phi,phi4=phi2*phi2;return[lambda*(.8707-.131979*phi2+phi4*(phi4*(.003971*phi2-.001529*phi4)-.013791)),phi*(1.007226+phi2*(.015085+phi4*(.028874*phi2-.044475-.005916*phi4)))]}function orthographicRaw(x,y){return[cos$1(y)*sin$1(x),sin$1(y)]}function stereographicRaw(x,y){var cy=cos$1(y),k=1+cos$1(x)*cy;return[cy*sin$1(x)/k,sin$1(y)/k]}function transverseMercatorRaw(lambda,phi){return[log(tan((halfPi$2+phi)/2)),-lambda]}function defaultSeparation(a,b){return a.parent===b.parent?1:2}function meanXReduce(x,c){return x+c.x}function maxYReduce(y,c){return Math.max(y,c.y)}function count(node){var sum=0,children=node.children,i=children&&children.length;if(i)for(;0<=--i;)sum+=children[i].value;else sum=1;node.value=sum}function hierarchy(data,children){var node,child,childs,i,n,root=new Node(data),valued=+data.value&&(root.value=data.value),nodes=[root];for(null==children&&(children=defaultChildren);node=nodes.pop();)if(valued&&(node.value=+node.data.value),(childs=children(node.data))&&(n=childs.length))for(node.children=new Array(n),i=n-1;0<=i;--i)nodes.push(child=node.children[i]=new Node(childs[i])),child.parent=node,child.depth=node.depth+1;return root.eachBefore(computeHeight)}function defaultChildren(d){return d.children}function copyData(node){node.data=node.data.data}function computeHeight(node){for(var height=0;node.height=height,(node=node.parent)&&node.height<++height;);}function Node(data){this.data=data,this.depth=this.height=0,this.parent=null}equalEarthRaw.invert=function(x,y){for(var delta,l=y,l2=l*l,l6=l2*l2*l2,i=0;i<12&&(l6=(l2=(l-=delta=(l*(A1+A2*l2+l6*(A3+A4*l2))-y)/(A1+3*A2*l2+l6*(7*A3+9*A4*l2)))*l)*l2*l2,!(abs(delta)<1e-12));++i);return[M*x*(A1+3*A2*l2+l6*(7*A3+9*A4*l2))/cos$1(l),asin(sin$1(l)/M)]},gnomonicRaw.invert=azimuthalInvert(atan),naturalEarth1Raw.invert=function(x,y){var phi=y,i=25;do{var phi2=phi*phi,delta=phi2*phi2}while(phi-=delta=(phi*(1.007226+phi2*(.015085+delta*(.028874*phi2-.044475-.005916*delta)))-y)/(1.007226+phi2*(.045255+delta*(.259866*phi2-.311325-.005916*11*delta))),abs(delta)>epsilon$2&&0<--i);return[x/(.8707+(phi2=phi*phi)*(phi2*(phi2*phi2*phi2*(.003971-.001529*phi2)-.013791)-.131979)),phi]},orthographicRaw.invert=azimuthalInvert(asin),stereographicRaw.invert=azimuthalInvert(function(z){return 2*atan(z)}),transverseMercatorRaw.invert=function(x,y){return[-y,2*atan(exp(x))-halfPi$2]},Node.prototype=hierarchy.prototype={constructor:Node,count:function node_count(){return this.eachAfter(count)},each:function node_each(callback){var node,current,children,i,n,next=[this];do{for(current=next.reverse(),next=[];node=current.pop();)if(callback(node),children=node.children)for(i=0,n=children.length;i<n;++i)next.push(children[i])}while(next.length);return this},eachAfter:function node_eachAfter(callback){for(var children,i,n,node=this,nodes=[node],next=[];node=nodes.pop();)if(next.push(node),children=node.children)for(i=0,n=children.length;i<n;++i)nodes.push(children[i]);for(;node=next.pop();)callback(node);return this},eachBefore:function node_eachBefore(callback){for(var node,children,i,nodes=[this];node=nodes.pop();)if(callback(node),children=node.children)for(i=children.length-1;0<=i;--i)nodes.push(children[i]);return this},sum:function node_sum(value){return this.eachAfter(function(node){for(var sum=+value(node.data)||0,children=node.children,i=children&&children.length;0<=--i;)sum+=children[i].value;node.value=sum})},sort:function node_sort(compare){return this.eachBefore(function(node){node.children&&node.children.sort(compare)})},path:function node_path(end){for(var start=this,ancestor=function leastCommonAncestor(a,b){if(a===b)return a;var aNodes=a.ancestors(),bNodes=b.ancestors(),c=null;a=aNodes.pop(),b=bNodes.pop();for(;a===b;)c=a,a=aNodes.pop(),b=bNodes.pop();return c}(start,end),nodes=[start];start!==ancestor;)start=start.parent,nodes.push(start);for(var k=nodes.length;end!==ancestor;)nodes.splice(k,0,end),end=end.parent;return nodes},ancestors:function node_ancestors(){for(var node=this,nodes=[node];node=node.parent;)nodes.push(node);return nodes},descendants:function node_descendants(){var nodes=[];return this.each(function(node){nodes.push(node)}),nodes},leaves:function node_leaves(){var leaves=[];return this.eachBefore(function(node){node.children||leaves.push(node)}),leaves},links:function node_links(){var root=this,links=[];return root.each(function(node){node!==root&&links.push({source:node.parent,target:node})}),links},copy:function node_copy(){return hierarchy(this).eachBefore(copyData)}};var slice$4=Array.prototype.slice;function enclose(circles){for(var p,e,i=0,n=(circles=function shuffle$1(array){for(var t,i,m=array.length;m;)i=Math.random()*m--|0,t=array[m],array[m]=array[i],array[i]=t;return array}(slice$4.call(circles))).length,B=[];i<n;)p=circles[i],e&&enclosesWeak(e,p)?++i:(e=function encloseBasis(B){switch(B.length){case 1:return function encloseBasis1(a){return{x:a.x,y:a.y,r:a.r}}(B[0]);case 2:return encloseBasis2(B[0],B[1]);case 3:return encloseBasis3(B[0],B[1],B[2])}}(B=function extendBasis(B,p){var i,j;if(enclosesWeakAll(p,B))return[p];for(i=0;i<B.length;++i)if(enclosesNot(p,B[i])&&enclosesWeakAll(encloseBasis2(B[i],p),B))return[B[i],p];for(i=0;i<B.length-1;++i)for(j=i+1;j<B.length;++j)if(enclosesNot(encloseBasis2(B[i],B[j]),p)&&enclosesNot(encloseBasis2(B[i],p),B[j])&&enclosesNot(encloseBasis2(B[j],p),B[i])&&enclosesWeakAll(encloseBasis3(B[i],B[j],p),B))return[B[i],B[j],p];throw new Error}(B,p)),i=0);return e}function enclosesNot(dy,b){var dr=dy.r-b.r,dx=b.x-dy.x,dy=b.y-dy.y;return dr<0||dr*dr<dx*dx+dy*dy}function enclosesWeak(dy,b){var dr=dy.r-b.r+1e-6,dx=b.x-dy.x,dy=b.y-dy.y;return 0<dr&&dx*dx+dy*dy<dr*dr}function enclosesWeakAll(a,B){for(var i=0;i<B.length;++i)if(!enclosesWeak(a,B[i]))return;return 1}function encloseBasis2(r21,l){var x1=r21.x,y1=r21.y,r1=r21.r,x2=l.x,y2=l.y,r2=l.r,x21=x2-x1,y21=y2-y1,r21=r2-r1,l=Math.sqrt(x21*x21+y21*y21);return{x:(x1+x2+x21/l*r21)/2,y:(y1+y2+y21/l*r21)/2,r:(l+r1+r2)/2}}function encloseBasis3(A,c3,d1){var x1=A.x,y1=A.y,C=A.r,x2=c3.x,y2=c3.y,d2=c3.r,ya=d1.x,r=d1.y,xa=d1.r,a2=x1-x2,yb=x1-ya,xb=y1-y2,b3=y1-r,A=d2-C,c3=xa-C,d1=x1*x1+y1*y1-C*C,d2=d1-x2*x2-y2*y2+d2*d2,ya=d1-ya*ya-r*r+xa*xa,r=yb*xb-a2*b3,xa=(xb*ya-b3*d2)/(2*r)-x1,xb=(b3*A-xb*c3)/r,ya=(yb*d2-a2*ya)/(2*r)-y1,yb=(a2*c3-yb*A)/r,A=xb*xb+yb*yb-1,r=2*(C+xa*xb+ya*yb),C=xa*xa+ya*ya-C*C,r=-(A?(r+Math.sqrt(r*r-4*A*C))/(2*A):C/r);return{x:x1+xa+xb*r,y:y1+ya+yb*r,r:r}}function place(b,a,c){var x,a2,y,b2,dx=b.x-a.x,dy=b.y-a.y,d2=dx*dx+dy*dy;d2?(a2=a.r+c.r,a2*=a2,b2=b.r+c.r,(b2*=b2)<a2?(x=(d2+b2-a2)/(2*d2),y=Math.sqrt(Math.max(0,b2/d2-x*x)),c.x=b.x-x*dx-y*dy,c.y=b.y-x*dy+y*dx):(x=(d2+a2-b2)/(2*d2),y=Math.sqrt(Math.max(0,a2/d2-x*x)),c.x=a.x+x*dx-y*dy,c.y=a.y+x*dy+y*dx)):(c.x=a.x+c.r,c.y=a.y)}function intersects(dy,b){var dr=dy.r+b.r-1e-6,dx=b.x-dy.x,dy=b.y-dy.y;return 0<dr&&dx*dx+dy*dy<dr*dr}function score(dx){var a=dx._,b=dx.next._,dy=a.r+b.r,dx=(a.x*b.r+b.x*a.r)/dy,dy=(a.y*b.r+b.y*a.r)/dy;return dx*dx+dy*dy}function Node$1(circle){this._=circle,this.next=null,this.previous=null}function packEnclose(circles){if(!(n=circles.length))return 0;var b,c,n,aa,ca,i,j,k,sj,sk,a=circles[0];if(a.x=0,a.y=0,!(1<n))return a.r;if(b=circles[1],a.x=-b.r,b.x=a.r,b.y=0,!(2<n))return a.r+b.r;place(b,a,c=circles[2]),a=new Node$1(a),b=new Node$1(b),c=new Node$1(c),((a.next=c.previous=b).next=a.previous=c).next=b.previous=a;pack:for(i=3;i<n;++i){place(a._,b._,c=circles[i]),c=new Node$1(c),j=b.next,k=a.previous,sj=b._.r,sk=a._.r;do{if(sj<=sk){if(intersects(j._,c._)){b=j,(a.next=b).previous=a,--i;continue pack}sj+=j._.r,j=j.next}else{if(intersects(k._,c._)){((a=k).next=b).previous=a,--i;continue pack}sk+=k._.r,k=k.previous}}while(j!==k.next);for(c.previous=a,c.next=b,a.next=b.previous=b=c,aa=score(a);(c=c.next)!==b;)(ca=score(c))<aa&&(a=c,aa=ca);b=a.next}for(a=[b._],c=b;(c=c.next)!==b;)a.push(c._);for(c=enclose(a),i=0;i<n;++i)(a=circles[i]).x-=c.x,a.y-=c.y;return c.r}function required(f){if("function"!=typeof f)throw new Error;return f}function constantZero(){return 0}function constant$9(x){return function(){return x}}function defaultRadius$1(d){return Math.sqrt(d.value)}function radiusLeaf(radius){return function(node){node.children||(node.r=Math.max(0,+radius(node)||0))}}function packChildren(padding,k){return function(node){if(children=node.children){var children,i,e,n=children.length,r=padding(node)*k||0;if(r)for(i=0;i<n;++i)children[i].r+=r;if(e=packEnclose(children),r)for(i=0;i<n;++i)children[i].r-=r;node.r=e+r}}}function translateChild(k){return function(node){var parent=node.parent;node.r*=k,parent&&(node.x=parent.x+k*node.x,node.y=parent.y+k*node.y)}}function roundNode(node){node.x0=Math.round(node.x0),node.y0=Math.round(node.y0),node.x1=Math.round(node.x1),node.y1=Math.round(node.y1)}function treemapDice(parent,x0,y0,x1,y1){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(x1-x0)/parent.value;++i<n;)(node=nodes[i]).y0=y0,node.y1=y1,node.x0=x0,node.x1=x0+=node.value*k}var preroot={depth:-1},ambiguous={};function defaultId(d){return d.id}function defaultParentId(d){return d.parentId}function defaultSeparation$1(a,b){return a.parent===b.parent?1:2}function nextLeft(v){var children=v.children;return children?children[0]:v.t}function nextRight(v){var children=v.children;return children?children[children.length-1]:v.t}function TreeNode(node,i){this._=node,this.parent=null,this.children=null,this.A=null,(this.a=this).z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=i}function treemapSlice(parent,x0,y0,x1,y1){for(var node,nodes=parent.children,i=-1,n=nodes.length,k=parent.value&&(y1-y0)/parent.value;++i<n;)(node=nodes[i]).x0=x0,node.x1=x1,node.y0=y0,node.y1=y0+=node.value*k}TreeNode.prototype=Object.create(Node.prototype);var catmullRom=(1+Math.sqrt(5))/2;function squarifyRatio(ratio,parent,x0,y0,x1,y1){for(var row,nodeValue,dx,dy,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta,rows=[],nodes=parent.children,i0=0,i1=0,n=nodes.length,value=parent.value;i0<n;){for(dx=x1-x0,dy=y1-y0;sumValue=nodes[i1++].value,!sumValue&&i1<n;);for(beta=(minValue=maxValue=sumValue)*sumValue*(alpha=Math.max(dy/dx,dx/dy)/(value*ratio)),minRatio=Math.max(maxValue/beta,beta/minValue);i1<n;++i1){if(sumValue+=nodeValue=nodes[i1].value,nodeValue<minValue&&(minValue=nodeValue),maxValue<nodeValue&&(maxValue=nodeValue),beta=sumValue*sumValue*alpha,minRatio<(newRatio=Math.max(maxValue/beta,beta/minValue))){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)}),row.dice?treemapDice(row,x0,y0,x1,value?y0+=dy*sumValue/value:y1):treemapSlice(row,x0,y0,value?x0+=dx*sumValue/value:x1,y1),value-=sumValue,i0=i1}return rows}var squarify=function custom(ratio){function squarify(parent,x0,y0,x1,y1){squarifyRatio(ratio,parent,x0,y0,x1,y1)}return squarify.ratio=function(x){return custom(1<(x=+x)?x:1)},squarify}(catmullRom);var resquarify=function custom(ratio){function resquarify(parent,x0,y0,x1,y1){if((rows=parent._squarify)&&rows.ratio===ratio)for(var rows,row,nodes,i,n,j=-1,m=rows.length,value=parent.value;++j<m;){for(nodes=(row=rows[j]).children,i=row.value=0,n=nodes.length;i<n;++i)row.value+=nodes[i].value;row.dice?treemapDice(row,x0,y0,x1,y0+=(y1-y0)*row.value/value):treemapSlice(row,x0,y0,x0+=(x1-x0)*row.value/value,y1),value-=row.value}else parent._squarify=rows=squarifyRatio(ratio,parent,x0,y0,x1,y1),rows.ratio=ratio}return resquarify.ratio=function(x){return custom(1<(x=+x)?x:1)},resquarify}(catmullRom);function lexicographicOrder(a,b){return a[0]-b[0]||a[1]-b[1]}function computeUpperHullIndexes(points){for(var n=points.length,indexes=[0,1],size=2,i=2;i<n;++i){for(;1<size&&function cross$1(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}(points[indexes[size-2]],points[indexes[size-1]],points[i])<=0;)--size;indexes[size++]=i}return indexes.slice(0,size)}function defaultSource$1(){return Math.random()}var uniform=function sourceRandomUniform(source){function randomUniform(min,max){return min=null==min?0:+min,max=null==max?1:+max,1===arguments.length?(max=min,min=0):max-=min,function(){return source()*max+min}}return randomUniform.source=sourceRandomUniform,randomUniform}(defaultSource$1),normal=function sourceRandomNormal(source){function randomNormal(mu,sigma){var x,r;return mu=null==mu?0:+mu,sigma=null==sigma?1:+sigma,function(){var y;if(null!=x)y=x,x=null;else for(;x=2*source()-1,y=2*source()-1,r=x*x+y*y,!r||1<r;);return mu+sigma*y*Math.sqrt(-2*Math.log(r)/r)}}return randomNormal.source=sourceRandomNormal,randomNormal}(defaultSource$1),logNormal=function sourceRandomLogNormal(source){function randomLogNormal(){var randomNormal=normal.source(source).apply(this,arguments);return function(){return Math.exp(randomNormal())}}return randomLogNormal.source=sourceRandomLogNormal,randomLogNormal}(defaultSource$1),irwinHall=function sourceRandomIrwinHall(source){function randomIrwinHall(n){return function(){for(var sum=0,i=0;i<n;++i)sum+=source();return sum}}return randomIrwinHall.source=sourceRandomIrwinHall,randomIrwinHall}(defaultSource$1),bates=function sourceRandomBates(source){function randomBates(n){var randomIrwinHall=irwinHall.source(source)(n);return function(){return randomIrwinHall()/n}}return randomBates.source=sourceRandomBates,randomBates}(defaultSource$1),exponential$1=function sourceRandomExponential(source){function randomExponential(lambda){return function(){return-Math.log(1-source())/lambda}}return randomExponential.source=sourceRandomExponential,randomExponential}(defaultSource$1);function initRange(domain,range){switch(arguments.length){case 0:break;case 1:this.range(domain);break;default:this.range(range).domain(domain)}return this}function initInterpolator(domain,interpolator){switch(arguments.length){case 0:break;case 1:this.interpolator(domain);break;default:this.interpolator(interpolator).domain(domain)}return this}var catmullRomClosed=Array.prototype,map$3=catmullRomClosed.map,slice$5=catmullRomClosed.slice,implicit={name:"implicit"};function ordinal(){var index=map$1(),domain=[],range=[],unknown=implicit;function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=map$1();for(var d,key,i=-1,n=_.length;++i<n;)index.has(key=(d=_[i])+"")||index.set(key,domain.push(d));return scale},scale.range=function(_){return arguments.length?(range=slice$5.call(_),scale):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal(domain,range).unknown(unknown)},initRange.apply(scale,arguments),scale}function band(){var step,bandwidth,scale=ordinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range,range=[0,1],round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){var values=domain().length,reverse=range[1]<range[0],start=range[+reverse],stop=range[1-reverse];step=(stop-start)/Math.max(1,values-paddingInner+2*paddingOuter),round&&(step=Math.floor(step)),start+=(stop-start-step*(values-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start=Math.round(start),bandwidth=Math.round(bandwidth));values=sequence(values).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?(range=[+_[0],+_[1]],rescale()):range.slice()},scale.rangeRound=function(_){return range=[+_[0],+_[1]],round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingInner=Math.min(1,paddingOuter=+_),rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.min(1,_),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=+_,rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.copy=function(){return band(domain(),range).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},initRange.apply(rescale(),arguments)}function number$2(x){return+x}var unit=[0,1];function identity$6(x){return x}function normalize(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:function constant$a(x){return function(){return x}}(isNaN(b)?NaN:.5)}function clamper(t){var a=t[0],b=t[t.length-1];return b<a&&(t=a,a=b,b=t),function(x){return Math.max(a,Math.min(b,x))}}function bimap(d1,r1,interpolate){var d0=d1[0],d1=d1[1],r0=r1[0],r1=r1[1],r0=d1<d0?(d0=normalize(d1,d0),interpolate(r1,r0)):(d0=normalize(d0,d1),interpolate(r0,r1));return function(x){return r0(d0(x))}}function polymap(domain,range,interpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;for(domain[j]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++i<j;)d[i]=normalize(domain[i],domain[i+1]),r[i]=interpolate(range[i],range[i+1]);return function(x){var i=bisectRight(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp()).unknown(source.unknown())}function transformer$1(){var transform,untransform,unknown,piecewise,output,input,domain=unit,range=unit,interpolate=interpolateValue,clamp=identity$6;function rescale(){return piecewise=2<Math.min(domain.length,range.length)?polymap:bimap,output=input=null,scale}function scale(x){return isNaN(x=+x)?unknown:(output=output||piecewise(domain.map(transform),range,interpolate))(transform(clamp(x)))}return scale.invert=function(y){return clamp(untransform((input=input||piecewise(range,domain.map(transform),interpolateNumber))(y)))},scale.domain=function(_){return arguments.length?(domain=map$3.call(_,number$2),clamp===identity$6||(clamp=clamper(domain)),rescale()):domain.slice()},scale.range=function(_){return arguments.length?(range=slice$5.call(_),rescale()):range.slice()},scale.rangeRound=function(_){return range=slice$5.call(_),interpolate=interpolateRound,rescale()},scale.clamp=function(_){return arguments.length?(clamp=_?clamper(domain):identity$6,scale):clamp!==identity$6},scale.interpolate=function(_){return arguments.length?(interpolate=_,rescale()):interpolate},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t,u){return transform=t,untransform=u,rescale()}}function continuous(transform,untransform){return transformer$1()(transform,untransform)}function tickFormat(start,stop,count,specifier){var precision,step=tickStep(start,stop,count);switch((specifier=formatSpecifier(null==specifier?",f":specifier)).type){case"s":var value=Math.max(Math.abs(start),Math.abs(stop));return null!=specifier.precision||isNaN(precision=precisionPrefix(step,value))||(specifier.precision=precision),exports.formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":null!=specifier.precision||isNaN(precision=precisionRound(step,Math.max(Math.abs(start),Math.abs(stop))))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":null!=specifier.precision||isNaN(precision=precisionFixed(step))||(specifier.precision=precision-2*("%"===specifier.type))}return exports.format(specifier)}function linearish(scale){var domain=scale.domain;return scale.ticks=function(count){var d=domain();return ticks(d[0],d[d.length-1],null==count?10:count)},scale.tickFormat=function(count,specifier){var d=domain();return tickFormat(d[0],d[d.length-1],null==count?10:count,specifier)},scale.nice=function(count){null==count&&(count=10);var step,d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1];return stop<start&&(step=start,start=stop,stop=step,step=i0,i0=i1,i1=step),0<(step=tickIncrement(start,stop,count))?step=tickIncrement(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step,count):step<0&&(step=tickIncrement(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step,count)),0<step?(d[i0]=Math.floor(start/step)*step,d[i1]=Math.ceil(stop/step)*step,domain(d)):step<0&&(d[i0]=Math.ceil(start*step)/step,d[i1]=Math.floor(stop*step)/step,domain(d)),scale},scale}function nice(domain,interval){var t,i0=0,i1=(domain=domain.slice()).length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(t=i0,i0=i1,i1=t,t=x0,x0=x1,x1=t),domain[i0]=interval.floor(x0),domain[i1]=interval.ceil(x1),domain}function transformLog(x){return Math.log(x)}function transformExp(x){return Math.exp(x)}function transformLogn(x){return-Math.log(-x)}function transformExpn(x){return-Math.exp(-x)}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function reflect(f){return function(x){return-f(-x)}}function loggish(transform){var logs,pows,scale=transform(transformLog,transformExp),domain=scale.domain,base=10;function rescale(){return logs=function logp(base){return base===Math.E?Math.log:10===base&&Math.log10||2===base&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}(base),pows=function powp(base){return 10===base?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}(base),domain()[0]<0?(logs=reflect(logs),pows=reflect(pows),transform(transformLogn,transformExpn)):transform(transformLog,transformExp),scale}return scale.base=function(_){return arguments.length?(base=+_,rescale()):base},scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.ticks=function(n){var r=domain(),u=r[0],v=r[r.length-1];(r=v<u)&&(i=u,u=v,v=i);var p,k,t,i=logs(u),j=logs(v),n=null==n?10:+n,z=[];if(!(base%1)&&j-i<n){if(i=Math.round(i)-1,j=Math.round(j)+1,0<u){for(;i<j;++i)for(k=1,p=pows(i);k<base;++k)if(!((t=p*k)<u)){if(v<t)break;z.push(t)}}else for(;i<j;++i)for(k=base-1,p=pows(i);1<=k;--k)if(!((t=p*k)<u)){if(v<t)break;z.push(t)}}else z=ticks(i,j,Math.min(j-i,n)).map(pows);return r?z.reverse():z},scale.tickFormat=function(count,specifier){if("function"!=typeof(specifier=null==specifier?10===base?".0e":",":specifier)&&(specifier=exports.format(specifier)),count===1/0)return specifier;null==count&&(count=10);var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));return i*base<base-.5&&(i*=base),i<=k?specifier(d):""}},scale.nice=function(){return domain(nice(domain(),{floor:function(x){return pows(Math.floor(logs(x)))},ceil:function(x){return pows(Math.ceil(logs(x)))}}))},scale}function transformSymlog(c){return function(x){return Math.sign(x)*Math.log1p(Math.abs(x/c))}}function transformSymexp(c){return function(x){return Math.sign(x)*Math.expm1(Math.abs(x))*c}}function symlogish(transform){var c=1,scale=transform(transformSymlog(c),transformSymexp(c));return scale.constant=function(_){return arguments.length?transform(transformSymlog(c=+_),transformSymexp(c)):c},linearish(scale)}function transformPow(exponent){return function(x){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}}function transformSqrt(x){return x<0?-Math.sqrt(-x):Math.sqrt(x)}function transformSquare(x){return x<0?-x*x:x*x}function powish(transform){var scale=transform(identity$6,identity$6),exponent=1;return scale.exponent=function(_){return arguments.length?(exponent=+_,function rescale(){return 1===exponent?transform(identity$6,identity$6):.5===exponent?transform(transformSqrt,transformSquare):transform(transformPow(exponent),transformPow(1/exponent))}()):exponent},linearish(scale)}function pow$1(){var scale=powish(transformer$1());return scale.copy=function(){return copy(scale,pow$1()).exponent(scale.exponent())},initRange.apply(scale,arguments),scale}var t0$1=new Date,t1$1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=0===arguments.length?new Date:new Date(+date)),date}return interval.floor=function(date){return floori(date=new Date(+date)),date},interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&0<step))return range;for(;range.push(previous=new Date(+start)),offseti(start,step),floori(start),previous<start&&start<stop;);return range},interval.filter=function(test){return newInterval(function(date){if(date<=date)for(;floori(date),!test(date);)date.setTime(date-1)},function(date,step){if(date<=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;0<=--step;)for(;offseti(date,1),!test(date););})},count&&(interval.count=function(start,end){return t0$1.setTime(+start),t1$1.setTime(+end),floori(t0$1),floori(t1$1),Math.floor(count(t0$1,t1$1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&0<step?1<step?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&0<k?1<k?newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k}):millisecond:null};var milliseconds=millisecond.range,second=newInterval(function(date){date.setTime(date-date.getMilliseconds())},function(date,step){date.setTime(+date+1e3*step)},function(start,end){return(end-start)/1e3},function(date){return date.getUTCSeconds()}),seconds=second.range,minute=newInterval(function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds())},function(date,step){date.setTime(+date+6e4*step)},function(start,end){return(end-start)/6e4},function(date){return date.getMinutes()}),minutes=minute.range,hour=newInterval(function(date){date.setTime(date-date.getMilliseconds()-1e3*date.getSeconds()-6e4*date.getMinutes())},function(date,step){date.setTime(+date+36e5*step)},function(start,end){return(end-start)/36e5},function(date){return date.getHours()}),hours=hour.range,day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/864e5},function(date){return date.getDate()-1}),days=day.range;function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+7*step)},function(start,end){return(end-start-6e4*(end.getTimezoneOffset()-start.getTimezoneOffset()))/6048e5})}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),sundays=sunday.range,mondays=monday.range,tuesdays=tuesday.range,wednesdays=wednesday.range,thursdays=thursday.range,fridays=friday.range,saturdays=saturday.range,month=newInterval(function(date){date.setDate(1),date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())},function(date){return date.getMonth()}),months=month.range,year=newInterval(function(date){date.setMonth(0,1),date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year.every=function(k){return isFinite(k=Math.floor(k))&&0<k?newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)}):null};var years=year.range,utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+6e4*step)},function(start,end){return(end-start)/6e4},function(date){return date.getUTCMinutes()}),utcMinutes=utcMinute.range,utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+36e5*step)},function(start,end){return(end-start)/36e5},function(date){return date.getUTCHours()}),utcHours=utcHour.range,utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/864e5},function(date){return date.getUTCDate()-1}),utcDays=utcDay.range;function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+7*step)},function(start,end){return(end-start)/6048e5})}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcSundays=utcSunday.range,utcMondays=utcMonday.range,utcTuesdays=utcTuesday.range,utcWednesdays=utcWednesday.range,utcThursdays=utcThursday.range,utcFridays=utcFriday.range,utcSaturdays=utcSaturday.range,utcMonth=newInterval(function(date){date.setUTCDate(1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+12*(end.getUTCFullYear()-start.getUTCFullYear())},function(date){return date.getUTCMonth()}),utcMonths=utcMonth.range,utcYear=newInterval(function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return isFinite(k=Math.floor(k))&&0<k?newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)}):null};var utcYears=utcYear.range;function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);return date.setFullYear(d.y),date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));return date.setUTCFullYear(d.y),date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newDate(y,m,d){return{y:y,m:m,d:d,H:0,M:0,S:0,L:0}}function formatLocale$1(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths,periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths),formats={a:function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]},A:function formatWeekday(d){return locale_weekdays[d.getDay()]},b:function formatShortMonth(d){return locale_shortMonths[d.getMonth()]},B:function formatMonth(d){return locale_months[d.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function formatPeriod(d){return locale_periods[+(12<=d.getHours())]},q:function formatQuarter(d){return 1+~~(d.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear$1,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},utcFormats={a:function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]},A:function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]},b:function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]},B:function formatUTCMonth(d){return locale_months[d.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function formatUTCPeriod(d){return locale_periods[+(12<=d.getUTCHours())]},q:function formatUTCQuarter(d){return 1+~~(d.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},parses={a:function parseShortWeekday(d,n,i){n=shortWeekdayRe.exec(n.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1},A:function parseWeekday(d,n,i){n=weekdayRe.exec(n.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1},b:function parseShortMonth(d,n,i){n=shortMonthRe.exec(n.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1},B:function parseMonth(d,n,i){n=monthRe.exec(n.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1},c:function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function parsePeriod(d,n,i){n=periodRe.exec(n.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)},X:function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function newFormat(specifier,formats){return function(date){var c,pad,format,string=[],i=-1,j=0,n=specifier.length;for(date instanceof Date||(date=new Date(+date));++i<n;)37===specifier.charCodeAt(i)&&(string.push(specifier.slice(j,i)),null!=(pad=pads[c=specifier.charAt(++i)])?c=specifier.charAt(++i):pad="e"===c?" ":"0",(format=formats[c])&&(c=format(date,pad)),string.push(c),j=i+1);return string.push(specifier.slice(j,i)),string.join("")}}function newParse(specifier,Z){return function(string){var week,day$1,d=newDate(1900,void 0,1);if(parseSpecifier(d,specifier,string+="",0)!=string.length)return null;if("Q"in d)return new Date(d.Q);if("s"in d)return new Date(1e3*d.s+("L"in d?d.L:0));if(!Z||"Z"in d||(d.Z=0),"p"in d&&(d.H=d.H%12+12*d.p),void 0===d.m&&(d.m="q"in d?d.q:0),"V"in d){if(d.V<1||53<d.V)return null;"w"in d||(d.w=1),"Z"in d?(week=4<(day$1=(week=utcDate(newDate(d.y,0,1))).getUTCDay())||0===day$1?utcMonday.ceil(week):utcMonday(week),week=utcDay.offset(week,7*(d.V-1)),d.y=week.getUTCFullYear(),d.m=week.getUTCMonth(),d.d=week.getUTCDate()+(d.w+6)%7):(week=4<(day$1=(week=localDate(newDate(d.y,0,1))).getDay())||0===day$1?monday.ceil(week):monday(week),week=day.offset(week,7*(d.V-1)),d.y=week.getFullYear(),d.m=week.getMonth(),d.d=week.getDate()+(d.w+6)%7)}else("W"in d||"U"in d)&&("w"in d||(d.w="u"in d?d.u%7:"W"in d?1:0),day$1="Z"in d?utcDate(newDate(d.y,0,1)).getUTCDay():localDate(newDate(d.y,0,1)).getDay(),d.m=0,d.d="W"in d?(d.w+6)%7+7*d.W-(day$1+5)%7:d.w+7*d.U-(day$1+6)%7);return"Z"in d?(d.H+=d.Z/100|0,d.M+=d.Z%100,utcDate(d)):localDate(d)}}function parseSpecifier(d,specifier,string,j){for(var c,parse,i=0,n=specifier.length,m=string.length;i<n;){if(m<=j)return-1;if(37===(c=specifier.charCodeAt(i++))){if(c=specifier.charAt(i++),!(parse=parses[c in pads?specifier.charAt(i++):c])||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}return formats.x=newFormat(locale_date,formats),formats.X=newFormat(locale_time,formats),formats.c=newFormat(locale_dateTime,formats),utcFormats.x=newFormat(locale_date,utcFormats),utcFormats.X=newFormat(locale_time,utcFormats),utcFormats.c=newFormat(locale_dateTime,utcFormats),{format:function(specifier){var f=newFormat(specifier+="",formats);return f.toString=function(){return specifier},f},parse:function(specifier){var p=newParse(specifier+="",!1);return p.toString=function(){return specifier},p},utcFormat:function(specifier){var f=newFormat(specifier+="",utcFormats);return f.toString=function(){return specifier},f},utcParse:function(specifier){var p=newParse(specifier+="",!0);return p.toString=function(){return specifier},p}}}var locale$1,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad$1(length,fill,width){var sign=length<0?"-":"",string=(sign?-length:length)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){for(var map={},i=-1,n=names.length;++i<n;)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumberSunday(d,n,i){n=numberRe.exec(n.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,n,i){n=numberRe.exec(n.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,n,i){n=numberRe.exec(n.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.y=+n[0]+(68<+n[0]?1900:2e3),i+n[0].length):-1}function parseZone(d,n,i){n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseQuarter(d,n,i){n=numberRe.exec(n.slice(i,i+1));return n?(d.q=3*n[0]-3,i+n[0].length):-1}function parseMonthNumber(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,n,i){n=numberRe.exec(n.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,n,i){n=numberRe.exec(n.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,n,i){n=numberRe.exec(n.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,n,i){n=numberRe.exec(n.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,n,i){n=percentRe.exec(n.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,n,i){n=numberRe.exec(n.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,n,i){n=numberRe.exec(n.slice(i));return n?(d.s=+n[0],i+n[0].length):-1}function formatDayOfMonth(d,p){return pad$1(d.getDate(),p,2)}function formatHour24(d,p){return pad$1(d.getHours(),p,2)}function formatHour12(d,p){return pad$1(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad$1(1+day.count(year(d),d),p,3)}function formatMilliseconds(d,p){return pad$1(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad$1(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad$1(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad$1(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(day){day=day.getDay();return 0===day?7:day}function formatWeekNumberSunday(d,p){return pad$1(sunday.count(year(d)-1,d),p,2)}function formatWeekNumberISO(d,p){var day=d.getDay();return d=4<=day||0===day?thursday(d):thursday.ceil(d),pad$1(thursday.count(year(d),d)+(4===year(d).getDay()),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad$1(monday.count(year(d)-1,d),p,2)}function formatYear$1(d,p){return pad$1(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad$1(d.getFullYear()%1e4,p,4)}function formatZone(z){z=z.getTimezoneOffset();return(0<z?"-":(z*=-1,"+"))+pad$1(z/60|0,"0",2)+pad$1(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad$1(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad$1(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad$1(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad$1(1+utcDay.count(utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad$1(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad$1(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad$1(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad$1(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(dow){dow=dow.getUTCDay();return 0===dow?7:dow}function formatUTCWeekNumberSunday(d,p){return pad$1(utcSunday.count(utcYear(d)-1,d),p,2)}function formatUTCWeekNumberISO(d,p){var day=d.getUTCDay();return d=4<=day||0===day?utcThursday(d):utcThursday.ceil(d),pad$1(utcThursday.count(utcYear(d),d)+(4===utcYear(d).getUTCDay()),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad$1(utcMonday.count(utcYear(d)-1,d),p,2)}function formatUTCYear(d,p){return pad$1(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad$1(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}function defaultLocale$1(definition){return locale$1=formatLocale$1(definition),exports.timeFormat=locale$1.format,exports.timeParse=locale$1.parse,exports.utcFormat=locale$1.utcFormat,exports.utcParse=locale$1.utcParse,locale$1}defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var formatIso=Date.prototype.toISOString?function formatIsoNative(date){return date.toISOString()}:exports.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");var parseIso=+new Date("2000-01-01T00:00:00.000Z")?function parseIsoNative(date){return date=new Date(date),isNaN(date)?null:date}:exports.utcParse("%Y-%m-%dT%H:%M:%S.%LZ"),durationSecond$1=1e3,durationMinute$1=60*durationSecond$1,durationHour$1=60*durationMinute$1,durationDay$1=24*durationHour$1,durationWeek$1=7*durationDay$1,durationMonth=30*durationDay$1,durationYear=365*durationDay$1;function date$1(t){return new Date(t)}function number$3(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(identity$6,identity$6),invert=scale.invert,domain=scale.domain,formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y"),tickIntervals=[[second,1,durationSecond$1],[second,5,5*durationSecond$1],[second,15,15*durationSecond$1],[second,30,30*durationSecond$1],[minute,1,durationMinute$1],[minute,5,5*durationMinute$1],[minute,15,15*durationMinute$1],[minute,30,30*durationMinute$1],[hour,1,durationHour$1],[hour,3,3*durationHour$1],[hour,6,6*durationHour$1],[hour,12,12*durationHour$1],[day,1,durationDay$1],[day,2,2*durationDay$1],[week,1,durationWeek$1],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){var target,i;return"number"==typeof(interval=null==interval?10:interval)&&(target=Math.abs(stop-start)/interval,interval=(i=bisector(function(i){return i[2]}).right(tickIntervals,target))===tickIntervals.length?(step=tickStep(start/durationYear,stop/durationYear,interval),year):i?(step=(i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i])[1],i[0]):(step=Math.max(tickStep(start,stop,interval),1),millisecond)),null==step?interval:interval.every(step)}return scale.invert=function(y){return new Date(invert(y))},scale.domain=function(_){return arguments.length?domain(map$3.call(_,number$3)):domain().map(date$1)},scale.ticks=function(interval,step){var t,r=domain(),t0=r[0],t1=r[r.length-1],r=t1<t0;return r&&(t=t0,t0=t1,t1=t),t=(t=tickInterval(interval,t0,t1,step))?t.range(t0,t1+1):[],r?t.reverse():t},scale.tickFormat=function(count,specifier){return null==specifier?tickFormat:format(specifier)},scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale},scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))},scale}function transformer$2(){var t0,t1,k10,transform,unknown,x0=0,x1=1,interpolator=identity$6,clamp=!1;function scale(x){return isNaN(x=+x)?unknown:interpolator(0===k10?.5:(x=(transform(x)-t0)*k10,clamp?Math.max(0,Math.min(1,x)):x))}return scale.domain=function(_){return arguments.length?(t0=transform(x0=+_[0]),t1=transform(x1=+_[1]),k10=t0===t1?0:1/(t1-t0),scale):[x0,x1]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t){return t0=(transform=t)(x0),t1=t(x1),k10=t0===t1?0:1/(t1-t0),scale}}function copy$1(source,target){return target.domain(source.domain()).interpolator(source.interpolator()).clamp(source.clamp()).unknown(source.unknown())}function sequentialPow(){var scale=powish(transformer$2());return scale.copy=function(){return copy$1(scale,sequentialPow()).exponent(scale.exponent())},initInterpolator.apply(scale,arguments)}function transformer$3(){var t0,t1,t2,k10,k21,transform,unknown,x0=0,x1=.5,x2=1,interpolator=identity$6,clamp=!1;function scale(x){return isNaN(x=+x)?unknown:(x=.5+((x=+transform(x))-t1)*(x<t1?k10:k21),interpolator(clamp?Math.max(0,Math.min(1,x)):x))}return scale.domain=function(_){return arguments.length?(t0=transform(x0=+_[0]),t1=transform(x1=+_[1]),t2=transform(x2=+_[2]),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1),scale):[x0,x1,x2]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},function(t){return t0=(transform=t)(x0),t1=t(x1),t2=t(x2),k10=t0===t1?0:.5/(t1-t0),k21=t1===t2?0:.5/(t2-t1),scale}}function divergingPow(){var scale=powish(transformer$3());return scale.copy=function(){return copy$1(scale,divergingPow()).exponent(scale.exponent())},initInterpolator.apply(scale,arguments)}function colors(specifier){for(var n=specifier.length/6|0,colors=new Array(n),i=0;i<n;)colors[i]="#"+specifier.slice(6*i,6*++i);return colors}var category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Accent=colors("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),Dark2=colors("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Paired=colors("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Pastel1=colors("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Pastel2=colors("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Set1=colors("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Set2=colors("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Set3=colors("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),Tableau10=colors("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function ramp(scheme){return rgbBasis(scheme[scheme.length-1])}var scheme=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(colors),BrBG=ramp(scheme),scheme$1=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(colors),PRGn=ramp(scheme$1),scheme$2=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(colors),PiYG=ramp(scheme$2),scheme$3=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(colors),PuOr=ramp(scheme$3),scheme$4=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(colors),RdBu=ramp(scheme$4),scheme$5=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(colors),RdGy=ramp(scheme$5),scheme$6=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(colors),RdYlBu=ramp(scheme$6),scheme$7=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(colors),RdYlGn=ramp(scheme$7),scheme$8=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(colors),Spectral=ramp(scheme$8),scheme$9=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(colors),BuGn=ramp(scheme$9),scheme$a=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(colors),BuPu=ramp(scheme$a),scheme$b=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(colors),GnBu=ramp(scheme$b),scheme$c=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(colors),OrRd=ramp(scheme$c),scheme$d=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(colors),PuBuGn=ramp(scheme$d),scheme$e=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(colors),PuBu=ramp(scheme$e),scheme$f=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(colors),PuRd=ramp(scheme$f),scheme$g=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(colors),RdPu=ramp(scheme$g),scheme$h=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(colors),YlGnBu=ramp(scheme$h),scheme$i=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(colors),YlGn=ramp(scheme$i),scheme$j=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(colors),YlOrBr=ramp(scheme$j),scheme$k=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(colors),YlOrRd=ramp(scheme$k),scheme$l=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(colors),Blues=ramp(scheme$l),scheme$m=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(colors),Greens=ramp(scheme$m),scheme$n=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(colors),Greys=ramp(scheme$n),scheme$o=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(colors),Purples=ramp(scheme$o),scheme$p=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(colors),Reds=ramp(scheme$p),scheme$q=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(colors),Oranges=ramp(scheme$q);var cubehelix$3=cubehelixLong(cubehelix(300,.5,0),cubehelix(-240,.5,1)),warm=cubehelixLong(cubehelix(-100,.75,.35),cubehelix(80,1.5,.8)),cool=cubehelixLong(cubehelix(260,.75,.35),cubehelix(80,1.5,.8)),c=cubehelix();var c$1=rgb(),pi_1_3=Math.PI/3,pi_2_3=2*Math.PI/3;function ramp$1(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}var viridis=ramp$1(colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),magma=ramp$1(colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),inferno=ramp$1(colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),plasma=ramp$1(colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function constant$b(x){return function constant(){return x}}var abs$1=Math.abs,atan2$1=Math.atan2,cos$2=Math.cos,max$2=Math.max,min$1=Math.min,sin$2=Math.sin,sqrt$2=Math.sqrt,epsilon$3=1e-12,pi$4=Math.PI,halfPi$3=pi$4/2,tau$4=2*pi$4;function asin$1(x){return 1<=x?halfPi$3:x<=-1?-halfPi$3:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function cornerTangents(dx,cy1,dy0,r,r1,D,cy0){var dy1=dx-dy0,cx0=cy1-r,dx1=(cy0?D:-D)/sqrt$2(dy1*dy1+cx0*cx0),ox=dx1*cx0,oy=-dx1*dy1,dx0=dx+ox,cx1=cy1+oy,cy0=dy0+ox,cx0=r+oy,dx1=(dx0+cy0)/2,dy1=(cx1+cx0)/2,dx=cy0-dx0,cy1=cx0-cx1,dy0=dx*dx+cy1*cy1,r=r1-D,D=dx0*cx0-cy0*cx1,dx0=(cy1<0?-1:1)*sqrt$2(max$2(0,r*r*dy0-D*D)),cx0=(D*cy1-dx*dx0)/dy0,cy0=(-D*dx-cy1*dx0)/dy0,cx1=(D*cy1+dx*dx0)/dy0,cy1=(-D*dx+cy1*dx0)/dy0,dx0=cx0-dx1,dy0=cy0-dy1,dx1=cx1-dx1,dy1=cy1-dy1;return dx1*dx1+dy1*dy1<dx0*dx0+dy0*dy0&&(cx0=cx1,cy0=cy1),{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function Linear(context){this._context=context}function curveLinear(context){return new Linear(context)}function x$3(p){return p[0]}function y$3(p){return p[1]}function line(){var x=x$3,y=y$3,defined=constant$b(!0),context=null,curve=curveLinear,output=null;function line(data){var i,d,buffer,n=data.length,defined0=!1;for(null==context&&(output=curve(buffer=path())),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&((defined0=!defined0)?output.lineStart():output.lineEnd()),defined0&&output.point(+x(d,i,data),+y(d,i,data));if(buffer)return output=null,buffer+""||null}return line.x=function(_){return arguments.length?(x="function"==typeof _?_:constant$b(+_),line):x},line.y=function(_){return arguments.length?(y="function"==typeof _?_:constant$b(+_),line):y},line.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant$b(!!_),line):defined},line.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),line):curve},line.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),line):context},line}function area$3(){var x0=x$3,x1=null,y0=constant$b(0),y1=y$3,defined=constant$b(!0),context=null,curve=curveLinear,output=null;function area(data){var i,j,k,d,buffer,n=data.length,defined0=!1,x0z=new Array(n),y0z=new Array(n);for(null==context&&(output=curve(buffer=path())),i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0)if(defined0=!defined0)j=i,output.areaStart(),output.lineStart();else{for(output.lineEnd(),output.lineStart(),k=i-1;j<=k;--k)output.point(x0z[k],y0z[k]);output.lineEnd(),output.areaEnd()}defined0&&(x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data),output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i]))}if(buffer)return output=null,buffer+""||null}function arealine(){return line().defined(defined).curve(curve).context(context)}return area.x=function(_){return arguments.length?(x0="function"==typeof _?_:constant$b(+_),x1=null,area):x0},area.x0=function(_){return arguments.length?(x0="function"==typeof _?_:constant$b(+_),area):x0},area.x1=function(_){return arguments.length?(x1=null==_?null:"function"==typeof _?_:constant$b(+_),area):x1},area.y=function(_){return arguments.length?(y0="function"==typeof _?_:constant$b(+_),y1=null,area):y0},area.y0=function(_){return arguments.length?(y0="function"==typeof _?_:constant$b(+_),area):y0},area.y1=function(_){return arguments.length?(y1=null==_?null:"function"==typeof _?_:constant$b(+_),area):y1},area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)},area.lineY1=function(){return arealine().x(x0).y(y1)},area.lineX1=function(){return arealine().x(x1).y(y0)},area.defined=function(_){return arguments.length?(defined="function"==typeof _?_:constant$b(!!_),area):defined},area.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),area):curve},area.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),area):context},area}function descending$1(a,b){return b<a?-1:a<b?1:a<=b?0:NaN}function identity$8(d){return d}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y)}}};var curveRadialLinear=curveRadial(curveLinear);function Radial(curve){this._curve=curve}function curveRadial(curve){function radial(context){return new Radial(curve(context))}return radial._curve=curve,radial}function lineRadial(l){var c=l.curve;return l.angle=l.x,delete l.x,l.radius=l.y,delete l.y,l.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve},l}function lineRadial$1(){return lineRadial(line().curve(curveRadialLinear))}function areaRadial(){var a=area$3().curve(curveRadialLinear),c=a.curve,x0=a.lineX0,x1=a.lineX1,y0=a.lineY0,y1=a.lineY1;return a.angle=a.x,delete a.x,a.startAngle=a.x0,delete a.x0,a.endAngle=a.x1,delete a.x1,a.radius=a.y,delete a.y,a.innerRadius=a.y0,delete a.y0,a.outerRadius=a.y1,delete a.y1,a.lineStartAngle=function(){return lineRadial(x0())},delete a.lineX0,a.lineEndAngle=function(){return lineRadial(x1())},delete a.lineX1,a.lineInnerRadius=function(){return lineRadial(y0())},delete a.lineY0,a.lineOuterRadius=function(){return lineRadial(y1())},delete a.lineY1,a.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve},a}function pointRadial(x,y){return[(y=+y)*Math.cos(x-=Math.PI/2),y*Math.sin(x)]}Radial.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};var slice$6=Array.prototype.slice;function linkSource(d){return d.source}function linkTarget(d){return d.target}function link$2(curve){var source=linkSource,target=linkTarget,x=x$3,y=y$3,context=null;function link(){var buffer,argv=slice$6.call(arguments),s=source.apply(this,argv),t=target.apply(this,argv);if(context=context||(buffer=path()),curve(context,+x.apply(this,(argv[0]=s,argv)),+y.apply(this,argv),+x.apply(this,(argv[0]=t,argv)),+y.apply(this,argv)),buffer)return context=null,buffer+""||null}return link.source=function(_){return arguments.length?(source=_,link):source},link.target=function(_){return arguments.length?(target=_,link):target},link.x=function(_){return arguments.length?(x="function"==typeof _?_:constant$b(+_),link):x},link.y=function(_){return arguments.length?(y="function"==typeof _?_:constant$b(+_),link):y},link.context=function(_){return arguments.length?(context=null==_?null:_,link):context},link}function curveHorizontal(context,x0,y0,x1,y1){context.moveTo(x0,y0),context.bezierCurveTo(x0=(x0+x1)/2,y0,x0,y1,x1,y1)}function curveVertical(context,x0,y0,x1,y1){context.moveTo(x0,y0),context.bezierCurveTo(x0,y0=(y0+y1)/2,x1,y0,x1,y1)}function curveRadial$1(context,p1,p2,x1,p3){var p0=pointRadial(p1,p2),p1=pointRadial(p1,p2=(p2+p3)/2),p2=pointRadial(x1,p2),p3=pointRadial(x1,p3);context.moveTo(p0[0],p0[1]),context.bezierCurveTo(p1[0],p1[1],p2[0],p2[1],p3[0],p3[1])}var circle$2={draw:function(context,r){r=Math.sqrt(r/pi$4);context.moveTo(r,0),context.arc(0,0,r,0,tau$4)}},cross$2={draw:function(context,r){r=Math.sqrt(r/5)/2;context.moveTo(-3*r,-r),context.lineTo(-r,-r),context.lineTo(-r,-3*r),context.lineTo(r,-3*r),context.lineTo(r,-r),context.lineTo(3*r,-r),context.lineTo(3*r,r),context.lineTo(r,r),context.lineTo(r,3*r),context.lineTo(-r,3*r),context.lineTo(-r,r),context.lineTo(-3*r,r),context.closePath()}},tan30=Math.sqrt(1/3),tan30_2=2*tan30,diamond={draw:function(context,x){var y=Math.sqrt(x/tan30_2),x=y*tan30;context.moveTo(0,-y),context.lineTo(x,0),context.lineTo(0,y),context.lineTo(-x,0),context.closePath()}},catmullRomOpen=Math.sin(pi$4/10)/Math.sin(7*pi$4/10),kx=Math.sin(tau$4/10)*catmullRomOpen,ky=-Math.cos(tau$4/10)*catmullRomOpen,star={draw:function(context,size){var r=Math.sqrt(.8908130915292852*size),x=kx*r,y=ky*r;context.moveTo(0,-r),context.lineTo(x,y);for(var i=1;i<5;++i){var s=tau$4*i/5,c=Math.cos(s),s=Math.sin(s);context.lineTo(s*r,-c*r),context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}},square={draw:function(context,x){var w=Math.sqrt(x),x=-w/2;context.rect(x,x,w,w)}},sqrt3=Math.sqrt(3),triangle={draw:function(context,y){y=-Math.sqrt(y/(3*sqrt3));context.moveTo(0,2*y),context.lineTo(-sqrt3*y,-y),context.lineTo(sqrt3*y,-y),context.closePath()}},s=Math.sqrt(3)/2,k=1/Math.sqrt(12),a=3*(k/2+1),wye={draw:function(context,x2){var y2=Math.sqrt(x2/a),x0=y2/2,y0=y2*k,x1=x0,y1=y2*k+y2,x2=-x1,y2=y1;context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.lineTo(-.5*x0-s*y0,s*x0+-.5*y0),context.lineTo(-.5*x1-s*y1,s*x1+-.5*y1),context.lineTo(-.5*x2-s*y2,s*x2+-.5*y2),context.lineTo(-.5*x0+s*y0,-.5*y0-s*x0),context.lineTo(-.5*x1+s*y1,-.5*y1-s*x1),context.lineTo(-.5*x2+s*y2,-.5*y2-s*x2),context.closePath()}},symbols=[circle$2,cross$2,diamond,square,star,triangle,wye];function noop$3(){}function point$2(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}function BasisClosed(context){this._context=context}function BasisOpen(context){this._context=context}function Bundle(context,beta){this._basis=new Basis(context),this._beta=beta}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point$2(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point$2(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},BasisClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x2=x,this._y2=y;break;case 1:this._point=2,this._x3=x,this._y3=y;break;case 2:this._point=3,this._x4=x,this._y4=y,this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:point$2(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:point$2(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}},Bundle.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var x=this._x,y=this._y,j=x.length-1;if(0<j)for(var t,x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1;++i<=j;)t=i/j,this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy));this._x=this._y=null,this._basis.lineEnd()},point:function(x,y){this._x.push(+x),this._y.push(+y)}};bundle=function custom(beta){function bundle(context){return 1===beta?new Basis(context):new Bundle(context,beta)}return bundle.beta=function(beta){return custom(+beta)},bundle}(.85);function point$3(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context,this._k=(1-tension)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$3(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2,this._x1=x,this._y1=y;break;case 2:this._point=3;default:point$3(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};cardinal=function custom(tension){function cardinal(context){return new Cardinal(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function CardinalClosed(context,tension){this._context=context,this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:point$3(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};cardinalClosed=function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function CardinalOpen(context,tension){this._context=context,this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$3(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};cardinalOpen=function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal}(0);function point$4(that,x,y){var b,m,x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;that._l01_a>epsilon$3&&(b=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,m=3*that._l01_a*(that._l01_a+that._l12_a),x1=(x1*b-that._x0*that._l12_2a+that._x2*that._l01_2a)/m,y1=(y1*b-that._y0*that._l12_2a+that._y2*that._l01_2a)/m),that._l23_a>epsilon$3&&(b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a),x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m,y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m),that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context,this._alpha=alpha}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){var x23,y23;switch(x=+x,y=+y,this._point&&(x23=this._x2-x,y23=this._y2-y,this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))),this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:point$4(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context,this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(x,y){var x23,y23;switch(x=+x,y=+y,this._point&&(x23=this._x2-x,y23=this._y2-y,this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))),this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:point$4(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};catmullRomClosed=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function CatmullRomOpen(context,alpha){this._context=context,this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){var x23,y23;switch(x=+x,y=+y,this._point&&(x23=this._x2-x,y23=this._y2-y,this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))),this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$4(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};catmullRomOpen=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function LinearClosed(context){this._context=context}function slope3(s1,s0,y2){var h0=s1._x1-s1._x0,p=s0-s1._x1,s0=(s1._y1-s1._y0)/(h0||p<0&&-0),s1=(y2-s1._y1)/(p||h0<0&&-0),p=(s0*p+s1*h0)/(h0+p);return((s0<0?-1:1)+(s1<0?-1:1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function point$5(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}function MonotoneY(context){this._context=new ReflectContext(context)}function ReflectContext(context){this._context=context}function Natural(context){this._context=context}function controlPoints(x){var i,m,n=x.length-1,a=new Array(n),b=new Array(n),r=new Array(n);for(b[a[0]=0]=2,r[0]=x[0]+2*x[1],i=1;i<n-1;++i)a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1];for(a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n],i=1;i<n;++i)m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1];for(a[n-1]=r[n-1]/b[n-1],i=n-2;0<=i;--i)a[i]=(r[i]-a[i+1])/b[i];for(b[n-1]=(x[n]+a[n-1])/2,i=0;i<n-1;++i)b[i]=2*x[i+1]-a[i+1];return[a,b]}function Step(context,t){this._context=context,this._t=t}function none$1(series,order){if(1<(n=series.length))for(var j,s0,n,i=1,s1=series[order[0]],m=s1.length;i<n;++i)for(s0=s1,s1=series[order[i]],j=0;j<m;++j)s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}function none$2(series){for(var n=series.length,o=new Array(n);0<=--n;)o[n]=n;return o}function stackValue(d,key){return d[key]}function appearance(series){var peaks=series.map(peak);return none$2(series).sort(function(a,b){return peaks[a]-peaks[b]})}function peak(series){for(var vi,i=-1,j=0,n=series.length,vj=-1/0;++i<n;)(vi=+series[i][1])>vj&&(vj=vi,j=i);return j}function ascending$3(series){var sums=series.map(sum$2);return none$2(series).sort(function(a,b){return sums[a]-sums[b]})}function sum$2(series){for(var v,s=0,i=-1,n=series.length;++i<n;)(v=+series[i][1])&&(s+=v);return s}function constant$c(x){return function(){return x}}function x$4(d){return d[0]}function y$4(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}function RedBlackRotateLeft(tree,parent){var p=parent,q=parent.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function RedBlackRotateRight(tree,parent){var p=parent,q=parent.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function RedBlackFirst(node){for(;node.L;)node=node.L;return node}function createEdge(left,right,v0,v1){var edge=[null,null],index=edges.push(edge)-1;return edge.left=left,edge.right=right,v0&&setEdgeEnd(edge,left,right,v0),v1&&setEdgeEnd(edge,right,left,v1),cells[left.index].halfedges.push(index),cells[right.index].halfedges.push(index),edge}function createBorderEdge(left,v0,edge){edge=[v0,edge];return edge.left=left,edge}function setEdgeEnd(edge,left,right,vertex){edge[0]||edge[1]?edge.left===right?edge[1]=vertex:edge[0]=vertex:(edge[0]=vertex,edge.left=left,edge.right=right)}function clipEdges(x0,y0,x1,y1){for(var edge,i=edges.length;i--;)(function connectEdge(edge,x0,y0,x1,y1){var v1=edge[1];if(v1)return 1;var v0=edge[0],fb=edge.left,fm=edge.right,lx=fb[0],ly=fb[1],rx=fm[0],ry=fm[1],fb=(lx+rx)/2,fm=(ly+ry)/2;if(ry===ly){if(fb<x0||x1<=fb)return;if(rx<lx){if(v0){if(v0[1]>=y1)return}else v0=[fb,y0];v1=[fb,y1]}else{if(v0){if(v0[1]<y0)return}else v0=[fb,y1];v1=[fb,y0]}}else if(fb=fm-(fm=(lx-rx)/(ry-ly))*fb,fm<-1||1<fm)if(rx<lx){if(v0){if(v0[1]>=y1)return}else v0=[(y0-fb)/fm,y0];v1=[(y1-fb)/fm,y1]}else{if(v0){if(v0[1]<y0)return}else v0=[(y1-fb)/fm,y1];v1=[(y0-fb)/fm,y0]}else if(ly<ry){if(v0){if(v0[0]>=x1)return}else v0=[x0,fm*x0+fb];v1=[x1,fm*x1+fb]}else{if(v0){if(v0[0]<x0)return}else v0=[x1,fm*x1+fb];v1=[x0,fm*x0+fb]}return edge[0]=v0,edge[1]=v1,1})(edge=edges[i],x0,y0,x1,y1)&&function clipEdge(edge,r,y0,x1,y1){var dx=edge[0],dy=edge[1],ax=dx[0],ay=dx[1],t0=0,t1=1,dx=dy[0]-ax,dy=dy[1]-ay,r=r-ax;if(dx||!(0<r)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dx){if(t1<r)return;t0<r&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dx){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(0<r)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(0<dy){if(t1<r)return;t0<r&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(t1<r)return;t0<r&&(t0=r)}else if(0<dy){if(r<t0)return;r<t1&&(t1=r)}return 0<t0||t1<1?(0<t0&&(edge[0]=[ax+t0*dx,ay+t0*dy]),t1<1&&(edge[1]=[ax+t1*dx,ay+t1*dy]),1):1}}}}}(edge,x0,y0,x1,y1)&&(Math.abs(edge[0][0]-edge[1][0])>epsilon$4||Math.abs(edge[0][1]-edge[1][1])>epsilon$4)||delete edges[i]}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function sortCellHalfedges(){for(var cell,halfedges,m,i=0,n=cells.length;i<n;++i)if((cell=cells[i])&&(m=(halfedges=cell.halfedges).length)){for(var index=new Array(m),array=new Array(m),j=0;j<m;++j)index[j]=j,array[j]=function cellHalfedgeAngle(vb,edge){var site=vb.site,va=edge.left,vb=edge.right;return site===vb&&(vb=va,va=site),vb?Math.atan2(vb[1]-va[1],vb[0]-va[0]):(vb=site===va?(va=edge[1],edge[0]):(va=edge[0],edge[1]),Math.atan2(va[0]-vb[0],vb[1]-va[1]))}(cell,edges[halfedges[j]]);for(index.sort(function(i,j){return array[j]-array[i]}),j=0;j<m;++j)array[j]=halfedges[index[j]];for(j=0;j<m;++j)halfedges[j]=array[j]}}function clipCells(x0,y0,x1,y1){var cell,site,iHalfedge,halfedges,nHalfedges,startX,startY,end,endX,endY,nCells=cells.length,cover=!0;for(iCell=0;iCell<nCells;++iCell)if(cell=cells[iCell]){for(site=cell.site,iHalfedge=(halfedges=cell.halfedges).length;iHalfedge--;)edges[halfedges[iHalfedge]]||halfedges.splice(iHalfedge,1);for(iHalfedge=0,nHalfedges=halfedges.length;iHalfedge<nHalfedges;)endX=(end=function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}(cell,edges[halfedges[iHalfedge]]))[0],endY=end[1],startX=(startY=cellHalfedgeStart(cell,edges[halfedges[++iHalfedge%nHalfedges]]))[0],startY=startY[1],(Math.abs(endX-startX)>epsilon$4||Math.abs(endY-startY)>epsilon$4)&&(halfedges.splice(iHalfedge,0,edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<epsilon$4&&epsilon$4<y1-endY?[x0,Math.abs(startX-x0)<epsilon$4?startY:y1]:Math.abs(endY-y1)<epsilon$4&&epsilon$4<x1-endX?[Math.abs(startY-y1)<epsilon$4?startX:x1,y1]:Math.abs(endX-x1)<epsilon$4&&epsilon$4<endY-y0?[x1,Math.abs(startX-x1)<epsilon$4?startY:y0]:Math.abs(endY-y0)<epsilon$4&&epsilon$4<endX-x0?[Math.abs(startY-y0)<epsilon$4?startX:x0,y0]:null))-1),++nHalfedges);nHalfedges&&(cover=!1)}if(cover){for(var d2,v00,v01,v11,v10,dc=1/0,iCell=0,cover=null;iCell<nCells;++iCell)(cell=cells[iCell])&&(d2=(d2=(site=cell.site)[0]-x0)*d2+(d2=site[1]-y0)*d2)<dc&&(dc=d2,cover=cell);cover&&(v00=[x0,y0],v01=[x0,y1],v11=[x1,y1],v10=[x1,y0],cover.halfedges.push(edges.push(createBorderEdge(site=cover.site,v00,v01))-1,edges.push(createBorderEdge(site,v01,v11))-1,edges.push(createBorderEdge(site,v11,v10))-1,edges.push(createBorderEdge(site,v10,v00))-1))}for(iCell=0;iCell<nCells;++iCell)(cell=cells[iCell])&&(cell.halfedges.length||delete cells[iCell])}LinearClosed.prototype={areaStart:noop$3,areaEnd:noop$3,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(x,y){x=+x,y=+y,this._point?this._context.lineTo(x,y):(this._point=1,this._context.moveTo(x,y))}},MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$5(this,this._t0,slope2(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(x,y){var t1=NaN;if(y=+y,(x=+x)!==this._x1||y!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,point$5(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:point$5(this,this._t0,t1=slope3(this,x,y))}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y,this._t0=t1}}},(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)},ReflectContext.prototype={moveTo:function(x,y){this._context.moveTo(y,x)},closePath:function(){this._context.closePath()},lineTo:function(x,y){this._context.lineTo(y,x)},bezierCurveTo:function(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}},Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var x=this._x,y=this._y,n=x.length;if(n)if(this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]),2===n)this._context.lineTo(x[1],y[1]);else for(var px=controlPoints(x),py=controlPoints(y),i0=0,i1=1;i1<n;++i0,++i1)this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(x,y){this._x.push(+x),this._y.push(+y)}},Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),0<=this._line&&(this._t=1-this._t,this._line=1-this._line)},point:function(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:var x1;this._t<=0?(this._context.lineTo(this._x,y),this._context.lineTo(x,y)):(x1=this._x*(1-this._t)+x*this._t,this._context.lineTo(x1,this._y),this._context.lineTo(x1,y))}this._x=x,this._y=y}},RedBlackTree.prototype={constructor:RedBlackTree,insert:function(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else parent=this._?(after=RedBlackFirst(this._),node.P=null,(node.N=after).P=after.L=node,after):(node.P=node.N=null,this._=node,null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)parent===(grandpa=parent.U).L?(uncle=grandpa.R)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(RedBlackRotateLeft(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,RedBlackRotateRight(this,grandpa)):(uncle=grandpa.L)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(RedBlackRotateRight(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,RedBlackRotateLeft(this,grandpa)),parent=after.U;this._.C=!1},remove:function(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var sibling,red,parent=node.U,left=node.L,right=node.R,next=left?right?RedBlackFirst(right):left:right;if(parent?parent.L===node?parent.L=next:parent.R=next:this._=next,left&&right?(red=next.C,next.C=node.C,((next.L=left).U=next)!==right?(parent=next.U,next.U=node.U,node=next.R,parent.L=node,(next.R=right).U=next):(next.U=parent,node=(parent=next).R)):(red=node.C,node=next),node&&(node.U=parent),!red)if(node&&node.C)node.C=!1;else{do{if(node===this._)break;if(node===parent.L){if((sibling=parent.R).C&&(sibling.C=!1,parent.C=!0,RedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.R&&sibling.R.C||(sibling.L.C=!1,sibling.C=!0,RedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,RedBlackRotateLeft(this,parent),node=this._;break}}else if((sibling=parent.L).C&&(sibling.C=!1,parent.C=!0,RedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.L&&sibling.L.C||(sibling.R.C=!1,sibling.C=!0,RedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,RedBlackRotateRight(this,parent),node=this._;break}}while(sibling.C=!0,parent=(node=parent).U,!node.C);node&&(node.C=!1)}}};var firstCircle,circlePool=[];function Circle(){RedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null}function attachCircle(arc){var cy=arc.P,y=arc.N;if(cy&&y){var ha=cy.site,cSite=arc.site,hc=y.site;if(ha!==hc){var bx=cSite[0],by=cSite[1],ax=ha[0]-bx,x=ha[1]-by,cx=hc[0]-bx,cy=hc[1]-by,y=2*(ax*cy-x*cx);if(!(-epsilon2$2<=y)){var ha=ax*ax+x*x,hc=cx*cx+cy*cy,x=(cy*ha-x*hc)/y,y=(ax*hc-cx*ha)/y,circle=circlePool.pop()||new Circle;circle.arc=arc,circle.site=cSite,circle.x=x+bx,circle.y=(circle.cy=y+by)+Math.sqrt(x*x+y*y),arc.circle=circle;for(var before=null,node=circles._;node;)if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(!node.L){before=node.P;break}node=node.L}else{if(!node.R){before=node;break}node=node.R}circles.insert(before,circle),before||(firstCircle=circle)}}}}function detachCircle(arc){var circle=arc.circle;circle&&(circle.P||(firstCircle=circle.N),circles.remove(circle),circlePool.push(circle),RedBlackNode(circle),arc.circle=null)}var beachPool=[];function Beach(){RedBlackNode(this),this.edge=this.site=this.circle=null}function createBeach(site){var beach=beachPool.pop()||new Beach;return beach.site=site,beach}function detachBeach(beach){detachCircle(beach),beaches.remove(beach),beachPool.push(beach),RedBlackNode(beach)}function addBeach(site){for(var lArc,rArc,dxl,dxr,x=site[0],directrix=site[1],node=beaches._;node;)if(dxl=leftBreakPoint(node,directrix)-x,epsilon$4<dxl)node=node.L;else{if(dxr=x-function rightBreakPoint(site,directrix){var rArc=site.N;if(rArc)return leftBreakPoint(rArc,directrix);site=site.site;return site[1]===directrix?site[0]:1/0}(node,directrix),!(epsilon$4<dxr)){-epsilon$4<dxl?(lArc=node.P,rArc=node):-epsilon$4<dxr?rArc=(lArc=node).N:lArc=rArc=node;break}if(!node.R){lArc=node;break}node=node.R}!function createCell(site){cells[site.index]={site:site,halfedges:[]}}(site);var lSite,ax,bx,rSite,cx,cy,d,hb,hc,vertex,newArc=createBeach(site);if(beaches.insert(lArc,newArc),lArc||rArc){if(lArc===rArc)return detachCircle(lArc),rArc=createBeach(lArc.site),beaches.insert(newArc,rArc),newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site),attachCircle(lArc),void attachCircle(rArc);rArc?(detachCircle(lArc),detachCircle(rArc),ax=(lSite=lArc.site)[0],vertex=lSite[1],bx=site[0]-ax,d=site[1]-vertex,cx=(rSite=rArc.site)[0]-ax,vertex=[((cy=rSite[1]-vertex)*(hb=bx*bx+d*d)-d*(hc=cx*cx+cy*cy))/(d=2*(bx*cy-d*cx))+ax,(bx*hc-cx*hb)/d+vertex],setEdgeEnd(rArc.edge,lSite,rSite,vertex),newArc.edge=createEdge(lSite,site,null,vertex),rArc.edge=createEdge(site,rSite,null,vertex),attachCircle(lArc),attachCircle(rArc)):newArc.edge=createEdge(lArc.site,newArc.site)}}function leftBreakPoint(plby2,b){var aby2=plby2.site,rfocx=aby2[0],rfocy=aby2[1],pby2=rfocy-b;if(!pby2)return rfocx;var hl=plby2.P;if(!hl)return-1/0;var lfocx=(aby2=hl.site)[0],lfocy=aby2[1],plby2=lfocy-b;if(!plby2)return lfocx;hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}var beaches,cells,circles,edges,epsilon$4=1e-6,epsilon2$2=1e-12;function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,y1){var x,y,circle,x0,y0,x1,site=sites.sort(lexicographic).pop();for(edges=[],cells=new Array(sites.length),beaches=new RedBlackTree,circles=new RedBlackTree;;)if(circle=firstCircle,site&&(!circle||site[1]<circle.y||site[1]===circle.y&&site[0]<circle.x))site[0]===x&&site[1]===y||(addBeach(site),x=site[0],y=site[1]),site=sites.pop();else{if(!circle)break;!function removeBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex=[x,y],previous=beach.P,next=beach.N,disappearing=[beach];detachBeach(beach);for(var lArc=previous;lArc.circle&&Math.abs(x-lArc.circle.x)<epsilon$4&&Math.abs(y-lArc.circle.cy)<epsilon$4;)previous=lArc.P,disappearing.unshift(lArc),detachBeach(lArc),lArc=previous;disappearing.unshift(lArc),detachCircle(lArc);for(var rArc=next;rArc.circle&&Math.abs(x-rArc.circle.x)<epsilon$4&&Math.abs(y-rArc.circle.cy)<epsilon$4;)next=rArc.N,disappearing.push(rArc),detachBeach(rArc),rArc=next;disappearing.push(rArc),detachCircle(rArc);for(var nArcs=disappearing.length,iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],(rArc=disappearing[nArcs-1]).edge=createEdge(lArc.site,rArc.site,null,vertex),attachCircle(lArc),attachCircle(rArc)}(circle.arc)}sortCellHalfedges(),y1&&(clipEdges(x0=+y1[0][0],y0=+y1[0][1],x1=+y1[1][0],y1=+y1[1][1]),clipCells(x0,y0,x1,y1)),this.edges=edges,this.cells=cells,beaches=circles=edges=cells=null}function constant$d(x){return function(){return x}}function ZoomEvent(target,type,transform){this.target=target,this.type=type,this.transform=transform}function Transform(k,x,y){this.k=k,this.x=x,this.y=y}Diagram.prototype={constructor:Diagram,polygons:function(){var edges=this.edges;return this.cells.map(function(cell){var polygon=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges[i])});return polygon.data=cell.site.data,polygon})},triangles:function(){var triangles=[],edges=this.edges;return this.cells.forEach(function(cell,i){if(m=(halfedges=cell.halfedges).length)for(var halfedges,m,s0,site=cell.site,j=-1,e1=edges[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;++j<m;)s0=s1,s1=(e1=edges[halfedges[j]]).left===site?e1.right:e1.left,s0&&s1&&i<s0.index&&i<s1.index&&function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}(site,s0,s1)<0&&triangles.push([site.data,s0.data,s1.data])}),triangles},links:function(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function(x,y,radius){for(var i0,cell,that=this,i1=that._found||0,n=that.cells.length;!(cell=that.cells[i1]);)if(++i1>=n)return null;for(var dx=x-cell.site[0],dy=y-cell.site[1],d2=dx*dx+dy*dy;cell=that.cells[i0=i1],i1=null,cell.halfedges.forEach(function(v){var v2=that.edges[v],v=v2.left;!(v!==cell.site&&v||(v=v2.right))||(v2=(v2=x-v[0])*v2+(v2=y-v[1])*v2)<d2&&(d2=v2,i1=v.index)}),null!==i1;);return that._found=i0,null==radius||d2<=radius*radius?cell.site:null}},Transform.prototype={constructor:Transform,scale:function(k){return 1===k?this:new Transform(this.k*k,this.x,this.y)},translate:function(x,y){return 0===x&0===y?this:new Transform(this.k,this.x+this.k*x,this.y+this.k*y)},apply:function(point){return[point[0]*this.k+this.x,point[1]*this.k+this.y]},applyX:function(x){return x*this.k+this.x},applyY:function(y){return y*this.k+this.y},invert:function(location){return[(location[0]-this.x)/this.k,(location[1]-this.y)/this.k]},invertX:function(x){return(x-this.x)/this.k},invertY:function(y){return(y-this.y)/this.k},rescaleX:function(x){return x.copy().domain(x.range().map(this.invertX,this).map(x.invert,x))},rescaleY:function(y){return y.copy().domain(y.range().map(this.invertY,this).map(y.invert,y))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var identity$9=new Transform(1,0,0);function transform$1(node){for(;!node.__zoom;)if(!(node=node.parentNode))return identity$9;return node.__zoom}function nopropagation$2(){exports.event.stopImmediatePropagation()}function noevent$2(){exports.event.preventDefault(),exports.event.stopImmediatePropagation()}function defaultFilter$2(){return!exports.event.ctrlKey&&!exports.event.button}function defaultExtent$1(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function defaultTransform(){return this.__zoom||identity$9}function defaultWheelDelta(){return-exports.event.deltaY*(1===exports.event.deltaMode?.05:exports.event.deltaMode?1:.002)}function defaultTouchable$2(){return navigator.maxTouchPoints||"ontouchstart"in this}function defaultConstrain(transform,extent,dy1){var dx0=transform.invertX(extent[0][0])-dy1[0][0],dx1=transform.invertX(extent[1][0])-dy1[1][0],dy0=transform.invertY(extent[0][1])-dy1[0][1],dy1=transform.invertY(extent[1][1])-dy1[1][1];return transform.translate(dx0<dx1?(dx0+dx1)/2:Math.min(0,dx0)||Math.max(0,dx1),dy0<dy1?(dy0+dy1)/2:Math.min(0,dy0)||Math.max(0,dy1))}transform$1.prototype=Transform.prototype,exports.FormatSpecifier=FormatSpecifier,exports.active=function active(node,name){var schedule,i,schedules=node.__transition;if(schedules)for(i in name=null==name?null:name+"",schedules)if((schedule=schedules[i]).state>SCHEDULED&&schedule.name===name)return new Transition([[node]],root$1,name,+i);return null},exports.arc=function arc(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant$b(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,a01,a11,a00,a10,da0,da1,rc,t0,t1,x01,y01,x10,y10,x11,y11,x00,y00,ax,lc,rc0,rc1,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),ay=startAngle.apply(this,arguments)-halfPi$3,bx=endAngle.apply(this,arguments)-halfPi$3,kc=abs$1(bx-ay),cw=ay<bx;if(context=context||(buffer=path()),r1<r0&&(x01=r1,r1=r0,r0=x01),epsilon$3<r1?tau$4-epsilon$3<kc?(context.moveTo(r1*cos$2(ay),r1*sin$2(ay)),context.arc(0,0,r1,ay,bx,!cw),epsilon$3<r0&&(context.moveTo(r0*cos$2(bx),r0*sin$2(bx)),context.arc(0,0,r0,bx,ay,cw))):(a00=a01=ay,a10=a11=bx,da1=da0=kc,x10=padAngle.apply(this,arguments)/2,y01=epsilon$3<x10&&(padRadius?+padRadius.apply(this,arguments):sqrt$2(r0*r0+r1*r1)),rc1=rc0=rc=min$1(abs$1(r1-r0)/2,+cornerRadius.apply(this,arguments)),epsilon$3<y01&&(y10=asin$1(y01/r0*sin$2(x10)),ax=asin$1(y01/r1*sin$2(x10)),(da0-=2*y10)>epsilon$3?(a00+=y10*=cw?1:-1,a10-=y10):(da0=0,a00=a10=(ay+bx)/2),(da1-=2*ax)>epsilon$3?(a01+=ax*=cw?1:-1,a11-=ax):(da1=0,a01=a11=(ay+bx)/2)),x01=r1*cos$2(a01),y01=r1*sin$2(a01),x10=r0*cos$2(a10),y10=r0*sin$2(a10),epsilon$3<rc&&(x11=r1*cos$2(a11),y11=r1*sin$2(a11),x00=r0*cos$2(a00),y00=r0*sin$2(a00),kc<pi$4&&(lc=function intersect(x0,y0,y10,x32,x2,y2,y32,t){var x10=y10-x0,y10=x32-y0,x32=y32-x2,y32=t-y2,t=y32*x10-x32*y10;if(!(t*t<epsilon$3))return[x0+(t=(x32*(y0-y2)-y32*(x0-x2))/t)*x10,y0+t*y10]}(x01,y01,x00,y00,x11,y11,x10,y10))&&(ax=x01-lc[0],ay=y01-lc[1],bx=x11-lc[0],kc=y11-lc[1],kc=1/sin$2(function acos$1(x){return 1<x?0:x<-1?pi$4:Math.acos(x)}((ax*bx+ay*kc)/(sqrt$2(ax*ax+ay*ay)*sqrt$2(bx*bx+kc*kc)))/2),lc=sqrt$2(lc[0]*lc[0]+lc[1]*lc[1]),rc0=min$1(rc,(r0-lc)/(kc-1)),rc1=min$1(rc,(r1-lc)/(1+kc)))),epsilon$3<da1?epsilon$3<rc1?(t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw),t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw),context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01),rc1<rc?context.arc(t0.cx,t0.cy,rc1,atan2$1(t0.y01,t0.x01),atan2$1(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc1,atan2$1(t0.y01,t0.x01),atan2$1(t0.y11,t0.x11),!cw),context.arc(0,0,r1,atan2$1(t0.cy+t0.y11,t0.cx+t0.x11),atan2$1(t1.cy+t1.y11,t1.cx+t1.x11),!cw),context.arc(t1.cx,t1.cy,rc1,atan2$1(t1.y11,t1.x11),atan2$1(t1.y01,t1.x01),!cw))):(context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw)):context.moveTo(x01,y01),epsilon$3<r0&&epsilon$3<da0?epsilon$3<rc0?(t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw),t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw),context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01),rc0<rc?context.arc(t0.cx,t0.cy,rc0,atan2$1(t0.y01,t0.x01),atan2$1(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc0,atan2$1(t0.y01,t0.x01),atan2$1(t0.y11,t0.x11),!cw),context.arc(0,0,r0,atan2$1(t0.cy+t0.y11,t0.cx+t0.x11),atan2$1(t1.cy+t1.y11,t1.cx+t1.x11),cw),context.arc(t1.cx,t1.cy,rc0,atan2$1(t1.y11,t1.x11),atan2$1(t1.y01,t1.x01),!cw))):context.arc(0,0,r0,a10,a00,cw):context.lineTo(x10,y10)):context.moveTo(0,0),context.closePath(),buffer)return context=null,buffer+""||null}return arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi$4/2;return[cos$2(a)*r,sin$2(a)*r]},arc.innerRadius=function(_){return arguments.length?(innerRadius="function"==typeof _?_:constant$b(+_),arc):innerRadius},arc.outerRadius=function(_){return arguments.length?(outerRadius="function"==typeof _?_:constant$b(+_),arc):outerRadius},arc.cornerRadius=function(_){return arguments.length?(cornerRadius="function"==typeof _?_:constant$b(+_),arc):cornerRadius},arc.padRadius=function(_){return arguments.length?(padRadius=null==_?null:"function"==typeof _?_:constant$b(+_),arc):padRadius},arc.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant$b(+_),arc):startAngle},arc.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant$b(+_),arc):endAngle},arc.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant$b(+_),arc):padAngle},arc.context=function(_){return arguments.length?(context=null==_?null:_,arc):context},arc},exports.area=area$3,exports.areaRadial=areaRadial,exports.ascending=ascending,exports.autoType=function autoType(object){for(var key in object){var number,m,value=object[key].trim();if(value)if("true"===value)value=!0;else if("false"===value)value=!1;else if("NaN"===value)value=NaN;else if(isNaN(number=+value)){if(!(m=value.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;fixtz&&m[4]&&!m[7]&&(value=value.replace(/-/g,"/").replace(/T/," ")),value=new Date(value)}else value=number;else value=null;object[key]=value}return object},exports.axisBottom=function axisBottom(scale){return axis(bottom,scale)},exports.axisLeft=function axisLeft(scale){return axis(left,scale)},exports.axisRight=function axisRight(scale){return axis(right,scale)},exports.axisTop=function axisTop(scale){return axis(top,scale)},exports.bisect=bisectRight,exports.bisectLeft=bisectLeft,exports.bisectRight=bisectRight,exports.bisector=bisector,exports.blob=function blob(input,init){return fetch(input,init).then(responseBlob)},exports.brush=function brush(){return brush$1(XY)},exports.brushSelection=function brushSelection(state){return(state=state.__brush)?state.dim.output(state.selection):null},exports.brushX=function brushX(){return brush$1(X)},exports.brushY=function brushY(){return brush$1(Y)},exports.buffer=function buffer(input,init){return fetch(input,init).then(responseArrayBuffer)},exports.chord=function chord(){var padAngle=0,sortGroups=null,sortSubgroups=null,sortChords=null;function chord(matrix){for(var x,x0,dx,j,n=matrix.length,groupSums=[],groupIndex=sequence(n),subgroupIndex=[],chords=[],groups=chords.groups=new Array(n),subgroups=new Array(n*n),k=0,i=-1;++i<n;){for(x=0,j=-1;++j<n;)x+=matrix[i][j];groupSums.push(x),subgroupIndex.push(sequence(n)),k+=x}for(sortGroups&&groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])}),sortSubgroups&&subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})}),dx=(k=max$1(0,tau$1-padAngle*n)/k)?padAngle:tau$1/n,x=0,i=-1;++i<n;){for(x0=x,j=-1;++j<n;){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[dj*n+di]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]},x+=dx}for(i=-1;++i<n;)for(j=i-1;++j<n;){var source=subgroups[j*n+i],target=subgroups[i*n+j];(source.value||target.value)&&chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}return sortChords?chords.sort(sortChords):chords}return chord.padAngle=function(_){return arguments.length?(padAngle=max$1(0,_),chord):padAngle},chord.sortGroups=function(_){return arguments.length?(sortGroups=_,chord):sortGroups},chord.sortSubgroups=function(_){return arguments.length?(sortSubgroups=_,chord):sortSubgroups},chord.sortChords=function(_){return arguments.length?(null==_?sortChords=null:(sortChords=function compareValue(compare){return function(a,b){return compare(a.source.value+a.target.value,b.source.value+b.target.value)}}(_))._=_,chord):sortChords&&sortChords._},chord},exports.clientPoint=point,exports.cluster=function cluster(){var separation=defaultSeparation,dx=1,dy=1,nodeSize=!1;function cluster(root){var previousNode,x=0;root.eachAfter(function(node){var children=node.children;children?(node.x=function meanX(children){return children.reduce(meanXReduce,0)/children.length}(children),node.y=function maxY(children){return 1+children.reduce(maxYReduce,0)}(children)):(node.x=previousNode?x+=separation(node,previousNode):0,node.y=0,previousNode=node)});var left=function leafLeft(node){for(var children;children=node.children;)node=children[0];return node}(root),right=function leafRight(node){for(var children;children=node.children;)node=children[children.length-1];return node}(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return root.eachAfter(nodeSize?function(node){node.x=(node.x-root.x)*dx,node.y=(root.y-node.y)*dy}:function(node){node.x=(node.x-x0)/(x1-x0)*dx,node.y=(1-(root.y?node.y/root.y:1))*dy})}return cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation},cluster.size=function(x){return arguments.length?(nodeSize=!1,dx=+x[0],dy=+x[1],cluster):nodeSize?null:[dx,dy]},cluster.nodeSize=function(x){return arguments.length?(nodeSize=!0,dx=+x[0],dy=+x[1],cluster):nodeSize?[dx,dy]:null},cluster},exports.color=color,exports.contourDensity=function density(){var x=defaultX,y=defaultY,weight=defaultWeight,dx=960,dy=500,r=20,k=2,o=3*r,n=dx+2*o>>k,m=dy+2*o>>k,threshold=constant$6(20);function density(tz){var values0=new Float32Array(n*m),stop=new Float32Array(n*m);tz.forEach(function(d,i,wi){var xi=+x(d,i,wi)+o>>k,yi=+y(d,i,wi)+o>>k,wi=+weight(d,i,wi);0<=xi&&xi<n&&0<=yi&&yi<m&&(values0[xi+yi*n]+=wi)}),blurX({width:n,height:m,data:values0},{width:n,height:m,data:stop},r>>k),blurY({width:n,height:m,data:stop},{width:n,height:m,data:values0},r>>k),blurX({width:n,height:m,data:values0},{width:n,height:m,data:stop},r>>k),blurY({width:n,height:m,data:stop},{width:n,height:m,data:values0},r>>k),blurX({width:n,height:m,data:values0},{width:n,height:m,data:stop},r>>k),blurY({width:n,height:m,data:stop},{width:n,height:m,data:values0},r>>k);tz=threshold(values0);return Array.isArray(tz)||(tz=tickStep(0,stop=max(values0),tz),(tz=sequence(0,Math.floor(stop/tz)*tz,tz)).shift()),contours().thresholds(tz).size([n,m])(values0).map(transform)}function transform(geometry){return geometry.value*=Math.pow(2,-2*k),geometry.coordinates.forEach(transformPolygon),geometry}function transformPolygon(coordinates){coordinates.forEach(transformRing)}function transformRing(coordinates){coordinates.forEach(transformPoint)}function transformPoint(coordinates){coordinates[0]=coordinates[0]*Math.pow(2,k)-o,coordinates[1]=coordinates[1]*Math.pow(2,k)-o}function resize(){return n=dx+2*(o=3*r)>>k,m=dy+2*o>>k,density}return density.x=function(_){return arguments.length?(x="function"==typeof _?_:constant$6(+_),density):x},density.y=function(_){return arguments.length?(y="function"==typeof _?_:constant$6(+_),density):y},density.weight=function(_){return arguments.length?(weight="function"==typeof _?_:constant$6(+_),density):weight},density.size=function(_1){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_1[0]),_1=Math.ceil(_1[1]);if(!(0<=_0||0<=_0))throw new Error("invalid size");return dx=_0,dy=_1,resize()},density.cellSize=function(_){if(!arguments.length)return 1<<k;if(!(1<=(_=+_)))throw new Error("invalid cell size");return k=Math.floor(Math.log(_)/Math.LN2),resize()},density.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant$6(slice$3.call(_)):constant$6(_),density):threshold},density.bandwidth=function(_){if(!arguments.length)return Math.sqrt(r*(r+1));if(!(0<=(_=+_)))throw new Error("invalid bandwidth");return r=Math.round((Math.sqrt(4*_*_+1)-1)/2),resize()},density},exports.contours=contours,exports.create=function create(name){return select(creator(name).call(document.documentElement))},exports.creator=creator,exports.cross=function cross(values0,values1,reduce){var i0,i1,i,value0,n0=values0.length,n1=values1.length,values=new Array(n0*n1);for(null==reduce&&(reduce=pair),i0=i=0;i0<n0;++i0)for(value0=values0[i0],i1=0;i1<n1;++i1,++i)values[i]=reduce(value0,values1[i1]);return values},exports.csv=csv$1,exports.csvFormat=csvFormat,exports.csvFormatBody=csvFormatBody,exports.csvFormatRow=csvFormatRow,exports.csvFormatRows=csvFormatRows,exports.csvFormatValue=csvFormatValue,exports.csvParse=csvParse,exports.csvParseRows=csvParseRows,exports.cubehelix=cubehelix,exports.curveBasis=function basis$2(context){return new Basis(context)},exports.curveBasisClosed=function basisClosed$1(context){return new BasisClosed(context)},exports.curveBasisOpen=function basisOpen(context){return new BasisOpen(context)},exports.curveBundle=bundle,exports.curveCardinal=cardinal,exports.curveCardinalClosed=cardinalClosed,exports.curveCardinalOpen=cardinalOpen,exports.curveCatmullRom=catmullRom,exports.curveCatmullRomClosed=catmullRomClosed,exports.curveCatmullRomOpen=catmullRomOpen,exports.curveLinear=curveLinear,exports.curveLinearClosed=function linearClosed(context){return new LinearClosed(context)},exports.curveMonotoneX=function monotoneX(context){return new MonotoneX(context)},exports.curveMonotoneY=function monotoneY(context){return new MonotoneY(context)},exports.curveNatural=function natural(context){return new Natural(context)},exports.curveStep=function step(context){return new Step(context,.5)},exports.curveStepAfter=function stepAfter(context){return new Step(context,1)},exports.curveStepBefore=function stepBefore(context){return new Step(context,0)},exports.customEvent=customEvent,exports.descending=function descending(a,b){return b<a?-1:a<b?1:a<=b?0:NaN},exports.deviation=deviation,exports.dispatch=dispatch,exports.drag=function drag(){var mousedownx,mousedowny,mousemoving,touchending,filter=defaultFilter,container=defaultContainer,subject=defaultSubject,touchable=defaultTouchable,gestures={},listeners=dispatch("start","drag","end"),active=0,clickDistance2=0;function drag(selection){selection.on("mousedown.drag",mousedowned).filter(touchable).on("touchstart.drag",touchstarted).on("touchmove.drag",touchmoved).on("touchend.drag touchcancel.drag",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function mousedowned(){var gesture;touchending||!filter.apply(this,arguments)||(gesture=beforestart("mouse",container.apply(this,arguments),mouse,this,arguments))&&(select(exports.event.view).on("mousemove.drag",mousemoved,!0).on("mouseup.drag",mouseupped,!0),dragDisable(exports.event.view),nopropagation(),mousemoving=!1,mousedownx=exports.event.clientX,mousedowny=exports.event.clientY,gesture("start"))}function mousemoved(){var dx,dy;noevent(),mousemoving||(dx=exports.event.clientX-mousedownx,dy=exports.event.clientY-mousedowny,mousemoving=clickDistance2<dx*dx+dy*dy),gestures.mouse("drag")}function mouseupped(){select(exports.event.view).on("mousemove.drag mouseup.drag",null),yesdrag(exports.event.view,mousemoving),noevent(),gestures.mouse("end")}function touchstarted(){if(filter.apply(this,arguments))for(var gesture,touches=exports.event.changedTouches,c=container.apply(this,arguments),n=touches.length,i=0;i<n;++i)(gesture=beforestart(touches[i].identifier,c,touch,this,arguments))&&(nopropagation(),gesture("start"))}function touchmoved(){for(var gesture,touches=exports.event.changedTouches,n=touches.length,i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(noevent(),gesture("drag"))}function touchended(){var i,gesture,touches=exports.event.changedTouches,n=touches.length;for(touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},500),i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(nopropagation(),gesture("end"))}function beforestart(id,container,point,that,args){var s,dx,dy,p=point(container,id),sublisteners=listeners.copy();if(customEvent(new DragEvent(drag,"beforestart",s,id,active,p[0],p[1],0,0,sublisteners),function(){return null!=(exports.event.subject=s=subject.apply(that,args))&&(dx=s.x-p[0]||0,dy=s.y-p[1]||0,!0)}))return function gesture(type){var n,p0=p;switch(type){case"start":gestures[id]=gesture,n=active++;break;case"end":delete gestures[id],--active;case"drag":p=point(container,id),n=active}customEvent(new DragEvent(drag,type,s,id,n,p[0]+dx,p[1]+dy,p[0]-p0[0],p[1]-p0[1],sublisteners),sublisteners.apply,sublisteners,[type,that,args])}}return drag.filter=function(_){return arguments.length?(filter="function"==typeof _?_:constant$2(!!_),drag):filter},drag.container=function(_){return arguments.length?(container="function"==typeof _?_:constant$2(_),drag):container},drag.subject=function(_){return arguments.length?(subject="function"==typeof _?_:constant$2(_),drag):subject},drag.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:constant$2(!!_),drag):touchable},drag.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?drag:value},drag.clickDistance=function(_){return arguments.length?(clickDistance2=(_=+_)*_,drag):Math.sqrt(clickDistance2)},drag},exports.dragDisable=dragDisable,exports.dragEnable=yesdrag,exports.dsv=function dsv(delimiter,input,init,row){3===arguments.length&&"function"==typeof init&&(row=init,init=void 0);var format=dsvFormat(delimiter);return text(input,init).then(function(response){return format.parse(response,row)})},exports.dsvFormat=dsvFormat,exports.easeBack=backInOut,exports.easeBackIn=backIn,exports.easeBackInOut=backInOut,exports.easeBackOut=backOut,exports.easeBounce=bounceOut,exports.easeBounceIn=function bounceIn(t){return 1-bounceOut(1-t)},exports.easeBounceInOut=function bounceInOut(t){return((t*=2)<=1?1-bounceOut(1-t):bounceOut(t-1)+1)/2},exports.easeBounceOut=bounceOut,exports.easeCircle=circleInOut,exports.easeCircleIn=function circleIn(t){return 1-Math.sqrt(1-t*t)},exports.easeCircleInOut=circleInOut,exports.easeCircleOut=function circleOut(t){return Math.sqrt(1- --t*t)},exports.easeCubic=cubicInOut,exports.easeCubicIn=function cubicIn(t){return t*t*t},exports.easeCubicInOut=cubicInOut,exports.easeCubicOut=function cubicOut(t){return--t*t*t+1},exports.easeElastic=elasticOut,exports.easeElasticIn=elasticIn,exports.easeElasticInOut=elasticInOut,exports.easeElasticOut=elasticOut,exports.easeExp=expInOut,exports.easeExpIn=function expIn(t){return Math.pow(2,10*t-10)},exports.easeExpInOut=expInOut,exports.easeExpOut=function expOut(t){return 1-Math.pow(2,-10*t)},exports.easeLinear=function linear$1(t){return+t},exports.easePoly=polyInOut,exports.easePolyIn=polyIn,exports.easePolyInOut=polyInOut,exports.easePolyOut=polyOut,exports.easeQuad=quadInOut,exports.easeQuadIn=function quadIn(t){return t*t},exports.easeQuadInOut=quadInOut,exports.easeQuadOut=function quadOut(t){return t*(2-t)},exports.easeSin=sinInOut,exports.easeSinIn=function sinIn(t){return 1-Math.cos(t*halfPi)},exports.easeSinInOut=sinInOut,exports.easeSinOut=function sinOut(t){return Math.sin(t*halfPi)},exports.entries=function entries(map){var key,entries=[];for(key in map)entries.push({key:key,value:map[key]});return entries},exports.extent=extent,exports.forceCenter=function center$1(x,y){var nodes;function force(){for(var node,n=nodes.length,sx=0,sy=0,i=0;i<n;++i)sx+=(node=nodes[i]).x,sy+=node.y;for(sx=sx/n-x,sy=sy/n-y,i=0;i<n;++i)(node=nodes[i]).x-=sx,node.y-=sy}return null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force},exports.forceCollide=function collide(radius){var nodes,radii,strength=1,iterations=1;function force(){for(var i,tree,node,xi,yi,ri,ri2,n=nodes.length,k=0;k<iterations;++k)for(tree=quadtree(nodes,x,y).visitAfter(prepare),i=0;i<n;++i)node=nodes[i],ri=radii[node.index],ri2=ri*ri,xi=node.x+node.vx,yi=node.y+node.vy,tree.visit(apply);function apply(r,x0,y,x,l){var data=r.data,rj=r.r,r=ri+rj;if(!data)return xi+r<x0||x<xi-r||yi+r<y||l<yi-r;data.index>node.index&&((l=(x=xi-data.x-data.vx)*x+(y=yi-data.y-data.vy)*y)<r*r&&(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l=(r-(l=Math.sqrt(l)))/l*strength,node.vx+=(x*=l)*(r=(rj*=rj)/(ri2+rj)),node.vy+=(y*=l)*r,data.vx-=x*(r=1-r),data.vy-=y*r))}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i)quad[i]&&quad[i].r>quad.r&&(quad.r=quad[i].r)}function initialize(){if(nodes){var i,node,n=nodes.length;for(radii=new Array(n),i=0;i<n;++i)node=nodes[i],radii[node.index]=+radius(node,i,nodes)}}return"function"!=typeof radius&&(radius=constant$7(null==radius?1:+radius)),force.initialize=function(_){nodes=_,initialize()},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength=+_,force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant$7(+_),initialize(),force):radius},force},exports.forceLink=function link(links){var strengths,distances,nodes,count,bias,id=index,strength=function defaultStrength(link){return 1/Math.min(count[link.source.index],count[link.target.index])},distance=constant$7(30),iterations=1;function force(alpha){for(var k=0,n=links.length;k<iterations;++k)for(var source,target,x,y,b,i=0;i<n;++i)source=(b=links[i]).source,x=(target=b.target).x+target.vx-source.x-source.vx||jiggle(),y=target.y+target.vy-source.y-source.vy||jiggle(),x*=b=((b=Math.sqrt(x*x+y*y))-distances[i])/b*alpha*strengths[i],y*=b,target.vx-=x*(b=bias[i]),target.vy-=y*b,source.vx+=x*(b=1-b),source.vy+=y*b}function initialize(){if(nodes){var link,n=nodes.length,m=links.length,nodeById=map$1(nodes,id),i=0;for(count=new Array(n);i<m;++i)(link=links[i]).index=i,"object"!=typeof link.source&&(link.source=find(nodeById,link.source)),"object"!=typeof link.target&&(link.target=find(nodeById,link.target)),count[link.source.index]=(count[link.source.index]||0)+1,count[link.target.index]=(count[link.target.index]||0)+1;for(i=0,bias=new Array(m);i<m;++i)link=links[i],bias[i]=count[link.source.index]/(count[link.source.index]+count[link.target.index]);strengths=new Array(m),initializeStrength(),distances=new Array(m),initializeDistance()}}function initializeStrength(){if(nodes)for(var i=0,n=links.length;i<n;++i)strengths[i]=+strength(links[i],i,links)}function initializeDistance(){if(nodes)for(var i=0,n=links.length;i<n;++i)distances[i]=+distance(links[i],i,links)}return null==links&&(links=[]),force.initialize=function(_){nodes=_,initialize()},force.links=function(_){return arguments.length?(links=_,initialize(),force):links},force.id=function(_){return arguments.length?(id=_,force):id},force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$7(+_),initializeStrength(),force):strength},force.distance=function(_){return arguments.length?(distance="function"==typeof _?_:constant$7(+_),initializeDistance(),force):distance},force},exports.forceManyBody=function manyBody(){var nodes,node,alpha,strengths,strength=constant$7(-30),distanceMin2=1,distanceMax2=1/0,theta2=.81;function force(_){var i,n=nodes.length,tree=quadtree(nodes,x$1,y$1).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i)node=nodes[i],tree.visit(apply)}function initialize(){if(nodes){var i,node,n=nodes.length;for(strengths=new Array(n),i=0;i<n;++i)node=nodes[i],strengths[node.index]=+strength(node,i,nodes)}}function accumulate(quad){var q,c,x,y,i,strength=0,weight=0;if(quad.length){for(x=y=i=0;i<4;++i)(q=quad[i])&&(c=Math.abs(q.value))&&(strength+=q.value,weight+=c,x+=c*q.x,y+=c*q.y);quad.x=x/weight,quad.y=y/weight}else for(q=quad,q.x=q.data.x,q.y=q.data.y;strength+=strengths[q.data.index],q=q.next;);quad.value=strength}function apply(quad,x1,_,x2){if(!quad.value)return!0;var x=quad.x-node.x,y=quad.y-node.y,w=x2-x1,l=x*x+y*y;if(w*w/theta2<l)return l<distanceMax2&&(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)),node.vx+=x*quad.value*alpha/l,node.vy+=y*quad.value*alpha/l),!0;if(!(quad.length||distanceMax2<=l))for(quad.data===node&&!quad.next||(0===x&&(l+=(x=jiggle())*x),0===y&&(l+=(y=jiggle())*y),l<distanceMin2&&(l=Math.sqrt(distanceMin2*l)));quad.data!==node&&(w=strengths[quad.data.index]*alpha/l,node.vx+=x*w,node.vy+=y*w),quad=quad.next;);}return force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$7(+_),initialize(),force):strength},force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)},force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)},force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)},force},exports.forceRadial=function radial(radius,x,y){var nodes,strengths,radiuses,strength=constant$7(.1);function force(alpha){for(var i=0,n=nodes.length;i<n;++i){var node=nodes[i],dx=node.x-x||1e-6,dy=node.y-y||1e-6,k=Math.sqrt(dx*dx+dy*dy),k=(radiuses[i]-k)*strengths[i]*alpha/k;node.vx+=dx*k,node.vy+=dy*k}}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),radiuses=new Array(n),i=0;i<n;++i)radiuses[i]=+radius(nodes[i],i,nodes),strengths[i]=isNaN(radiuses[i])?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof radius&&(radius=constant$7(+radius)),null==x&&(x=0),null==y&&(y=0),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$7(+_),initialize(),force):strength},force.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant$7(+_),initialize(),force):radius},force.x=function(_){return arguments.length?(x=+_,force):x},force.y=function(_){return arguments.length?(y=+_,force):y},force},exports.forceSimulation=function simulation(nodes){var simulation,alpha=1,alphaMin=.001,alphaDecay=1-Math.pow(alphaMin,1/300),alphaTarget=0,velocityDecay=.6,forces=map$1(),stepper=timer(step),event=dispatch("tick","end");function step(){tick(),event.call("tick",simulation),alpha<alphaMin&&(stepper.stop(),event.call("end",simulation))}function tick(iterations){var i,node,n=nodes.length;void 0===iterations&&(iterations=1);for(var k=0;k<iterations;++k)for(alpha+=(alphaTarget-alpha)*alphaDecay,forces.each(function(force){force(alpha)}),i=0;i<n;++i)null==(node=nodes[i]).fx?node.x+=node.vx*=velocityDecay:(node.x=node.fx,node.vx=0),null==node.fy?node.y+=node.vy*=velocityDecay:(node.y=node.fy,node.vy=0);return simulation}function initializeNodes(){for(var radius,angle,node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).index=i,null!=node.fx&&(node.x=node.fx),null!=node.fy&&(node.y=node.fy),(isNaN(node.x)||isNaN(node.y))&&(radius=10*Math.sqrt(i),angle=i*initialAngle,node.x=radius*Math.cos(angle),node.y=radius*Math.sin(angle)),(isNaN(node.vx)||isNaN(node.vy))&&(node.vx=node.vy=0)}function initializeForce(force){return force.initialize&&force.initialize(nodes),force}return null==nodes&&(nodes=[]),initializeNodes(),simulation={tick:tick,restart:function(){return stepper.restart(step),simulation},stop:function(){return stepper.stop(),simulation},nodes:function(_){return arguments.length?(nodes=_,initializeNodes(),forces.each(initializeForce),simulation):nodes},alpha:function(_){return arguments.length?(alpha=+_,simulation):alpha},alphaMin:function(_){return arguments.length?(alphaMin=+_,simulation):alphaMin},alphaDecay:function(_){return arguments.length?(alphaDecay=+_,simulation):+alphaDecay},alphaTarget:function(_){return arguments.length?(alphaTarget=+_,simulation):alphaTarget},velocityDecay:function(_){return arguments.length?(velocityDecay=1-_,simulation):1-velocityDecay},force:function(name,_){return 1<arguments.length?(null==_?forces.remove(name):forces.set(name,initializeForce(_)),simulation):forces.get(name)},find:function(x,y,radius){var d2,node,closest,i=0,n=nodes.length;for(null==radius?radius=1/0:radius*=radius,i=0;i<n;++i)(d2=(d2=x-(node=nodes[i]).x)*d2+(d2=y-node.y)*d2)<radius&&(closest=node,radius=d2);return closest},on:function(name,_){return 1<arguments.length?(event.on(name,_),simulation):event.on(name)}}},exports.forceX=function x$2(x){var nodes,strengths,xz,strength=constant$7(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vx+=(xz[i]-node.x)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),xz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(xz[i]=+x(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof x&&(x=constant$7(null==x?0:+x)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$7(+_),initialize(),force):strength},force.x=function(_){return arguments.length?(x="function"==typeof _?_:constant$7(+_),initialize(),force):x},force},exports.forceY=function y$2(y){var nodes,strengths,yz,strength=constant$7(.1);function force(alpha){for(var node,i=0,n=nodes.length;i<n;++i)(node=nodes[i]).vy+=(yz[i]-node.y)*strengths[i]*alpha}function initialize(){if(nodes){var i,n=nodes.length;for(strengths=new Array(n),yz=new Array(n),i=0;i<n;++i)strengths[i]=isNaN(yz[i]=+y(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}return"function"!=typeof y&&(y=constant$7(null==y?0:+y)),force.initialize=function(_){nodes=_,initialize()},force.strength=function(_){return arguments.length?(strength="function"==typeof _?_:constant$7(+_),initialize(),force):strength},force.y=function(_){return arguments.length?(y="function"==typeof _?_:constant$7(+_),initialize(),force):y},force},exports.formatDefaultLocale=defaultLocale,exports.formatLocale=formatLocale,exports.formatSpecifier=formatSpecifier,exports.geoAlbers=albers,exports.geoAlbersUsa=function albersUsa(){var cache,cacheStream,lower48Point,alaskaPoint,hawaiiPoint,point,lower48=albers(),alaska=conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};function albersUsa(y){var x=y[0],y=y[1];return point=null,lower48Point.point(x,y),point||(alaskaPoint.point(x,y),point)||(hawaiiPoint.point(x,y),point)}function reset(){return cache=cacheStream=null,albersUsa}return albersUsa.invert=function(coordinates){var y=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/y,y=(coordinates[1]-t[1])/y;return(.12<=y&&y<.234&&-.425<=x&&x<-.214?alaska:.166<=y&&y<.234&&-.214<=x&&x<-.115?hawaii:lower48).invert(coordinates)},albersUsa.stream=function(stream){return cache&&cacheStream===stream?cache:cache=function multiplex(streams){var n=streams.length;return{point:function(x,y){for(var i=-1;++i<n;)streams[i].point(x,y)},sphere:function(){for(var i=-1;++i<n;)streams[i].sphere()},lineStart:function(){for(var i=-1;++i<n;)streams[i].lineStart()},lineEnd:function(){for(var i=-1;++i<n;)streams[i].lineEnd()},polygonStart:function(){for(var i=-1;++i<n;)streams[i].polygonStart()},polygonEnd:function(){for(var i=-1;++i<n;)streams[i].polygonEnd()}}}([lower48.stream(cacheStream=stream),alaska.stream(stream),hawaii.stream(stream)])},albersUsa.precision=function(_){return arguments.length?(lower48.precision(_),alaska.precision(_),hawaii.precision(_),reset()):lower48.precision()},albersUsa.scale=function(_){return arguments.length?(lower48.scale(_),alaska.scale(.35*_),hawaii.scale(_),albersUsa.translate(lower48.translate())):lower48.scale()},albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];return lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream),alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+epsilon$2,y+.12*k+epsilon$2],[x-.214*k-epsilon$2,y+.234*k-epsilon$2]]).stream(pointStream),hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+epsilon$2,y+.166*k+epsilon$2],[x-.115*k-epsilon$2,y+.234*k-epsilon$2]]).stream(pointStream),reset()},albersUsa.fitExtent=function(extent,object){return fitExtent(albersUsa,extent,object)},albersUsa.fitSize=function(size,object){return fitSize(albersUsa,size,object)},albersUsa.fitWidth=function(width,object){return fitWidth(albersUsa,width,object)},albersUsa.fitHeight=function(height,object){return fitHeight(albersUsa,height,object)},albersUsa.scale(1070)},exports.geoArea=function area$1(object){return areaSum.reset(),geoStream(object,areaStream),2*areaSum},exports.geoAzimuthalEqualArea=function azimuthalEqualArea(){return projection(azimuthalEqualAreaRaw).scale(124.75).clipAngle(179.999)},exports.geoAzimuthalEqualAreaRaw=azimuthalEqualAreaRaw,exports.geoAzimuthalEquidistant=function azimuthalEquidistant(){return projection(azimuthalEquidistantRaw).scale(79.4188).clipAngle(179.999)},exports.geoAzimuthalEquidistantRaw=azimuthalEquidistantRaw,exports.geoBounds=function bounds(feature){var i,n,a,b,merged,deltaMax,delta;if(phi1=lambda1=-(lambda0$1=phi0=1/0),ranges=[],geoStream(feature,boundsStream),n=ranges.length){for(ranges.sort(rangeCompare),i=1,merged=[a=ranges[0]];i<n;++i)rangeContains(a,(b=ranges[i])[0])||rangeContains(a,b[1])?(angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]),angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])):merged.push(a=b);for(deltaMax=-1/0,i=0,a=merged[n=merged.length-1];i<=n;a=b,++i)b=merged[i],(delta=angle(a[1],b[0]))>deltaMax&&(deltaMax=delta,lambda0$1=b[0],lambda1=a[1])}return ranges=range=null,lambda0$1===1/0||phi0===1/0?[[NaN,NaN],[NaN,NaN]]:[[lambda0$1,phi0],[lambda1,phi1]]},exports.geoCentroid=function centroid(m){W0=W1=X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0,geoStream(m,centroidStream);var x=X2,y=Y2,z=Z2;return(m=x*x+y*y+z*z)<1e-12&&(x=X1,y=Y1,z=Z1,W1<epsilon$2&&(x=X0,y=Y0,z=Z0),(m=x*x+y*y+z*z)<1e-12)?[NaN,NaN]:[atan2(y,x)*degrees$1,asin(z/sqrt(m))*degrees$1]},exports.geoCircle=function circle(){var ring,rotate,center=constant$8([0,0]),radius=constant$8(90),precision=constant$8(6),stream={point:function point(x,y){ring.push(x=rotate(x,y)),x[0]*=degrees$1,x[1]*=degrees$1}};function circle(){var c=center.apply(this,arguments),r=radius.apply(this,arguments)*radians,p=precision.apply(this,arguments)*radians;return ring=[],rotate=rotateRadians(-c[0]*radians,-c[1]*radians,0).invert,circleStream(stream,r,p,1),c={type:"Polygon",coordinates:[ring]},ring=rotate=null,c}return circle.center=function(_){return arguments.length?(center="function"==typeof _?_:constant$8([+_[0],+_[1]]),circle):center},circle.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant$8(+_),circle):radius},circle.precision=function(_){return arguments.length?(precision="function"==typeof _?_:constant$8(+_),circle):precision},circle},exports.geoClipAntimeridian=clipAntimeridian,exports.geoClipCircle=clipCircle,exports.geoClipExtent=function extent$1(){var cache,cacheStream,clip,x0=0,y0=0,x1=960,y1=500;return clip={stream:function(stream){return cache&&cacheStream===stream?cache:cache=clipRectangle(x0,y0,x1,y1)(cacheStream=stream)},extent:function(_){return arguments.length?(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1],cache=cacheStream=null,clip):[[x0,y0],[x1,y1]]}}},exports.geoClipRectangle=clipRectangle,exports.geoConicConformal=function conicConformal(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])},exports.geoConicConformalRaw=conicConformalRaw,exports.geoConicEqualArea=conicEqualArea,exports.geoConicEqualAreaRaw=conicEqualAreaRaw,exports.geoConicEquidistant=function conicEquidistant(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])},exports.geoConicEquidistantRaw=conicEquidistantRaw,exports.geoContains=function contains$1(object,point){return(object&&containsObjectType.hasOwnProperty(object.type)?containsObjectType[object.type]:containsGeometry)(object,point)},exports.geoDistance=distance,exports.geoEqualEarth=function equalEarth(){return projection(equalEarthRaw).scale(177.158)},exports.geoEqualEarthRaw=equalEarthRaw,exports.geoEquirectangular=function equirectangular(){return projection(equirectangularRaw).scale(152.63)},exports.geoEquirectangularRaw=equirectangularRaw,exports.geoGnomonic=function gnomonic(){return projection(gnomonicRaw).scale(144.049).clipAngle(60)},exports.geoGnomonicRaw=gnomonicRaw,exports.geoGraticule=graticule,exports.geoGraticule10=function graticule10(){return graticule()()},exports.geoIdentity=function identity$5(){var y0,x1,y1,cache,cacheStream,projection,k=1,tx=0,ty=0,sx=1,sy=1,transform=identity$4,x0=null,postclip=identity$4;function reset(){return cache=cacheStream=null,projection}return projection={stream:function(stream){return cache&&cacheStream===stream?cache:cache=transform(postclip(cacheStream=stream))},postclip:function(_){return arguments.length?(postclip=_,x0=y0=x1=y1=null,reset()):postclip},clipExtent:function(_){return arguments.length?(postclip=null==_?(x0=y0=x1=y1=null,identity$4):clipRectangle(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),reset()):null==x0?null:[[x0,y0],[x1,y1]]},scale:function(_){return arguments.length?(transform=scaleTranslate$1((k=+_)*sx,k*sy,tx,ty),reset()):k},translate:function(_){return arguments.length?(transform=scaleTranslate$1(k*sx,k*sy,tx=+_[0],ty=+_[1]),reset()):[tx,ty]},reflectX:function(_){return arguments.length?(transform=scaleTranslate$1(k*(sx=_?-1:1),k*sy,tx,ty),reset()):sx<0},reflectY:function(_){return arguments.length?(transform=scaleTranslate$1(k*sx,k*(sy=_?-1:1),tx,ty),reset()):sy<0},fitExtent:function(extent,object){return fitExtent(projection,extent,object)},fitSize:function(size,object){return fitSize(projection,size,object)},fitWidth:function(width,object){return fitWidth(projection,width,object)},fitHeight:function(height,object){return fitHeight(projection,height,object)}}},exports.geoInterpolate=function interpolate$1(cy0,cy1){var x0=cy0[0]*radians,y0=cy0[1]*radians,interpolate=cy1[0]*radians,y1=cy1[1]*radians,cy0=cos$1(y0),sy0=sin$1(y0),cy1=cos$1(y1),sy1=sin$1(y1),kx0=cy0*cos$1(x0),ky0=cy0*sin$1(x0),kx1=cy1*cos$1(interpolate),ky1=cy1*sin$1(interpolate),d=2*asin(sqrt(haversin(y1-y0)+cy0*cy1*haversin(interpolate-x0))),k=sin$1(d);return(interpolate=d?function(y){var z=sin$1(y*=d)/k,A=sin$1(d-y)/k,x=A*kx0+z*kx1,y=A*ky0+z*ky1,z=A*sy0+z*sy1;return[atan2(y,x)*degrees$1,atan2(z,sqrt(x*x+y*y))*degrees$1]}:function(){return[x0*degrees$1,y0*degrees$1]}).distance=d,interpolate},exports.geoLength=length$1,exports.geoMercator=function mercator(){return mercatorProjection(mercatorRaw).scale(961/tau$3)},exports.geoMercatorRaw=mercatorRaw,exports.geoNaturalEarth1=function naturalEarth1(){return projection(naturalEarth1Raw).scale(175.295)},exports.geoNaturalEarth1Raw=naturalEarth1Raw,exports.geoOrthographic=function orthographic(){return projection(orthographicRaw).scale(249.5).clipAngle(90+epsilon$2)},exports.geoOrthographicRaw=orthographicRaw,exports.geoPath=function index$1(projection,context){var projectionStream,contextStream,pointRadius=4.5;function path(object){return object&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),geoStream(object,projectionStream(contextStream))),contextStream.result()}return path.area=function(object){return geoStream(object,projectionStream(areaStream$1)),areaStream$1.result()},path.measure=function(object){return geoStream(object,projectionStream(lengthStream$1)),lengthStream$1.result()},path.bounds=function(object){return geoStream(object,projectionStream(boundsStream$1)),boundsStream$1.result()},path.centroid=function(object){return geoStream(object,projectionStream(centroidStream$1)),centroidStream$1.result()},path.projection=function(_){return arguments.length?(projectionStream=null==_?(projection=null,identity$4):(projection=_).stream,path):projection},path.context=function(_){return arguments.length?(contextStream=null==_?(context=null,new PathString):new PathContext(context=_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),path):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.projection(projection).context(context)},exports.geoProjection=projection,exports.geoProjectionMutator=projectionMutator,exports.geoRotation=rotation,exports.geoStereographic=function stereographic(){return projection(stereographicRaw).scale(250).clipAngle(142)},exports.geoStereographicRaw=stereographicRaw,exports.geoStream=geoStream,exports.geoTransform=function transform(methods){return{stream:transformer(methods)}},exports.geoTransverseMercator=function transverseMercator(){var m=mercatorProjection(transverseMercatorRaw),center=m.center,rotate=m.rotate;return m.center=function(_){return arguments.length?center([-_[1],_[0]]):[(_=center())[1],-_[0]]},m.rotate=function(_){return arguments.length?rotate([_[0],_[1],2<_.length?_[2]+90:90]):[(_=rotate())[0],_[1],_[2]-90]},rotate([0,0,90]).scale(159.155)},exports.geoTransverseMercatorRaw=transverseMercatorRaw,exports.gray=function gray(l,opacity){return new Lab(l,0,0,null==opacity?1:opacity)},exports.hcl=hcl,exports.hierarchy=hierarchy,exports.histogram=function histogram(){var value=identity,domain=extent,threshold=thresholdSturges;function histogram(data){for(var x,n=data.length,values=new Array(n),i=0;i<n;++i)values[i]=value(data[i],i,data);var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);Array.isArray(tz)||(tz=tickStep(x0,x1,tz),tz=sequence(Math.ceil(x0/tz)*tz,x1,tz));for(var m=tz.length;tz[0]<=x0;)tz.shift(),--m;for(;tz[m-1]>x1;)tz.pop(),--m;var bin,bins=new Array(m+1);for(i=0;i<=m;++i)(bin=bins[i]=[]).x0=0<i?tz[i-1]:x0,bin.x1=i<m?tz[i]:x1;for(i=0;i<n;++i)x0<=(x=values[i])&&x<=x1&&bins[bisectRight(tz,x,0,m)].push(data[i]);return bins}return histogram.value=function(_){return arguments.length?(value="function"==typeof _?_:constant(_),histogram):value},histogram.domain=function(_){return arguments.length?(domain="function"==typeof _?_:constant([_[0],_[1]]),histogram):domain},histogram.thresholds=function(_){return arguments.length?(threshold="function"==typeof _?_:Array.isArray(_)?constant(slice.call(_)):constant(_),histogram):threshold},histogram},exports.hsl=hsl,exports.html=html,exports.image=function image(input,init){return new Promise(function(resolve,reject){var key,image=new Image;for(key in init)image[key]=init[key];image.onerror=reject,image.onload=function(){resolve(image)},image.src=input})},exports.interpolate=interpolateValue,exports.interpolateArray=array$1,exports.interpolateBasis=basis$1,exports.interpolateBasisClosed=basisClosed,exports.interpolateBlues=Blues,exports.interpolateBrBG=BrBG,exports.interpolateBuGn=BuGn,exports.interpolateBuPu=BuPu,exports.interpolateCividis=function cividis(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"},exports.interpolateCool=cool,exports.interpolateCubehelix=cubehelix$2,exports.interpolateCubehelixDefault=cubehelix$3,exports.interpolateCubehelixLong=cubehelixLong,exports.interpolateDate=date,exports.interpolateDiscrete=function discrete(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}},exports.interpolateGnBu=GnBu,exports.interpolateGreens=Greens,exports.interpolateGreys=Greys,exports.interpolateHcl=hcl$2,exports.interpolateHclLong=hclLong,exports.interpolateHsl=hsl$2,exports.interpolateHslLong=hslLong,exports.interpolateHue=function hue$1(a,b){var i=hue(+a,+b);return function(x){x=i(x);return x-360*Math.floor(x/360)}},exports.interpolateInferno=inferno,exports.interpolateLab=function lab$1(start,end){var l=nogamma((start=lab(start)).l,(end=lab(end)).l),a=nogamma(start.a,end.a),b=nogamma(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.l=l(t),start.a=a(t),start.b=b(t),start.opacity=opacity(t),start+""}},exports.interpolateMagma=magma,exports.interpolateNumber=interpolateNumber,exports.interpolateObject=object,exports.interpolateOrRd=OrRd,exports.interpolateOranges=Oranges,exports.interpolatePRGn=PRGn,exports.interpolatePiYG=PiYG,exports.interpolatePlasma=plasma,exports.interpolatePuBu=PuBu,exports.interpolatePuBuGn=PuBuGn,exports.interpolatePuOr=PuOr,exports.interpolatePuRd=PuRd,exports.interpolatePurples=Purples,exports.interpolateRainbow=function rainbow(t){(t<0||1<t)&&(t-=Math.floor(t));var ts=Math.abs(t-.5);return c.h=360*t-100,c.s=1.5-1.5*ts,c.l=.8-.9*ts,c+""},exports.interpolateRdBu=RdBu,exports.interpolateRdGy=RdGy,exports.interpolateRdPu=RdPu,exports.interpolateRdYlBu=RdYlBu,exports.interpolateRdYlGn=RdYlGn,exports.interpolateReds=Reds,exports.interpolateRgb=interpolateRgb,exports.interpolateRgbBasis=rgbBasis,exports.interpolateRgbBasisClosed=rgbBasisClosed,exports.interpolateRound=interpolateRound,exports.interpolateSinebow=function sinebow(t){var x;return t=(.5-t)*Math.PI,c$1.r=255*(x=Math.sin(t))*x,c$1.g=255*(x=Math.sin(t+pi_1_3))*x,c$1.b=255*(x=Math.sin(t+pi_2_3))*x,c$1+""},exports.interpolateSpectral=Spectral,exports.interpolateString=interpolateString,exports.interpolateTransformCss=interpolateTransformCss,exports.interpolateTransformSvg=interpolateTransformSvg,exports.interpolateTurbo=function turbo(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"},exports.interpolateViridis=viridis,exports.interpolateWarm=warm,exports.interpolateYlGn=YlGn,exports.interpolateYlGnBu=YlGnBu,exports.interpolateYlOrBr=YlOrBr,exports.interpolateYlOrRd=YlOrRd,exports.interpolateZoom=interpolateZoom,exports.interrupt=interrupt,exports.interval=function interval$1(callback,delay,time){var t=new Timer,total=delay;return null==delay?t.restart(callback,delay,time):(delay=+delay,time=null==time?now():+time,t.restart(function tick(elapsed){elapsed+=total,t.restart(tick,total+=delay,time),callback(elapsed)},delay,time)),t},exports.isoFormat=formatIso,exports.isoParse=parseIso,exports.json=function json(input,init){return fetch(input,init).then(responseJson)},exports.keys=function keys(map){var key,keys=[];for(key in map)keys.push(key);return keys},exports.lab=lab,exports.lch=function lch(l,c,h,opacity){return 1===arguments.length?hclConvert(l):new Hcl(h,c,l,null==opacity?1:opacity)},exports.line=line,exports.lineRadial=lineRadial$1,exports.linkHorizontal=function linkHorizontal(){return link$2(curveHorizontal)},exports.linkRadial=function linkRadial(){var l=link$2(curveRadial$1);return l.angle=l.x,delete l.x,l.radius=l.y,delete l.y,l},exports.linkVertical=function linkVertical(){return link$2(curveVertical)},exports.local=local,exports.map=map$1,exports.matcher=matcher,exports.max=max,exports.mean=function mean(values,valueof){var value,n=values.length,m=n,i=-1,sum=0;if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))?--m:sum+=value;else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))?--m:sum+=value;if(m)return sum/m},exports.median=function median(values,valueof){var value,n=values.length,i=-1,numbers=[];if(null==valueof)for(;++i<n;)isNaN(value=number(values[i]))||numbers.push(value);else for(;++i<n;)isNaN(value=number(valueof(values[i],i,values)))||numbers.push(value);return threshold(numbers.sort(ascending),.5)},exports.merge=merge,exports.min=min,exports.mouse=mouse,exports.namespace=namespace,exports.namespaces=namespaces,exports.nest=function nest(){var sortValues,rollup,nest,keys=[],sortKeys=[];function apply(array,depth,createResult,setResult){if(depth>=keys.length)return null!=sortValues&&array.sort(sortValues),null!=rollup?rollup(array):array;for(var keyValue,value,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=map$1(),result=createResult();++i<n;)(values=valuesByKey.get(keyValue=key(value=array[i])+""))?values.push(value):valuesByKey.set(keyValue,[value]);return valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))}),result}return nest={object:function(array){return apply(array,0,createObject,setObject)},map:function(array){return apply(array,0,createMap,setMap)},entries:function(array){return function entries(map,depth){if(++depth>keys.length)return map;var array,sortKey=sortKeys[depth-1];return null!=rollup&&depth>=keys.length?array=map.entries():(array=[],map.each(function(v,k){array.push({key:k,values:entries(v,depth)})})),null!=sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}(apply(array,0,createMap,setMap),0)},key:function(d){return keys.push(d),nest},sortKeys:function(order){return sortKeys[keys.length-1]=order,nest},sortValues:function(order){return sortValues=order,nest},rollup:function(f){return rollup=f,nest}}},exports.now=now,exports.pack=function index$2(){var radius=null,dx=1,dy=1,padding=constantZero;function pack(root){return root.x=dx/2,root.y=dy/2,radius?root.eachBefore(radiusLeaf(radius)).eachAfter(packChildren(padding,.5)).eachBefore(translateChild(1)):root.eachBefore(radiusLeaf(defaultRadius$1)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(padding,root.r/Math.min(dx,dy))).eachBefore(translateChild(Math.min(dx,dy)/(2*root.r))),root}return pack.radius=function(x){return arguments.length?(radius=function optional(f){return null==f?null:required(f)}(x),pack):radius},pack.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],pack):[dx,dy]},pack.padding=function(x){return arguments.length?(padding="function"==typeof x?x:constant$9(+x),pack):padding},pack},exports.packEnclose=enclose,exports.packSiblings=function siblings(circles){return packEnclose(circles),circles},exports.pairs=function pairs(array,f){null==f&&(f=pair);for(var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=f(p,p=array[++i]);return pairs},exports.partition=function partition(){var dx=1,dy=1,padding=0,round=!1;function partition(root){var n=root.height+1;return root.x0=root.y0=padding,root.x1=dx,root.y1=dy/n,root.eachBefore(function positionNode(dy,n){return function(node){node.children&&treemapDice(node,node.x0,dy*(node.depth+1)/n,node.x1,dy*(node.depth+2)/n);var x0=node.x0,y0=node.y0,x1=node.x1-padding,y1=node.y1-padding;x1<x0&&(x0=x1=(x0+x1)/2),y1<y0&&(y0=y1=(y0+y1)/2),node.x0=x0,node.y0=y0,node.x1=x1,node.y1=y1}}(dy,n)),round&&root.eachBefore(roundNode),root}return partition.round=function(x){return arguments.length?(round=!!x,partition):round},partition.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],partition):[dx,dy]},partition.padding=function(x){return arguments.length?(padding=+x,partition):padding},partition},exports.path=path,exports.permute=function permute(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},exports.pie=function pie(){var value=identity$8,sortValues=descending$1,sort=null,startAngle=constant$b(0),endAngle=constant$b(tau$4),padAngle=constant$b(0);function pie(data){for(var j,k,a1,v,n=data.length,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau$4,Math.max(-tau$4,endAngle.apply(this,arguments)-a0)),p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1),i=0;i<n;++i)0<(v=arcs[index[i]=i]=+value(data[i],i,data))&&(sum+=v);for(null!=sortValues?index.sort(function(i,j){return sortValues(arcs[i],arcs[j])}):null!=sort&&index.sort(function(i,j){return sort(data[i],data[j])}),i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1)j=index[i],a1=a0+(0<(v=arcs[j])?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p};return arcs}return pie.value=function(_){return arguments.length?(value="function"==typeof _?_:constant$b(+_),pie):value},pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues},pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant$b(+_),pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant$b(+_),pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:constant$b(+_),pie):padAngle},pie},exports.piecewise=function piecewise(interpolate,values){for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}},exports.pointRadial=pointRadial,exports.polygonArea=function area$2(polygon){for(var a,i=-1,n=polygon.length,b=polygon[n-1],area=0;++i<n;)a=b,b=polygon[i],area+=a[1]*b[0]-a[0]*b[1];return area/2},exports.polygonCentroid=function centroid$1(polygon){for(var a,c,i=-1,n=polygon.length,x=0,y=0,b=polygon[n-1],k=0;++i<n;)a=b,b=polygon[i],k+=c=a[0]*b[1]-b[0]*a[1],x+=(a[0]+b[0])*c,y+=(a[1]+b[1])*c;return[x/(k*=3),y/k]},exports.polygonContains=function contains$2(polygon,point){for(var x1,y1,n=polygon.length,p=polygon[n-1],x=point[0],y=point[1],x0=p[0],y0=p[1],inside=!1,i=0;i<n;++i)x1=(p=polygon[i])[0],y<(y1=p[1])!=y<y0&&x<(x0-x1)*(y-y1)/(y0-y1)+x1&&(inside=!inside),x0=x1,y0=y1;return inside},exports.polygonHull=function hull(points){if((n=points.length)<3)return null;for(var n,sortedPoints=new Array(n),flippedPoints=new Array(n),i=0;i<n;++i)sortedPoints[i]=[+points[i][0],+points[i][1],i];for(sortedPoints.sort(lexicographicOrder),i=0;i<n;++i)flippedPoints[i]=[sortedPoints[i][0],-sortedPoints[i][1]];var upperIndexes=computeUpperHullIndexes(sortedPoints),lowerIndexes=computeUpperHullIndexes(flippedPoints),skipLeft=lowerIndexes[0]===upperIndexes[0],skipRight=lowerIndexes[lowerIndexes.length-1]===upperIndexes[upperIndexes.length-1],hull=[];for(i=upperIndexes.length-1;0<=i;--i)hull.push(points[sortedPoints[upperIndexes[i]][2]]);for(i=+skipLeft;i<lowerIndexes.length-skipRight;++i)hull.push(points[sortedPoints[lowerIndexes[i]][2]]);return hull},exports.polygonLength=function length$2(polygon){for(var xa,ya,i=-1,n=polygon.length,b=polygon[n-1],xb=b[0],yb=b[1],perimeter=0;++i<n;)xa=xb,ya=yb,xa-=xb=(b=polygon[i])[0],ya-=yb=b[1],perimeter+=Math.sqrt(xa*xa+ya*ya);return perimeter},exports.precisionFixed=precisionFixed,exports.precisionPrefix=precisionPrefix,exports.precisionRound=precisionRound,exports.quadtree=quadtree,exports.quantile=threshold,exports.quantize=function quantize(interpolator,n){for(var samples=new Array(n),i=0;i<n;++i)samples[i]=interpolator(i/(n-1));return samples},exports.radialArea=areaRadial,exports.radialLine=lineRadial$1,exports.randomBates=bates,exports.randomExponential=exponential$1,exports.randomIrwinHall=irwinHall,exports.randomLogNormal=logNormal,exports.randomNormal=normal,exports.randomUniform=uniform,exports.range=sequence,exports.rgb=rgb,exports.ribbon=function ribbon(){var source=defaultSource,target=defaultTarget,radius=defaultRadius,startAngle=defaultStartAngle,endAngle=defaultEndAngle,context=null;function ribbon(){var buffer,ta1=slice$2.call(arguments),tr=source.apply(this,ta1),ta0=target.apply(this,ta1),sr=+radius.apply(this,(ta1[0]=tr,ta1)),sa0=startAngle.apply(this,ta1)-halfPi$1,sa1=endAngle.apply(this,ta1)-halfPi$1,sx0=sr*cos(sa0),sy0=sr*sin(sa0),tr=+radius.apply(this,(ta1[0]=ta0,ta1)),ta0=startAngle.apply(this,ta1)-halfPi$1,ta1=endAngle.apply(this,ta1)-halfPi$1;if((context=context||(buffer=path())).moveTo(sx0,sy0),context.arc(0,0,sr,sa0,sa1),sa0==ta0&&sa1==ta1||(context.quadraticCurveTo(0,0,tr*cos(ta0),tr*sin(ta0)),context.arc(0,0,tr,ta0,ta1)),context.quadraticCurveTo(0,0,sx0,sy0),context.closePath(),buffer)return context=null,buffer+""||null}return ribbon.radius=function(_){return arguments.length?(radius="function"==typeof _?_:constant$5(+_),ribbon):radius},ribbon.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:constant$5(+_),ribbon):startAngle},ribbon.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:constant$5(+_),ribbon):endAngle},ribbon.source=function(_){return arguments.length?(source=_,ribbon):source},ribbon.target=function(_){return arguments.length?(target=_,ribbon):target},ribbon.context=function(_){return arguments.length?(context=null==_?null:_,ribbon):context},ribbon},exports.scaleBand=band,exports.scaleDiverging=function diverging(){var scale=linearish(transformer$3()(identity$6));return scale.copy=function(){return copy$1(scale,diverging())},initInterpolator.apply(scale,arguments)},exports.scaleDivergingLog=function divergingLog(){var scale=loggish(transformer$3()).domain([.1,1,10]);return scale.copy=function(){return copy$1(scale,divergingLog()).base(scale.base())},initInterpolator.apply(scale,arguments)},exports.scaleDivergingPow=divergingPow,exports.scaleDivergingSqrt=function divergingSqrt(){return divergingPow.apply(null,arguments).exponent(.5)},exports.scaleDivergingSymlog=function divergingSymlog(){var scale=symlogish(transformer$3());return scale.copy=function(){return copy$1(scale,divergingSymlog()).constant(scale.constant())},initInterpolator.apply(scale,arguments)},exports.scaleIdentity=function identity$7(domain){var unknown;function scale(x){return isNaN(x=+x)?unknown:x}return(scale.invert=scale).domain=scale.range=function(_){return arguments.length?(domain=map$3.call(_,number$2),scale):domain.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return identity$7(domain).unknown(unknown)},domain=arguments.length?map$3.call(domain,number$2):[0,1],linearish(scale)},exports.scaleImplicit=implicit,exports.scaleLinear=function linear$2(){var scale=continuous(identity$6,identity$6);return scale.copy=function(){return copy(scale,linear$2())},initRange.apply(scale,arguments),linearish(scale)},exports.scaleLog=function log$1(){var scale=loggish(transformer$1()).domain([1,10]);return scale.copy=function(){return copy(scale,log$1()).base(scale.base())},initRange.apply(scale,arguments),scale},exports.scaleOrdinal=ordinal,exports.scalePoint=function point$1(){return function pointish(scale){var copy=scale.copy;return scale.padding=scale.paddingOuter,delete scale.paddingInner,delete scale.paddingOuter,scale.copy=function(){return pointish(copy())},scale}(band.apply(null,arguments).paddingInner(1))},exports.scalePow=pow$1,exports.scaleQuantile=function quantile(){var unknown,domain=[],range=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range.length);for(thresholds=new Array(n-1);++i<n;)thresholds[i-1]=threshold(domain,i/n);return scale}function scale(x){return isNaN(x=+x)?unknown:range[bisectRight(thresholds,x)]}return scale.invertExtent=function(i){return(i=range.indexOf(i))<0?[NaN,NaN]:[0<i?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]},scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var d,i=0,n=_.length;i<n;++i)null==(d=_[i])||isNaN(d=+d)||domain.push(d);return domain.sort(ascending),rescale()},scale.range=function(_){return arguments.length?(range=slice$5.call(_),rescale()):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.quantiles=function(){return thresholds.slice()},scale.copy=function(){return quantile().domain(domain).range(range).unknown(unknown)},initRange.apply(scale,arguments)},exports.scaleQuantize=function quantize$1(){var unknown,x0=0,x1=1,n=1,domain=[.5],range=[0,1];function scale(x){return x<=x?range[bisectRight(domain,x,0,n)]:unknown}function rescale(){var i=-1;for(domain=new Array(n);++i<n;)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}return scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]},scale.range=function(_){return arguments.length?(n=(range=slice$5.call(_)).length-1,rescale()):range.slice()},scale.invertExtent=function(i){return(i=range.indexOf(i))<0?[NaN,NaN]:i<1?[x0,domain[0]]:n<=i?[domain[n-1],x1]:[domain[i-1],domain[i]]},scale.unknown=function(_){return arguments.length&&(unknown=_),scale},scale.thresholds=function(){return domain.slice()},scale.copy=function(){return quantize$1().domain([x0,x1]).range(range).unknown(unknown)},initRange.apply(linearish(scale),arguments)},exports.scaleSequential=function sequential(){var scale=linearish(transformer$2()(identity$6));return scale.copy=function(){return copy$1(scale,sequential())},initInterpolator.apply(scale,arguments)},exports.scaleSequentialLog=function sequentialLog(){var scale=loggish(transformer$2()).domain([1,10]);return scale.copy=function(){return copy$1(scale,sequentialLog()).base(scale.base())},initInterpolator.apply(scale,arguments)},exports.scaleSequentialPow=sequentialPow,exports.scaleSequentialQuantile=function sequentialQuantile(){var domain=[],interpolator=identity$6;function scale(x){if(!isNaN(x=+x))return interpolator((bisectRight(domain,x)-1)/(domain.length-1))}return scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var d,i=0,n=_.length;i<n;++i)null==(d=_[i])||isNaN(d=+d)||domain.push(d);return domain.sort(ascending),scale},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.copy=function(){return sequentialQuantile(interpolator).domain(domain)},initInterpolator.apply(scale,arguments)},exports.scaleSequentialSqrt=function sequentialSqrt(){return sequentialPow.apply(null,arguments).exponent(.5)},exports.scaleSequentialSymlog=function sequentialSymlog(){var scale=symlogish(transformer$2());return scale.copy=function(){return copy$1(scale,sequentialSymlog()).constant(scale.constant())},initInterpolator.apply(scale,arguments)},exports.scaleSqrt=function sqrt$1(){return pow$1.apply(null,arguments).exponent(.5)},exports.scaleSymlog=function symlog(){var scale=symlogish(transformer$1());return scale.copy=function(){return copy(scale,symlog()).constant(scale.constant())},initRange.apply(scale,arguments)},exports.scaleThreshold=function threshold$1(){var unknown,domain=[.5],range=[0,1],n=1;function scale(x){return x<=x?range[bisectRight(domain,x,0,n)]:unknown}return scale.domain=function(_){return arguments.length?(domain=slice$5.call(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()},scale.range=function(_){return arguments.length?(range=slice$5.call(_),n=Math.min(domain.length,range.length-1),scale):range.slice()},scale.invertExtent=function(i){return i=range.indexOf(i),[domain[i-1],domain[i]]},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return threshold$1().domain(domain).range(range).unknown(unknown)},initRange.apply(scale,arguments)},exports.scaleTime=function time(){return initRange.apply(calendar(year,month,sunday,day,hour,minute,second,millisecond,exports.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},exports.scaleUtc=function utcTime(){return initRange.apply(calendar(utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute,second,millisecond,exports.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},exports.scan=function scan(values,compare){if(n=values.length){var n,xi,i=0,j=0,xj=values[j];for(null==compare&&(compare=ascending);++i<n;)(compare(xi=values[i],xj)<0||0!==compare(xj,xj))&&(xj=xi,j=i);return 0===compare(xj,xj)?j:void 0}},exports.schemeAccent=Accent,exports.schemeBlues=scheme$l,exports.schemeBrBG=scheme,exports.schemeBuGn=scheme$9,exports.schemeBuPu=scheme$a,exports.schemeCategory10=category10,exports.schemeDark2=Dark2,exports.schemeGnBu=scheme$b,exports.schemeGreens=scheme$m,exports.schemeGreys=scheme$n,exports.schemeOrRd=scheme$c,exports.schemeOranges=scheme$q,exports.schemePRGn=scheme$1,exports.schemePaired=Paired,exports.schemePastel1=Pastel1,exports.schemePastel2=Pastel2,exports.schemePiYG=scheme$2,exports.schemePuBu=scheme$e,exports.schemePuBuGn=scheme$d,exports.schemePuOr=scheme$3,exports.schemePuRd=scheme$f,exports.schemePurples=scheme$o,exports.schemeRdBu=scheme$4,exports.schemeRdGy=scheme$5,exports.schemeRdPu=scheme$g,exports.schemeRdYlBu=scheme$6,exports.schemeRdYlGn=scheme$7,exports.schemeReds=scheme$p,exports.schemeSet1=Set1,exports.schemeSet2=Set2,exports.schemeSet3=Set3,exports.schemeSpectral=scheme$8,exports.schemeTableau10=Tableau10,exports.schemeYlGn=scheme$i,exports.schemeYlGnBu=scheme$h,exports.schemeYlOrBr=scheme$j,exports.schemeYlOrRd=scheme$k,exports.select=select,exports.selectAll=function selectAll(selector){return"string"==typeof selector?new Selection([document.querySelectorAll(selector)],[document.documentElement]):new Selection([null==selector?[]:selector],root)},exports.selection=selection,exports.selector=selector,exports.selectorAll=selectorAll,exports.set=set$2,exports.shuffle=function shuffle(array,i0,i1){for(var t,i,m=(null==i1?array.length:i1)-(i0=null==i0?0:+i0);m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},exports.stack=function stack(){var keys=constant$b([]),order=none$2,offset=none$1,value=stackValue;function stack(data){for(var oz,kz=keys.apply(this,arguments),m=data.length,n=kz.length,sz=new Array(n),i=0;i<n;++i){for(var sij,ki=kz[i],si=sz[i]=new Array(m),j=0;j<m;++j)si[j]=sij=[0,+value(data[j],ki,j,data)],sij.data=data[j];si.key=ki}for(i=0,oz=order(sz);i<n;++i)sz[oz[i]].index=i;return offset(sz,oz),sz}return stack.keys=function(_){return arguments.length?(keys="function"==typeof _?_:constant$b(slice$6.call(_)),stack):keys},stack.value=function(_){return arguments.length?(value="function"==typeof _?_:constant$b(+_),stack):value},stack.order=function(_){return arguments.length?(order=null==_?none$2:"function"==typeof _?_:constant$b(slice$6.call(_)),stack):order},stack.offset=function(_){return arguments.length?(offset=null==_?none$1:_,stack):offset},stack},exports.stackOffsetDiverging=function diverging$1(series,order){if(0<(n=series.length))for(var i,d,dy,yp,yn,n,j=0,m=series[order[0]].length;j<m;++j)for(i=yp=yn=0;i<n;++i)0<(dy=(d=series[order[i]][j])[1]-d[0])?(d[0]=yp,d[1]=yp+=dy):dy<0?(d[1]=yn,d[0]=yn+=dy):(d[0]=0,d[1]=dy)},exports.stackOffsetExpand=function expand(series,order){if(0<(n=series.length)){for(var i,n,y,j=0,m=series[0].length;j<m;++j){for(y=i=0;i<n;++i)y+=series[i][j][1]||0;if(y)for(i=0;i<n;++i)series[i][j][1]/=y}none$1(series,order)}},exports.stackOffsetNone=none$1,exports.stackOffsetSilhouette=function silhouette(series,order){if(0<(n=series.length)){for(var n,j=0,s0=series[order[0]],m=s0.length;j<m;++j){for(var i=0,y=0;i<n;++i)y+=series[i][j][1]||0;s0[j][1]+=s0[j][0]=-y/2}none$1(series,order)}},exports.stackOffsetWiggle=function wiggle(series,order){if(0<(n=series.length)&&0<(m=(s0=series[order[0]]).length)){for(var s0,m,n,y=0,j=1;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){for(var si=series[order[i]],sij0=si[j][1]||0,s3=(sij0-(si[j-1][1]||0))/2,k=0;k<i;++k){var sk=series[order[k]];s3+=(sk[j][1]||0)-(sk[j-1][1]||0)}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y,s1&&(y-=s2/s1)}s0[j-1][1]+=s0[j-1][0]=y,none$1(series,order)}},exports.stackOrderAppearance=appearance,exports.stackOrderAscending=ascending$3,exports.stackOrderDescending=function descending$2(series){return ascending$3(series).reverse()},exports.stackOrderInsideOut=function insideOut(series){for(var j,n=series.length,sums=series.map(sum$2),order=appearance(series),top=0,bottom=0,tops=[],bottoms=[],i=0;i<n;++i)j=order[i],top<bottom?(top+=sums[j],tops.push(j)):(bottom+=sums[j],bottoms.push(j));return bottoms.reverse().concat(tops)},exports.stackOrderNone=none$2,exports.stackOrderReverse=function reverse(series){return none$2(series).reverse()},exports.stratify=function stratify(){var id=defaultId,parentId=defaultParentId;function stratify(data){for(var root,parent,node,nodeId,nodeKey,n=data.length,nodes=new Array(n),nodeByKey={},i=0;i<n;++i)nodeKey=data[i],node=nodes[i]=new Node(nodeKey),null!=(nodeId=id(nodeKey,i,data))&&(nodeId+="")&&(nodeByKey[nodeKey="$"+(node.id=nodeId)]=nodeKey in nodeByKey?ambiguous:node);for(i=0;i<n;++i)if(node=nodes[i],null!=(nodeId=parentId(data[i],i,data))&&(nodeId+="")){if(!(parent=nodeByKey["$"+nodeId]))throw new Error("missing: "+nodeId);if(parent===ambiguous)throw new Error("ambiguous: "+nodeId);parent.children?parent.children.push(node):parent.children=[node],node.parent=parent}else{if(root)throw new Error("multiple roots");root=node}if(!root)throw new Error("no root");if(root.parent=preroot,root.eachBefore(function(node){node.depth=node.parent.depth+1,--n}).eachBefore(computeHeight),root.parent=null,0<n)throw new Error("cycle");return root}return stratify.id=function(x){return arguments.length?(id=required(x),stratify):id},stratify.parentId=function(x){return arguments.length?(parentId=required(x),stratify):parentId},stratify},exports.style=styleValue,exports.sum=function sum(values,valueof){var value,n=values.length,i=-1,sum=0;if(null==valueof)for(;++i<n;)(value=+values[i])&&(sum+=value);else for(;++i<n;)(value=+valueof(values[i],i,values))&&(sum+=value);return sum},exports.svg=svg,exports.symbol=function symbol(){var type=constant$b(circle$2),size=constant$b(64),context=null;function symbol(){var buffer;if(context=context||(buffer=path()),type.apply(this,arguments).draw(context,+size.apply(this,arguments)),buffer)return context=null,buffer+""||null}return symbol.type=function(_){return arguments.length?(type="function"==typeof _?_:constant$b(_),symbol):type},symbol.size=function(_){return arguments.length?(size="function"==typeof _?_:constant$b(+_),symbol):size},symbol.context=function(_){return arguments.length?(context=null==_?null:_,symbol):context},symbol},exports.symbolCircle=circle$2,exports.symbolCross=cross$2,exports.symbolDiamond=diamond,exports.symbolSquare=square,exports.symbolStar=star,exports.symbolTriangle=triangle,exports.symbolWye=wye,exports.symbols=symbols,exports.text=text,exports.thresholdFreedmanDiaconis=function freedmanDiaconis(values,min,max){return values=map.call(values,number).sort(ascending),Math.ceil((max-min)/(2*(threshold(values,.75)-threshold(values,.25))*Math.pow(values.length,-1/3)))},exports.thresholdScott=function scott(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))},exports.thresholdSturges=thresholdSturges,exports.tickFormat=tickFormat,exports.tickIncrement=tickIncrement,exports.tickStep=tickStep,exports.ticks=ticks,exports.timeDay=day,exports.timeDays=days,exports.timeFormatDefaultLocale=defaultLocale$1,exports.timeFormatLocale=formatLocale$1,exports.timeFriday=friday,exports.timeFridays=fridays,exports.timeHour=hour,exports.timeHours=hours,exports.timeInterval=newInterval,exports.timeMillisecond=millisecond,exports.timeMilliseconds=milliseconds,exports.timeMinute=minute,exports.timeMinutes=minutes,exports.timeMonday=monday,exports.timeMondays=mondays,exports.timeMonth=month,exports.timeMonths=months,exports.timeSaturday=saturday,exports.timeSaturdays=saturdays,exports.timeSecond=second,exports.timeSeconds=seconds,exports.timeSunday=sunday,exports.timeSundays=sundays,exports.timeThursday=thursday,exports.timeThursdays=thursdays,exports.timeTuesday=tuesday,exports.timeTuesdays=tuesdays,exports.timeWednesday=wednesday,exports.timeWednesdays=wednesdays,exports.timeWeek=sunday,exports.timeWeeks=sundays,exports.timeYear=year,exports.timeYears=years,exports.timeout=timeout$1,exports.timer=timer,exports.timerFlush=timerFlush,exports.touch=touch,exports.touches=function touches(node,touches){for(var i=0,n=(touches=null==touches?sourceEvent().touches:touches)?touches.length:0,points=new Array(n);i<n;++i)points[i]=point(node,touches[i]);return points},exports.transition=transition,exports.transpose=transpose,exports.tree=function tree(){var separation=defaultSeparation$1,dx=1,dy=1,nodeSize=null;function tree(root){var left,right,bottom,tx,kx,ky,s=function treeRoot(tree){for(var node,child,children,i,n,nodes=[tree=new TreeNode(tree,0)];node=nodes.pop();)if(children=node._.children)for(node.children=new Array(n=children.length),i=n-1;0<=i;--i)nodes.push(child=node.children[i]=new TreeNode(children[i],i)),child.parent=node;return(tree.parent=new TreeNode(null,0)).children=[tree],tree}(root);return s.eachAfter(firstWalk),s.parent.m=-s.z,s.eachBefore(secondWalk),nodeSize?root.eachBefore(sizeNode):((bottom=right=left=root).eachBefore(function(node){node.x<left.x&&(left=node),node.x>right.x&&(right=node),node.depth>bottom.depth&&(bottom=node)}),s=left===right?1:separation(left,right)/2,tx=s-left.x,kx=dx/(right.x+s+tx),ky=dy/(bottom.depth||1),root.eachBefore(function(node){node.x=(node.x+tx)*kx,node.y=node.depth*ky})),root}function firstWalk(v){var midpoint=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;midpoint?(function executeShifts(v){for(var w,shift=0,change=0,children=v.children,i=children.length;0<=--i;)(w=children[i]).z+=shift,w.m+=shift,shift+=w.s+(change+=w.c)}(v),midpoint=(midpoint[0].z+midpoint[midpoint.length-1].z)/2,w?(v.z=w.z+separation(v._,w._),v.m=v.z-midpoint):v.z=midpoint):w&&(v.z=w.z+separation(v._,w._)),v.parent.A=function apportion(v,w,ancestor){if(w){for(var shift,vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m;vim=nextRight(vim),vip=nextLeft(vip),vim&&vip;)vom=nextLeft(vom),(vop=nextRight(vop)).a=v,0<(shift=vim.z+sim-vip.z-sip+separation(vim._,vip._))&&(function moveSubtree(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change,wp.s+=shift,wm.c+=change,wp.z+=shift,wp.m+=shift}(function nextAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}(vim,v,ancestor),v,shift),sip+=shift,sop+=shift),sim+=vim.m,sip+=vip.m,som+=vom.m,sop+=vop.m;vim&&!nextRight(vop)&&(vop.t=vim,vop.m+=sim-sop),vip&&!nextLeft(vom)&&(vom.t=vip,vom.m+=sip-som,ancestor=v)}return ancestor}(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m,v.m+=v.parent.m}function sizeNode(node){node.x*=dx,node.y=node.depth*dy}return tree.separation=function(x){return arguments.length?(separation=x,tree):separation},tree.size=function(x){return arguments.length?(nodeSize=!1,dx=+x[0],dy=+x[1],tree):nodeSize?null:[dx,dy]},tree.nodeSize=function(x){return arguments.length?(nodeSize=!0,dx=+x[0],dy=+x[1],tree):nodeSize?[dx,dy]:null},tree},exports.treemap=function index$3(){var tile=squarify,round=!1,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root){return root.x0=root.y0=0,root.x1=dx,root.y1=dy,root.eachBefore(positionNode),paddingStack=[0],round&&root.eachBefore(roundNode),root}function positionNode(node){var p=paddingStack[node.depth],x0=node.x0+p,y0=node.y0+p,x1=node.x1-p,y1=node.y1-p;x1<x0&&(x0=x1=(x0+x1)/2),y1<y0&&(y0=y1=(y0+y1)/2),node.x0=x0,node.y0=y0,node.x1=x1,node.y1=y1,node.children&&(p=paddingStack[node.depth+1]=paddingInner(node)/2,x0+=paddingLeft(node)-p,y0+=paddingTop(node)-p,(x1-=paddingRight(node)-p)<x0&&(x0=x1=(x0+x1)/2),(y1-=paddingBottom(node)-p)<y0&&(y0=y1=(y0+y1)/2),tile(node,x0,y0,x1,y1))}return treemap.round=function(x){return arguments.length?(round=!!x,treemap):round},treemap.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],treemap):[dx,dy]},treemap.tile=function(x){return arguments.length?(tile=required(x),treemap):tile},treemap.padding=function(x){return arguments.length?treemap.paddingInner(x).paddingOuter(x):treemap.paddingInner()},treemap.paddingInner=function(x){return arguments.length?(paddingInner="function"==typeof x?x:constant$9(+x),treemap):paddingInner},treemap.paddingOuter=function(x){return arguments.length?treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x):treemap.paddingTop()},treemap.paddingTop=function(x){return arguments.length?(paddingTop="function"==typeof x?x:constant$9(+x),treemap):paddingTop},treemap.paddingRight=function(x){return arguments.length?(paddingRight="function"==typeof x?x:constant$9(+x),treemap):paddingRight},treemap.paddingBottom=function(x){return arguments.length?(paddingBottom="function"==typeof x?x:constant$9(+x),treemap):paddingBottom},treemap.paddingLeft=function(x){return arguments.length?(paddingLeft="function"==typeof x?x:constant$9(+x),treemap):paddingLeft},treemap},exports.treemapBinary=function binary(parent,x0,y0,x1,y1){var i,sum,nodes=parent.children,n=nodes.length,sums=new Array(n+1);for(sums[0]=sum=i=0;i<n;++i)sums[i+1]=sum+=nodes[i].value;!function partition(i,j,yk,x0,y0,x1,y1){if(j-1<=i){var valueRight=nodes[i];return valueRight.x0=x0,valueRight.y0=y0,valueRight.x1=x1,void(valueRight.y1=y1)}var xk=sums[i],valueTarget=yk/2+xk,k=i+1,hi=j-1;for(;k<hi;){var mid=k+hi>>>1;sums[mid]<valueTarget?k=1+mid:hi=mid}valueTarget-sums[k-1]<sums[k]-valueTarget&&i+1<k&&--k;var valueLeft=sums[k]-xk,valueRight=yk-valueLeft;y1-y0<x1-x0?(partition(i,k,valueLeft,x0,y0,xk=(x0*valueRight+x1*valueLeft)/yk,y1),partition(k,j,valueRight,xk,y0,x1,y1)):(partition(i,k,valueLeft,x0,y0,x1,yk=(y0*valueRight+y1*valueLeft)/yk),partition(k,j,valueRight,x0,yk,x1,y1))}(0,n,parent.value,x0,y0,x1,y1)},exports.treemapDice=treemapDice,exports.treemapResquarify=resquarify,exports.treemapSlice=treemapSlice,exports.treemapSliceDice=function sliceDice(parent,x0,y0,x1,y1){(1&parent.depth?treemapSlice:treemapDice)(parent,x0,y0,x1,y1)},exports.treemapSquarify=squarify,exports.tsv=tsv$1,exports.tsvFormat=tsvFormat,exports.tsvFormatBody=tsvFormatBody,exports.tsvFormatRow=tsvFormatRow,exports.tsvFormatRows=tsvFormatRows,exports.tsvFormatValue=tsvFormatValue,exports.tsvParse=tsvParse,exports.tsvParseRows=tsvParseRows,exports.utcDay=utcDay,exports.utcDays=utcDays,exports.utcFriday=utcFriday,exports.utcFridays=utcFridays,exports.utcHour=utcHour,exports.utcHours=utcHours,exports.utcMillisecond=millisecond,exports.utcMilliseconds=milliseconds,exports.utcMinute=utcMinute,exports.utcMinutes=utcMinutes,exports.utcMonday=utcMonday,exports.utcMondays=utcMondays,exports.utcMonth=utcMonth,exports.utcMonths=utcMonths,exports.utcSaturday=utcSaturday,exports.utcSaturdays=utcSaturdays,exports.utcSecond=second,exports.utcSeconds=seconds,exports.utcSunday=utcSunday,exports.utcSundays=utcSundays,exports.utcThursday=utcThursday,exports.utcThursdays=utcThursdays,exports.utcTuesday=utcTuesday,exports.utcTuesdays=utcTuesdays,exports.utcWednesday=utcWednesday,exports.utcWednesdays=utcWednesdays,exports.utcWeek=utcSunday,exports.utcWeeks=utcSundays,exports.utcYear=utcYear,exports.utcYears=utcYears,exports.values=function values(map){var key,values=[];for(key in map)values.push(map[key]);return values},exports.variance=variance,exports.version="5.14.2",exports.voronoi=function voronoi(){var x=x$4,y=y$4,extent=null;function voronoi(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x(d,i,data)/epsilon$4)*epsilon$4,Math.round(y(d,i,data)/epsilon$4)*epsilon$4];return s.index=i,s.data=d,s}),extent)}return voronoi.polygons=function(data){return voronoi(data).polygons()},voronoi.links=function(data){return voronoi(data).links()},voronoi.triangles=function(data){return voronoi(data).triangles()},voronoi.x=function(_){return arguments.length?(x="function"==typeof _?_:constant$c(+_),voronoi):x},voronoi.y=function(_){return arguments.length?(y="function"==typeof _?_:constant$c(+_),voronoi):y},voronoi.extent=function(_){return arguments.length?(extent=null==_?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]},voronoi.size=function(_){return arguments.length?(extent=null==_?null:[[0,0],[+_[0],+_[1]]],voronoi):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]},voronoi},exports.window=defaultView,exports.xml=xml,exports.zip=function zip(){return transpose(arguments)},exports.zoom=function zoom(){var touchstarting,touchending,filter=defaultFilter$2,extent=defaultExtent$1,constrain=defaultConstrain,wheelDelta=defaultWheelDelta,touchable=defaultTouchable$2,scaleExtent=[0,1/0],translateExtent=[[-1/0,-1/0],[1/0,1/0]],duration=250,interpolate=interpolateZoom,listeners=dispatch("start","zoom","end"),touchDelay=500,wheelDelay=150,clickDistance2=0;function zoom(selection){selection.property("__zoom",defaultTransform).on("wheel.zoom",wheeled).on("mousedown.zoom",mousedowned).on("dblclick.zoom",dblclicked).filter(touchable).on("touchstart.zoom",touchstarted).on("touchmove.zoom",touchmoved).on("touchend.zoom touchcancel.zoom",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function scale(transform,k){return(k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],k)))===transform.k?transform:new Transform(k,transform.x,transform.y)}function translate(transform,p0,y){var x=p0[0]-y[0]*transform.k,y=p0[1]-y[1]*transform.k;return x===transform.x&&y===transform.y?transform:new Transform(transform.k,x,y)}function centroid(extent){return[(+extent[0][0]+ +extent[1][0])/2,(+extent[0][1]+ +extent[1][1])/2]}function schedule(transition,transform,point){transition.on("start.zoom",function(){gesture(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){gesture(this,arguments).end()}).tween("zoom",function(){var args=arguments,g=gesture(this,args),a=extent.apply(this,args),p=null==point?centroid(a):"function"==typeof point?point.apply(this,args):point,w=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),a=this.__zoom,b="function"==typeof transform?transform.apply(this,args):transform,i=interpolate(a.invert(p).concat(w/a.k),b.invert(p).concat(w/b.k));return function(t){var l,k;t=1===t?b:(l=i(t),new Transform(k=w/l[2],p[0]-l[0]*k,p[1]-l[1]*k)),g.zoom(null,t)}})}function gesture(that,args,clean){return!clean&&that.__zooming||new Gesture(that,args)}function Gesture(that,args){this.that=that,this.args=args,this.active=0,this.extent=extent.apply(that,args),this.taps=0}function wheeled(){if(filter.apply(this,arguments)){var g=gesture(this,arguments),t=this.__zoom,k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],t.k*Math.pow(2,wheelDelta.apply(this,arguments)))),p=mouse(this);if(g.wheel)g.mouse[0][0]===p[0]&&g.mouse[0][1]===p[1]||(g.mouse[1]=t.invert(g.mouse[0]=p)),clearTimeout(g.wheel);else{if(t.k===k)return;g.mouse=[p,t.invert(p)],interrupt(this),g.start()}noevent$2(),g.wheel=setTimeout(function wheelidled(){g.wheel=null,g.end()},wheelDelay),g.zoom("mouse",constrain(translate(scale(t,k),g.mouse[0],g.mouse[1]),g.extent,translateExtent))}}function mousedowned(){var g,v,p,x0,y0;!touchending&&filter.apply(this,arguments)&&(g=gesture(this,arguments,!0),v=select(exports.event.view).on("mousemove.zoom",function mousemoved(){{var dx,dy;noevent$2(),g.moved||(dx=exports.event.clientX-x0,dy=exports.event.clientY-y0,g.moved=clickDistance2<dx*dx+dy*dy)}g.zoom("mouse",constrain(translate(g.that.__zoom,g.mouse[0]=mouse(g.that),g.mouse[1]),g.extent,translateExtent))},!0).on("mouseup.zoom",function mouseupped(){v.on("mousemove.zoom mouseup.zoom",null),yesdrag(exports.event.view,g.moved),noevent$2(),g.end()},!0),p=mouse(this),x0=exports.event.clientX,y0=exports.event.clientY,dragDisable(exports.event.view),nopropagation$2(),g.mouse=[p,this.__zoom.invert(p)],interrupt(this),g.start())}function dblclicked(){var t0,p0,k1,t1;filter.apply(this,arguments)&&(t0=this.__zoom,p0=mouse(this),t1=t0.invert(p0),k1=t0.k*(exports.event.shiftKey?.5:2),t1=constrain(translate(scale(t0,k1),p0,t1),extent.apply(this,arguments),translateExtent),noevent$2(),0<duration?select(this).transition().duration(duration).call(schedule,t1,p0):select(this).call(zoom.transform,t1))}function touchstarted(){if(filter.apply(this,arguments)){var started,i,t,p,touches=exports.event.touches,n=touches.length,g=gesture(this,arguments,exports.event.changedTouches.length===n);for(nopropagation$2(),i=0;i<n;++i)p=[p=touch(this,touches,(t=touches[i]).identifier),this.__zoom.invert(p),t.identifier],g.touch0?g.touch1||g.touch0[2]===p[2]||(g.touch1=p,g.taps=0):(g.touch0=p,started=!0,g.taps=1+!!touchstarting);touchstarting=touchstarting&&clearTimeout(touchstarting),started&&(g.taps<2&&(touchstarting=setTimeout(function(){touchstarting=null},touchDelay)),interrupt(this),g.start())}}function touchmoved(){if(this.__zooming){var i,g=gesture(this,arguments),touches=exports.event.changedTouches,n=touches.length;for(noevent$2(),touchstarting=touchstarting&&clearTimeout(touchstarting),i=g.taps=0;i<n;++i)p=touch(this,touches,(t=touches[i]).identifier),g.touch0&&g.touch0[2]===t.identifier?g.touch0[0]=p:g.touch1&&g.touch1[2]===t.identifier&&(g.touch1[0]=p);if(t=g.that.__zoom,g.touch1)var p0=g.touch0[0],l0=g.touch0[1],p1=g.touch1[0],l=g.touch1[1],dp=(dp=p1[0]-p0[0])*dp+(dp=p1[1]-p0[1])*dp,dl=(dl=l[0]-l0[0])*dl+(dl=l[1]-l0[1])*dl,t=scale(t,Math.sqrt(dp/dl)),p=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2],l=[(l0[0]+l[0])/2,(l0[1]+l[1])/2];else{if(!g.touch0)return;p=g.touch0[0],l=g.touch0[1]}g.zoom("touch",constrain(translate(t,p,l),g.extent,translateExtent))}}function touchended(){if(this.__zooming){var i,t,p,g=gesture(this,arguments),touches=exports.event.changedTouches,n=touches.length;for(nopropagation$2(),touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},touchDelay),i=0;i<n;++i)t=touches[i],g.touch0&&g.touch0[2]===t.identifier?delete g.touch0:g.touch1&&g.touch1[2]===t.identifier&&delete g.touch1;g.touch1&&!g.touch0&&(g.touch0=g.touch1,delete g.touch1),g.touch0?g.touch0[1]=this.__zoom.invert(g.touch0[0]):(g.end(),2!==g.taps||(p=select(this).on("dblclick.zoom"))&&p.apply(this,arguments))}}return zoom.transform=function(collection,transform,point){var selection=collection.selection?collection.selection():collection;selection.property("__zoom",defaultTransform),collection!==selection?schedule(collection,transform,point):selection.interrupt().each(function(){gesture(this,arguments).start().zoom(null,"function"==typeof transform?transform.apply(this,arguments):transform).end()})},zoom.scaleBy=function(selection,k,p){zoom.scaleTo(selection,function(){return this.__zoom.k*("function"==typeof k?k.apply(this,arguments):k)},p)},zoom.scaleTo=function(selection,k,p){zoom.transform(selection,function(){var e=extent.apply(this,arguments),t0=this.__zoom,p0=null==p?centroid(e):"function"==typeof p?p.apply(this,arguments):p,p1=t0.invert(p0),k1="function"==typeof k?k.apply(this,arguments):k;return constrain(translate(scale(t0,k1),p0,p1),e,translateExtent)},p)},zoom.translateBy=function(selection,x,y){zoom.transform(selection,function(){return constrain(this.__zoom.translate("function"==typeof x?x.apply(this,arguments):x,"function"==typeof y?y.apply(this,arguments):y),extent.apply(this,arguments),translateExtent)})},zoom.translateTo=function(selection,x,y,p){zoom.transform(selection,function(){var e=extent.apply(this,arguments),t=this.__zoom,p0=null==p?centroid(e):"function"==typeof p?p.apply(this,arguments):p;return constrain(identity$9.translate(p0[0],p0[1]).scale(t.k).translate("function"==typeof x?-x.apply(this,arguments):-x,"function"==typeof y?-y.apply(this,arguments):-y),e,translateExtent)},p)},Gesture.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this).emit("start"),this},zoom:function(key,transform){return this.mouse&&"mouse"!==key&&(this.mouse[1]=transform.invert(this.mouse[0])),this.touch0&&"touch"!==key&&(this.touch0[1]=transform.invert(this.touch0[0])),this.touch1&&"touch"!==key&&(this.touch1[1]=transform.invert(this.touch1[0])),this.that.__zoom=transform,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(type){customEvent(new ZoomEvent(zoom,type,this.that.__zoom),listeners.apply,listeners,[type,this.that,this.args])}},zoom.wheelDelta=function(_){return arguments.length?(wheelDelta="function"==typeof _?_:constant$d(+_),zoom):wheelDelta},zoom.filter=function(_){return arguments.length?(filter="function"==typeof _?_:constant$d(!!_),zoom):filter},zoom.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:constant$d(!!_),zoom):touchable},zoom.extent=function(_){return arguments.length?(extent="function"==typeof _?_:constant$d([[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]]),zoom):extent},zoom.scaleExtent=function(_){return arguments.length?(scaleExtent[0]=+_[0],scaleExtent[1]=+_[1],zoom):[scaleExtent[0],scaleExtent[1]]},zoom.translateExtent=function(_){return arguments.length?(translateExtent[0][0]=+_[0][0],translateExtent[1][0]=+_[1][0],translateExtent[0][1]=+_[0][1],translateExtent[1][1]=+_[1][1],zoom):[[translateExtent[0][0],translateExtent[0][1]],[translateExtent[1][0],translateExtent[1][1]]]},zoom.constrain=function(_){return arguments.length?(constrain=_,zoom):constrain},zoom.duration=function(_){return arguments.length?(duration=+_,zoom):duration},zoom.interpolate=function(_){return arguments.length?(interpolate=_,zoom):interpolate},zoom.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?zoom:value},zoom.clickDistance=function(_){return arguments.length?(clickDistance2=(_=+_)*_,zoom):Math.sqrt(clickDistance2)},zoom},exports.zoomIdentity=identity$9,exports.zoomTransform=transform$1,Object.defineProperty(exports,"__esModule",{value:!0})}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("c3",factory):(global=global||self).c3=factory()}(this,function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ChartInternal(api){var $$=this;$$.d3=window.d3||("undefined"!=typeof require?require("d3"):void 0),$$.api=api,$$.config=$$.getDefaultConfig(),$$.data={},$$.cache={},$$.axes={}}function Chart(config){this.internal=new ChartInternal(this),this.internal.loadConfig(config),this.internal.beforeInit(config),this.internal.init(),this.internal.afterInit(config),function bindThis(fn,target,argThis){Object.keys(fn).forEach(function(key){target[key]=fn[key].bind(argThis),0<Object.keys(fn[key]).length&&bindThis(fn[key],target[key],argThis)})}(Chart.prototype,this,this)}function asHalfPixel(n){return Math.ceil(n)+.5}function ceil10(v){return 10*Math.ceil(v/10)}function diffDomain(d){return d[1]-d[0]}function getOption(options,key,defaultValue){return isDefined(options[key])?options[key]:defaultValue}function getPathBox(items){var box=getBBox(items);return{x:(items=[items.pathSegList.getItem(0),items.pathSegList.getItem(1)])[0].x,y:Math.min(items[0].y,items[1].y),width:box.width,height:box.height}}function hasValue(dict,value){var found=!1;return Object.keys(dict).forEach(function(key){dict[key]===value&&(found=!0)}),found}function isArray(o){return Array.isArray(o)}function isEmpty(o){return null==o||isString(o)&&0===o.length||"object"===_typeof(o)&&0===Object.keys(o).length}function isFunction(o){return"function"==typeof o}function isNumber(o){return"number"==typeof o}function isUndefined(v){return void 0===v}function isValue(v){return v||0===v}function notEmpty(o){return!isEmpty(o)}function sanitise(str){return"string"==typeof str?str.replace(/</g,"&lt;").replace(/>/g,"&gt;"):str}function flattenArray(arr){var _ref;return Array.isArray(arr)?(_ref=[]).concat.apply(_ref,_toConsumableArray(arr)):[]}function isWithinBox(point,box){var yEnd=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,xStart=box.x-yEnd,xEnd=box.x+box.width+yEnd,yStart=box.y+box.height+yEnd,yEnd=box.y-yEnd;return xStart<point[0]&&point[0]<xEnd&&yEnd<point[1]&&point[1]<yStart}var getBBox=function getBBox(element){try{return element.getBBox()}catch(ignore){return{x:0,y:0,width:0,height:0}}},isDefined=function isDefined(v){return void 0!==v},isString=function isString(o){return"string"==typeof o};function AxisInternal(component,params){this.component=component,this.params=params||{},this.d3=component.d3,this.scale=this.d3.scaleLinear(),this.range,this.orient="bottom",this.innerTickSize=6,this.outerTickSize=this.params.withOuterTick?6:0,this.tickPadding=3,this.tickValues=null,this.tickFormat,this.tickArguments,this.tickOffset=0,this.tickCulling=!0,this.tickCentered,this.tickTextCharSize,this.tickTextRotate=this.params.tickTextRotate,this.tickLength,this.axis=this.generateAxis()}AxisInternal.prototype.axisX=function(selection,x,tickOffset){selection.attr("transform",function(d){return"translate("+Math.ceil(x(d)+tickOffset)+", 0)"})},AxisInternal.prototype.axisY=function(selection,y){selection.attr("transform",function(d){return"translate(0,"+Math.ceil(y(d))+")"})},AxisInternal.prototype.scaleExtent=function(stop){var start=stop[0],stop=stop[stop.length-1];return start<stop?[start,stop]:[stop,start]},AxisInternal.prototype.generateTicks=function(scale){var i,domain,ticks=[];if(scale.ticks)return scale.ticks.apply(scale,this.tickArguments);for(domain=scale.domain(),i=Math.ceil(domain[0]);i<domain[1];i++)ticks.push(i);return 0<ticks.length&&0<ticks[0]&&ticks.unshift(ticks[0]-(ticks[1]-ticks[0])),ticks},AxisInternal.prototype.copyScale=function(){var domain,newScale=this.scale.copy();return this.params.isCategory&&(domain=this.scale.domain(),newScale.domain([domain[0],domain[1]-1])),newScale},AxisInternal.prototype.textFormatted=function(formatted){formatted=this.tickFormat?this.tickFormat(formatted):formatted;return void 0!==formatted?formatted:""},AxisInternal.prototype.updateRange=function(){return this.range=this.scale.rangeExtent?this.scale.rangeExtent():this.scaleExtent(this.scale.range()),this.range},AxisInternal.prototype.updateTickTextCharSize=function(tick){var internal=this;if(internal.tickTextCharSize)return internal.tickTextCharSize;var size={h:11.5,w:5.5};return tick.select("text").text(function(d){return internal.textFormatted(d)}).each(function(h){var box=getBBox(this),w=internal.textFormatted(h),h=box.height,w=w?box.width/w.length:void 0;h&&w&&(size.h=h,size.w=w)}).text(""),internal.tickTextCharSize=size},AxisInternal.prototype.isVertical=function(){return"left"===this.orient||"right"===this.orient},AxisInternal.prototype.tspanData=function(d,i,scale){var splitted=this.params.tickMultiline?this.splitTickText(d,scale):[].concat(this.textFormatted(d));return(splitted=this.params.tickMultiline&&0<this.params.tickMultilineMax?this.ellipsify(splitted,this.params.tickMultilineMax):splitted).map(function(s){return{index:i,splitted:s,length:splitted.length}})},AxisInternal.prototype.splitTickText=function(tickText,scale){var subtext,spaceIndex,textWidth,internal=this,tickText=internal.textFormatted(tickText),maxWidth=internal.params.tickWidth;return"[object Array]"===Object.prototype.toString.call(tickText)?tickText:((!maxWidth||maxWidth<=0)&&(maxWidth=internal.isVertical()?95:internal.params.isCategory?Math.ceil(scale(1)-scale(0))-12:110),function split(splitted,text){spaceIndex=void 0;for(var i=1;i<text.length;i++)if(" "===text.charAt(i)&&(spaceIndex=i),subtext=text.substr(0,i+1),textWidth=internal.tickTextCharSize.w*subtext.length,maxWidth<textWidth)return split(splitted.concat(text.substr(0,spaceIndex||i)),text.slice(spaceIndex?spaceIndex+1:i));return splitted.concat(text)}([],tickText+""))},AxisInternal.prototype.ellipsify=function(splitted,max){if(splitted.length<=max)return splitted;for(var ellipsified=splitted.slice(0,max),remaining=3,i=max-1;0<=i;i--){var available=ellipsified[i].length;if(ellipsified[i]=ellipsified[i].substr(0,available-remaining).padEnd(available,"."),(remaining-=available)<=0)break}return ellipsified},AxisInternal.prototype.updateTickLength=function(){this.tickLength=Math.max(this.innerTickSize,0)+this.tickPadding},AxisInternal.prototype.lineY2=function(tickPosition){tickPosition=this.scale(tickPosition)+(this.tickCentered?0:this.tickOffset);return this.range[0]<tickPosition&&tickPosition<this.range[1]?this.innerTickSize:0},AxisInternal.prototype.textY=function(){var rotate=this.tickTextRotate;return rotate?11.5-rotate/15*2.5*(0<rotate?1:-1):this.tickLength},AxisInternal.prototype.textTransform=function(){var rotate=this.tickTextRotate;return rotate?"rotate("+rotate+")":""},AxisInternal.prototype.textTextAnchor=function(){var rotate=this.tickTextRotate;return rotate?0<rotate?"start":"end":"middle"},AxisInternal.prototype.tspanDx=function(){var rotate=this.tickTextRotate;return rotate?8*Math.sin(Math.PI*(rotate/180)):0},AxisInternal.prototype.tspanDy=function(d,i){var dy=this.tickTextCharSize.h;return dy=0===i?this.isVertical()?-((d.length-1)*(this.tickTextCharSize.h/2)-3):".71em":dy},AxisInternal.prototype.generateAxis=function(){var internal=this,d3=internal.d3,params=internal.params;function axis(g,transition){var self;return g.each(function(){var tickTransform,tickX,tickY,path=axis.g=d3.select(this),scale0=this.__chart__||internal.scale,scale1=this.__chart__=internal.copyScale(),tickUpdate=internal.tickValues||internal.generateTicks(scale1),tspans=path.selectAll(".tick").data(tickUpdate,scale1),tickEnter=tspans.enter().insert("g",".domain").attr("class","tick").style("opacity",1e-6),tickExit=tspans.exit().remove(),tickUpdate=tspans.merge(tickEnter);params.isCategory?(internal.tickOffset=Math.ceil((scale1(1)-scale1(0))/2),tickX=internal.tickCentered?0:internal.tickOffset,tickY=internal.tickCentered?internal.tickOffset:0):internal.tickOffset=tickX=0,internal.updateRange(),internal.updateTickLength(),internal.updateTickTextCharSize(path.select(".tick"));var lineUpdate=tickUpdate.select("line").merge(tickEnter.append("line")),textUpdate=tickUpdate.select("text").merge(tickEnter.append("text")),tspans=tickUpdate.selectAll("text").selectAll("tspan").data(function(d,i){return internal.tspanData(d,i,scale1)}),tspanUpdate=tspans.enter().append("tspan").merge(tspans).text(function(d){return d.splitted});tspans.exit().remove();var x,dx,path=path.selectAll(".domain").data([0]),pathUpdate=path.enter().append("path").merge(path).attr("class","domain");switch(internal.orient){case"bottom":tickTransform=internal.axisX,lineUpdate.attr("x1",tickX).attr("x2",tickX).attr("y2",function(d,i){return internal.lineY2(d,i)}),textUpdate.attr("x",0).attr("y",function(d,i){return internal.textY(d,i)}).attr("transform",function(d,i){return internal.textTransform(d,i)}).style("text-anchor",function(d,i){return internal.textTextAnchor(d,i)}),tspanUpdate.attr("x",0).attr("dy",function(d,i){return internal.tspanDy(d,i)}).attr("dx",function(d,i){return internal.tspanDx(d,i)}),pathUpdate.attr("d","M"+internal.range[0]+","+internal.outerTickSize+"V0H"+internal.range[1]+"V"+internal.outerTickSize);break;case"top":tickTransform=internal.axisX,lineUpdate.attr("x1",tickX).attr("x2",tickX).attr("y2",function(d,i){return-1*internal.lineY2(d,i)}),textUpdate.attr("x",0).attr("y",function(d,i){return-1*internal.textY(d,i)-(params.isCategory?2:internal.tickLength-2)}).attr("transform",function(d,i){return internal.textTransform(d,i)}).style("text-anchor",function(d,i){return internal.textTextAnchor(d,i)}),tspanUpdate.attr("x",0).attr("dy",function(d,i){return internal.tspanDy(d,i)}).attr("dx",function(d,i){return internal.tspanDx(d,i)}),pathUpdate.attr("d","M"+internal.range[0]+","+-internal.outerTickSize+"V0H"+internal.range[1]+"V"+-internal.outerTickSize);break;case"left":tickTransform=internal.axisY,lineUpdate.attr("x2",-internal.innerTickSize).attr("y1",tickY).attr("y2",tickY),textUpdate.attr("x",-internal.tickLength).attr("y",internal.tickOffset).style("text-anchor","end"),tspanUpdate.attr("x",-internal.tickLength).attr("dy",function(d,i){return internal.tspanDy(d,i)}),pathUpdate.attr("d","M"+-internal.outerTickSize+","+internal.range[0]+"H0V"+internal.range[1]+"H"+-internal.outerTickSize);break;case"right":tickTransform=internal.axisY,lineUpdate.attr("x2",internal.innerTickSize).attr("y1",tickY).attr("y2",tickY),textUpdate.attr("x",internal.tickLength).attr("y",internal.tickOffset).style("text-anchor","start"),tspanUpdate.attr("x",internal.tickLength).attr("dy",function(d,i){return internal.tspanDy(d,i)}),pathUpdate.attr("d","M"+internal.outerTickSize+","+internal.range[0]+"H0V"+internal.range[1]+"H"+internal.outerTickSize)}scale1.rangeBand?(dx=(x=scale1).rangeBand()/2,scale0=scale1=function scale1(d){return x(d)+dx}):scale0.rangeBand?scale0=scale1:tickExit.call(tickTransform,scale1,internal.tickOffset),tickEnter.call(tickTransform,scale0,internal.tickOffset),self=(transition?tickUpdate.transition(transition):tickUpdate).style("opacity",1).call(tickTransform,scale1,internal.tickOffset)}),self}return axis.scale=function(x){return arguments.length?(internal.scale=x,axis):internal.scale},axis.orient=function(x){return arguments.length?(internal.orient=x in{top:1,right:1,bottom:1,left:1}?x+"":"bottom",axis):internal.orient},axis.tickFormat=function(format){return arguments.length?(internal.tickFormat=format,axis):internal.tickFormat},axis.tickCentered=function(isCentered){return arguments.length?(internal.tickCentered=isCentered,axis):internal.tickCentered},axis.tickOffset=function(){return internal.tickOffset},axis.tickInterval=function(){var interval=params.isCategory?2*internal.tickOffset:(axis.g.select("path.domain").node().getTotalLength()-2*internal.outerTickSize)/axis.g.selectAll("line").size();return interval===1/0?0:interval},axis.ticks=function(){return arguments.length?(internal.tickArguments=arguments,axis):internal.tickArguments},axis.tickCulling=function(culling){return arguments.length?(internal.tickCulling=culling,axis):internal.tickCulling},axis.tickValues=function(x){if("function"==typeof x)internal.tickValues=function(){return x(internal.scale.domain())};else{if(!arguments.length)return internal.tickValues;internal.tickValues=x}return axis},axis};function Axis(owner){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Axis),this.owner=owner,this.d3=owner.d3,this.internal=AxisInternal}var CLASS={target:"c3-target",chart:"c3-chart",chartLine:"c3-chart-line",chartLines:"c3-chart-lines",chartBar:"c3-chart-bar",chartBars:"c3-chart-bars",chartText:"c3-chart-text",chartTexts:"c3-chart-texts",chartArc:"c3-chart-arc",chartArcs:"c3-chart-arcs",chartArcsTitle:"c3-chart-arcs-title",chartArcsBackground:"c3-chart-arcs-background",chartArcsGaugeUnit:"c3-chart-arcs-gauge-unit",chartArcsGaugeMax:"c3-chart-arcs-gauge-max",chartArcsGaugeMin:"c3-chart-arcs-gauge-min",selectedCircle:"c3-selected-circle",selectedCircles:"c3-selected-circles",eventRect:"c3-event-rect",eventRects:"c3-event-rects",eventRectsSingle:"c3-event-rects-single",eventRectsMultiple:"c3-event-rects-multiple",zoomRect:"c3-zoom-rect",brush:"c3-brush",dragZoom:"c3-drag-zoom",focused:"c3-focused",defocused:"c3-defocused",region:"c3-region",regions:"c3-regions",title:"c3-title",tooltipContainer:"c3-tooltip-container",tooltip:"c3-tooltip",tooltipName:"c3-tooltip-name",shape:"c3-shape",shapes:"c3-shapes",line:"c3-line",lines:"c3-lines",bar:"c3-bar",bars:"c3-bars",circle:"c3-circle",circles:"c3-circles",arc:"c3-arc",arcLabelLine:"c3-arc-label-line",arcs:"c3-arcs",area:"c3-area",areas:"c3-areas",empty:"c3-empty",text:"c3-text",texts:"c3-texts",gaugeValue:"c3-gauge-value",grid:"c3-grid",gridLines:"c3-grid-lines",xgrid:"c3-xgrid",xgrids:"c3-xgrids",xgridLine:"c3-xgrid-line",xgridLines:"c3-xgrid-lines",xgridFocus:"c3-xgrid-focus",ygrid:"c3-ygrid",ygrids:"c3-ygrids",ygridLine:"c3-ygrid-line",ygridLines:"c3-ygrid-lines",colorScale:"c3-colorscale",stanfordElements:"c3-stanford-elements",stanfordLine:"c3-stanford-line",stanfordLines:"c3-stanford-lines",stanfordRegion:"c3-stanford-region",stanfordRegions:"c3-stanford-regions",stanfordText:"c3-stanford-text",stanfordTexts:"c3-stanford-texts",axis:"c3-axis",axisX:"c3-axis-x",axisXLabel:"c3-axis-x-label",axisY:"c3-axis-y",axisYLabel:"c3-axis-y-label",axisY2:"c3-axis-y2",axisY2Label:"c3-axis-y2-label",legendBackground:"c3-legend-background",legendItem:"c3-legend-item",legendItemEvent:"c3-legend-item-event",legendItemTile:"c3-legend-item-tile",legendItemHidden:"c3-legend-item-hidden",legendItemFocused:"c3-legend-item-focused",dragarea:"c3-dragarea",EXPANDED:"_expanded_",SELECTED:"_selected_",INCLUDED:"_included_"};Axis.prototype.init=function init(){var $$=this.owner,config=$$.config,main=$$.main;$$.axes.x=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisX).attr("clip-path",config.axis_x_inner?"":$$.clipPathForXAxis).attr("transform",$$.getTranslate("x")).style("visibility",config.axis_x_show?"visible":"hidden"),$$.axes.x.append("text").attr("class",CLASS.axisXLabel).attr("transform",config.axis_rotated?"rotate(-90)":"").style("text-anchor",this.textAnchorForXAxisLabel.bind(this)),$$.axes.y=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisY).attr("clip-path",config.axis_y_inner?"":$$.clipPathForYAxis).attr("transform",$$.getTranslate("y")).style("visibility",config.axis_y_show?"visible":"hidden"),$$.axes.y.append("text").attr("class",CLASS.axisYLabel).attr("transform",config.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForYAxisLabel.bind(this)),$$.axes.y2=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisY2).attr("transform",$$.getTranslate("y2")).style("visibility",config.axis_y2_show?"visible":"hidden"),$$.axes.y2.append("text").attr("class",CLASS.axisY2Label).attr("transform",config.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForY2AxisLabel.bind(this))},Axis.prototype.getXAxis=function getXAxis(scale,axis,tickFormat,tickValues,withOuterTick,axisParams,withoutRotateTickText){var $$=this.owner,config=$$.config,axisParams={isCategory:$$.isCategorized(),withOuterTick:withOuterTick,tickMultiline:config.axis_x_tick_multiline,tickMultilineMax:config.axis_x_tick_multiline?Number(config.axis_x_tick_multilineMax):0,tickWidth:config.axis_x_tick_width,tickTextRotate:withoutRotateTickText?0:config.axis_x_tick_rotate,withoutTransition:axisParams},axis=new this.internal(this,axisParams).axis.scale(scale).orient(axis);return $$.isTimeSeries()&&tickValues&&"function"!=typeof tickValues&&(tickValues=tickValues.map(function(v){return $$.parseDate(v)})),axis.tickFormat(tickFormat).tickValues(tickValues),$$.isCategorized()&&(axis.tickCentered(config.axis_x_tick_centered),isEmpty(config.axis_x_tick_culling)&&(config.axis_x_tick_culling=!1)),axis},Axis.prototype.updateXAxisTickValues=function updateXAxisTickValues(targets,axis){var tickValues,$$=this.owner,config=$$.config;return(config.axis_x_tick_fit||config.axis_x_tick_count)&&(tickValues=this.generateTickValues($$.mapTargetsToUniqueXs(targets),config.axis_x_tick_count,$$.isTimeSeries())),axis?axis.tickValues(tickValues):($$.xAxis.tickValues(tickValues),$$.subXAxis.tickValues(tickValues)),tickValues},Axis.prototype.getYAxis=function getYAxis(axisId,scale,axis,tickValues,withOuterTick,withoutTransition,withoutRotateTickText){var $$=this.owner,config=$$.config,tickFormat=config["axis_".concat(axisId,"_tick_format")];!tickFormat&&$$.isAxisNormalized(axisId)&&(tickFormat=function tickFormat(x){return"".concat(x,"%")});axis=new this.internal(this,{withOuterTick:withOuterTick,withoutTransition:withoutTransition,tickTextRotate:withoutRotateTickText?0:config.axis_y_tick_rotate}).axis.scale(scale).orient(axis);return tickFormat&&axis.tickFormat(tickFormat),$$.isTimeSeriesY()?axis.ticks(config.axis_y_tick_time_type,config.axis_y_tick_time_interval):axis.tickValues(tickValues),axis},Axis.prototype.getId=function getId(id){var config=this.owner.config;return id in config.data_axes?config.data_axes[id]:"y"},Axis.prototype.getXAxisTickFormat=function getXAxisTickFormat(){var $$=this.owner,config=$$.config,format=$$.isTimeSeries()?$$.defaultAxisTimeFormat:$$.isCategorized()?$$.categoryName:function(v){return v};return config.axis_x_tick_format&&(isFunction(config.axis_x_tick_format)?format=config.axis_x_tick_format:$$.isTimeSeries()&&(format=function format(date){return date?$$.axisTimeFormat(config.axis_x_tick_format)(date):""})),isFunction(format)?function(v){return format.call($$,v)}:format},Axis.prototype.getTickValues=function getTickValues(tickValues,axis){return tickValues||(axis?axis.tickValues():void 0)},Axis.prototype.getXAxisTickValues=function getXAxisTickValues(){return this.getTickValues(this.owner.config.axis_x_tick_values,this.owner.xAxis)},Axis.prototype.getYAxisTickValues=function getYAxisTickValues(){return this.getTickValues(this.owner.config.axis_y_tick_values,this.owner.yAxis)},Axis.prototype.getY2AxisTickValues=function getY2AxisTickValues(){return this.getTickValues(this.owner.config.axis_y2_tick_values,this.owner.y2Axis)},Axis.prototype.getLabelOptionByAxisId=function getLabelOptionByAxisId(axisId){var option,config=this.owner.config;return"y"===axisId?option=config.axis_y_label:"y2"===axisId?option=config.axis_y2_label:"x"===axisId&&(option=config.axis_x_label),option},Axis.prototype.getLabelText=function getLabelText(option){option=this.getLabelOptionByAxisId(option);return isString(option)?option:option?option.text:null},Axis.prototype.setLabelText=function setLabelText(axisId,text){var config=this.owner.config,option=this.getLabelOptionByAxisId(axisId);isString(option)?"y"===axisId?config.axis_y_label=text:"y2"===axisId?config.axis_y2_label=text:"x"===axisId&&(config.axis_x_label=text):option&&(option.text=text)},Axis.prototype.getLabelPosition=function getLabelPosition(option,position){option=this.getLabelOptionByAxisId(option),position=option&&"object"===_typeof(option)&&option.position?option.position:position;return{isInner:0<=position.indexOf("inner"),isOuter:0<=position.indexOf("outer"),isLeft:0<=position.indexOf("left"),isCenter:0<=position.indexOf("center"),isRight:0<=position.indexOf("right"),isTop:0<=position.indexOf("top"),isMiddle:0<=position.indexOf("middle"),isBottom:0<=position.indexOf("bottom")}},Axis.prototype.getXAxisLabelPosition=function getXAxisLabelPosition(){return this.getLabelPosition("x",this.owner.config.axis_rotated?"inner-top":"inner-right")},Axis.prototype.getYAxisLabelPosition=function getYAxisLabelPosition(){return this.getLabelPosition("y",this.owner.config.axis_rotated?"inner-right":"inner-top")},Axis.prototype.getY2AxisLabelPosition=function getY2AxisLabelPosition(){return this.getLabelPosition("y2",this.owner.config.axis_rotated?"inner-right":"inner-top")},Axis.prototype.getLabelPositionById=function getLabelPositionById(id){return"y2"===id?this.getY2AxisLabelPosition():"y"===id?this.getYAxisLabelPosition():this.getXAxisLabelPosition()},Axis.prototype.textForXAxisLabel=function textForXAxisLabel(){return this.getLabelText("x")},Axis.prototype.textForYAxisLabel=function textForYAxisLabel(){return this.getLabelText("y")},Axis.prototype.textForY2AxisLabel=function textForY2AxisLabel(){return this.getLabelText("y2")},Axis.prototype.xForAxisLabel=function xForAxisLabel(forHorizontal,position){var $$=this.owner;return forHorizontal?position.isLeft?0:position.isCenter?$$.width/2:$$.width:position.isBottom?-$$.height:position.isMiddle?-$$.height/2:0},Axis.prototype.dxForAxisLabel=function dxForAxisLabel(forHorizontal,position){return forHorizontal?position.isLeft?"0.5em":position.isRight?"-0.5em":"0":position.isTop?"-0.5em":position.isBottom?"0.5em":"0"},Axis.prototype.textAnchorForAxisLabel=function textAnchorForAxisLabel(forHorizontal,position){return forHorizontal?position.isLeft?"start":position.isCenter?"middle":"end":position.isBottom?"start":position.isMiddle?"middle":"end"},Axis.prototype.xForXAxisLabel=function xForXAxisLabel(){return this.xForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},Axis.prototype.xForYAxisLabel=function xForYAxisLabel(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},Axis.prototype.xForY2AxisLabel=function xForY2AxisLabel(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},Axis.prototype.dxForXAxisLabel=function dxForXAxisLabel(){return this.dxForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},Axis.prototype.dxForYAxisLabel=function dxForYAxisLabel(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},Axis.prototype.dxForY2AxisLabel=function dxForY2AxisLabel(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},Axis.prototype.dyForXAxisLabel=function dyForXAxisLabel(){var $$=this.owner,config=$$.config,position=this.getXAxisLabelPosition();return config.axis_rotated?position.isInner?"1.2em":-25-($$.config.axis_x_inner?0:this.getMaxTickWidth("x")):position.isInner?"-0.5em":$$.getHorizontalAxisHeight("x")-10},Axis.prototype.dyForYAxisLabel=function dyForYAxisLabel(){var $$=this.owner,position=this.getYAxisLabelPosition();return $$.config.axis_rotated?position.isInner?"-0.5em":"3em":position.isInner?"1.2em":-10-($$.config.axis_y_inner?0:this.getMaxTickWidth("y")+10)},Axis.prototype.dyForY2AxisLabel=function dyForY2AxisLabel(){var $$=this.owner,position=this.getY2AxisLabelPosition();return $$.config.axis_rotated?position.isInner?"1.2em":"-2.2em":position.isInner?"-0.5em":15+($$.config.axis_y2_inner?0:this.getMaxTickWidth("y2")+15)},Axis.prototype.textAnchorForXAxisLabel=function textAnchorForXAxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel(!$$.config.axis_rotated,this.getXAxisLabelPosition())},Axis.prototype.textAnchorForYAxisLabel=function textAnchorForYAxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel($$.config.axis_rotated,this.getYAxisLabelPosition())},Axis.prototype.textAnchorForY2AxisLabel=function textAnchorForY2AxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel($$.config.axis_rotated,this.getY2AxisLabelPosition())},Axis.prototype.getMaxTickWidth=function getMaxTickWidth(id,targetsToShow){var scale,axis,dummy,$$=this.owner,maxWidth=0;return targetsToShow&&$$.currentMaxTickWidths[id]||($$.svg&&(targetsToShow=$$.filterTargetsToShow($$.data.targets),"y"===id?(scale=$$.y.copy().domain($$.getYDomain(targetsToShow,"y")),axis=this.getYAxis(id,scale,$$.yOrient,$$.yAxisTickValues,!1,!0,!0)):"y2"===id?(scale=$$.y2.copy().domain($$.getYDomain(targetsToShow,"y2")),axis=this.getYAxis(id,scale,$$.y2Orient,$$.y2AxisTickValues,!1,!0,!0)):(scale=$$.x.copy().domain($$.getXDomain(targetsToShow)),axis=this.getXAxis(scale,$$.xOrient,$$.xAxisTickFormat,$$.xAxisTickValues,!1,!0,!0),this.updateXAxisTickValues(targetsToShow,axis)),(dummy=$$.d3.select("body").append("div").classed("c3",!0)).append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0).append("g").call(axis).each(function(){$$.d3.select(this).selectAll("text").each(function(){var box=getBBox(this);maxWidth<box.width&&(maxWidth=box.width)}),dummy.remove()})),$$.currentMaxTickWidths[id]=maxWidth<=0?$$.currentMaxTickWidths[id]:maxWidth),$$.currentMaxTickWidths[id]},Axis.prototype.updateLabels=function updateLabels(withTransition){var axisY2Label=this.owner,axisXLabel=axisY2Label.main.select("."+CLASS.axisX+" ."+CLASS.axisXLabel),axisYLabel=axisY2Label.main.select("."+CLASS.axisY+" ."+CLASS.axisYLabel),axisY2Label=axisY2Label.main.select("."+CLASS.axisY2+" ."+CLASS.axisY2Label);(withTransition?axisXLabel.transition():axisXLabel).attr("x",this.xForXAxisLabel.bind(this)).attr("dx",this.dxForXAxisLabel.bind(this)).attr("dy",this.dyForXAxisLabel.bind(this)).text(this.textForXAxisLabel.bind(this)),(withTransition?axisYLabel.transition():axisYLabel).attr("x",this.xForYAxisLabel.bind(this)).attr("dx",this.dxForYAxisLabel.bind(this)).attr("dy",this.dyForYAxisLabel.bind(this)).text(this.textForYAxisLabel.bind(this)),(withTransition?axisY2Label.transition():axisY2Label).attr("x",this.xForY2AxisLabel.bind(this)).attr("dx",this.dxForY2AxisLabel.bind(this)).attr("dy",this.dyForY2AxisLabel.bind(this)).text(this.textForY2AxisLabel.bind(this))},Axis.prototype.getPadding=function getPadding(padding,key,defaultValue,domainLength){var p="number"==typeof padding?padding:padding[key];return isValue(p)?"ratio"===padding.unit?padding[key]*domainLength:this.convertPixelsToAxisPadding(p,domainLength):defaultValue},Axis.prototype.convertPixelsToAxisPadding=function convertPixelsToAxisPadding(pixels,domainLength){var $$=this.owner;return domainLength*(pixels/($$.config.axis_rotated?$$.width:$$.height))},Axis.prototype.generateTickValues=function generateTickValues(end,targetCount,forTimeSeries){var start,count,interval,i,tickValue,tickValues=end;if(targetCount)if(1===(targetCount=isFunction(targetCount)?targetCount():targetCount))tickValues=[end[0]];else if(2===targetCount)tickValues=[end[0],end[end.length-1]];else if(2<targetCount){for(count=targetCount-2,start=end[0],interval=((end=end[end.length-1])-start)/(1+count),tickValues=[start],i=0;i<count;i++)tickValue=+start+interval*(i+1),tickValues.push(forTimeSeries?new Date(tickValue):tickValue);tickValues.push(end)}return tickValues=!forTimeSeries?tickValues.sort(function(a,b){return a-b}):tickValues},Axis.prototype.generateTransitions=function generateTransitions(duration){var axes=this.owner.axes;return{axisX:duration?axes.x.transition().duration(duration):axes.x,axisY:duration?axes.y.transition().duration(duration):axes.y,axisY2:duration?axes.y2.transition().duration(duration):axes.y2,axisSubX:duration?axes.subx.transition().duration(duration):axes.subx}},Axis.prototype.redraw=function redraw(transition,isHidden){var $$=this.owner,transition=transition?$$.d3.transition().duration(transition):null;$$.axes.x.style("opacity",isHidden?0:1).call($$.xAxis,transition),$$.axes.y.style("opacity",isHidden?0:1).call($$.yAxis,transition),$$.axes.y2.style("opacity",isHidden?0:1).call($$.y2Axis,transition),$$.axes.subx.style("opacity",isHidden?0:1).call($$.subXAxis,transition)};var c3={version:"0.7.11",chart:{fn:Chart.prototype,internal:{fn:ChartInternal.prototype,axis:{fn:Axis.prototype,internal:{fn:AxisInternal.prototype}}}},generate:function generate(config){return new Chart(config)}};function c3LogScale(d3,linearScale,logScale){var PROJECTION=[.01,10];function scale(x){return logScale(linearScale(x))}return linearScale||(linearScale=d3.scaleLinear()).range(PROJECTION),logScale||((logScale=d3.scaleLog()).domain(PROJECTION),logScale.nice()),scale.domain=function(x){return arguments.length?(linearScale.domain(x),scale):linearScale.domain()},scale.range=function(x){return arguments.length?(logScale.range(x),scale):logScale.range()},scale.ticks=function(m){return function logspace(a,b,len){var arr,end,tmp,d;if(arguments.length<3)len=10;else if(0===len)return[];d=(b-a)/(end=len-1),tmp=a,(arr=new Array(len))[0]=Math.pow(10,tmp);for(var i=1;i<end;i++)tmp+=d,arr[i]=Math.pow(10,tmp);return arr[end]=Math.pow(10,b),arr}(-2,1,m||10).map(function(v){return linearScale.invert(v)})},scale.copy=function(){return c3LogScale(d3,linearScale.copy(),logScale.copy())},scale}function powerOfTen(d){return d/Math.pow(10,Math.ceil(Math.log(d)/Math.LN10-1e-12))==1}ChartInternal.prototype.beforeInit=function(){},ChartInternal.prototype.afterInit=function(){},ChartInternal.prototype.init=function(){var $$=this,config=$$.config;if($$.initParams(),config.data_url)$$.convertUrlToData(config.data_url,config.data_mimeType,config.data_headers,config.data_keys,$$.initWithData);else if(config.data_json)$$.initWithData($$.convertJsonToData(config.data_json,config.data_keys));else if(config.data_rows)$$.initWithData($$.convertRowsToData(config.data_rows));else{if(!config.data_columns)throw Error("url or json or rows or columns is required.");$$.initWithData($$.convertColumnsToData(config.data_columns))}},ChartInternal.prototype.initParams=function(){var $$=this,d3=$$.d3,config=$$.config;$$.clipId="c3-"+ +new Date+"-clip",$$.clipIdForXAxis=$$.clipId+"-xaxis",$$.clipIdForYAxis=$$.clipId+"-yaxis",$$.clipIdForGrid=$$.clipId+"-grid",$$.clipIdForSubchart=$$.clipId+"-subchart",$$.clipPath=$$.getClipPath($$.clipId),$$.clipPathForXAxis=$$.getClipPath($$.clipIdForXAxis),$$.clipPathForYAxis=$$.getClipPath($$.clipIdForYAxis),$$.clipPathForGrid=$$.getClipPath($$.clipIdForGrid),$$.clipPathForSubchart=$$.getClipPath($$.clipIdForSubchart),$$.dragStart=null,$$.dragging=!1,$$.flowing=!1,$$.cancelClick=!1,$$.mouseover=void 0,$$.transiting=!1,$$.color=$$.generateColor(),$$.levelColor=$$.generateLevelColor(),$$.dataTimeParse=(config.data_xLocaltime?d3.timeParse:d3.utcParse)($$.config.data_xFormat),$$.axisTimeFormat=config.axis_x_localtime?d3.timeFormat:d3.utcFormat,$$.defaultAxisTimeFormat=function(date){return(date.getMilliseconds()?d3.timeFormat(".%L"):date.getSeconds()?d3.timeFormat(":%S"):date.getMinutes()?d3.timeFormat("%I:%M"):date.getHours()?d3.timeFormat("%I %p"):date.getDay()&&1!==date.getDate()||1!==date.getDate()||date.getMonth()?d3.timeFormat("%-m/%-d"):d3.timeFormat("%Y/%-m/%-d"))(date)},$$.hiddenTargetIds=[],$$.hiddenLegendIds=[],$$.focusedTargetIds=[],$$.defocusedTargetIds=[],$$.xOrient=config.axis_rotated?config.axis_x_inner?"right":"left":config.axis_x_inner?"top":"bottom",$$.yOrient=config.axis_rotated?config.axis_y_inner?"top":"bottom":config.axis_y_inner?"right":"left",$$.y2Orient=config.axis_rotated?config.axis_y2_inner?"bottom":"top":config.axis_y2_inner?"left":"right",$$.subXOrient=config.axis_rotated?"left":"bottom",$$.isLegendRight="right"===config.legend_position,$$.isLegendInset="inset"===config.legend_position,$$.isLegendTop="top-left"===config.legend_inset_anchor||"top-right"===config.legend_inset_anchor,$$.isLegendLeft="top-left"===config.legend_inset_anchor||"bottom-left"===config.legend_inset_anchor,$$.legendStep=0,$$.legendItemWidth=0,$$.legendItemHeight=0,$$.currentMaxTickWidths={x:0,y:0,y2:0},$$.rotated_padding_left=30,$$.rotated_padding_right=config.axis_rotated&&!config.axis_x_show?0:30,$$.rotated_padding_top=5,$$.withoutFadeIn={},$$.intervalForObserveInserted=void 0,$$.axes.subx=d3.selectAll([])},ChartInternal.prototype.initChartElements=function(){this.initBar&&this.initBar(),this.initLine&&this.initLine(),this.initArc&&this.initArc(),this.initGauge&&this.initGauge(),this.initText&&this.initText()},ChartInternal.prototype.initWithData=function(data){var $$=this,main=$$.d3,config=$$.config,binding=!0;$$.axis=new Axis($$),config.bindto?"function"==typeof config.bindto.node?$$.selectChart=config.bindto:$$.selectChart=main.select(config.bindto):$$.selectChart=main.selectAll([]),$$.selectChart.empty()&&($$.selectChart=main.select(document.createElement("div")).style("opacity",0),$$.observeInserted($$.selectChart),binding=!1),$$.selectChart.html("").classed("c3",!0),$$.data.xs={},$$.data.targets=$$.convertDataToTargets(data),config.data_filter&&($$.data.targets=$$.data.targets.filter(config.data_filter)),config.data_hide&&$$.addHiddenTargetIds(!0===config.data_hide?$$.mapToIds($$.data.targets):config.data_hide),config.legend_hide&&$$.addHiddenLegendIds(!0===config.legend_hide?$$.mapToIds($$.data.targets):config.legend_hide),$$.isStanfordGraphType()&&$$.initStanfordData(),$$.updateSizes(),$$.updateScales(),$$.x.domain(main.extent($$.getXDomain($$.data.targets))),$$.y.domain($$.getYDomain($$.data.targets,"y")),$$.y2.domain($$.getYDomain($$.data.targets,"y2")),$$.subX.domain($$.x.domain()),$$.subY.domain($$.y.domain()),$$.subY2.domain($$.y2.domain()),$$.orgXDomain=$$.x.domain(),$$.svg=$$.selectChart.append("svg").style("overflow","hidden").on("mouseenter",function(){return config.onmouseover.call($$)}).on("mouseleave",function(){return config.onmouseout.call($$)}),$$.config.svg_classname&&$$.svg.attr("class",$$.config.svg_classname),main=$$.svg.append("defs"),$$.clipChart=$$.appendClip(main,$$.clipId),$$.clipXAxis=$$.appendClip(main,$$.clipIdForXAxis),$$.clipYAxis=$$.appendClip(main,$$.clipIdForYAxis),$$.clipGrid=$$.appendClip(main,$$.clipIdForGrid),$$.clipSubchart=$$.appendClip(main,$$.clipIdForSubchart),$$.updateSvgSize(),main=$$.main=$$.svg.append("g").attr("transform",$$.getTranslate("main")),$$.initPie&&$$.initPie(),$$.initDragZoom&&$$.initDragZoom(),$$.initSubchart&&$$.initSubchart(),$$.initTooltip&&$$.initTooltip(),$$.initLegend&&$$.initLegend(),$$.initTitle&&$$.initTitle(),$$.initZoom&&$$.initZoom(),$$.isStanfordGraphType()&&$$.drawColorScale(),$$.initSubchartBrush&&$$.initSubchartBrush(),main.append("text").attr("class",CLASS.text+" "+CLASS.empty).attr("text-anchor","middle").attr("dominant-baseline","middle"),$$.initRegion(),$$.initGrid(),main.append("g").attr("clip-path",$$.clipPath).attr("class",CLASS.chart),config.grid_lines_front&&$$.initGridLines(),$$.initStanfordElements(),$$.initEventRect(),$$.initChartElements(),$$.axis.init(),$$.updateTargets($$.data.targets),config.axis_x_selection&&$$.brush.selectionAsValue($$.getDefaultSelection()),binding&&($$.updateDimension(),$$.config.oninit.call($$),$$.redraw({withTransition:!1,withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransitionForAxis:!1})),$$.bindResize(),$$.bindWindowFocus(),$$.api.element=$$.selectChart.node()},ChartInternal.prototype.smoothLines=function(el,type){var $$=this;"grid"===type&&el.each(function(){var g=$$.d3.select(this),x1=g.attr("x1"),x2=g.attr("x2"),y1=g.attr("y1"),y2=g.attr("y2");g.attr({x1:Math.ceil(x1),x2:Math.ceil(x2),y1:Math.ceil(y1),y2:Math.ceil(y2)})})},ChartInternal.prototype.updateSizes=function(){var $$=this,config=$$.config,legendHeight=$$.legend?$$.getLegendHeight():0,legendWidth=$$.legend?$$.getLegendWidth():0,legendHeightForBottom=$$.isLegendRight||$$.isLegendInset?0:legendHeight,hasArc=$$.hasArcType(),xAxisHeight=config.axis_rotated||hasArc?0:$$.getHorizontalAxisHeight("x"),subchartHeight=config.subchart_show&&!hasArc?config.subchart_size_height+xAxisHeight:0;$$.currentWidth=$$.getCurrentWidth(),$$.currentHeight=$$.getCurrentHeight(),$$.margin=config.axis_rotated?{top:$$.getHorizontalAxisHeight("y2")+$$.getCurrentPaddingTop(),right:hasArc?0:$$.getCurrentPaddingRight(),bottom:$$.getHorizontalAxisHeight("y")+legendHeightForBottom+$$.getCurrentPaddingBottom(),left:subchartHeight+(hasArc?0:$$.getCurrentPaddingLeft())}:{top:4+$$.getCurrentPaddingTop(),right:hasArc?0:$$.getCurrentPaddingRight(),bottom:xAxisHeight+subchartHeight+legendHeightForBottom+$$.getCurrentPaddingBottom(),left:hasArc?0:$$.getCurrentPaddingLeft()},$$.margin2=config.axis_rotated?{top:$$.margin.top,right:NaN,bottom:20+legendHeightForBottom,left:$$.rotated_padding_left}:{top:$$.currentHeight-subchartHeight-legendHeightForBottom,right:NaN,bottom:xAxisHeight+legendHeightForBottom,left:$$.margin.left},$$.margin3={top:0,right:NaN,bottom:0,left:0},$$.updateSizeForLegend&&$$.updateSizeForLegend(legendHeight,legendWidth),$$.width=$$.currentWidth-$$.margin.left-$$.margin.right,$$.height=$$.currentHeight-$$.margin.top-$$.margin.bottom,$$.width<0&&($$.width=0),$$.height<0&&($$.height=0),$$.width2=config.axis_rotated?$$.margin.left-$$.rotated_padding_left-$$.rotated_padding_right:$$.width,$$.height2=config.axis_rotated?$$.height:$$.currentHeight-$$.margin2.top-$$.margin2.bottom,$$.width2<0&&($$.width2=0),$$.height2<0&&($$.height2=0),$$.arcWidth=$$.width-($$.isLegendRight?legendWidth+10:0),$$.arcHeight=$$.height-($$.isLegendRight?0:10),$$.hasType("gauge")&&!config.gauge_fullCircle&&($$.arcHeight+=$$.height-$$.getGaugeLabelHeight()),$$.updateRadius&&$$.updateRadius(),$$.isLegendRight&&hasArc&&($$.margin3.left=$$.arcWidth/2+1.1*$$.radiusExpanded)},ChartInternal.prototype.updateTargets=function(targets){var $$=this;$$.updateTargetsForText(targets),$$.updateTargetsForBar(targets),$$.updateTargetsForLine(targets),$$.hasArcType()&&$$.updateTargetsForArc&&$$.updateTargetsForArc(targets),$$.updateTargetsForSubchart&&$$.updateTargetsForSubchart(targets),$$.showTargets()},ChartInternal.prototype.showTargets=function(){var $$=this;$$.svg.selectAll("."+CLASS.target).filter(function(d){return $$.isTargetToShow(d.id)}).transition().duration($$.config.transition_duration).style("opacity",1)},ChartInternal.prototype.redraw=function(options,transitions){var transitionsToWait,waitForDraw,flow,tickValues,i,intervalForCulling,drawBar,$$=this,main=$$.main,d3=$$.d3,config=$$.config,areaIndices=$$.getShapeIndices($$.isAreaType),barIndices=$$.getShapeIndices($$.isBarType),lineIndices=$$.getShapeIndices($$.isLineType),xForText=$$.hasArcType(),targetsToShow=$$.filterTargetsToShow($$.data.targets),xv=$$.xv.bind($$),withY=getOption(options=options||{},"withY",!0),withSubchart=getOption(options,"withSubchart",!0),yForText=getOption(options,"withTransition",!0),withTransform=getOption(options,"withTransform",!1),cx=getOption(options,"withUpdateXDomain",!1),withUpdateOrgXDomain=getOption(options,"withUpdateOrgXDomain",!1),drawArea=getOption(options,"withTrimXDomain",!0),cy=getOption(options,"withUpdateXAxis",cx),withLegend=getOption(options,"withLegend",!1),withEventRect=getOption(options,"withEventRect",!0),withDimension=getOption(options,"withDimension",!0),durationForExit=getOption(options,"withTransitionForExit",yForText),drawLine=getOption(options,"withTransitionForAxis",yForText),transition=yForText?config.transition_duration:0,durationForExit=durationForExit?transition:0,drawLine=drawLine?transition:0;if(transitions=transitions||$$.axis.generateTransitions(drawLine),withLegend&&config.legend_show?$$.updateLegend($$.mapToIds($$.data.targets),options,transitions):withDimension&&$$.updateDimension(!0),$$.isCategorized()&&0===targetsToShow.length&&$$.x.domain([0,$$.axes.x.selectAll(".tick").size()]),targetsToShow.length?($$.updateXDomain(targetsToShow,cx,withUpdateOrgXDomain,drawArea),config.axis_x_tick_values||(tickValues=$$.axis.updateXAxisTickValues(targetsToShow))):($$.xAxis.tickValues([]),$$.subXAxis.tickValues([])),config.zoom_rescale&&!options.flow&&(drawBar=$$.x.orgDomain()),$$.y.domain($$.getYDomain(targetsToShow,"y",drawBar)),$$.y2.domain($$.getYDomain(targetsToShow,"y2",drawBar)),!config.axis_y_tick_values&&config.axis_y_tick_count&&$$.yAxis.tickValues($$.axis.generateTickValues($$.y.domain(),config.axis_y_tick_count)),!config.axis_y2_tick_values&&config.axis_y2_tick_count&&$$.y2Axis.tickValues($$.axis.generateTickValues($$.y2.domain(),config.axis_y2_tick_count)),$$.axis.redraw(drawLine,xForText),$$.axis.updateLabels(yForText),(cx||cy)&&targetsToShow.length)if(config.axis_x_tick_culling&&tickValues){for(i=1;i<tickValues.length;i++)if(tickValues.length/i<config.axis_x_tick_culling_max){intervalForCulling=i;break}$$.svg.selectAll("."+CLASS.axisX+" .tick text").each(function(index){index=tickValues.indexOf(index);0<=index&&d3.select(this).style("display",index%intervalForCulling?"none":"block")})}else $$.svg.selectAll("."+CLASS.axisX+" .tick text").style("display","block");drawArea=$$.generateDrawArea?$$.generateDrawArea(areaIndices,!1):void 0,drawBar=$$.generateDrawBar?$$.generateDrawBar(barIndices):void 0,drawLine=$$.generateDrawLine?$$.generateDrawLine(lineIndices,!1):void 0,xForText=$$.generateXYForText(areaIndices,barIndices,lineIndices,!0),yForText=$$.generateXYForText(areaIndices,barIndices,lineIndices,!1),$$.updateCircleY(),cx=($$.config.axis_rotated?$$.circleY:$$.circleX).bind($$),cy=($$.config.axis_rotated?$$.circleX:$$.circleY).bind($$),withY&&($$.subY.domain($$.getYDomain(targetsToShow,"y")),$$.subY2.domain($$.getYDomain(targetsToShow,"y2"))),$$.updateXgridFocus(),main.select("text."+CLASS.text+"."+CLASS.empty).attr("x",$$.width/2).attr("y",$$.height/2).text(config.data_empty_label_text).transition().style("opacity",targetsToShow.length?0:1),withEventRect&&$$.redrawEventRect(),$$.updateGrid(transition),$$.updateStanfordElements(transition),$$.updateRegion(transition),$$.updateBar(durationForExit),$$.updateLine(durationForExit),$$.updateArea(durationForExit),$$.updateCircle(cx,cy),$$.hasDataLabel()&&$$.updateText(xForText,yForText,durationForExit),$$.redrawTitle&&$$.redrawTitle(),$$.redrawArc&&$$.redrawArc(transition,durationForExit,withTransform),$$.redrawSubchart&&$$.redrawSubchart(withSubchart,transitions,transition,durationForExit,areaIndices,barIndices,lineIndices),$$.isStanfordGraphType()&&$$.drawColorScale(),main.selectAll("."+CLASS.selectedCircles).filter($$.isBarType.bind($$)).selectAll("circle").remove(),options.flow&&(flow=$$.generateFlow({targets:targetsToShow,flow:options.flow,duration:options.flow.duration,drawBar:drawBar,drawLine:drawLine,drawArea:drawArea,cx:cx,cy:cy,xv:xv,xForText:xForText,yForText:yForText})),transition&&$$.isTabVisible()?(transition=d3.transition().duration(transition),transitionsToWait=[],[$$.redrawBar(drawBar,!0,transition),$$.redrawLine(drawLine,!0,transition),$$.redrawArea(drawArea,!0,transition),$$.redrawCircle(cx,cy,!0,transition),$$.redrawText(xForText,yForText,options.flow,!0,transition),$$.redrawRegion(!0,transition),$$.redrawGrid(!0,transition)].forEach(function(transitions){transitions.forEach(function(transition){transitionsToWait.push(transition)})}),waitForDraw=$$.generateWait(),transitionsToWait.forEach(function(t){waitForDraw.add(t)}),waitForDraw(function(){flow&&flow(),config.onrendered&&config.onrendered.call($$)})):($$.redrawBar(drawBar),$$.redrawLine(drawLine),$$.redrawArea(drawArea),$$.redrawCircle(cx,cy),$$.redrawText(xForText,yForText,options.flow),$$.redrawRegion(),$$.redrawGrid(),flow&&flow(),config.onrendered&&config.onrendered.call($$)),$$.mapToIds($$.data.targets).forEach(function(id){$$.withoutFadeIn[id]=!0})},ChartInternal.prototype.updateAndRedraw=function(options){var transitions,$$=this,config=$$.config;(options=options||{}).withTransition=getOption(options,"withTransition",!0),options.withTransform=getOption(options,"withTransform",!1),options.withLegend=getOption(options,"withLegend",!1),options.withUpdateXDomain=getOption(options,"withUpdateXDomain",!0),options.withUpdateOrgXDomain=getOption(options,"withUpdateOrgXDomain",!0),options.withTransitionForExit=!1,options.withTransitionForTransform=getOption(options,"withTransitionForTransform",options.withTransition),$$.updateSizes(),options.withLegend&&config.legend_show||(transitions=$$.axis.generateTransitions(options.withTransitionForAxis?config.transition_duration:0),$$.updateScales(),$$.updateSvgSize(),$$.transformAll(options.withTransitionForTransform,transitions)),$$.redraw(options,transitions)},ChartInternal.prototype.redrawWithoutRescale=function(){this.redraw({withY:!1,withSubchart:!1,withEventRect:!1,withTransitionForAxis:!1})},ChartInternal.prototype.isTimeSeries=function(){return"timeseries"===this.config.axis_x_type},ChartInternal.prototype.isCategorized=function(){return 0<=this.config.axis_x_type.indexOf("categor")},ChartInternal.prototype.isCustomX=function(){var config=this.config;return!this.isTimeSeries()&&(config.data_x||notEmpty(config.data_xs))},ChartInternal.prototype.isTimeSeriesY=function(){return"timeseries"===this.config.axis_y_type},ChartInternal.prototype.getTranslate=function(target){var x,y,$$=this,config=$$.config;return"main"===target?(x=asHalfPixel($$.margin.left),y=asHalfPixel($$.margin.top)):"context"===target?(x=asHalfPixel($$.margin2.left),y=asHalfPixel($$.margin2.top)):"legend"===target?(x=$$.margin3.left,y=$$.margin3.top):"x"===target?(x=0,y=config.axis_rotated?0:$$.height):"y"===target?(x=0,y=config.axis_rotated?$$.height:0):"y2"===target?(x=config.axis_rotated?0:$$.width,y=config.axis_rotated?1:0):"subx"===target?(x=0,y=config.axis_rotated?0:$$.height2):"arc"===target&&(x=$$.arcWidth/2,y=$$.arcHeight/2-($$.hasType("gauge")?6:0)),"translate("+x+","+y+")"},ChartInternal.prototype.initialOpacity=function(d){return null!==d.value&&this.withoutFadeIn[d.id]?1:0},ChartInternal.prototype.initialOpacityForCircle=function(d){return null!==d.value&&this.withoutFadeIn[d.id]?this.opacityForCircle(d):0},ChartInternal.prototype.opacityForCircle=function(d){var opacity=(isFunction(this.config.point_show)?this.config.point_show(d):this.config.point_show)||this.isStanfordType(d)?1:0;return isValue(d.value)?this.isScatterType(d)?.5:opacity:0},ChartInternal.prototype.opacityForText=function(){return this.hasDataLabel()?1:0},ChartInternal.prototype.xx=function(d){return d?this.x(d.x):null},ChartInternal.prototype.xvCustom=function(d,value){var $$=this,value=value?d[value]:d.value;return $$.isTimeSeries()?value=$$.parseDate(d.value):$$.isCategorized()&&"string"==typeof d.value&&(value=$$.config.axis_x_categories.indexOf(d.value)),Math.ceil($$.x(value))},ChartInternal.prototype.yvCustom=function(value,xyValue){var yScale=value.axis&&"y2"===value.axis?this.y2:this.y,value=xyValue?value[xyValue]:value.value;return Math.ceil(yScale(value))},ChartInternal.prototype.xv=function(d){var $$=this,value=d.value;return $$.isTimeSeries()?value=$$.parseDate(d.value):$$.isCategorized()&&"string"==typeof d.value&&(value=$$.config.axis_x_categories.indexOf(d.value)),Math.ceil($$.x(value))},ChartInternal.prototype.yv=function(d){var yScale=d.axis&&"y2"===d.axis?this.y2:this.y;return Math.ceil(yScale(d.value))},ChartInternal.prototype.subxx=function(d){return d?this.subX(d.x):null},ChartInternal.prototype.transformMain=function(withTransition,transitions){var xAxis,yAxis,y2Axis,$$=this;transitions&&transitions.axisX?xAxis=transitions.axisX:(xAxis=$$.main.select("."+CLASS.axisX),withTransition&&(xAxis=xAxis.transition())),transitions&&transitions.axisY?yAxis=transitions.axisY:(yAxis=$$.main.select("."+CLASS.axisY),withTransition&&(yAxis=yAxis.transition())),transitions&&transitions.axisY2?y2Axis=transitions.axisY2:(y2Axis=$$.main.select("."+CLASS.axisY2),withTransition&&(y2Axis=y2Axis.transition())),(withTransition?$$.main.transition():$$.main).attr("transform",$$.getTranslate("main")),xAxis.attr("transform",$$.getTranslate("x")),yAxis.attr("transform",$$.getTranslate("y")),y2Axis.attr("transform",$$.getTranslate("y2")),$$.main.select("."+CLASS.chartArcs).attr("transform",$$.getTranslate("arc"))},ChartInternal.prototype.transformAll=function(withTransition,transitions){var $$=this;$$.transformMain(withTransition,transitions),$$.config.subchart_show&&$$.transformContext(withTransition,transitions),$$.legend&&$$.transformLegend(withTransition)},ChartInternal.prototype.updateSvgSize=function(){var $$=this,brush=$$.svg.select(".c3-brush .overlay");$$.svg.attr("width",$$.currentWidth).attr("height",$$.currentHeight),$$.svg.selectAll(["#"+$$.clipId,"#"+$$.clipIdForGrid]).select("rect").attr("width",$$.width).attr("height",$$.height),$$.svg.select("#"+$$.clipIdForXAxis).select("rect").attr("x",$$.getXAxisClipX.bind($$)).attr("y",$$.getXAxisClipY.bind($$)).attr("width",$$.getXAxisClipWidth.bind($$)).attr("height",$$.getXAxisClipHeight.bind($$)),$$.svg.select("#"+$$.clipIdForYAxis).select("rect").attr("x",$$.getYAxisClipX.bind($$)).attr("y",$$.getYAxisClipY.bind($$)).attr("width",$$.getYAxisClipWidth.bind($$)).attr("height",$$.getYAxisClipHeight.bind($$)),$$.svg.select("#"+$$.clipIdForSubchart).select("rect").attr("width",$$.width).attr("height",brush.size()?brush.attr("height"):0),$$.selectChart.style("max-height",$$.currentHeight+"px")},ChartInternal.prototype.updateDimension=function(withoutAxis){var $$=this;withoutAxis||($$.config.axis_rotated?($$.axes.x.call($$.xAxis),$$.axes.subx.call($$.subXAxis)):($$.axes.y.call($$.yAxis),$$.axes.y2.call($$.y2Axis))),$$.updateSizes(),$$.updateScales(),$$.updateSvgSize(),$$.transformAll(!1)},ChartInternal.prototype.observeInserted=function(selection){var observer,$$=this;"undefined"!=typeof MutationObserver?(observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){"childList"===mutation.type&&mutation.previousSibling&&(observer.disconnect(),$$.intervalForObserveInserted=window.setInterval(function(){selection.node().parentNode&&(window.clearInterval($$.intervalForObserveInserted),$$.updateDimension(),$$.brush&&$$.brush.update(),$$.config.oninit.call($$),$$.redraw({withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransition:!1,withTransitionForTransform:!1,withLegend:!0}),selection.transition().style("opacity",1))},10))})})).observe(selection.node(),{attributes:!0,childList:!0,characterData:!0}):window.console.error("MutationObserver not defined.")},ChartInternal.prototype.bindResize=function(){var wrapper,$$=this,config=$$.config;$$.resizeFunction=$$.generateResize(),$$.resizeFunction.add(function(){config.onresize.call($$)}),config.resize_auto&&$$.resizeFunction.add(function(){void 0!==$$.resizeTimeout&&window.clearTimeout($$.resizeTimeout),$$.resizeTimeout=window.setTimeout(function(){delete $$.resizeTimeout,$$.updateAndRedraw({withUpdateXDomain:!1,withUpdateOrgXDomain:!1,withTransition:!1,withTransitionForTransform:!1,withLegend:!0}),$$.brush&&$$.brush.update()},100)}),$$.resizeFunction.add(function(){config.onresized.call($$)}),$$.resizeIfElementDisplayed=function(){null!=$$.api&&$$.api.element.offsetParent&&$$.resizeFunction()},window.attachEvent?window.attachEvent("onresize",$$.resizeIfElementDisplayed):window.addEventListener?window.addEventListener("resize",$$.resizeIfElementDisplayed,!1):((wrapper=window.onresize)?wrapper.add&&wrapper.remove||(wrapper=$$.generateResize()).add(window.onresize):wrapper=$$.generateResize(),wrapper.add($$.resizeFunction),window.onresize=function(){$$.api.element.offsetParent&&wrapper()})},ChartInternal.prototype.bindWindowFocus=function(){var _this=this;this.windowFocusHandler||(this.windowFocusHandler=function(){_this.redraw()},window.addEventListener("focus",this.windowFocusHandler))},ChartInternal.prototype.unbindWindowFocus=function(){window.removeEventListener("focus",this.windowFocusHandler),delete this.windowFocusHandler},ChartInternal.prototype.generateResize=function(){var resizeFunctions=[];function callResizeFunctions(){resizeFunctions.forEach(function(f){f()})}return callResizeFunctions.add=function(f){resizeFunctions.push(f)},callResizeFunctions.remove=function(f){for(var i=0;i<resizeFunctions.length;i++)if(resizeFunctions[i]===f){resizeFunctions.splice(i,1);break}},callResizeFunctions},ChartInternal.prototype.endall=function(transition,callback){var n=0;transition.each(function(){++n}).on("end",function(){--n||callback.apply(this,arguments)})},ChartInternal.prototype.generateWait=function(){function f(callback){var timer=setInterval(function(){var done;$$.isTabVisible()&&(done=0,transitionsToWait.forEach(function(t){if(t.empty())done+=1;else try{t.transition()}catch(e){done+=1}}),done===transitionsToWait.length&&(clearInterval(timer),callback&&callback()))},50)}var $$=this,transitionsToWait=[];return f.add=function(transition){transitionsToWait.push(transition)},f},ChartInternal.prototype.parseDate=function(date){var parsedDate;return date instanceof Date?parsedDate=date:"string"==typeof date?parsedDate=this.dataTimeParse(date):"object"!==_typeof(date)&&("number"!=typeof date||isNaN(date))||(parsedDate=new Date(+date)),parsedDate&&!isNaN(+parsedDate)||window.console.error("Failed to parse x '"+date+"' to Date object"),parsedDate},ChartInternal.prototype.isTabVisible=function(){return!document.hidden},ChartInternal.prototype.getPathBox=getPathBox,ChartInternal.prototype.CLASS=CLASS,"SVGPathSeg"in window||(window.SVGPathSeg=function(type,typeAsLetter,owningPathSegList){this.pathSegType=type,this.pathSegTypeAsLetter=typeAsLetter,this._owningPathSegList=owningPathSegList},window.SVGPathSeg.prototype.classname="SVGPathSeg",window.SVGPathSeg.PATHSEG_UNKNOWN=0,window.SVGPathSeg.PATHSEG_CLOSEPATH=1,window.SVGPathSeg.PATHSEG_MOVETO_ABS=2,window.SVGPathSeg.PATHSEG_MOVETO_REL=3,window.SVGPathSeg.PATHSEG_LINETO_ABS=4,window.SVGPathSeg.PATHSEG_LINETO_REL=5,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9,window.SVGPathSeg.PATHSEG_ARC_ABS=10,window.SVGPathSeg.PATHSEG_ARC_REL=11,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19,window.SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)},window.SVGPathSegClosePath=function(owningPathSegList){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CLOSEPATH,"z",owningPathSegList)},window.SVGPathSegClosePath.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"},window.SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter},window.SVGPathSegClosePath.prototype.clone=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathSegMovetoAbs=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_ABS,"M",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegMovetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"},window.SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoAbs.prototype.clone=function(){return new window.SVGPathSegMovetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegMovetoRel=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_MOVETO_REL,"m",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegMovetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"},window.SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegMovetoRel.prototype.clone=function(){return new window.SVGPathSegMovetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegMovetoRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoAbs=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_ABS,"L",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegLinetoAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"},window.SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoAbs.prototype.clone=function(){return new window.SVGPathSegLinetoAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoRel=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_REL,"l",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegLinetoRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"},window.SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegLinetoRel.prototype.clone=function(){return new window.SVGPathSegLinetoRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegLinetoRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicAbs=function(owningPathSegList,x,y,x1,y1,x2,y2){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",owningPathSegList),this._x=x,this._y=y,this._x1=x1,this._y1=y1,this._x2=x2,this._y2=y2},window.SVGPathSegCurvetoCubicAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"},window.SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function get(){return this._x1},set:function set(x1){this._x1=x1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function get(){return this._y1},set:function set(y1){this._y1=y1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function get(){return this._x2},set:function set(x2){this._x2=x2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function get(){return this._y2},set:function set(y2){this._y2=y2,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicRel=function(owningPathSegList,x,y,x1,y1,x2,y2){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",owningPathSegList),this._x=x,this._y=y,this._x1=x1,this._y1=y1,this._x2=x2,this._y2=y2},window.SVGPathSegCurvetoCubicRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"},window.SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function get(){return this._x1},set:function set(x1){this._x1=x1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function get(){return this._y1},set:function set(y1){this._y1=y1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function get(){return this._x2},set:function set(x2){this._x2=x2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function get(){return this._y2},set:function set(y2){this._y2=y2,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticAbs=function(owningPathSegList,x,y,x1,y1){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",owningPathSegList),this._x=x,this._y=y,this._x1=x1,this._y1=y1},window.SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"},window.SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function get(){return this._x1},set:function set(x1){this._x1=x1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function get(){return this._y1},set:function set(y1){this._y1=y1,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticRel=function(owningPathSegList,x,y,x1,y1){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",owningPathSegList),this._x=x,this._y=y,this._x1=x1,this._y1=y1},window.SVGPathSegCurvetoQuadraticRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"},window.SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function get(){return this._x1},set:function set(x1){this._x1=x1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function get(){return this._y1},set:function set(y1){this._y1=y1,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcAbs=function(owningPathSegList,x,y,r1,r2,angle,largeArcFlag,sweepFlag){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_ABS,"A",owningPathSegList),this._x=x,this._y=y,this._r1=r1,this._r2=r2,this._angle=angle,this._largeArcFlag=largeArcFlag,this._sweepFlag=sweepFlag},window.SVGPathSegArcAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"},window.SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcAbs.prototype.clone=function(){return new window.SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r1",{get:function get(){return this._r1},set:function set(r1){this._r1=r1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"r2",{get:function get(){return this._r2},set:function set(r2){this._r2=r2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"angle",{get:function get(){return this._angle},set:function set(angle){this._angle=angle,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function get(){return this._largeArcFlag},set:function set(largeArcFlag){this._largeArcFlag=largeArcFlag,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcAbs.prototype,"sweepFlag",{get:function get(){return this._sweepFlag},set:function set(sweepFlag){this._sweepFlag=sweepFlag,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcRel=function(owningPathSegList,x,y,r1,r2,angle,largeArcFlag,sweepFlag){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_ARC_REL,"a",owningPathSegList),this._x=x,this._y=y,this._r1=r1,this._r2=r2,this._angle=angle,this._largeArcFlag=largeArcFlag,this._sweepFlag=sweepFlag},window.SVGPathSegArcRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"},window.SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},window.SVGPathSegArcRel.prototype.clone=function(){return new window.SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(window.SVGPathSegArcRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r1",{get:function get(){return this._r1},set:function set(r1){this._r1=r1,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"r2",{get:function get(){return this._r2},set:function set(r2){this._r2=r2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"angle",{get:function get(){return this._angle},set:function set(angle){this._angle=angle,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"largeArcFlag",{get:function get(){return this._largeArcFlag},set:function set(largeArcFlag){this._largeArcFlag=largeArcFlag,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegArcRel.prototype,"sweepFlag",{get:function get(){return this._sweepFlag},set:function set(sweepFlag){this._sweepFlag=sweepFlag,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalAbs=function(owningPathSegList,x){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",owningPathSegList),this._x=x},window.SVGPathSegLinetoHorizontalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"},window.SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalAbs(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalRel=function(owningPathSegList,x){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",owningPathSegList),this._x=x},window.SVGPathSegLinetoHorizontalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"},window.SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},window.SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new window.SVGPathSegLinetoHorizontalRel(void 0,this._x)},Object.defineProperty(window.SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalAbs=function(owningPathSegList,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",owningPathSegList),this._y=y},window.SVGPathSegLinetoVerticalAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"},window.SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalAbs(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalRel=function(owningPathSegList,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",owningPathSegList),this._y=y},window.SVGPathSegLinetoVerticalRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"},window.SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},window.SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new window.SVGPathSegLinetoVerticalRel(void 0,this._y)},Object.defineProperty(window.SVGPathSegLinetoVerticalRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothAbs=function(owningPathSegList,x,y,x2,y2){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",owningPathSegList),this._x=x,this._y=y,this._x2=x2,this._y2=y2},window.SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"},window.SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function get(){return this._x2},set:function set(x2){this._x2=x2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function get(){return this._y2},set:function set(y2){this._y2=y2,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothRel=function(owningPathSegList,x,y,x2,y2){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",owningPathSegList),this._x=x,this._y=y,this._x2=x2,this._y2=y2},window.SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"},window.SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},window.SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function get(){return this._x2},set:function set(x2){this._x2=x2,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function get(){return this._y2},set:function set(y2){this._y2=y2,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothAbs=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothRel=function(owningPathSegList,x,y){window.SVGPathSeg.call(this,window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",owningPathSegList),this._x=x,this._y=y},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(window.SVGPathSeg.prototype),window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},window.SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)},Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function get(){return this._x},set:function set(x){this._x=x,this._segmentChanged()},enumerable:!0}),Object.defineProperty(window.SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function get(){return this._y},set:function set(y){this._y=y,this._segmentChanged()},enumerable:!0}),window.SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new window.SVGPathSegClosePath(void 0)},window.SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(x,y){return new window.SVGPathSegMovetoAbs(void 0,x,y)},window.SVGPathElement.prototype.createSVGPathSegMovetoRel=function(x,y){return new window.SVGPathSegMovetoRel(void 0,x,y)},window.SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(x,y){return new window.SVGPathSegLinetoAbs(void 0,x,y)},window.SVGPathElement.prototype.createSVGPathSegLinetoRel=function(x,y){return new window.SVGPathSegLinetoRel(void 0,x,y)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(x,y,x1,y1,x2,y2){return new window.SVGPathSegCurvetoCubicAbs(void 0,x,y,x1,y1,x2,y2)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(x,y,x1,y1,x2,y2){return new window.SVGPathSegCurvetoCubicRel(void 0,x,y,x1,y1,x2,y2)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(x,y,x1,y1){return new window.SVGPathSegCurvetoQuadraticAbs(void 0,x,y,x1,y1)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(x,y,x1,y1){return new window.SVGPathSegCurvetoQuadraticRel(void 0,x,y,x1,y1)},window.SVGPathElement.prototype.createSVGPathSegArcAbs=function(x,y,r1,r2,angle,largeArcFlag,sweepFlag){return new window.SVGPathSegArcAbs(void 0,x,y,r1,r2,angle,largeArcFlag,sweepFlag)},window.SVGPathElement.prototype.createSVGPathSegArcRel=function(x,y,r1,r2,angle,largeArcFlag,sweepFlag){return new window.SVGPathSegArcRel(void 0,x,y,r1,r2,angle,largeArcFlag,sweepFlag)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(x){return new window.SVGPathSegLinetoHorizontalAbs(void 0,x)},window.SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(x){return new window.SVGPathSegLinetoHorizontalRel(void 0,x)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(y){return new window.SVGPathSegLinetoVerticalAbs(void 0,y)},window.SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(y){return new window.SVGPathSegLinetoVerticalRel(void 0,y)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(x,y,x2,y2){return new window.SVGPathSegCurvetoCubicSmoothAbs(void 0,x,y,x2,y2)},window.SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(x,y,x2,y2){return new window.SVGPathSegCurvetoCubicSmoothRel(void 0,x,y,x2,y2)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(x,y){return new window.SVGPathSegCurvetoQuadraticSmoothAbs(void 0,x,y)},window.SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(x,y){return new window.SVGPathSegCurvetoQuadraticSmoothRel(void 0,x,y)},"getPathSegAtLength"in window.SVGPathElement.prototype||(window.SVGPathElement.prototype.getPathSegAtLength=function(distance){if(void 0===distance||!isFinite(distance))throw"Invalid arguments.";var measurementElement=document.createElementNS("http://www.w3.org/2000/svg","path");measurementElement.setAttribute("d",this.getAttribute("d"));var lastPathSegment=measurementElement.pathSegList.numberOfItems-1;if(lastPathSegment<=0)return 0;for(;measurementElement.pathSegList.removeItem(lastPathSegment),!(distance>measurementElement.getTotalLength())&&0<--lastPathSegment;);return lastPathSegment})),"SVGPathSegList"in window||(window.SVGPathSegList=function(pathElement){this._pathElement=pathElement,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.classname="SVGPathSegList",Object.defineProperty(window.SVGPathSegList.prototype,"numberOfItems",{get:function get(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"pathSegList",{get:function get(){return this._pathSegList||(this._pathSegList=new window.SVGPathSegList(this)),this._pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"normalizedPathSegList",{get:function get(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedPathSegList",{get:function get(){return this.pathSegList},enumerable:!0}),Object.defineProperty(window.SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function get(){return this.pathSegList},enumerable:!0}),window.SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())},window.SVGPathSegList.prototype._updateListFromPathMutations=function(mutationRecords){var hasPathMutations;this._pathElement&&(hasPathMutations=!1,mutationRecords.forEach(function(record){"d"==record.attributeName&&(hasPathMutations=!0)}),hasPathMutations&&(this._list=this._parsePath(this._pathElement.getAttribute("d"))))},window.SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",window.SVGPathSegList._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},window.SVGPathSegList.prototype.segmentChanged=function(pathSeg){this._writeListToPath()},window.SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList(),this._list.forEach(function(pathSeg){pathSeg._owningPathSegList=null}),this._list=[],this._writeListToPath()},window.SVGPathSegList.prototype.initialize=function(newItem){return this._checkPathSynchronizedToList(),this._list=[newItem],(newItem._owningPathSegList=this)._writeListToPath(),newItem},window.SVGPathSegList.prototype._checkValidIndex=function(index){if(isNaN(index)||index<0||index>=this.numberOfItems)throw"INDEX_SIZE_ERR"},window.SVGPathSegList.prototype.getItem=function(index){return this._checkPathSynchronizedToList(),this._checkValidIndex(index),this._list[index]},window.SVGPathSegList.prototype.insertItemBefore=function(newItem,index){return this._checkPathSynchronizedToList(),index>this.numberOfItems&&(index=this.numberOfItems),newItem._owningPathSegList&&(newItem=newItem.clone()),this._list.splice(index,0,newItem),(newItem._owningPathSegList=this)._writeListToPath(),newItem},window.SVGPathSegList.prototype.replaceItem=function(newItem,index){return this._checkPathSynchronizedToList(),newItem._owningPathSegList&&(newItem=newItem.clone()),this._checkValidIndex(index),((this._list[index]=newItem)._owningPathSegList=this)._writeListToPath(),newItem},window.SVGPathSegList.prototype.removeItem=function(index){this._checkPathSynchronizedToList(),this._checkValidIndex(index);var item=this._list[index];return this._list.splice(index,1),this._writeListToPath(),item},window.SVGPathSegList.prototype.appendItem=function(newItem){return this._checkPathSynchronizedToList(),newItem._owningPathSegList&&(newItem=newItem.clone()),this._list.push(newItem),(newItem._owningPathSegList=this)._writeListToPath(),newItem},window.SVGPathSegList._pathSegArrayAsString=function(pathSegArray){var string="",first=!0;return pathSegArray.forEach(function(pathSeg){first?(first=!1,string+=pathSeg._asPathString()):string+=" "+pathSeg._asPathString()}),string},window.SVGPathSegList.prototype._parsePath=function(string){if(!string||0==string.length)return[];function Builder(){this.pathSegList=[]}var owningPathSegList=this;Builder.prototype.appendSegment=function(pathSeg){this.pathSegList.push(pathSeg)};function Source(string){this._string=string,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=window.SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()}Source.prototype._isCurrentSpace=function(){var character=this._string[this._currentIndex];return character<=" "&&(" "==character||"\n"==character||"\t"==character||"\r"==character||"\f"==character)},Source.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex},Source.prototype._skipOptionalSpacesOrDelimiter=function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},Source.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex},Source.prototype.peekSegmentType=function(){var lookahead=this._string[this._currentIndex];return this._pathSegTypeFromChar(lookahead)},Source.prototype._pathSegTypeFromChar=function(lookahead){switch(lookahead){case"Z":case"z":return window.SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return window.SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return window.SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return window.SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return window.SVGPathSeg.PATHSEG_LINETO_REL;case"C":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return window.SVGPathSeg.PATHSEG_ARC_ABS;case"a":return window.SVGPathSeg.PATHSEG_ARC_REL;case"H":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return window.SVGPathSeg.PATHSEG_UNKNOWN}},Source.prototype._nextCommandHelper=function(lookahead,previousCommand){return("+"==lookahead||"-"==lookahead||"."==lookahead||"0"<=lookahead&&lookahead<="9")&&previousCommand!=window.SVGPathSeg.PATHSEG_CLOSEPATH?previousCommand==window.SVGPathSeg.PATHSEG_MOVETO_ABS?window.SVGPathSeg.PATHSEG_LINETO_ABS:previousCommand==window.SVGPathSeg.PATHSEG_MOVETO_REL?window.SVGPathSeg.PATHSEG_LINETO_REL:previousCommand:window.SVGPathSeg.PATHSEG_UNKNOWN},Source.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var command=this.peekSegmentType();return command==window.SVGPathSeg.PATHSEG_MOVETO_ABS||command==window.SVGPathSeg.PATHSEG_MOVETO_REL},Source.prototype._parseNumber=function(){var exponent=0,integer=0,frac=1,decimal=0,sign=1,expsign=1,startIndex=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,sign=-1),!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))&&"."!=this._string.charAt(this._currentIndex))){for(var startIntPartIndex=this._currentIndex;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=startIntPartIndex)for(var scanIntPartIndex=this._currentIndex-1,multiplier=1;startIntPartIndex<=scanIntPartIndex;)integer+=multiplier*(this._string.charAt(scanIntPartIndex--)-"0"),multiplier*=10;if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))return;for(;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)frac*=10,decimal+=(this._string.charAt(this._currentIndex)-"0")/frac,this._currentIndex+=1}if(this._currentIndex!=startIndex&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,expsign=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||"9"<this._string.charAt(this._currentIndex))return;for(;this._currentIndex<this._endIndex&&"0"<=this._string.charAt(this._currentIndex)&&this._string.charAt(this._currentIndex)<="9";)exponent*=10,exponent+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var number=integer+decimal;if(number*=sign,exponent&&(number*=Math.pow(10,expsign*exponent)),startIndex!=this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),number}},Source.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var flag=!1,flagChar=this._string.charAt(this._currentIndex++);if("0"==flagChar)flag=!1;else{if("1"!=flagChar)return;flag=!0}return this._skipOptionalSpacesOrDelimiter(),flag}},Source.prototype.parseSegment=function(){var lookahead=this._string[this._currentIndex],command=this._pathSegTypeFromChar(lookahead);if(command==window.SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==window.SVGPathSeg.PATHSEG_UNKNOWN)return null;if((command=this._nextCommandHelper(lookahead,this._previousCommand))==window.SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=command){case window.SVGPathSeg.PATHSEG_MOVETO_REL:return new window.SVGPathSegMovetoRel(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_MOVETO_ABS:return new window.SVGPathSegMovetoAbs(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_REL:return new window.SVGPathSegLinetoRel(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_ABS:return new window.SVGPathSegLinetoAbs(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new window.SVGPathSegLinetoHorizontalRel(owningPathSegList,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new window.SVGPathSegLinetoHorizontalAbs(owningPathSegList,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new window.SVGPathSegLinetoVerticalRel(owningPathSegList,this._parseNumber());case window.SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new window.SVGPathSegLinetoVerticalAbs(owningPathSegList,this._parseNumber());case window.SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new window.SVGPathSegClosePath(owningPathSegList);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var points={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicRel(owningPathSegList,points.x,points.y,points.x1,points.y1,points.x2,points.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:points={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicAbs(owningPathSegList,points.x,points.y,points.x1,points.y1,points.x2,points.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:points={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicSmoothRel(owningPathSegList,points.x,points.y,points.x2,points.y2);case window.SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:points={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoCubicSmoothAbs(owningPathSegList,points.x,points.y,points.x2,points.y2);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:points={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoQuadraticRel(owningPathSegList,points.x,points.y,points.x1,points.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:points={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegCurvetoQuadraticAbs(owningPathSegList,points.x,points.y,points.x1,points.y1);case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new window.SVGPathSegCurvetoQuadraticSmoothRel(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new window.SVGPathSegCurvetoQuadraticSmoothAbs(owningPathSegList,this._parseNumber(),this._parseNumber());case window.SVGPathSeg.PATHSEG_ARC_REL:points={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegArcRel(owningPathSegList,points.x,points.y,points.x1,points.y1,points.arcAngle,points.arcLarge,points.arcSweep);case window.SVGPathSeg.PATHSEG_ARC_ABS:points={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new window.SVGPathSegArcAbs(owningPathSegList,points.x,points.y,points.x1,points.y1,points.arcAngle,points.arcLarge,points.arcSweep);default:throw"Unknown path seg type."}};var builder=new Builder,source=new Source(string);if(!source.initialCommandIsMoveTo())return[];for(;source.hasMoreData();){var pathSeg=source.parseSegment();if(!pathSeg)return[];builder.appendSegment(pathSeg)}return builder.pathSegList}),String.prototype.padEnd||(String.prototype.padEnd=function padEnd(targetLength,padString){return targetLength>>=0,padString=String(void 0!==padString?padString:" "),this.length>targetLength?String(this):((targetLength-=this.length)>padString.length&&(padString+=padString.repeat(targetLength/padString.length)),String(this)+padString.slice(0,targetLength))}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function assign(target,varArgs){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to},writable:!0,configurable:!0}),(Chart.prototype.axis=function(){}).labels=function(labels){var $$=this.internal;arguments.length&&(Object.keys(labels).forEach(function(axisId){$$.axis.setLabelText(axisId,labels[axisId])}),$$.axis.updateLabels())},Chart.prototype.axis.max=function(max){var $$=this.internal,config=$$.config;if(!arguments.length)return{x:config.axis_x_max,y:config.axis_y_max,y2:config.axis_y2_max};"object"===_typeof(max)?(isValue(max.x)&&(config.axis_x_max=max.x),isValue(max.y)&&(config.axis_y_max=max.y),isValue(max.y2)&&(config.axis_y2_max=max.y2)):config.axis_y_max=config.axis_y2_max=max,$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},Chart.prototype.axis.min=function(min){var $$=this.internal,config=$$.config;if(!arguments.length)return{x:config.axis_x_min,y:config.axis_y_min,y2:config.axis_y2_min};"object"===_typeof(min)?(isValue(min.x)&&(config.axis_x_min=min.x),isValue(min.y)&&(config.axis_y_min=min.y),isValue(min.y2)&&(config.axis_y2_min=min.y2)):config.axis_y_min=config.axis_y2_min=min,$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},Chart.prototype.axis.range=function(range){if(!arguments.length)return{max:this.axis.max(),min:this.axis.min()};isDefined(range.max)&&this.axis.max(range.max),isDefined(range.min)&&this.axis.min(range.min)},Chart.prototype.axis.types=function(types){var $$=this.internal;if(void 0===types)return{y:$$.config.axis_y_type,y2:$$.config.axis_y2_type};isDefined(types.y)&&($$.config.axis_y_type=types.y),isDefined(types.y2)&&($$.config.axis_y2_type=types.y2),$$.updateScales(),$$.redraw()},Chart.prototype.category=function(i,category){var $$=this.internal,config=$$.config;return 1<arguments.length&&(config.axis_x_categories[i]=category,$$.redraw()),config.axis_x_categories[i]},Chart.prototype.categories=function(categories){var $$=this.internal,config=$$.config;return arguments.length&&(config.axis_x_categories=categories,$$.redraw()),config.axis_x_categories},Chart.prototype.resize=function(size){var config=this.internal.config;config.size_width=size?size.width:null,config.size_height=size?size.height:null,this.flush()},Chart.prototype.flush=function(){this.internal.updateAndRedraw({withLegend:!0,withTransition:!1,withTransitionForTransform:!1})},Chart.prototype.destroy=function(){var wrapper,$$=this.internal;return window.clearInterval($$.intervalForObserveInserted),void 0!==$$.resizeTimeout&&window.clearTimeout($$.resizeTimeout),window.detachEvent?window.detachEvent("onresize",$$.resizeIfElementDisplayed):window.removeEventListener?window.removeEventListener("resize",$$.resizeIfElementDisplayed):(wrapper=window.onresize)&&wrapper.add&&wrapper.remove&&wrapper.remove($$.resizeFunction),$$.resizeFunction.remove(),$$.unbindWindowFocus(),$$.selectChart.classed("c3",!1).html(""),Object.keys($$).forEach(function(key){$$[key]=null}),null},Chart.prototype.color=function(id){return this.internal.color(id)},(Chart.prototype.data=function(targetIds){var targets=this.internal.data.targets;return void 0===targetIds?targets:targets.filter(function(t){return 0<=[].concat(targetIds).indexOf(t.id)})}).shown=function(targetIds){return this.internal.filterTargetsToShow(this.data(targetIds))},Chart.prototype.data.values=function(targets){var flat=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],values=null;return!targets||(targets=this.data(targets))&&isArray(targets)&&(values=targets.reduce(function(ret,dataValue){dataValue=dataValue.values.map(function(d){return d.value});return flat?ret=ret.concat(dataValue):ret.push(dataValue),ret},[])),values},Chart.prototype.data.names=function(names){return this.internal.clearLegendItemTextBoxCache(),this.internal.updateDataAttributes("names",names)},Chart.prototype.data.colors=function(colors){return this.internal.updateDataAttributes("colors",colors)},Chart.prototype.data.axes=function(axes){return this.internal.updateDataAttributes("axes",axes)},Chart.prototype.data.stackNormalized=function(normalized){if(void 0===normalized)return this.internal.isStackNormalized();this.internal.config.data_stack_normalize=!!normalized,this.internal.redraw()},(Chart.prototype.donut=function(){}).padAngle=function(padAngle){if(void 0===padAngle)return this.internal.config.donut_padAngle;this.internal.config.donut_padAngle=padAngle,this.flush()},Chart.prototype.flow=function(args){var targets,domain,baseTarget,baseValue,diff,to,$$=this.internal,notfoundIds=[],orgDataCount=$$.getMaxDataCount(),length=0,tail=0;if(args.json)baseValue=$$.convertJsonToData(args.json,args.keys);else if(args.rows)baseValue=$$.convertRowsToData(args.rows);else{if(!args.columns)return;baseValue=$$.convertColumnsToData(args.columns)}targets=$$.convertDataToTargets(baseValue,!0),$$.data.targets.forEach(function(t){for(var j,found=!1,i=0;i<targets.length;i++)if(t.id===targets[i].id){for(found=!0,t.values[t.values.length-1]&&(tail=t.values[t.values.length-1].index+1),length=targets[i].values.length,j=0;j<length;j++)targets[i].values[j].index=tail+j,$$.isTimeSeries()||(targets[i].values[j].x=tail+j);t.values=t.values.concat(targets[i].values),targets.splice(i,1);break}found||notfoundIds.push(t.id)}),$$.data.targets.forEach(function(t){for(var j,i=0;i<notfoundIds.length;i++)if(t.id===notfoundIds[i])for(tail=t.values[t.values.length-1].index+1,j=0;j<length;j++)t.values.push({id:t.id,index:tail+j,x:$$.isTimeSeries()?$$.getOtherTargetX(tail+j):tail+j,value:null})}),$$.data.targets.length&&targets.forEach(function(t){for(var missing=[],i=$$.data.targets[0].values[0].index;i<tail;i++)missing.push({id:t.id,index:i,x:$$.isTimeSeries()?$$.getOtherTargetX(i):i,value:null});t.values.forEach(function(v){v.index+=tail,$$.isTimeSeries()||(v.x+=tail)}),t.values=missing.concat(t.values)}),$$.data.targets=$$.data.targets.concat(targets),$$.getMaxDataCount(),baseValue=(baseTarget=$$.data.targets[0]).values[0],isDefined(args.to)?(length=0,to=$$.isTimeSeries()?$$.parseDate(args.to):args.to,baseTarget.values.forEach(function(v){v.x<to&&length++})):isDefined(args.length)&&(length=args.length),orgDataCount?1===orgDataCount&&$$.isTimeSeries()&&(diff=(baseTarget.values[baseTarget.values.length-1].x-baseValue.x)/2,domain=[new Date(+baseValue.x-diff),new Date(+baseValue.x+diff)],$$.updateXDomain(null,!0,!0,!1,domain)):(diff=$$.isTimeSeries()?1<baseTarget.values.length?baseTarget.values[baseTarget.values.length-1].x-baseValue.x:baseValue.x-$$.getXDomain($$.data.targets)[0]:1,domain=[baseValue.x-diff,baseValue.x],$$.updateXDomain(null,!0,!0,!1,domain)),$$.updateTargets($$.data.targets),$$.redraw({flow:{index:baseValue.index,length:length,duration:isValue(args.duration)?args.duration:$$.config.transition_duration,done:args.done,orgDataCount:orgDataCount},withLegend:!0,withTransition:1<orgDataCount,withTrimXDomain:!1,withUpdateXAxis:!0})},ChartInternal.prototype.generateFlow=function(args){var $$=this,config=$$.config,d3=$$.d3;return function(){var xgrid,xgridLines,mainRegion,mainText,mainBar,mainLine,mainArea,mainCircle,transform=args.targets,flow=args.flow,drawBar=args.drawBar,drawLine=args.drawLine,drawArea=args.drawArea,cx=args.cx,cy=args.cy,xv=args.xv,xForText=args.xForText,yForText=args.yForText,wait=args.duration,flowIndex=flow.index,flowLength=flow.length,flowStart=$$.getValueOnIndex($$.data.targets[0].values,flowIndex),flowEnd=$$.getValueOnIndex($$.data.targets[0].values,flowIndex+flowLength),orgDomain=$$.x.domain(),flowTransition=flow.duration||wait,done=flow.done||function(){},wait=$$.generateWait();$$.flowing=!0,$$.data.targets.forEach(function(d){d.values.splice(0,flowLength)}),transform=$$.updateXDomain(transform,!0,!0),$$.updateXGrid&&$$.updateXGrid(!0),xgrid=$$.xgrid||d3.selectAll([]),xgridLines=$$.xgridLines||d3.selectAll([]),mainRegion=$$.mainRegion||d3.selectAll([]),mainText=$$.mainText||d3.selectAll([]),mainBar=$$.mainBar||d3.selectAll([]),mainLine=$$.mainLine||d3.selectAll([]),mainArea=$$.mainArea||d3.selectAll([]),mainCircle=$$.mainCircle||d3.selectAll([]),transform="translate("+(flow.orgDataCount?1===flow.orgDataCount||(flowStart&&flowStart.x)===(flowEnd&&flowEnd.x)||$$.isTimeSeries()?$$.x(orgDomain[0])-$$.x(transform[0]):$$.x(flowStart.x)-$$.x(flowEnd.x):1!==$$.data.targets[0].values.length?$$.x(orgDomain[0])-$$.x(transform[0]):$$.isTimeSeries()?(flowStart=$$.getValueOnIndex($$.data.targets[0].values,0),flowEnd=$$.getValueOnIndex($$.data.targets[0].values,$$.data.targets[0].values.length-1),$$.x(flowStart.x)-$$.x(flowEnd.x)):diffDomain(transform)/2)+",0) scale("+diffDomain(orgDomain)/diffDomain(transform)+",1)",$$.hideXGridFocus();flowTransition=d3.transition().ease(d3.easeLinear).duration(flowTransition);wait.add($$.xAxis($$.axes.x,flowTransition)),wait.add(mainBar.transition(flowTransition).attr("transform",transform)),wait.add(mainLine.transition(flowTransition).attr("transform",transform)),wait.add(mainArea.transition(flowTransition).attr("transform",transform)),wait.add(mainCircle.transition(flowTransition).attr("transform",transform)),wait.add(mainText.transition(flowTransition).attr("transform",transform)),wait.add(mainRegion.filter($$.isRegionOnX).transition(flowTransition).attr("transform",transform)),wait.add(xgrid.transition(flowTransition).attr("transform",transform)),wait.add(xgridLines.transition(flowTransition).attr("transform",transform)),wait(function(){var i,shapes=[],texts=[];if(flowLength){for(i=0;i<flowLength;i++)shapes.push("."+CLASS.shape+"-"+(flowIndex+i)),texts.push("."+CLASS.text+"-"+(flowIndex+i));$$.svg.selectAll("."+CLASS.shapes).selectAll(shapes).remove(),$$.svg.selectAll("."+CLASS.texts).selectAll(texts).remove(),$$.svg.select("."+CLASS.xgrid).remove()}xgrid.attr("transform",null).attr("x1",$$.xgridAttr.x1).attr("x2",$$.xgridAttr.x2).attr("y1",$$.xgridAttr.y1).attr("y2",$$.xgridAttr.y2).style("opacity",$$.xgridAttr.opacity),xgridLines.attr("transform",null),xgridLines.select("line").attr("x1",config.axis_rotated?0:xv).attr("x2",config.axis_rotated?$$.width:xv),xgridLines.select("text").attr("x",config.axis_rotated?$$.width:0).attr("y",xv),mainBar.attr("transform",null).attr("d",drawBar),mainLine.attr("transform",null).attr("d",drawLine),mainArea.attr("transform",null).attr("d",drawArea),mainCircle.attr("transform",null).attr("cx",cx).attr("cy",cy),mainText.attr("transform",null).attr("x",xForText).attr("y",yForText).style("fill-opacity",$$.opacityForText.bind($$)),mainRegion.attr("transform",null),mainRegion.filter($$.isRegionOnX).attr("x",$$.regionX.bind($$)).attr("width",$$.regionWidth.bind($$)),done(),$$.flowing=!1})}},Chart.prototype.focus=function(targetIds){var candidates,$$=this.internal;targetIds=$$.mapToTargetIds(targetIds),candidates=$$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow,$$))),this.revert(),this.defocus(),candidates.classed(CLASS.focused,!0).classed(CLASS.defocused,!1),$$.hasArcType()&&$$.expandArc(targetIds),$$.toggleFocusLegend(targetIds,!0),$$.focusedTargetIds=targetIds,$$.defocusedTargetIds=$$.defocusedTargetIds.filter(function(id){return targetIds.indexOf(id)<0})},Chart.prototype.defocus=function(targetIds){var $$=this.internal;targetIds=$$.mapToTargetIds(targetIds),$$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow,$$))).classed(CLASS.focused,!1).classed(CLASS.defocused,!0),$$.hasArcType()&&$$.unexpandArc(targetIds),$$.toggleFocusLegend(targetIds,!1),$$.focusedTargetIds=$$.focusedTargetIds.filter(function(id){return targetIds.indexOf(id)<0}),$$.defocusedTargetIds=targetIds},Chart.prototype.revert=function(targetIds){var $$=this.internal;targetIds=$$.mapToTargetIds(targetIds),$$.svg.selectAll($$.selectorTargets(targetIds)).classed(CLASS.focused,!1).classed(CLASS.defocused,!1),$$.hasArcType()&&$$.unexpandArc(targetIds),$$.config.legend_show&&($$.showLegend(targetIds.filter($$.isLegendToShow.bind($$))),$$.legend.selectAll($$.selectorLegends(targetIds)).filter(function(){return $$.d3.select(this).classed(CLASS.legendItemFocused)}).classed(CLASS.legendItemFocused,!1)),$$.focusedTargetIds=[],$$.defocusedTargetIds=[]},(Chart.prototype.xgrids=function(grids){var $$=this.internal,config=$$.config;return grids&&(config.grid_x_lines=grids,$$.redrawWithoutRescale()),config.grid_x_lines}).add=function(grids){var $$=this.internal;return this.xgrids($$.config.grid_x_lines.concat(grids||[]))},Chart.prototype.xgrids.remove=function(params){this.internal.removeGridLines(params,!0)},(Chart.prototype.ygrids=function(grids){var $$=this.internal,config=$$.config;return grids&&(config.grid_y_lines=grids,$$.redrawWithoutRescale()),config.grid_y_lines}).add=function(grids){var $$=this.internal;return this.ygrids($$.config.grid_y_lines.concat(grids||[]))},Chart.prototype.ygrids.remove=function(params){this.internal.removeGridLines(params,!1)},Chart.prototype.groups=function(groups){var $$=this.internal,config=$$.config;return isUndefined(groups)||(config.data_groups=groups,$$.redraw()),config.data_groups},(Chart.prototype.legend=function(){}).show=function(targetIds){var $$=this.internal;$$.showLegend($$.mapToTargetIds(targetIds)),$$.updateAndRedraw({withLegend:!0})},Chart.prototype.legend.hide=function(targetIds){var $$=this.internal;$$.hideLegend($$.mapToTargetIds(targetIds)),$$.updateAndRedraw({withLegend:!1})},Chart.prototype.load=function(args){var $$=this.internal,config=$$.config;args.xs&&$$.addXs(args.xs),"names"in args&&Chart.prototype.data.names.bind(this)(args.names),"classes"in args&&Object.keys(args.classes).forEach(function(id){config.data_classes[id]=args.classes[id]}),"categories"in args&&$$.isCategorized()&&(config.axis_x_categories=args.categories),"axes"in args&&Object.keys(args.axes).forEach(function(id){config.data_axes[id]=args.axes[id]}),"colors"in args&&Object.keys(args.colors).forEach(function(id){config.data_colors[id]=args.colors[id]}),"cacheIds"in args&&$$.hasCaches(args.cacheIds)?$$.load($$.getCaches(args.cacheIds),args.done):args.unload?$$.unload($$.mapToTargetIds(!0===args.unload?null:args.unload),function(){$$.loadFromArgs(args)}):$$.loadFromArgs(args)},Chart.prototype.unload=function(args){var $$=this.internal;(args=args||{})instanceof Array?args={ids:args}:"string"==typeof args&&(args={ids:[args]}),$$.unload($$.mapToTargetIds(args.ids),function(){$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),args.done&&args.done()})},(Chart.prototype.pie=function(){}).padAngle=function(padAngle){if(void 0===padAngle)return this.internal.config.pie_padAngle;this.internal.config.pie_padAngle=padAngle,this.flush()},(Chart.prototype.regions=function(regions){var $$=this.internal,config=$$.config;return regions&&(config.regions=regions,$$.redrawWithoutRescale()),config.regions}).add=function(regions){var $$=this.internal,config=$$.config;return regions&&(config.regions=config.regions.concat(regions),$$.redrawWithoutRescale()),config.regions},Chart.prototype.regions.remove=function(options){var regions=this.internal,config=regions.config,duration=getOption(options=options||{},"duration",config.transition_duration),classes=getOption(options,"classes",[CLASS.region]),regions=regions.main.select("."+CLASS.regions).selectAll(classes.map(function(c){return"."+c}));return(duration?regions.transition().duration(duration):regions).style("opacity",0).remove(),config.regions=config.regions.filter(function(region){var found=!1;return!region.class||(region.class.split(" ").forEach(function(c){0<=classes.indexOf(c)&&(found=!0)}),!found)}),config.regions},Chart.prototype.selected=function(targetId){var $$=this.internal,d3=$$.d3;return $$.main.selectAll("."+CLASS.shapes+$$.getTargetSelectorSuffix(targetId)).selectAll("."+CLASS.shape).filter(function(){return d3.select(this).classed(CLASS.SELECTED)}).nodes().map(function(data){data=data.__data__;return data.data||data})},Chart.prototype.select=function(ids,indices,resetOther){var $$=this.internal,d3=$$.d3,config=$$.config;config.data_selection_enabled&&$$.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this),isSelected=(d.data||d).id,toggle=$$.getToggle(this,d).bind($$),isTargetId=config.data_selection_grouped||!ids||0<=ids.indexOf(isSelected),isTargetIndex=!indices||0<=indices.indexOf(i),isSelected=shape.classed(CLASS.SELECTED);shape.classed(CLASS.line)||shape.classed(CLASS.area)||(isTargetId&&isTargetIndex?config.data_selection_isselectable(d)&&!isSelected&&toggle(!0,shape.classed(CLASS.SELECTED,!0),d,i):isDefined(resetOther)&&resetOther&&isSelected&&toggle(!1,shape.classed(CLASS.SELECTED,!1),d,i))})},Chart.prototype.unselect=function(ids,indices){var $$=this.internal,d3=$$.d3,config=$$.config;config.data_selection_enabled&&$$.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this),isSelected=(d.data||d).id,toggle=$$.getToggle(this,d).bind($$),isTargetId=config.data_selection_grouped||!ids||0<=ids.indexOf(isSelected),isTargetIndex=!indices||0<=indices.indexOf(i),isSelected=shape.classed(CLASS.SELECTED);shape.classed(CLASS.line)||shape.classed(CLASS.area)||isTargetId&&isTargetIndex&&config.data_selection_isselectable(d)&&isSelected&&toggle(!1,shape.classed(CLASS.SELECTED,!1),d,i)})},Chart.prototype.show=function(targetIds,options){var targets,$$=this.internal;targetIds=$$.mapToTargetIds(targetIds),options=options||{},$$.removeHiddenTargetIds(targetIds),(targets=$$.svg.selectAll($$.selectorTargets(targetIds))).transition().style("display","initial","important").style("opacity",1,"important").call($$.endall,function(){targets.style("opacity",null).style("opacity",1)}),options.withLegend&&$$.showLegend(targetIds),$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},Chart.prototype.hide=function(targetIds,options){var targets,$$=this.internal;targetIds=$$.mapToTargetIds(targetIds),options=options||{},$$.addHiddenTargetIds(targetIds),(targets=$$.svg.selectAll($$.selectorTargets(targetIds))).transition().style("opacity",0,"important").call($$.endall,function(){targets.style("opacity",null).style("opacity",0),targets.style("display","none")}),options.withLegend&&$$.hideLegend(targetIds),$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},Chart.prototype.toggle=function(targetIds,options){var that=this,$$=this.internal;$$.mapToTargetIds(targetIds).forEach(function(targetId){$$.isTargetToShow(targetId)?that.hide(targetId,options):that.show(targetId,options)})},(Chart.prototype.tooltip=function(){}).show=function(args){var targets,data,$$=this.internal,mouse={},mouse=args.mouse||(args.data?data=args.data:void 0!==args.x&&(targets=args.id?$$.data.targets.filter(function(t){return t.id===args.id}):$$.data.targets,data=$$.filterByX(targets,args.x).slice(0,1)[0]),data?$$.getMousePosition(data):null);$$.dispatchEvent("mousemove",mouse),$$.config.tooltip_onshow.call($$,data)},Chart.prototype.tooltip.hide=function(){this.internal.dispatchEvent("mouseout",0),this.internal.config.tooltip_onhide.call(this)},Chart.prototype.transform=function(type,targetIds){var $$=this.internal,options=0<=["pie","donut"].indexOf(type)?{withTransform:!0}:null;$$.transformTo(targetIds,type,options)},ChartInternal.prototype.transformTo=function(targetIds,type,optionsForRedraw){var $$=this,options=!$$.hasArcType(),options=optionsForRedraw||{withTransitionForAxis:options};options.withTransitionForTransform=!1,$$.transiting=!1,$$.setTargetType(targetIds,type),$$.updateTargets($$.data.targets),$$.updateAndRedraw(options)},Chart.prototype.x=function(x){var $$=this.internal;return arguments.length&&($$.updateTargetX($$.data.targets,x),$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),$$.data.xs},Chart.prototype.xs=function(xs){var $$=this.internal;return arguments.length&&($$.updateTargetXs($$.data.targets,xs),$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),$$.data.xs},(Chart.prototype.zoom=function(domain){var $$=this.internal;return domain?($$.isTimeSeries()&&(domain=domain.map(function(x){return $$.parseDate(x)})),$$.config.subchart_show?$$.brush.selectionAsValue(domain,!0):($$.updateXDomain(null,!0,!1,!1,domain),$$.redraw({withY:$$.config.zoom_rescale,withSubchart:!1})),$$.config.zoom_onzoom.call(this,$$.x.orgDomain()),domain):$$.x.domain()}).enable=function(enabled){var $$=this.internal;$$.config.zoom_enabled=enabled,$$.updateAndRedraw()},Chart.prototype.unzoom=function(){var $$=this.internal;$$.config.subchart_show?$$.brush.clear():($$.updateXDomain(null,!0,!1,!1,$$.subX.domain()),$$.redraw({withY:$$.config.zoom_rescale,withSubchart:!1}))},Chart.prototype.zoom.max=function(max){var $$=this.internal,config=$$.config,d3=$$.d3;if(0!==max&&!max)return config.zoom_x_max;config.zoom_x_max=d3.max([$$.orgXDomain[1],max])},Chart.prototype.zoom.min=function(min){var $$=this.internal,config=$$.config,d3=$$.d3;if(0!==min&&!min)return config.zoom_x_min;config.zoom_x_min=d3.min([$$.orgXDomain[0],min])},Chart.prototype.zoom.range=function(range){if(!arguments.length)return{max:this.domain.max(),min:this.domain.min()};isDefined(range.max)&&this.domain.max(range.max),isDefined(range.min)&&this.domain.min(range.min)},ChartInternal.prototype.initPie=function(){var $$=this,orderFct=$$.d3;$$.pie=orderFct.pie().padAngle(this.getPadAngle.bind(this)).value(function(d){return d.values.reduce(function(a,b){return a+b.value},0)});var defaultSort,orderFct=$$.getOrderFunction();orderFct&&($$.isOrderAsc()||$$.isOrderDesc())&&(defaultSort=orderFct,orderFct=function orderFct(t1,t2){return-1*defaultSort(t1,t2)}),$$.pie.sort(orderFct||null)},ChartInternal.prototype.updateRadius=function(){var $$=this,gaugeArcWidth=$$.config,w=gaugeArcWidth.gauge_width||gaugeArcWidth.donut_width,gaugeArcWidth=$$.filterTargetsToShow($$.data.targets).length*$$.config.gauge_arcs_minWidth;$$.radiusExpanded=Math.min($$.arcWidth,$$.arcHeight)/2*($$.hasType("gauge")?.85:1),$$.radius=.95*$$.radiusExpanded,$$.innerRadiusRatio=w?($$.radius-w)/$$.radius:.6,$$.innerRadius=$$.hasType("donut")||$$.hasType("gauge")?$$.radius*$$.innerRadiusRatio:0,$$.gaugeArcWidth=w||(gaugeArcWidth<=$$.radius-$$.innerRadius?$$.radius-$$.innerRadius:gaugeArcWidth<=$$.radius?gaugeArcWidth:$$.radius)},ChartInternal.prototype.getPadAngle=function(){return this.hasType("pie")?this.config.pie_padAngle||0:this.hasType("donut")&&this.config.donut_padAngle||0},ChartInternal.prototype.updateArc=function(){var $$=this;$$.svgArc=$$.getSvgArc(),$$.svgArcExpanded=$$.getSvgArcExpanded(),$$.svgArcExpandedSub=$$.getSvgArcExpanded(.98)},ChartInternal.prototype.updateAngle=function(d){var gMax,gValue,gTic=this,config=gTic.config,found=!1,index=0;return config?(gTic.pie(gTic.filterTargetsToShow(gTic.data.targets)).forEach(function(t){found||t.data.id!==d.data.id||(found=!0,(d=t).index=index),index++}),isNaN(d.startAngle)&&(d.startAngle=0),isNaN(d.endAngle)&&(d.endAngle=d.startAngle),gTic.isGaugeType(d.data)&&(gValue=config.gauge_min,gMax=config.gauge_max,gTic=Math.PI*(config.gauge_fullCircle?2:1)/(gMax-gValue),gValue=d.value<gValue?0:d.value<gMax?d.value-gValue:gMax-gValue,d.startAngle=config.gauge_startingAngle,d.endAngle=d.startAngle+gTic*gValue),found?d:null):null},ChartInternal.prototype.getSvgArc=function(){function newArc(updated,withoutUpdate){return withoutUpdate||(updated=$$.updateAngle(updated))?arc(updated):"M 0 0"}var $$=this,hasGaugeType=$$.hasType("gauge"),singleArcWidth=$$.gaugeArcWidth/$$.filterTargetsToShow($$.data.targets).length,arc=$$.d3.arc().outerRadius(function(d){return hasGaugeType?$$.radius-singleArcWidth*d.index:$$.radius}).innerRadius(function(d){return hasGaugeType?$$.radius-singleArcWidth*(d.index+1):$$.innerRadius});return newArc.centroid=arc.centroid,newArc},ChartInternal.prototype.getSvgArcExpanded=function(rate){rate=rate||1;var $$=this,hasGaugeType=$$.hasType("gauge"),singleArcWidth=$$.gaugeArcWidth/$$.filterTargetsToShow($$.data.targets).length,expandWidth=Math.min($$.radiusExpanded*rate-$$.radius,.8*singleArcWidth-100*(1-rate)),arc=$$.d3.arc().outerRadius(function(d){return hasGaugeType?$$.radius-singleArcWidth*d.index+expandWidth:$$.radiusExpanded*rate}).innerRadius(function(d){return hasGaugeType?$$.radius-singleArcWidth*(d.index+1):$$.innerRadius});return function(updated){updated=$$.updateAngle(updated);return updated?arc(updated):"M 0 0"}},ChartInternal.prototype.getArc=function(d,withoutUpdate,force){return force||this.isArcType(d.data)?this.svgArc(d,withoutUpdate):"M 0 0"},ChartInternal.prototype.transformForArcLabel=function(d){var ratio,x,y,$$=this,config=$$.config,updated=$$.updateAngle(d),translate="",y1=$$.hasType("gauge");return updated&&!y1?(ratio=this.svgArc.centroid(updated),x=isNaN(ratio[0])?0:ratio[0],y=isNaN(ratio[1])?0:ratio[1],ratio=Math.sqrt(x*x+y*y),translate="translate("+x*(ratio=$$.hasType("donut")&&config.donut_label_ratio?isFunction(config.donut_label_ratio)?config.donut_label_ratio(d,$$.radius,ratio):config.donut_label_ratio:$$.hasType("pie")&&config.pie_label_ratio?isFunction(config.pie_label_ratio)?config.pie_label_ratio(d,$$.radius,ratio):config.pie_label_ratio:$$.radius&&ratio?(.375<36/$$.radius?1.175-36/$$.radius:.8)*$$.radius/ratio:0)+","+y*ratio+")"):updated&&y1&&1<$$.filterTargetsToShow($$.data.targets).length&&(y1=Math.sin(updated.endAngle-Math.PI/2),translate="translate("+(x=Math.cos(updated.endAngle-Math.PI/2)*($$.radiusExpanded+25))+","+(y=y1*($$.radiusExpanded+15-Math.abs(10*y1))+3)+")"),translate},ChartInternal.prototype.getArcRatio=function(d){return this.getRatio("arc",d)},ChartInternal.prototype.convertToArcData=function(d){return this.addName({id:d.data.id,value:d.value,ratio:this.getRatio("arc",d),index:d.index})},ChartInternal.prototype.textForArcLabel=function(format){var value,ratio,id,$$=this;return $$.shouldShowArcLabel()?(value=(id=$$.updateAngle(format))?id.value:null,ratio=$$.getRatio("arc",id),id=format.data.id,$$.hasType("gauge")||$$.meetsArcLabelThreshold(ratio)?(format=$$.getArcLabelFormat())?format(value,ratio,id):$$.defaultArcValueFormat(value,ratio):""):""},ChartInternal.prototype.textForGaugeMinMax=function(value,isMax){var format=this.getGaugeLabelExtents();return format?format(value,isMax):value},ChartInternal.prototype.expandArc=function(targetIds){var interval,$$=this;$$.transiting?interval=window.setInterval(function(){$$.transiting||(window.clearInterval(interval),0<$$.legend.selectAll(".c3-legend-item-focused").size()&&$$.expandArc(targetIds))},10):(targetIds=$$.mapToTargetIds(targetIds),$$.svg.selectAll($$.selectorTargets(targetIds,"."+CLASS.chartArc)).each(function(d){$$.shouldExpand(d.data.id)&&$$.d3.select(this).selectAll("path").transition().duration($$.expandDuration(d.data.id)).attr("d",$$.svgArcExpanded).transition().duration(2*$$.expandDuration(d.data.id)).attr("d",$$.svgArcExpandedSub).each(function(d){$$.isDonutType(d.data)})}))},ChartInternal.prototype.unexpandArc=function(targetIds){var $$=this;$$.transiting||(targetIds=$$.mapToTargetIds(targetIds),$$.svg.selectAll($$.selectorTargets(targetIds,"."+CLASS.chartArc)).selectAll("path").transition().duration(function(d){return $$.expandDuration(d.data.id)}).attr("d",$$.svgArc),$$.svg.selectAll("."+CLASS.arc))},ChartInternal.prototype.expandDuration=function(id){var config=this.config;return this.isDonutType(id)?config.donut_expand_duration:this.isGaugeType(id)?config.gauge_expand_duration:this.isPieType(id)?config.pie_expand_duration:50},ChartInternal.prototype.shouldExpand=function(id){var config=this.config;return this.isDonutType(id)&&config.donut_expand||this.isGaugeType(id)&&config.gauge_expand||this.isPieType(id)&&config.pie_expand},ChartInternal.prototype.shouldShowArcLabel=function(){var config=this.config,shouldShow=!0;return this.hasType("donut")?shouldShow=config.donut_label_show:this.hasType("pie")&&(shouldShow=config.pie_label_show),shouldShow},ChartInternal.prototype.meetsArcLabelThreshold=function(ratio){var config=this.config;return(this.hasType("donut")?config.donut_label_threshold:config.pie_label_threshold)<=ratio},ChartInternal.prototype.getArcLabelFormat=function(){var config=this.config,format=config.pie_label_format;return this.hasType("gauge")?format=config.gauge_label_format:this.hasType("donut")&&(format=config.donut_label_format),format},ChartInternal.prototype.getGaugeLabelExtents=function(){return this.config.gauge_label_extents},ChartInternal.prototype.getArcTitle=function(){return this.hasType("donut")?this.config.donut_title:""},ChartInternal.prototype.updateTargetsForArc=function(mainPieEnter){var $$=this,main=$$.main,classChartArc=$$.classChartArc.bind($$),classArcs=$$.classArcs.bind($$),classFocus=$$.classFocus.bind($$),mainPieEnter=main.select("."+CLASS.chartArcs).selectAll("."+CLASS.chartArc).data($$.pie(mainPieEnter)).attr("class",function(d){return classChartArc(d)+classFocus(d.data)}).enter().append("g").attr("class",classChartArc);mainPieEnter.append("g").attr("class",classArcs),mainPieEnter.append("text").attr("dy",$$.hasType("gauge")?"-.1em":".35em").style("opacity",0).style("text-anchor","middle").style("pointer-events","none")},ChartInternal.prototype.initArc=function(){var $$=this;$$.arcs=$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartArcs).attr("transform",$$.getTranslate("arc")),$$.arcs.append("text").attr("class",CLASS.chartArcsTitle).style("text-anchor","middle").text($$.getArcTitle())},ChartInternal.prototype.redrawArc=function(duration,durationForExit,withTransform){var mainArcLabelLine,index,$$=this,d3=$$.d3,config=$$.config,main=$$.main,backgroundArc=$$.hasType("gauge"),arcs=main.selectAll("."+CLASS.arcs).selectAll("."+CLASS.arc).data($$.arcData.bind($$)),mainArc=arcs.enter().append("path").attr("class",$$.classArc.bind($$)).style("fill",function(d){return $$.color(d.data)}).style("cursor",function(d){return config.interaction_enabled&&config.data_selection_isselectable(d)?"pointer":null}).each(function(d){$$.isGaugeType(d.data)&&(d.startAngle=d.endAngle=config.gauge_startingAngle),this._current=d}).merge(arcs);backgroundArc&&(mainArcLabelLine=(mainArcLabelLine=main.selectAll("."+CLASS.arcs).selectAll("."+CLASS.arcLabelLine).data($$.arcData.bind($$))).enter().append("rect").attr("class",function(d){return CLASS.arcLabelLine+" "+CLASS.target+" "+CLASS.target+"-"+d.data.id}).merge(mainArcLabelLine),1===$$.filterTargetsToShow($$.data.targets).length?mainArcLabelLine.style("display","none"):mainArcLabelLine.style("fill",function(d){return $$.levelColor?$$.levelColor(d.data.values[0].value):$$.color(d.data)}).style("display",config.gauge_labelLine_show?"":"none").each(function(arcInnerRadius){var innerLineLength,lineAngle,linePositioningAngle,lineLength=0,x=0,y=0,transform="";$$.hiddenTargetIds.indexOf(arcInnerRadius.data.id)<0&&(linePositioningAngle=$$.updateAngle(arcInnerRadius),innerLineLength=$$.gaugeArcWidth/$$.filterTargetsToShow($$.data.targets).length*(linePositioningAngle.index+1),linePositioningAngle=(lineAngle=linePositioningAngle.endAngle-Math.PI/2)-(0==(arcInnerRadius=$$.radius-innerLineLength)?0:1/arcInnerRadius),lineLength=$$.radiusExpanded-$$.radius+innerLineLength,x=Math.cos(linePositioningAngle)*arcInnerRadius,y=Math.sin(linePositioningAngle)*arcInnerRadius,transform="rotate("+180*lineAngle/Math.PI+", "+x+", "+y+")"),d3.select(this).attr("x",x).attr("y",y).attr("width",lineLength).attr("height",2).attr("transform",transform).style("stroke-dasharray","0, "+(lineLength+2)+", 0")})),mainArc.attr("transform",function(d){return!$$.isGaugeType(d.data)&&withTransform?"scale(0)":""}).on("mouseover",config.interaction_enabled?function(arcData){var updated;$$.transiting||(updated=$$.updateAngle(arcData))&&(arcData=$$.convertToArcData(updated),$$.expandArc(updated.data.id),$$.api.focus(updated.data.id),$$.toggleFocusLegend(updated.data.id,!0),$$.config.data_onmouseover(arcData,this))}:null).on("mousemove",config.interaction_enabled?function(selectedData){selectedData=$$.updateAngle(selectedData);selectedData&&(selectedData=[$$.convertToArcData(selectedData)],$$.showTooltip(selectedData,this))}:null).on("mouseout",config.interaction_enabled?function(arcData){var updated;$$.transiting||(updated=$$.updateAngle(arcData))&&(arcData=$$.convertToArcData(updated),$$.unexpandArc(updated.data.id),$$.api.revert(),$$.revertLegend(),$$.hideTooltip(),$$.config.data_onmouseout(arcData,this))}:null).on("click",config.interaction_enabled?function(arcData,i){arcData=$$.updateAngle(arcData);arcData&&(arcData=$$.convertToArcData(arcData),$$.toggleShape&&$$.toggleShape(this,arcData,i),$$.config.data_onclick.call($$.api,arcData,this))}:null).each(function(){$$.transiting=!0}).transition().duration(duration).attrTween("d",function(d){var interpolate,updated=$$.updateAngle(d);return updated?(isNaN(this._current.startAngle)&&(this._current.startAngle=0),isNaN(this._current.endAngle)&&(this._current.endAngle=this._current.startAngle),interpolate=d3.interpolate(this._current,updated),this._current=interpolate(0),function(interpolated){if(null===$$.config)return"M 0 0";interpolated=interpolate(interpolated);return interpolated.data=d.data,$$.getArc(interpolated,!0)}):function(){return"M 0 0"}}).attr("transform",withTransform?"scale(1)":"").style("fill",function(d){return $$.levelColor?$$.levelColor(d.data.values[0].value):$$.color(d.data.id)}).call($$.endall,function(){$$.transiting=!1}),arcs.exit().transition().duration(durationForExit).style("opacity",0).remove(),main.selectAll("."+CLASS.chartArc).select("text").style("opacity",0).attr("class",function(d){return $$.isGaugeType(d.data)?CLASS.gaugeValue:""}).text($$.textForArcLabel.bind($$)).attr("transform",$$.transformForArcLabel.bind($$)).style("font-size",function(d){return $$.isGaugeType(d.data)&&1===$$.filterTargetsToShow($$.data.targets).length?Math.round($$.radius/5)+"px":""}).transition().duration(duration).style("opacity",function(d){return $$.isTargetToShow(d.data.id)&&$$.isArcType(d.data)?1:0}),main.select("."+CLASS.chartArcsTitle).style("opacity",$$.hasType("donut")||backgroundArc?1:0),backgroundArc&&(index=0,(backgroundArc=$$.arcs.select("g."+CLASS.chartArcsBackground).selectAll("path."+CLASS.chartArcsBackground).data($$.data.targets)).enter().append("path").attr("class",function(d,i){return CLASS.chartArcsBackground+" "+CLASS.chartArcsBackground+"-"+i}).merge(backgroundArc).attr("d",function(d){if(0<=$$.hiddenTargetIds.indexOf(d.id))return"M 0 0";d={data:[{value:config.gauge_max}],startAngle:config.gauge_startingAngle,endAngle:-1*config.gauge_startingAngle*(config.gauge_fullCircle?Math.PI:1),index:index++};return $$.getArc(d,!0,!0)}),backgroundArc.exit().remove(),$$.arcs.select("."+CLASS.chartArcsGaugeUnit).attr("dy",".75em").text(config.gauge_label_show?config.gauge_units:""),$$.arcs.select("."+CLASS.chartArcsGaugeMin).attr("dx",-1*($$.innerRadius+($$.radius-$$.innerRadius)/(config.gauge_fullCircle?1:2))+"px").attr("dy","1.2em").text(config.gauge_label_show?$$.textForGaugeMinMax(config.gauge_min,!1):""),$$.arcs.select("."+CLASS.chartArcsGaugeMax).attr("dx",$$.innerRadius+($$.radius-$$.innerRadius)/(config.gauge_fullCircle?1:2)+"px").attr("dy","1.2em").text(config.gauge_label_show?$$.textForGaugeMinMax(config.gauge_max,!0):""))},ChartInternal.prototype.initGauge=function(){var arcs=this.arcs;this.hasType("gauge")&&(arcs.append("g").attr("class",CLASS.chartArcsBackground),arcs.append("text").attr("class",CLASS.chartArcsGaugeUnit).style("text-anchor","middle").style("pointer-events","none"),arcs.append("text").attr("class",CLASS.chartArcsGaugeMin).style("text-anchor","middle").style("pointer-events","none"),arcs.append("text").attr("class",CLASS.chartArcsGaugeMax).style("text-anchor","middle").style("pointer-events","none"))},ChartInternal.prototype.getGaugeLabelHeight=function(){return this.config.gauge_label_show?20:0},ChartInternal.prototype.addToCache=function(key,value){this.cache["$".concat(key)]=value},ChartInternal.prototype.getFromCache=function(key){return this.cache["$".concat(key)]},ChartInternal.prototype.resetCache=function(){var _this=this;Object.keys(this.cache).filter(function(key){return/^\$/.test(key)}).forEach(function(key){delete _this.cache[key]})},ChartInternal.prototype.hasCaches=function(ids){for(var i=0;i<ids.length;i++)if(!(ids[i]in this.cache))return!1;return!0},ChartInternal.prototype.addCache=function(id,target){this.cache[id]=this.cloneTarget(target)},ChartInternal.prototype.getCaches=function(ids){for(var targets=[],i=0;i<ids.length;i++)ids[i]in this.cache&&targets.push(this.cloneTarget(this.cache[ids[i]]));return targets},ChartInternal.prototype.categoryName=function(i){var config=this.config;return i<config.axis_x_categories.length?config.axis_x_categories[i]:i},ChartInternal.prototype.generateTargetClass=function(targetId){return targetId||0===targetId?("-"+targetId).replace(/\s/g,"-"):""},ChartInternal.prototype.generateClass=function(prefix,targetId){return" "+prefix+" "+prefix+this.generateTargetClass(targetId)},ChartInternal.prototype.classText=function(d){return this.generateClass(CLASS.text,d.index)},ChartInternal.prototype.classTexts=function(d){return this.generateClass(CLASS.texts,d.id)},ChartInternal.prototype.classShape=function(d){return this.generateClass(CLASS.shape,d.index)},ChartInternal.prototype.classShapes=function(d){return this.generateClass(CLASS.shapes,d.id)},ChartInternal.prototype.classLine=function(d){return this.classShape(d)+this.generateClass(CLASS.line,d.id)},ChartInternal.prototype.classLines=function(d){return this.classShapes(d)+this.generateClass(CLASS.lines,d.id)},ChartInternal.prototype.classCircle=function(d){return this.classShape(d)+this.generateClass(CLASS.circle,d.index)},ChartInternal.prototype.classCircles=function(d){return this.classShapes(d)+this.generateClass(CLASS.circles,d.id)},ChartInternal.prototype.classBar=function(d){return this.classShape(d)+this.generateClass(CLASS.bar,d.index)},ChartInternal.prototype.classBars=function(d){return this.classShapes(d)+this.generateClass(CLASS.bars,d.id)},ChartInternal.prototype.classArc=function(d){return this.classShape(d.data)+this.generateClass(CLASS.arc,d.data.id)},ChartInternal.prototype.classArcs=function(d){return this.classShapes(d.data)+this.generateClass(CLASS.arcs,d.data.id)},ChartInternal.prototype.classArea=function(d){return this.classShape(d)+this.generateClass(CLASS.area,d.id)},ChartInternal.prototype.classAreas=function(d){return this.classShapes(d)+this.generateClass(CLASS.areas,d.id)},ChartInternal.prototype.classRegion=function(d,i){return this.generateClass(CLASS.region,i)+" "+("class"in d?d.class:"")},ChartInternal.prototype.classEvent=function(d){return this.generateClass(CLASS.eventRect,d.index)},ChartInternal.prototype.classTarget=function(id){var additionalClass=this.config.data_classes[id],additionalClass=additionalClass?" "+CLASS.target+"-"+additionalClass:"";return this.generateClass(CLASS.target,id)+additionalClass},ChartInternal.prototype.classFocus=function(d){return this.classFocused(d)+this.classDefocused(d)},ChartInternal.prototype.classFocused=function(d){return" "+(0<=this.focusedTargetIds.indexOf(d.id)?CLASS.focused:"")},ChartInternal.prototype.classDefocused=function(d){return" "+(0<=this.defocusedTargetIds.indexOf(d.id)?CLASS.defocused:"")},ChartInternal.prototype.classChartText=function(d){return CLASS.chartText+this.classTarget(d.id)},ChartInternal.prototype.classChartLine=function(d){return CLASS.chartLine+this.classTarget(d.id)},ChartInternal.prototype.classChartBar=function(d){return CLASS.chartBar+this.classTarget(d.id)},ChartInternal.prototype.classChartArc=function(d){return CLASS.chartArc+this.classTarget(d.data.id)},ChartInternal.prototype.getTargetSelectorSuffix=function(targetClass){targetClass=this.generateTargetClass(targetClass);return window.CSS&&window.CSS.escape?window.CSS.escape(targetClass):targetClass.replace(/([?!@#$%^&*()=+,.<>'":;\[\]\/|~`{}\\])/g,"\\$1")},ChartInternal.prototype.selectorTarget=function(id,prefix){return(prefix||"")+"."+CLASS.target+this.getTargetSelectorSuffix(id)},ChartInternal.prototype.selectorTargets=function(ids,prefix){var $$=this;return(ids=ids||[]).length?ids.map(function(id){return $$.selectorTarget(id,prefix)}):null},ChartInternal.prototype.selectorLegend=function(id){return"."+CLASS.legendItem+this.getTargetSelectorSuffix(id)},ChartInternal.prototype.selectorLegends=function(ids){var $$=this;return ids&&ids.length?ids.map(function(id){return $$.selectorLegend(id)}):null},ChartInternal.prototype.getClipPath=function(id){return"url("+(0<=window.navigator.appVersion.toLowerCase().indexOf("msie 9.")?"":document.URL.split("#")[0])+"#"+id+")"},ChartInternal.prototype.appendClip=function(parent,id){return parent.append("clipPath").attr("id",id).append("rect")},ChartInternal.prototype.getAxisClipX=function(forHorizontal){var left=Math.max(30,this.margin.left);return forHorizontal?-(1+left):-(left-1)},ChartInternal.prototype.getAxisClipY=function(forHorizontal){return forHorizontal?-20:-this.margin.top},ChartInternal.prototype.getXAxisClipX=function(){return this.getAxisClipX(!this.config.axis_rotated)},ChartInternal.prototype.getXAxisClipY=function(){return this.getAxisClipY(!this.config.axis_rotated)},ChartInternal.prototype.getYAxisClipX=function(){return this.config.axis_y_inner?-1:this.getAxisClipX(this.config.axis_rotated)},ChartInternal.prototype.getYAxisClipY=function(){return this.getAxisClipY(this.config.axis_rotated)},ChartInternal.prototype.getAxisClipWidth=function(forHorizontal){var left=Math.max(30,this.margin.left),right=Math.max(30,this.margin.right);return forHorizontal?this.width+2+left+right:this.margin.left+20},ChartInternal.prototype.getAxisClipHeight=function(forHorizontal){return(forHorizontal?this.margin.bottom:this.margin.top+this.height)+20},ChartInternal.prototype.getXAxisClipWidth=function(){return this.getAxisClipWidth(!this.config.axis_rotated)},ChartInternal.prototype.getXAxisClipHeight=function(){return this.getAxisClipHeight(!this.config.axis_rotated)},ChartInternal.prototype.getYAxisClipWidth=function(){return this.getAxisClipWidth(this.config.axis_rotated)+(this.config.axis_y_inner?20:0)},ChartInternal.prototype.getYAxisClipHeight=function(){return this.getAxisClipHeight(this.config.axis_rotated)},ChartInternal.prototype.generateColor=function(){var config=this.config,d3=this.d3,colors=config.data_colors,pattern=notEmpty(config.color_pattern)?config.color_pattern:d3.schemeCategory10,callback=config.data_color,ids=[];return function(d){var color,id=d.id||d.data&&d.data.id||d;return colors[id]instanceof Function?color=colors[id](d):colors[id]?color=colors[id]:(ids.indexOf(id)<0&&ids.push(id),color=pattern[ids.indexOf(id)%pattern.length],colors[id]=color),callback instanceof Function?callback(color,d):color}},ChartInternal.prototype.generateLevelColor=function(){var threshold=this.config,colors=threshold.color_pattern,threshold=threshold.color_threshold,asValue="value"===threshold.unit,values=threshold.values&&threshold.values.length?threshold.values:[],max=threshold.max||100;return notEmpty(threshold)&&notEmpty(colors)?function(value){for(var color=colors[colors.length-1],i=0;i<values.length;i++)if((asValue?value:100*value/max)<values[i]){color=colors[i];break}return color}:null},ChartInternal.prototype.getDefaultConfig=function(){var config={bindto:"#chart",svg_classname:void 0,size_width:void 0,size_height:void 0,padding_left:void 0,padding_right:void 0,padding_top:void 0,padding_bottom:void 0,resize_auto:!0,zoom_enabled:!1,zoom_initialRange:void 0,zoom_type:"scroll",zoom_disableDefaultBehavior:!1,zoom_privileged:!1,zoom_rescale:!1,zoom_onzoom:function zoom_onzoom(){},zoom_onzoomstart:function zoom_onzoomstart(){},zoom_onzoomend:function zoom_onzoomend(){},zoom_x_min:void 0,zoom_x_max:void 0,interaction_brighten:!0,interaction_enabled:!0,onmouseover:function onmouseover(){},onmouseout:function onmouseout(){},onresize:function onresize(){},onresized:function onresized(){},oninit:function oninit(){},onrendered:function onrendered(){},transition_duration:350,data_epochs:"epochs",data_x:void 0,data_xs:{},data_xFormat:"%Y-%m-%d",data_xLocaltime:!0,data_xSort:!0,data_idConverter:function data_idConverter(id){return id},data_names:{},data_classes:{},data_groups:[],data_axes:{},data_type:void 0,data_types:{},data_labels:{},data_order:"desc",data_regions:{},data_color:void 0,data_colors:{},data_hide:!1,data_filter:void 0,data_selection_enabled:!1,data_selection_grouped:!1,data_selection_isselectable:function data_selection_isselectable(){return!0},data_selection_multiple:!0,data_selection_draggable:!1,data_stack_normalize:!1,data_onclick:function data_onclick(){},data_onmouseover:function data_onmouseover(){},data_onmouseout:function data_onmouseout(){},data_onselected:function data_onselected(){},data_onunselected:function data_onunselected(){},data_url:void 0,data_headers:void 0,data_json:void 0,data_rows:void 0,data_columns:void 0,data_mimeType:void 0,data_keys:void 0,data_empty_label_text:"",subchart_show:!1,subchart_size_height:60,subchart_axis_x_show:!0,subchart_onbrush:function subchart_onbrush(){},color_pattern:[],color_threshold:{},legend_show:!0,legend_hide:!1,legend_position:"bottom",legend_inset_anchor:"top-left",legend_inset_x:10,legend_inset_y:0,legend_inset_step:void 0,legend_item_onclick:void 0,legend_item_onmouseover:void 0,legend_item_onmouseout:void 0,legend_equally:!1,legend_padding:0,legend_item_tile_width:10,legend_item_tile_height:10,axis_rotated:!1,axis_x_show:!0,axis_x_type:"indexed",axis_x_localtime:!0,axis_x_categories:[],axis_x_tick_centered:!1,axis_x_tick_format:void 0,axis_x_tick_culling:{},axis_x_tick_culling_max:10,axis_x_tick_count:void 0,axis_x_tick_fit:!0,axis_x_tick_values:null,axis_x_tick_rotate:0,axis_x_tick_outer:!0,axis_x_tick_multiline:!0,axis_x_tick_multilineMax:0,axis_x_tick_width:null,axis_x_max:void 0,axis_x_min:void 0,axis_x_padding:{},axis_x_height:void 0,axis_x_selection:void 0,axis_x_label:{},axis_x_inner:void 0,axis_y_show:!0,axis_y_type:"linear",axis_y_max:void 0,axis_y_min:void 0,axis_y_inverted:!1,axis_y_center:void 0,axis_y_inner:void 0,axis_y_label:{},axis_y_tick_format:void 0,axis_y_tick_outer:!0,axis_y_tick_values:null,axis_y_tick_rotate:0,axis_y_tick_count:void 0,axis_y_tick_time_type:void 0,axis_y_tick_time_interval:void 0,axis_y_padding:{},axis_y_default:void 0,axis_y2_show:!1,axis_y2_type:"linear",axis_y2_max:void 0,axis_y2_min:void 0,axis_y2_inverted:!1,axis_y2_center:void 0,axis_y2_inner:void 0,axis_y2_label:{},axis_y2_tick_format:void 0,axis_y2_tick_outer:!0,axis_y2_tick_values:null,axis_y2_tick_count:void 0,axis_y2_padding:{},axis_y2_default:void 0,grid_x_show:!1,grid_x_type:"tick",grid_x_lines:[],grid_y_show:!1,grid_y_lines:[],grid_y_ticks:10,grid_focus_show:!0,grid_lines_front:!0,point_show:!0,point_r:2.5,point_sensitivity:10,point_focus_expand_enabled:!0,point_focus_expand_r:void 0,point_select_r:void 0,line_connectNull:!1,line_step_type:"step",bar_width:void 0,bar_width_ratio:.6,bar_width_max:void 0,bar_zerobased:!0,bar_space:0,area_zerobased:!0,area_above:!1,pie_label_show:!0,pie_label_format:void 0,pie_label_threshold:.05,pie_label_ratio:void 0,pie_expand:{},pie_expand_duration:50,pie_padAngle:0,gauge_fullCircle:!1,gauge_label_show:!0,gauge_labelLine_show:!0,gauge_label_format:void 0,gauge_min:0,gauge_max:100,gauge_startingAngle:-1*Math.PI/2,gauge_label_extents:void 0,gauge_units:void 0,gauge_width:void 0,gauge_arcs_minWidth:5,gauge_expand:{},gauge_expand_duration:50,donut_label_show:!0,donut_label_format:void 0,donut_label_threshold:.05,donut_label_ratio:void 0,donut_width:void 0,donut_title:"",donut_expand:{},donut_expand_duration:50,donut_padAngle:0,spline_interpolation_type:"cardinal",stanford_lines:[],stanford_regions:[],stanford_texts:[],stanford_scaleMin:void 0,stanford_scaleMax:void 0,stanford_scaleWidth:void 0,stanford_scaleFormat:void 0,stanford_scaleValues:void 0,stanford_colors:void 0,stanford_padding:{top:0,right:0,bottom:0,left:0},regions:[],tooltip_show:!0,tooltip_grouped:!0,tooltip_order:void 0,tooltip_format_title:void 0,tooltip_format_name:void 0,tooltip_format_value:void 0,tooltip_horizontal:void 0,tooltip_position:void 0,tooltip_contents:function tooltip_contents(d,defaultTitleFormat,defaultValueFormat,color){return this.getTooltipContent?this.getTooltipContent(d,defaultTitleFormat,defaultValueFormat,color):""},tooltip_init_show:!1,tooltip_init_x:0,tooltip_init_position:{top:"0px",left:"50px"},tooltip_onshow:function tooltip_onshow(){},tooltip_onhide:function tooltip_onhide(){},title_text:void 0,title_padding:{top:0,right:0,bottom:0,left:0},title_position:"top-center"};return Object.keys(this.additionalConfig).forEach(function(key){config[key]=this.additionalConfig[key]},this),config},ChartInternal.prototype.additionalConfig={},ChartInternal.prototype.loadConfig=function(config){var target,keys,read,this_config=this.config;Object.keys(this_config).forEach(function(key){target=config,keys=key.split("_"),read=function find(){var key=keys.shift();return key&&target&&"object"===_typeof(target)&&key in target?(target=target[key],find()):key?void 0:target}(),isDefined(read)&&(this_config[key]=read)})},ChartInternal.prototype.convertUrlToData=function(url,type,headers,keys,done){var f,$$=this,type=type||"csv",converter="json"===type?(f=$$.d3.json,$$.convertJsonToData):(f="tsv"===type?$$.d3.tsv:$$.d3.csv,$$.convertXsvToData);f(url,headers).then(function(data){done.call($$,converter.call($$,data,keys))}).catch(function(error){throw error})},ChartInternal.prototype.convertXsvToData=function(xsv){var keys=xsv.columns;return 0===xsv.length?{keys:keys,rows:[keys.reduce(function(row,key){return Object.assign(row,function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},key,null))},{})]}:{keys:keys,rows:[].concat(xsv)}},ChartInternal.prototype.convertJsonToData=function(json,data){var targetKeys,$$=this,new_rows=[],data=data?(data.x?(targetKeys=data.value.concat(data.x),$$.config.data_x=data.x):targetKeys=data.value,new_rows.push(targetKeys),json.forEach(function(o){var new_row=[];targetKeys.forEach(function(v){v=$$.findValueInJson(o,v);isUndefined(v)&&(v=null),new_row.push(v)}),new_rows.push(new_row)}),$$.convertRowsToData(new_rows)):(Object.keys(json).forEach(function(key){new_rows.push([key].concat(json[key]))}),$$.convertColumnsToData(new_rows));return data},ChartInternal.prototype.findValueInJson=function(object,path){for(var pathArray=(path=(path=path.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),i=0;i<pathArray.length;++i){var k=pathArray[i];if(!(k in object))return;object=object[k]}return object},ChartInternal.prototype.convertRowsToData=function(rows){for(var newRows=[],keys=rows[0],i=1;i<rows.length;i++){for(var newRow={},j=0;j<rows[i].length;j++){if(isUndefined(rows[i][j]))throw new Error("Source data is missing a component at ("+i+","+j+")!");newRow[keys[j]]=rows[i][j]}newRows.push(newRow)}return{keys:keys,rows:newRows}},ChartInternal.prototype.convertColumnsToData=function(columns){for(var newRows=[],keys=[],i=0;i<columns.length;i++){for(var key=columns[i][0],j=1;j<columns[i].length;j++){if(isUndefined(newRows[j-1])&&(newRows[j-1]={}),isUndefined(columns[i][j]))throw new Error("Source data is missing a component at ("+i+","+j+")!");newRows[j-1][key]=columns[i][j]}keys.push(key)}return{keys:keys,rows:newRows}},ChartInternal.prototype.convertDataToTargets=function(data,appendXs){var targets,xs,keys,epochs,$$=this,config=$$.config;if(isArray(data)?keys=Object.keys(data[0]):(keys=data.keys,data=data.rows),xs=keys.filter($$.isX,$$),$$.isStanfordGraphType()){if(epochs=keys.filter($$.isEpochs,$$),targets=keys.filter($$.isNotXAndNotEpochs,$$),1!==xs.length||1!==epochs.length||1!==targets.length)throw new Error("You must define the 'x' key name and the 'epochs' for Stanford Diagrams")}else targets=keys.filter($$.isNotX,$$);return targets.forEach(function(id){var xKey=$$.getXKey(id);$$.isCustomX()||$$.isTimeSeries()?0<=xs.indexOf(xKey)?$$.data.xs[id]=(appendXs&&$$.data.xs[id]?$$.data.xs[id]:[]).concat(data.map(function(d){return d[xKey]}).filter(isValue).map(function(rawX,i){return $$.generateTargetX(rawX,id,i)})):config.data_x?$$.data.xs[id]=$$.getOtherTargetXs():notEmpty(config.data_xs)&&($$.data.xs[id]=$$.getXValuesOfXKey(xKey,$$.data.targets)):$$.data.xs[id]=data.map(function(d,i){return i})}),targets.forEach(function(id){if(!$$.data.xs[id])throw new Error('x is not defined for id = "'+id+'".')}),(targets=targets.map(function(id,index){var convertedId=config.data_idConverter(id);return{id:convertedId,id_org:id,values:data.map(function(d,i){var x,rawX=d[$$.getXKey(id)],returnData=null===d[id]||isNaN(d[id])?null:+d[id];return $$.isCustomX()&&$$.isCategorized()&&!isUndefined(rawX)?(0===index&&0===i&&(config.axis_x_categories=[]),-1===(x=config.axis_x_categories.indexOf(rawX))&&(x=config.axis_x_categories.length,config.axis_x_categories.push(rawX))):x=$$.generateTargetX(rawX,id,i),returnData={x:x=isUndefined(d[id])||$$.data.xs[id].length<=i?void 0:x,value:returnData,id:convertedId},$$.isStanfordGraphType()&&(returnData.epochs=d[epochs]),returnData}).filter(function(v){return isDefined(v.x)})}})).forEach(function(t){var i;config.data_xSort&&(t.values=t.values.sort(function(v1,v2){return(v1.x||0===v1.x?v1.x:1/0)-(v2.x||0===v2.x?v2.x:1/0)})),i=0,t.values.forEach(function(v){v.index=i++}),$$.data.xs[t.id].sort(function(v1,v2){return v1-v2})}),$$.hasNegativeValue=$$.hasNegativeValueInTargets(targets),$$.hasPositiveValue=$$.hasPositiveValueInTargets(targets),config.data_type&&$$.setTargetType($$.mapToIds(targets).filter(function(id){return!(id in config.data_types)}),config.data_type),targets.forEach(function(d){$$.addCache(d.id_org,d)}),targets},ChartInternal.prototype.isEpochs=function(key){var config=this.config;return config.data_epochs&&key===config.data_epochs},ChartInternal.prototype.isX=function(key){var config=this.config;return config.data_x&&key===config.data_x||notEmpty(config.data_xs)&&hasValue(config.data_xs,key)},ChartInternal.prototype.isNotX=function(key){return!this.isX(key)},ChartInternal.prototype.isNotXAndNotEpochs=function(key){return!this.isX(key)&&!this.isEpochs(key)},ChartInternal.prototype.isStackNormalized=function(){return this.config.data_stack_normalize&&0<this.config.data_groups.length},ChartInternal.prototype.isAxisNormalized=function(axisId){var $$=this;return!!$$.isStackNormalized()&&$$.data.targets.filter(function(target){return $$.axis.getId(target.id)===axisId}).some(function(target){return $$.isTargetNormalized(target.id)})},ChartInternal.prototype.isTargetNormalized=function(targetId){return this.isStackNormalized()&&this.config.data_groups.some(function(group){return group.includes(targetId)})},ChartInternal.prototype.getXKey=function(id){var config=this.config;return config.data_x||(notEmpty(config.data_xs)?config.data_xs[id]:null)},ChartInternal.prototype.getTotalPerIndex=function(axisId){var $$=this;if(!$$.isStackNormalized())return null;var cached=$$.getFromCache("getTotalPerIndex");if(void 0!==cached)return cached[axisId];var sum={y:[],y2:[]};return $$.data.targets.filter(function(target){return $$.isTargetNormalized(target.id)}).filter(function(target){return $$.isTargetToShow(target.id)}).forEach(function(target){var sumByAxis=sum[$$.axis.getId(target.id)];target.values.forEach(function(v,i){sumByAxis[i]||(sumByAxis[i]=0),sumByAxis[i]+=isNumber(v.value)?v.value:0})}),$$.addToCache("getTotalPerIndex",sum),sum[axisId]},ChartInternal.prototype.getTotalDataSum=function(){var $$=this,totalDataSum=$$.getFromCache("getTotalDataSum");if(void 0!==totalDataSum)return totalDataSum;totalDataSum=flattenArray($$.data.targets.filter(function(target){return $$.isTargetToShow(target.id)}).map(function(target){return target.values})).map(function(d){return d.value}).reduce(function(p,c){return p+c},0);return $$.addToCache("getTotalDataSum",totalDataSum),totalDataSum},ChartInternal.prototype.getXValuesOfXKey=function(key,targets){var xValues,$$=this;return(targets&&notEmpty(targets)?$$.mapToIds(targets):[]).forEach(function(id){$$.getXKey(id)===key&&(xValues=$$.data.xs[id])}),xValues},ChartInternal.prototype.getXValue=function(id,i){return id in this.data.xs&&this.data.xs[id]&&isValue(this.data.xs[id][i])?this.data.xs[id][i]:i},ChartInternal.prototype.getOtherTargetXs=function(){var idsForX=Object.keys(this.data.xs);return idsForX.length?this.data.xs[idsForX[0]]:null},ChartInternal.prototype.getOtherTargetX=function(index){var xs=this.getOtherTargetXs();return xs&&index<xs.length?xs[index]:null},ChartInternal.prototype.addXs=function(xs){var $$=this;Object.keys(xs).forEach(function(id){$$.config.data_xs[id]=xs[id]})},ChartInternal.prototype.addName=function(data){var name;return data&&(name=this.config.data_names[data.id],data.name=void 0!==name?name:data.id),data},ChartInternal.prototype.getValueOnIndex=function(valueOnIndex,index){valueOnIndex=valueOnIndex.filter(function(v){return v.index===index});return valueOnIndex.length?valueOnIndex[0]:null},ChartInternal.prototype.updateTargetX=function(targets,x){var $$=this;targets.forEach(function(t){t.values.forEach(function(v,i){v.x=$$.generateTargetX(x[i],t.id,i)}),$$.data.xs[t.id]=x})},ChartInternal.prototype.updateTargetXs=function(targets,xs){var $$=this;targets.forEach(function(t){xs[t.id]&&$$.updateTargetX([t],xs[t.id])})},ChartInternal.prototype.generateTargetX=function(rawX,id,x){var $$=this,x=$$.isTimeSeries()?rawX?$$.parseDate(rawX):$$.parseDate($$.getXValue(id,x)):$$.isCustomX()&&!$$.isCategorized()?isValue(rawX)?+rawX:$$.getXValue(id,x):x;return x},ChartInternal.prototype.cloneTarget=function(target){return{id:target.id,id_org:target.id_org,values:target.values.map(function(d){return{x:d.x,value:d.value,id:d.id}})}},ChartInternal.prototype.getMaxDataCount=function(){return this.d3.max(this.data.targets,function(t){return t.values.length})},ChartInternal.prototype.mapToIds=function(targets){return targets.map(function(d){return d.id})},ChartInternal.prototype.mapToTargetIds=function(ids){return ids?[].concat(ids):this.mapToIds(this.data.targets)},ChartInternal.prototype.hasTarget=function(targets,id){for(var ids=this.mapToIds(targets),i=0;i<ids.length;i++)if(ids[i]===id)return!0;return!1},ChartInternal.prototype.isTargetToShow=function(targetId){return this.hiddenTargetIds.indexOf(targetId)<0},ChartInternal.prototype.isLegendToShow=function(targetId){return this.hiddenLegendIds.indexOf(targetId)<0},ChartInternal.prototype.getTargetsToShow=function(){return this.filterTargetsToShow(this.data.targets)},ChartInternal.prototype.filterTargetsToShow=function(targets){var $$=this;return targets.filter(function(t){return $$.isTargetToShow(t.id)})},ChartInternal.prototype.mapTargetsToUniqueXs=function(xs){xs=this.d3.set(this.d3.merge(xs.map(function(t){return t.values.map(function(v){return+v.x})}))).values();return(xs=this.isTimeSeries()?xs.map(function(x){return new Date(+x)}):xs.map(function(x){return+x})).sort(function(a,b){return a<b?-1:b<a?1:b<=a?0:NaN})},ChartInternal.prototype.addHiddenTargetIds=function(targetIds){targetIds=targetIds instanceof Array?targetIds:new Array(targetIds);for(var i=0;i<targetIds.length;i++)this.hiddenTargetIds.indexOf(targetIds[i])<0&&(this.hiddenTargetIds=this.hiddenTargetIds.concat(targetIds[i]));this.resetCache()},ChartInternal.prototype.removeHiddenTargetIds=function(targetIds){this.hiddenTargetIds=this.hiddenTargetIds.filter(function(id){return targetIds.indexOf(id)<0}),this.resetCache()},ChartInternal.prototype.addHiddenLegendIds=function(targetIds){targetIds=targetIds instanceof Array?targetIds:new Array(targetIds);for(var i=0;i<targetIds.length;i++)this.hiddenLegendIds.indexOf(targetIds[i])<0&&(this.hiddenLegendIds=this.hiddenLegendIds.concat(targetIds[i]))},ChartInternal.prototype.removeHiddenLegendIds=function(targetIds){this.hiddenLegendIds=this.hiddenLegendIds.filter(function(id){return targetIds.indexOf(id)<0})},ChartInternal.prototype.getValuesAsIdKeyed=function(targets){var ys={};return targets.forEach(function(t){ys[t.id]=[],t.values.forEach(function(v){ys[t.id].push(v.value)})}),ys},ChartInternal.prototype.checkValueInTargets=function(targets,checker){for(var j,values,ids=Object.keys(targets),i=0;i<ids.length;i++)for(values=targets[ids[i]].values,j=0;j<values.length;j++)if(checker(values[j].value))return!0;return!1},ChartInternal.prototype.hasNegativeValueInTargets=function(targets){return this.checkValueInTargets(targets,function(v){return v<0})},ChartInternal.prototype.hasPositiveValueInTargets=function(targets){return this.checkValueInTargets(targets,function(v){return 0<v})},ChartInternal.prototype.isOrderDesc=function(){var config=this.config;return"string"==typeof config.data_order&&"desc"===config.data_order.toLowerCase()},ChartInternal.prototype.isOrderAsc=function(){var config=this.config;return"string"==typeof config.data_order&&"asc"===config.data_order.toLowerCase()},ChartInternal.prototype.getOrderFunction=function(){var config=this.config,orderAsc=this.isOrderAsc(),orderDesc=this.isOrderDesc();if(orderAsc||orderDesc){var reducer=function reducer(p,c){return p+Math.abs(c.value)};return function(t1Sum,t2Sum){t1Sum=t1Sum.values.reduce(reducer,0),t2Sum=t2Sum.values.reduce(reducer,0);return orderAsc?t2Sum-t1Sum:t1Sum-t2Sum}}if(isFunction(config.data_order))return config.data_order;if(isArray(config.data_order)){var order=config.data_order;return function(t1,t2){return order.indexOf(t1.id)-order.indexOf(t2.id)}}},ChartInternal.prototype.orderTargets=function(targets){var fct=this.getOrderFunction();return fct&&targets.sort(fct),targets},ChartInternal.prototype.filterByIndex=function(targets,index){return this.d3.merge(targets.map(function(t){return t.values.filter(function(v){return v.index===index})}))},ChartInternal.prototype.filterByX=function(targets,x){return this.d3.merge(targets.map(function(t){return t.values})).filter(function(v){return v.x-x==0})},ChartInternal.prototype.filterRemoveNull=function(data){return data.filter(function(d){return isValue(d.value)})},ChartInternal.prototype.filterByXDomain=function(targets,xDomain){return targets.map(function(t){return{id:t.id,id_org:t.id_org,values:t.values.filter(function(v){return xDomain[0]<=v.x&&v.x<=xDomain[1]})}})},ChartInternal.prototype.hasDataLabel=function(){var config=this.config;return!("boolean"!=typeof config.data_labels||!config.data_labels)||!("object"!==_typeof(config.data_labels)||!notEmpty(config.data_labels))},ChartInternal.prototype.getDataLabelLength=function(min,max,key){var $$=this,lengths=[0,0];return $$.selectChart.select("svg").selectAll(".dummy").data([min,max]).enter().append("text").text(function(d){return $$.dataLabelFormat(d.id)(d)}).each(function(d,i){lengths[i]=1.3*getBBox(this)[key]}).remove(),lengths},ChartInternal.prototype.isNoneArc=function(d){return this.hasTarget(this.data.targets,d.id)},ChartInternal.prototype.isArc=function(d){return"data"in d&&this.hasTarget(this.data.targets,d.data.id)},ChartInternal.prototype.findClosestFromTargets=function(candidates,pos){var $$=this,candidates=candidates.map(function(t){return $$.findClosest(t.values,pos,($$.config.tooltip_horizontal?$$.horizontalDistance:$$.dist).bind($$),$$.config.point_sensitivity)}).filter(function(v){return v});if(0!==candidates.length)return 1===candidates.length?candidates[0]:$$.findClosest(candidates,pos,$$.dist.bind($$))},ChartInternal.prototype.findClosestFromTargetsByX=function(targets,x){var closest,diff;return targets.forEach(function(t){t.values.forEach(function(d){var newDiff=Math.abs(x-d.x);(void 0===diff||newDiff<diff)&&(closest=d,diff=newDiff)})}),closest},ChartInternal.prototype.findClosest=function(dataPoints,pos,computeDist){var closest,minDist=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1/0,$$=this;return dataPoints.filter(function(v){return v&&$$.isBarType(v.id)}).forEach(function(v){var shape;closest||(shape=$$.main.select("."+CLASS.bars+$$.getTargetSelectorSuffix(v.id)+" ."+CLASS.bar+"-"+v.index).node(),$$.isWithinBar(pos,shape)&&(closest=v))}),dataPoints.filter(function(v){return v&&!$$.isBarType(v.id)}).forEach(function(v){var d=computeDist(v,pos);d<minDist&&(minDist=d,closest=v)}),closest},ChartInternal.prototype.dist=function(x,pos){var y=this.config,xIndex=y.axis_rotated?1:0,yIndex=y.axis_rotated?0:1,y=this.circleY(x,x.index),x=this.x(x.x);return Math.sqrt(Math.pow(x-pos[xIndex],2)+Math.pow(y-pos[yIndex],2))},ChartInternal.prototype.horizontalDistance=function(x,pos){var xIndex=this.config.axis_rotated?1:0,x=this.x(x.x);return Math.abs(x-pos[xIndex])},ChartInternal.prototype.convertValuesToStep=function(values){var i,converted=[].concat(values);if(!this.isCategorized())return values;for(i=values.length+1;0<i;i--)converted[i]=converted[i-1];return converted[0]={x:converted[0].x-1,value:converted[0].value,id:converted[0].id},converted[values.length+1]={x:converted[values.length].x+1,value:converted[values.length].value,id:converted[values.length].id},converted},ChartInternal.prototype.getRatio=function(type,d){var asPercent=2<arguments.length&&void 0!==arguments[2]&&arguments[2],_total=this,total=_total.api,ratio=0;return d&&total.data.shown.call(total).length&&(ratio=d.ratio||d.value,"arc"===type?ratio=_total.hasType("gauge")?(d.endAngle-d.startAngle)/(Math.PI*(_total.config.gauge_fullCircle?2:1)):(total=_total.getTotalDataSum(),d.value/total):"index"===type&&(_total=_total.getTotalPerIndex(_total.axis.getId(d.id)),d.ratio=isNumber(d.value)&&_total&&0<_total[d.index]?d.value/_total[d.index]:0,ratio=d.ratio)),asPercent&&ratio?100*ratio:ratio},ChartInternal.prototype.updateDataAttributes=function(name,attrs){var current=this.config["data_"+name];return void 0===attrs||(Object.keys(attrs).forEach(function(id){current[id]=attrs[id]}),this.redraw({withLegend:!0})),current},ChartInternal.prototype.load=function(targets,args){var $$=this;targets&&(args.filter&&(targets=targets.filter(args.filter)),(args.type||args.types)&&targets.forEach(function(t){var type=args.types&&args.types[t.id]?args.types[t.id]:args.type;$$.setTargetType(t.id,type)}),$$.data.targets.forEach(function(d){for(var i=0;i<targets.length;i++)if(d.id===targets[i].id){d.values=targets[i].values,targets.splice(i,1);break}}),$$.data.targets=$$.data.targets.concat(targets)),$$.updateTargets($$.data.targets),$$.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),args.done&&args.done()},ChartInternal.prototype.loadFromArgs=function(args){var $$=this;$$.resetCache(),args.data?$$.load($$.convertDataToTargets(args.data),args):args.url?$$.convertUrlToData(args.url,args.mimeType,args.headers,args.keys,function(data){$$.load($$.convertDataToTargets(data),args)}):args.json?$$.load($$.convertDataToTargets($$.convertJsonToData(args.json,args.keys)),args):args.rows?$$.load($$.convertDataToTargets($$.convertRowsToData(args.rows)),args):args.columns?$$.load($$.convertDataToTargets($$.convertColumnsToData(args.columns)),args):$$.load(null,args)},ChartInternal.prototype.unload=function(targetIds,done){var $$=this;$$.resetCache(),done=done||function done(){},(targetIds=targetIds.filter(function(id){return $$.hasTarget($$.data.targets,id)}))&&0!==targetIds.length?($$.svg.selectAll(targetIds.map(function(id){return $$.selectorTarget(id)})).transition().style("opacity",0).remove().call($$.endall,done),targetIds.forEach(function(id){$$.withoutFadeIn[id]=!1,$$.legend&&$$.legend.selectAll("."+CLASS.legendItem+$$.getTargetSelectorSuffix(id)).remove(),$$.data.targets=$$.data.targets.filter(function(t){return t.id!==id})})):done()},ChartInternal.prototype.getYDomainMin=function(targets){var j,k,baseId,idsInGroup,id,hasNegativeValue,$$=this,config=$$.config,ids=$$.mapToIds(targets),ys=$$.getValuesAsIdKeyed(targets);if(0<config.data_groups.length)for(hasNegativeValue=$$.hasNegativeValueInTargets(targets),j=0;j<config.data_groups.length;j++)if(0!==(idsInGroup=config.data_groups[j].filter(function(id){return 0<=ids.indexOf(id)})).length)for(baseId=idsInGroup[0],hasNegativeValue&&ys[baseId]&&ys[baseId].forEach(function(v,i){ys[baseId][i]=v<0?v:0}),k=1;k<idsInGroup.length;k++)id=idsInGroup[k],ys[id]&&ys[id].forEach(function(v,i){$$.axis.getId(id)!==$$.axis.getId(baseId)||!ys[baseId]||hasNegativeValue&&0<+v||(ys[baseId][i]+=+v)});return $$.d3.min(Object.keys(ys).map(function(key){return $$.d3.min(ys[key])}))},ChartInternal.prototype.getYDomainMax=function(targets){var j,k,baseId,idsInGroup,id,hasPositiveValue,$$=this,config=$$.config,ids=$$.mapToIds(targets),ys=$$.getValuesAsIdKeyed(targets);if(0<config.data_groups.length)for(hasPositiveValue=$$.hasPositiveValueInTargets(targets),j=0;j<config.data_groups.length;j++)if(0!==(idsInGroup=config.data_groups[j].filter(function(id){return 0<=ids.indexOf(id)})).length)for(baseId=idsInGroup[0],hasPositiveValue&&ys[baseId]&&ys[baseId].forEach(function(v,i){ys[baseId][i]=0<v?v:0}),k=1;k<idsInGroup.length;k++)id=idsInGroup[k],ys[id]&&ys[id].forEach(function(v,i){$$.axis.getId(id)!==$$.axis.getId(baseId)||!ys[baseId]||hasPositiveValue&&+v<0||(ys[baseId][i]+=+v)});return $$.d3.max(Object.keys(ys).map(function(key){return $$.d3.max(ys[key])}))},ChartInternal.prototype.getYDomain=function(isAllPositive,axisId,isAllNegative){var $$=this,config=$$.config;if($$.isAxisNormalized(axisId))return[0,100];var lengths,domainLength=isAllPositive.filter(function(t){return $$.axis.getId(t.id)===axisId}),padding_bottom=isAllNegative?$$.filterByXDomain(domainLength,isAllNegative):domainLength,domain="y2"===axisId?config.axis_y2_min:config.axis_y_min,yDomainAbs="y2"===axisId?config.axis_y2_max:config.axis_y_max,yDomainMin=$$.getYDomainMin(padding_bottom),yDomainMax=$$.getYDomainMax(padding_bottom),center="y2"===axisId?config.axis_y2_center:config.axis_y_center,isZeroBased=$$.hasType("bar",padding_bottom)&&config.bar_zerobased||$$.hasType("area",padding_bottom)&&config.area_zerobased,isInverted="y2"===axisId?config.axis_y2_inverted:config.axis_y_inverted,ratio=$$.hasDataLabel()&&config.axis_rotated,pixelsToAxisPadding=$$.hasDataLabel()&&!config.axis_rotated,yDomainMin=isValue(domain)?domain:!isValue(yDomainAbs)||yDomainMin<yDomainAbs?yDomainMin:yDomainAbs-10,yDomainMax=isValue(yDomainAbs)?yDomainAbs:!isValue(domain)||domain<yDomainMax?yDomainMax:domain+10;return 0===padding_bottom.length?("y2"===axisId?$$.y2:$$.y).domain():((yDomainMin=isNaN(yDomainMin)?0:yDomainMin)===(yDomainMax=isNaN(yDomainMax)?yDomainMin:yDomainMax)&&(yDomainMin<0?yDomainMax=0:yDomainMin=0),isAllPositive=0<=yDomainMin&&0<=yDomainMax,isAllNegative=yDomainMin<=0&&yDomainMax<=0,(isZeroBased=isValue(domain)&&isAllPositive||isValue(yDomainAbs)&&isAllNegative?!1:isZeroBased)&&(isAllPositive&&(yDomainMin=0),isAllNegative&&(yDomainMax=0)),domain=padding_bottom=.1*(domainLength=Math.abs(yDomainMax-yDomainMin)),void 0!==center&&(yDomainMax=center+(yDomainAbs=Math.max(Math.abs(yDomainMin),Math.abs(yDomainMax))),yDomainMin=center-yDomainAbs),ratio?(lengths=$$.getDataLabelLength(yDomainMin,yDomainMax,"width"),ratio=diffDomain($$.y.range()),domain+=domainLength*((ratio=[lengths[0]/ratio,lengths[1]/ratio])[1]/(1-ratio[0]-ratio[1])),padding_bottom+=domainLength*(ratio[0]/(1-ratio[0]-ratio[1]))):pixelsToAxisPadding&&(lengths=$$.getDataLabelLength(yDomainMin,yDomainMax,"height"),domain+=(pixelsToAxisPadding=$$.getY(config["axis_".concat(axisId,"_type")],[0,config.axis_rotated?$$.width:$$.height],[0,domainLength]))(lengths[1]),padding_bottom+=pixelsToAxisPadding(lengths[0])),"y"===axisId&&notEmpty(config.axis_y_padding)&&(domain=$$.axis.getPadding(config.axis_y_padding,"top",domain,domainLength),padding_bottom=$$.axis.getPadding(config.axis_y_padding,"bottom",padding_bottom,domainLength)),"y2"===axisId&&notEmpty(config.axis_y2_padding)&&(domain=$$.axis.getPadding(config.axis_y2_padding,"top",domain,domainLength),padding_bottom=$$.axis.getPadding(config.axis_y2_padding,"bottom",padding_bottom,domainLength)),isZeroBased&&(isAllPositive&&(padding_bottom=yDomainMin),isAllNegative&&(domain=-yDomainMax)),domain=[yDomainMin-padding_bottom,yDomainMax+domain],isInverted?domain.reverse():domain)},ChartInternal.prototype.getXDomainMin=function(targets){var $$=this,config=$$.config;return isDefined(config.axis_x_min)?$$.isTimeSeries()?this.parseDate(config.axis_x_min):config.axis_x_min:$$.d3.min(targets,function(t){return $$.d3.min(t.values,function(v){return v.x})})},ChartInternal.prototype.getXDomainMax=function(targets){var $$=this,config=$$.config;return isDefined(config.axis_x_max)?$$.isTimeSeries()?this.parseDate(config.axis_x_max):config.axis_x_max:$$.d3.max(targets,function(t){return $$.d3.max(t.values,function(v){return v.x})})},ChartInternal.prototype.getXDomainPadding=function(maxDataCount){var paddingLeft,paddingRight,config=this.config,padding=maxDataCount[1]-maxDataCount[0],padding=this.isCategorized()?0:this.hasType("bar")?1<(maxDataCount=this.getMaxDataCount())?padding/(maxDataCount-1)/2:.5:.01*padding;return"object"===_typeof(config.axis_x_padding)&&notEmpty(config.axis_x_padding)?(paddingLeft=isValue(config.axis_x_padding.left)?config.axis_x_padding.left:padding,paddingRight=isValue(config.axis_x_padding.right)?config.axis_x_padding.right:padding):paddingLeft=paddingRight="number"==typeof config.axis_x_padding?config.axis_x_padding:padding,{left:paddingLeft,right:paddingRight}},ChartInternal.prototype.getXDomain=function(min){var $$=this,max=[$$.getXDomainMin(min),$$.getXDomainMax(min)],firstX=max[0],lastX=max[1],padding=$$.getXDomainPadding(max),min=0,max=0;return firstX-lastX!=0||$$.isCategorized()||(lastX=$$.isTimeSeries()?(firstX=new Date(.5*firstX.getTime()),new Date(1.5*lastX.getTime())):(firstX=0===firstX?1:.5*firstX,0===lastX?-1:1.5*lastX)),[min=firstX||0===firstX?$$.isTimeSeries()?new Date(firstX.getTime()-padding.left):firstX-padding.left:min,max=lastX||0===lastX?$$.isTimeSeries()?new Date(lastX.getTime()+padding.right):lastX+padding.right:max]},ChartInternal.prototype.updateXDomain=function(targets,withUpdateXDomain,withUpdateOrgXDomain,withTrim,domain){var $$=this,config=$$.config;return withUpdateOrgXDomain&&($$.x.domain(domain||$$.d3.extent($$.getXDomain(targets))),$$.orgXDomain=$$.x.domain(),config.zoom_enabled&&$$.zoom.update(),$$.subX.domain($$.x.domain()),$$.brush&&$$.brush.updateScale($$.subX)),withUpdateXDomain&&$$.x.domain(domain||(!$$.brush||$$.brush.empty()?$$.orgXDomain:$$.brush.selectionAsValue())),withTrim&&$$.x.domain($$.trimXDomain($$.x.orgDomain())),$$.x.domain()},ChartInternal.prototype.trimXDomain=function(domain){var max=this.getZoomDomain(),min=max[0],max=max[1];return domain[0]<=min&&(domain[1]=+domain[1]+(min-domain[0]),domain[0]=min),max<=domain[1]&&(domain[0]=+domain[0]-(domain[1]-max),domain[1]=max),domain},ChartInternal.prototype.drag=function(my){var sx,sy,mx,minX,maxX,minY,maxY,$$=this,config=$$.config,main=$$.main,d3=$$.d3;$$.hasArcType()||config.data_selection_enabled&&config.data_selection_multiple&&(sx=$$.dragStart[0],sy=$$.dragStart[1],mx=my[0],my=my[1],minX=Math.min(sx,mx),maxX=Math.max(sx,mx),minY=config.data_selection_grouped?$$.margin.top:Math.min(sy,my),maxY=config.data_selection_grouped?$$.height:Math.max(sy,my),main.select("."+CLASS.dragarea).attr("x",minX).attr("y",minY).attr("width",maxX-minX).attr("height",maxY-minY),main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).filter(function(d){return config.data_selection_isselectable(d)}).each(function(d,i){var _x,_y,_w,toggle,_h,shape=d3.select(this),isSelected=shape.classed(CLASS.SELECTED),isIncluded=shape.classed(CLASS.INCLUDED),isWithin=!1;if(shape.classed(CLASS.circle))_x=+shape.attr("cx"),_y=+shape.attr("cy"),toggle=$$.togglePoint,isWithin=minX<_x&&_x<maxX&&minY<_y&&_y<maxY;else{if(!shape.classed(CLASS.bar))return;_x=(_h=getPathBox(this)).x,_y=_h.y,_w=_h.width,_h=_h.height,toggle=$$.togglePath,isWithin=!(maxX<_x||_x+_w<minX||maxY<_y||_y+_h<minY)}isWithin^isIncluded&&(shape.classed(CLASS.INCLUDED,!isIncluded),shape.classed(CLASS.SELECTED,!isSelected),toggle.call($$,!isSelected,shape,d,i))}))},ChartInternal.prototype.dragstart=function(mouse){var $$=this,config=$$.config;$$.hasArcType()||config.data_selection_enabled&&($$.dragStart=mouse,$$.main.select("."+CLASS.chart).append("rect").attr("class",CLASS.dragarea).style("opacity",.1),$$.dragging=!0)},ChartInternal.prototype.dragend=function(){var $$=this,config=$$.config;$$.hasArcType()||config.data_selection_enabled&&($$.main.select("."+CLASS.dragarea).transition().duration(100).style("opacity",0).remove(),$$.main.selectAll("."+CLASS.shape).classed(CLASS.INCLUDED,!1),$$.dragging=!1)},ChartInternal.prototype.getYFormat=function(forArc){var $$=this,formatForY=forArc&&!$$.hasType("gauge")?$$.defaultArcValueFormat:$$.yFormat,formatForY2=forArc&&!$$.hasType("gauge")?$$.defaultArcValueFormat:$$.y2Format;return function(v,ratio,id){return("y2"===$$.axis.getId(id)?formatForY2:formatForY).call($$,v,ratio)}},ChartInternal.prototype.yFormat=function(v){var config=this.config;return(config.axis_y_tick_format||this.defaultValueFormat)(v)},ChartInternal.prototype.y2Format=function(v){var config=this.config;return(config.axis_y2_tick_format||this.defaultValueFormat)(v)},ChartInternal.prototype.defaultValueFormat=function(v){return isValue(v)?+v:""},ChartInternal.prototype.defaultArcValueFormat=function(v,ratio){return(100*ratio).toFixed(1)+"%"},ChartInternal.prototype.dataLabelFormat=function(targetId){var data_labels=this.config.data_labels,format=function defaultFormat(v){return isValue(v)?+v:""},format="function"==typeof data_labels.format?data_labels.format:"object"===_typeof(data_labels.format)?data_labels.format[targetId]?!0===data_labels.format[targetId]?format:data_labels.format[targetId]:function format(){return""}:format;return format},ChartInternal.prototype.initGrid=function(){var $$=this,config=$$.config,d3=$$.d3;$$.grid=$$.main.append("g").attr("clip-path",$$.clipPathForGrid).attr("class",CLASS.grid),config.grid_x_show&&$$.grid.append("g").attr("class",CLASS.xgrids),config.grid_y_show&&$$.grid.append("g").attr("class",CLASS.ygrids),config.grid_focus_show&&$$.grid.append("g").attr("class",CLASS.xgridFocus).append("line").attr("class",CLASS.xgridFocus),$$.xgrid=d3.selectAll([]),config.grid_lines_front||$$.initGridLines()},ChartInternal.prototype.initGridLines=function(){var $$=this,d3=$$.d3;$$.gridLines=$$.main.append("g").attr("clip-path",$$.clipPathForGrid).attr("class",CLASS.grid+" "+CLASS.gridLines),$$.gridLines.append("g").attr("class",CLASS.xgridLines),$$.gridLines.append("g").attr("class",CLASS.ygridLines),$$.xgridLines=d3.selectAll([])},ChartInternal.prototype.updateXGrid=function(withoutUpdate){var $$=this,config=$$.config,d3=$$.d3,xgridEnter=$$.generateGridData(config.grid_x_type,$$.x),tickOffset=$$.isCategorized()?$$.xAxis.tickOffset():0;$$.xgridAttr=config.axis_rotated?{x1:0,x2:$$.width,y1:function y1(d){return $$.x(d)-tickOffset},y2:function y2(d){return $$.x(d)-tickOffset}}:{x1:function x1(d){return $$.x(d)+tickOffset},x2:function x2(d){return $$.x(d)+tickOffset},y1:0,y2:$$.height},$$.xgridAttr.opacity=function(){return+d3.select(this).attr(config.axis_rotated?"y1":"x1")===(config.axis_rotated?$$.height:0)?0:1};var xgrid=$$.main.select("."+CLASS.xgrids).selectAll("."+CLASS.xgrid).data(xgridEnter),xgridEnter=xgrid.enter().append("line").attr("class",CLASS.xgrid).attr("x1",$$.xgridAttr.x1).attr("x2",$$.xgridAttr.x2).attr("y1",$$.xgridAttr.y1).attr("y2",$$.xgridAttr.y2).style("opacity",0);$$.xgrid=xgridEnter.merge(xgrid),withoutUpdate||$$.xgrid.attr("x1",$$.xgridAttr.x1).attr("x2",$$.xgridAttr.x2).attr("y1",$$.xgridAttr.y1).attr("y2",$$.xgridAttr.y2).style("opacity",$$.xgridAttr.opacity),xgrid.exit().remove()},ChartInternal.prototype.updateYGrid=function(){var $$=this,config=$$.config,ygridEnter=$$.yAxis.tickValues()||$$.y.ticks(config.grid_y_ticks),ygrid=$$.main.select("."+CLASS.ygrids).selectAll("."+CLASS.ygrid).data(ygridEnter),ygridEnter=ygrid.enter().append("line").attr("class",CLASS.ygrid);$$.ygrid=ygridEnter.merge(ygrid),$$.ygrid.attr("x1",config.axis_rotated?$$.y:0).attr("x2",config.axis_rotated?$$.y:$$.width).attr("y1",config.axis_rotated?0:$$.y).attr("y2",config.axis_rotated?$$.height:$$.y),ygrid.exit().remove(),$$.smoothLines($$.ygrid,"grid")},ChartInternal.prototype.gridTextAnchor=function(d){return d.position||"end"},ChartInternal.prototype.gridTextDx=function(d){return"start"===d.position?4:"middle"===d.position?0:-4},ChartInternal.prototype.xGridTextX=function(d){return"start"===d.position?-this.height:"middle"===d.position?-this.height/2:0},ChartInternal.prototype.yGridTextX=function(d){return"start"===d.position?0:"middle"===d.position?this.width/2:this.width},ChartInternal.prototype.updateGrid=function(duration){var xgridLineEnter,ygridLine,$$=this,ygridLineEnter=$$.main,config=$$.config,xv=$$.xv.bind($$),yv=$$.yv.bind($$),xGridTextX=$$.xGridTextX.bind($$),yGridTextX=$$.yGridTextX.bind($$);$$.grid.style("visibility",$$.hasArcType()?"hidden":"visible"),ygridLineEnter.select("line."+CLASS.xgridFocus).style("visibility","hidden"),config.grid_x_show&&$$.updateXGrid(),(xgridLineEnter=(ygridLine=ygridLineEnter.select("."+CLASS.xgridLines).selectAll("."+CLASS.xgridLine).data(config.grid_x_lines)).enter().append("g").attr("class",function(d){return CLASS.xgridLine+(d.class?" "+d.class:"")})).append("line").attr("x1",config.axis_rotated?0:xv).attr("x2",config.axis_rotated?$$.width:xv).attr("y1",config.axis_rotated?xv:0).attr("y2",config.axis_rotated?xv:$$.height).style("opacity",0),xgridLineEnter.append("text").attr("text-anchor",$$.gridTextAnchor).attr("transform",config.axis_rotated?"":"rotate(-90)").attr("x",config.axis_rotated?yGridTextX:xGridTextX).attr("y",xv).attr("dx",$$.gridTextDx).attr("dy",-5).style("opacity",0),$$.xgridLines=xgridLineEnter.merge(ygridLine),ygridLine.exit().transition().duration(duration).style("opacity",0).remove(),config.grid_y_show&&$$.updateYGrid(),(ygridLineEnter=(ygridLine=ygridLineEnter.select("."+CLASS.ygridLines).selectAll("."+CLASS.ygridLine).data(config.grid_y_lines)).enter().append("g").attr("class",function(d){return CLASS.ygridLine+(d.class?" "+d.class:"")})).append("line").attr("x1",config.axis_rotated?yv:0).attr("x2",config.axis_rotated?yv:$$.width).attr("y1",config.axis_rotated?0:yv).attr("y2",config.axis_rotated?$$.height:yv).style("opacity",0),ygridLineEnter.append("text").attr("text-anchor",$$.gridTextAnchor).attr("transform",config.axis_rotated?"rotate(-90)":"").attr("x",config.axis_rotated?xGridTextX:yGridTextX).attr("y",yv).attr("dx",$$.gridTextDx).attr("dy",-5).style("opacity",0),$$.ygridLines=ygridLineEnter.merge(ygridLine),$$.ygridLines.select("line").transition().duration(duration).attr("x1",config.axis_rotated?yv:0).attr("x2",config.axis_rotated?yv:$$.width).attr("y1",config.axis_rotated?0:yv).attr("y2",config.axis_rotated?$$.height:yv).style("opacity",1),$$.ygridLines.select("text").transition().duration(duration).attr("x",(config.axis_rotated?$$.xGridTextX:$$.yGridTextX).bind($$)).attr("y",yv).text(function(d){return d.text}).style("opacity",1),ygridLine.exit().transition().duration(duration).style("opacity",0).remove()},ChartInternal.prototype.redrawGrid=function(withTransition,transition){var $$=this,config=$$.config,xv=$$.xv.bind($$),lines=$$.xgridLines.select("line"),texts=$$.xgridLines.select("text");return[(withTransition?lines.transition(transition):lines).attr("x1",config.axis_rotated?0:xv).attr("x2",config.axis_rotated?$$.width:xv).attr("y1",config.axis_rotated?xv:0).attr("y2",config.axis_rotated?xv:$$.height).style("opacity",1),(withTransition?texts.transition(transition):texts).attr("x",(config.axis_rotated?$$.yGridTextX:$$.xGridTextX).bind($$)).attr("y",xv).text(function(d){return d.text}).style("opacity",1)]},ChartInternal.prototype.showXGridFocus=function(xx){var $$=this,config=$$.config,dataToShow=xx.filter(function(d){return d&&isValue(d.value)}),focusEl=$$.main.selectAll("line."+CLASS.xgridFocus),xx=$$.xx.bind($$);config.tooltip_show&&($$.hasType("stanford")||$$.hasArcType()||(focusEl.style("visibility","visible").data([dataToShow[0]]).attr(config.axis_rotated?"y1":"x1",xx).attr(config.axis_rotated?"y2":"x2",xx),$$.smoothLines(focusEl,"grid")))},ChartInternal.prototype.hideXGridFocus=function(){this.main.select("line."+CLASS.xgridFocus).style("visibility","hidden")},ChartInternal.prototype.updateXgridFocus=function(){var config=this.config;this.main.select("line."+CLASS.xgridFocus).attr("x1",config.axis_rotated?0:-10).attr("x2",config.axis_rotated?this.width:-10).attr("y1",config.axis_rotated?-10:0).attr("y2",config.axis_rotated?-10:this.height)},ChartInternal.prototype.generateGridData=function(firstYear,scale){var xDomain,lastYear,i,gridData=[],tickNum=this.main.select("."+CLASS.axisX).selectAll(".tick").size();if("year"===firstYear)for(firstYear=(xDomain=this.getXDomain())[0].getFullYear(),lastYear=xDomain[1].getFullYear(),i=firstYear;i<=lastYear;i++)gridData.push(new Date(i+"-01-01 00:00:00"));else(gridData=scale.ticks(10)).length>tickNum&&(gridData=gridData.filter(function(d){return(""+d).indexOf(".")<0}));return gridData},ChartInternal.prototype.getGridFilterToRemove=function(params){return params?function(line){var found=!1;return[].concat(params).forEach(function(param){("value"in param&&line.value===param.value||"class"in param&&line.class===param.class)&&(found=!0)}),found}:function(){return!0}},ChartInternal.prototype.removeGridLines=function(classLine,forX){function toShow(line){return!toRemove(line)}var config=this.config,toRemove=this.getGridFilterToRemove(classLine),classLines=forX?CLASS.xgridLines:CLASS.ygridLines,classLine=forX?CLASS.xgridLine:CLASS.ygridLine;this.main.select("."+classLines).selectAll("."+classLine).filter(toRemove).transition().duration(config.transition_duration).style("opacity",0).remove(),forX?config.grid_x_lines=config.grid_x_lines.filter(toShow):config.grid_y_lines=config.grid_y_lines.filter(toShow)},ChartInternal.prototype.initEventRect=function(){var $$=this,config=$$.config;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.eventRects).style("fill-opacity",0),$$.eventRect=$$.main.select("."+CLASS.eventRects).append("rect").attr("class",CLASS.eventRect),config.zoom_enabled&&$$.zoom&&($$.eventRect.call($$.zoom).on("dblclick.zoom",null),config.zoom_initialRange&&$$.eventRect.transition().duration(0).call($$.zoom.transform,$$.zoomTransform(config.zoom_initialRange)))},ChartInternal.prototype.redrawEventRect=function(){var $$=this,d3=$$.d3,config=$$.config;function mouseout(){$$.svg.select("."+CLASS.eventRect).style("cursor",null),$$.hideXGridFocus(),$$.hideTooltip(),$$.unexpandCircles(),$$.unexpandBars()}function isHoveringDataPoint(mouse,closest){return closest&&($$.isBarType(closest.id)||$$.dist(closest,mouse)<config.point_sensitivity)}function withName(d){return d?$$.addName(Object.assign({},d)):null}$$.main.select("."+CLASS.eventRects).style("cursor",config.zoom_enabled?config.axis_rotated?"ns-resize":"ew-resize":null),$$.eventRect.attr("x",0).attr("y",0).attr("width",$$.width).attr("height",$$.height).on("mouseout",config.interaction_enabled?function(){config&&($$.hasArcType()||($$.mouseover&&(config.data_onmouseout.call($$.api,$$.mouseover),$$.mouseover=void 0),mouseout()))}:null).on("mousemove",config.interaction_enabled?function(){if(!$$.dragging){var targetsToShow=$$.getTargetsToShow();if(!$$.hasArcType(targetsToShow)){var selectedData,closestByX,mouse=d3.mouse(this),closest=withName($$.findClosestFromTargets(targetsToShow,mouse)),isMouseCloseToDataPoint=isHoveringDataPoint(mouse,closest);if(!$$.mouseover||closest&&closest.id===$$.mouseover.id&&closest.index===$$.mouseover.index||(config.data_onmouseout.call($$.api,$$.mouseover),$$.mouseover=void 0),closest&&!$$.mouseover&&(config.data_onmouseover.call($$.api,closest),$$.mouseover=closest),$$.svg.select("."+CLASS.eventRect).style("cursor",isMouseCloseToDataPoint?"pointer":null),!config.tooltip_grouped||$$.hasType("stanford",targetsToShow)?closest&&(selectedData=[closest]):(closestByX=closest||(closestByX=config.axis_rotated?mouse[1]:mouse[0],$$.findClosestFromTargetsByX(targetsToShow,$$.x.invert(closestByX))))&&(selectedData=$$.filterByX(targetsToShow,closestByX.x)),!selectedData||0===selectedData.length)return mouseout();selectedData=selectedData.map(withName),$$.showTooltip(selectedData,this),config.point_focus_expand_enabled&&($$.unexpandCircles(),selectedData.forEach(function(d){$$.expandCircles(d.index,d.id,!1)})),$$.unexpandBars(),selectedData.forEach(function(d){$$.expandBars(d.index,d.id,!1)}),$$.showXGridFocus(selectedData)}}}:null).on("click",config.interaction_enabled?function(){var mouse,closest,shape=$$.getTargetsToShow();$$.hasArcType(shape)||(mouse=d3.mouse(this),closest=withName($$.findClosestFromTargets(shape,mouse)),isHoveringDataPoint(mouse,closest)&&((!config.data_selection_grouped||$$.isStanfordType(closest)?[closest]:$$.filterByX(shape,closest.x)).forEach(function(d){$$.main.selectAll("."+CLASS.shapes+$$.getTargetSelectorSuffix(d.id)).selectAll("."+CLASS.shape+"-"+d.index).each(function(){(config.data_selection_grouped||$$.isWithinShape(this,d))&&$$.toggleShape(this,d,d.index)})}),closest&&(shape=$$.main.selectAll("."+CLASS.shapes+$$.getTargetSelectorSuffix(closest.id)).select("."+CLASS.shape+"-"+closest.index),config.data_onclick.call($$.api,closest,shape.node()))))}:null).call(config.interaction_enabled&&config.data_selection_draggable&&$$.drag?d3.drag().on("drag",function(){$$.drag(d3.mouse(this))}).on("start",function(){$$.dragstart(d3.mouse(this))}).on("end",function(){$$.dragend()}):function(){})},ChartInternal.prototype.getMousePosition=function(data){return[this.x(data.x),this.getYScale(data.id)(data.value)]},ChartInternal.prototype.dispatchEvent=function(type,event){var x="."+CLASS.eventRect,eventRect=this.main.select(x).node(),y=eventRect.getBoundingClientRect(),x=y.left+(event?event[0]:0),y=y.top+(event?event[1]:0),event=document.createEvent("MouseEvents");event.initMouseEvent(type,!0,!0,window,0,x,y,x,y,!1,!1,!1,!1,0,null),eventRect.dispatchEvent(event)},ChartInternal.prototype.initLegend=function(){var $$=this;if($$.legendItemTextBox={},$$.legendHasRendered=!1,$$.legend=$$.svg.append("g").attr("transform",$$.getTranslate("legend")),!$$.config.legend_show)return $$.legend.style("visibility","hidden"),void($$.hiddenLegendIds=$$.mapToIds($$.data.targets));$$.updateLegendWithDefaults()},ChartInternal.prototype.updateLegendWithDefaults=function(){this.updateLegend(this.mapToIds(this.data.targets),{withTransform:!1,withTransitionForTransform:!1,withTransition:!1})},ChartInternal.prototype.updateSizeForLegend=function(legendHeight,legendWidth){var $$=this,insetLegendPosition=$$.config,insetLegendPosition={top:$$.isLegendTop?$$.getCurrentPaddingTop()+insetLegendPosition.legend_inset_y+5.5:$$.currentHeight-legendHeight-$$.getCurrentPaddingBottom()-insetLegendPosition.legend_inset_y,left:$$.isLegendLeft?$$.getCurrentPaddingLeft()+insetLegendPosition.legend_inset_x+.5:$$.currentWidth-legendWidth-$$.getCurrentPaddingRight()-insetLegendPosition.legend_inset_x+.5};$$.margin3={top:$$.isLegendRight?0:$$.isLegendInset?insetLegendPosition.top:$$.currentHeight-legendHeight,right:NaN,bottom:0,left:$$.isLegendRight?$$.currentWidth-legendWidth:$$.isLegendInset?insetLegendPosition.left:0}},ChartInternal.prototype.transformLegend=function(withTransition){(withTransition?this.legend.transition():this.legend).attr("transform",this.getTranslate("legend"))},ChartInternal.prototype.updateLegendStep=function(step){this.legendStep=step},ChartInternal.prototype.updateLegendItemWidth=function(w){this.legendItemWidth=w},ChartInternal.prototype.updateLegendItemHeight=function(h){this.legendItemHeight=h},ChartInternal.prototype.getLegendWidth=function(){var $$=this;return $$.config.legend_show?$$.isLegendRight||$$.isLegendInset?$$.legendItemWidth*($$.legendStep+1):$$.currentWidth:0},ChartInternal.prototype.getLegendHeight=function(){var $$=this,h=0;return h=$$.config.legend_show?$$.isLegendRight?$$.currentHeight:Math.max(20,$$.legendItemHeight)*($$.legendStep+1):h},ChartInternal.prototype.opacityForLegend=function(legendItem){return legendItem.classed(CLASS.legendItemHidden)?null:1},ChartInternal.prototype.opacityForUnfocusedLegend=function(legendItem){return legendItem.classed(CLASS.legendItemHidden)?null:.3},ChartInternal.prototype.toggleFocusLegend=function(targetIds,focus){var $$=this;targetIds=$$.mapToTargetIds(targetIds),$$.legend.selectAll("."+CLASS.legendItem).filter(function(id){return 0<=targetIds.indexOf(id)}).classed(CLASS.legendItemFocused,focus).transition().duration(100).style("opacity",function(){return(focus?$$.opacityForLegend:$$.opacityForUnfocusedLegend).call($$,$$.d3.select(this))})},ChartInternal.prototype.revertLegend=function(){var $$=this,d3=$$.d3;$$.legend.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemFocused,!1).transition().duration(100).style("opacity",function(){return $$.opacityForLegend(d3.select(this))})},ChartInternal.prototype.showLegend=function(targetIds){var $$=this,config=$$.config;config.legend_show||(config.legend_show=!0,$$.legend.style("visibility","visible"),$$.legendHasRendered||$$.updateLegendWithDefaults()),$$.removeHiddenLegendIds(targetIds),$$.legend.selectAll($$.selectorLegends(targetIds)).style("visibility","visible").transition().style("opacity",function(){return $$.opacityForLegend($$.d3.select(this))})},ChartInternal.prototype.hideLegend=function(targetIds){var $$=this,config=$$.config;config.legend_show&&isEmpty(targetIds)&&(config.legend_show=!1,$$.legend.style("visibility","hidden")),$$.addHiddenLegendIds(targetIds),$$.legend.selectAll($$.selectorLegends(targetIds)).style("opacity",0).style("visibility","hidden")},ChartInternal.prototype.clearLegendItemTextBoxCache=function(){this.legendItemTextBox={}},ChartInternal.prototype.updateLegend=function(targetIds,background,transitions){var xForLegend,xForLegendText,xForLegendRect,yForLegend,x1ForLegendTile,x2ForLegendTile,yForLegendTile,withTransition,withTransitionForTransform,texts,rects,tiles,$$=this,config=$$.config,paddingTop=4,paddingRight=10,maxWidth=0,maxHeight=0,posMin=10,tileWidth=config.legend_item_tile_width+5,totalLength=0,offsets={},widths={},heights={},margins=[0],steps={},step=0;function updatePositions(maxLength,id,itemWidth){var margin,reset=0===itemWidth,itemWidth=itemWidth===targetIds.length-1,maxLength=function getTextBox(textElement,id){return $$.legendItemTextBox[id]||($$.legendItemTextBox[id]=$$.getTextRect(textElement.textContent,CLASS.legendItem,textElement)),$$.legendItemTextBox[id]}(maxLength,id),itemWidth=maxLength.width+tileWidth+(!itemWidth||$$.isLegendRight||$$.isLegendInset?paddingRight:0)+config.legend_padding,maxLength=maxLength.height+paddingTop,itemLength=$$.isLegendRight||$$.isLegendInset?maxLength:itemWidth,areaLength=$$.isLegendRight||$$.isLegendInset?$$.getLegendHeight():$$.getLegendWidth();function updateValues(id,withoutStep){withoutStep||(margin=(areaLength-totalLength-itemLength)/2)<posMin&&(margin=(areaLength-itemLength)/2,totalLength=0,step++),steps[id]=step,margins[step]=$$.isLegendInset?10:margin,offsets[id]=totalLength,totalLength+=itemLength}reset&&(maxHeight=maxWidth=step=totalLength=0),!config.legend_show||$$.isLegendToShow(id)?(widths[id]=itemWidth,heights[id]=maxLength,(!maxWidth||maxWidth<=itemWidth)&&(maxWidth=itemWidth),(!maxHeight||maxHeight<=maxLength)&&(maxHeight=maxLength),maxLength=$$.isLegendRight||$$.isLegendInset?maxHeight:maxWidth,config.legend_equally?(Object.keys(widths).forEach(function(id){widths[id]=maxWidth}),Object.keys(heights).forEach(function(id){heights[id]=maxHeight}),(margin=(areaLength-maxLength*targetIds.length)/2)<posMin?(step=totalLength=0,targetIds.forEach(function(id){updateValues(id)})):updateValues(id,!0)):updateValues(id)):widths[id]=heights[id]=steps[id]=offsets[id]=0}targetIds=targetIds.filter(function(id){return!isDefined(config.data_names[id])||null!==config.data_names[id]}),withTransition=getOption(background=background||{},"withTransition",!0),withTransitionForTransform=getOption(background,"withTransitionForTransform",!0),$$.isLegendInset&&(step=config.legend_inset_step||targetIds.length,$$.updateLegendStep(step)),yForLegend=$$.isLegendRight?(xForLegend=function xForLegend(id){return maxWidth*steps[id]},function yForLegend(id){return margins[steps[id]]+offsets[id]}):$$.isLegendInset?(xForLegend=function xForLegend(id){return maxWidth*steps[id]+10},function yForLegend(id){return margins[steps[id]]+offsets[id]}):(xForLegend=function xForLegend(id){return margins[steps[id]]+offsets[id]},function yForLegend(id){return maxHeight*steps[id]}),xForLegendText=function xForLegendText(id,i){return xForLegend(id,i)+4+config.legend_item_tile_width},rects=function yForLegendText(id,i){return yForLegend(id,i)+9},xForLegendRect=function xForLegendRect(id,i){return xForLegend(id,i)},tiles=function yForLegendRect(id,i){return yForLegend(id,i)-5},x1ForLegendTile=function x1ForLegendTile(id,i){return xForLegend(id,i)-2},x2ForLegendTile=function x2ForLegendTile(id,i){return xForLegend(id,i)-2+config.legend_item_tile_width},yForLegendTile=function yForLegendTile(id,i){return yForLegend(id,i)+4},(texts=$$.legend.selectAll("."+CLASS.legendItem).data(targetIds).enter().append("g").attr("class",function(id){return $$.generateClass(CLASS.legendItem,id)}).style("visibility",function(id){return $$.isLegendToShow(id)?"visible":"hidden"}).style("cursor","pointer").on("click",function(id){config.legend_item_onclick?config.legend_item_onclick.call($$,id):$$.d3.event.altKey?($$.api.hide(),$$.api.show(id)):($$.api.toggle(id),$$.isTargetToShow(id)?$$.api.focus(id):$$.api.revert())}).on("mouseover",function(id){config.legend_item_onmouseover?config.legend_item_onmouseover.call($$,id):($$.d3.select(this).classed(CLASS.legendItemFocused,!0),!$$.transiting&&$$.isTargetToShow(id)&&$$.api.focus(id))}).on("mouseout",function(id){config.legend_item_onmouseout?config.legend_item_onmouseout.call($$,id):($$.d3.select(this).classed(CLASS.legendItemFocused,!1),$$.api.revert())})).append("text").text(function(id){return isDefined(config.data_names[id])?config.data_names[id]:id}).each(function(id,i){updatePositions(this,id,i)}).style("pointer-events","none").attr("x",$$.isLegendRight||$$.isLegendInset?xForLegendText:-200).attr("y",$$.isLegendRight||$$.isLegendInset?-200:rects),texts.append("rect").attr("class",CLASS.legendItemEvent).style("fill-opacity",0).attr("x",$$.isLegendRight||$$.isLegendInset?xForLegendRect:-200).attr("y",$$.isLegendRight||$$.isLegendInset?-200:tiles),texts.append("line").attr("class",CLASS.legendItemTile).style("stroke",$$.color).style("pointer-events","none").attr("x1",$$.isLegendRight||$$.isLegendInset?x1ForLegendTile:-200).attr("y1",$$.isLegendRight||$$.isLegendInset?-200:yForLegendTile).attr("x2",$$.isLegendRight||$$.isLegendInset?x2ForLegendTile:-200).attr("y2",$$.isLegendRight||$$.isLegendInset?-200:yForLegendTile).attr("stroke-width",config.legend_item_tile_height),background=$$.legend.select("."+CLASS.legendBackground+" rect"),$$.isLegendInset&&0<maxWidth&&0===background.size()&&(background=$$.legend.insert("g","."+CLASS.legendItem).attr("class",CLASS.legendBackground).append("rect")),texts=$$.legend.selectAll("text").data(targetIds).text(function(id){return isDefined(config.data_names[id])?config.data_names[id]:id}).each(function(id,i){updatePositions(this,id,i)}),(withTransition?texts.transition():texts).attr("x",xForLegendText).attr("y",rects),rects=$$.legend.selectAll("rect."+CLASS.legendItemEvent).data(targetIds),(withTransition?rects.transition():rects).attr("width",function(id){return widths[id]}).attr("height",function(id){return heights[id]}).attr("x",xForLegendRect).attr("y",tiles),tiles=$$.legend.selectAll("line."+CLASS.legendItemTile).data(targetIds),(withTransition?tiles.transition():tiles).style("stroke",$$.levelColor?function(id){return $$.levelColor($$.cache[id].values[0].value)}:$$.color).attr("x1",x1ForLegendTile).attr("y1",yForLegendTile).attr("x2",x2ForLegendTile).attr("y2",yForLegendTile),background&&(withTransition?background.transition():background).attr("height",$$.getLegendHeight()-12).attr("width",maxWidth*(step+1)+10),$$.legend.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemHidden,function(id){return!$$.isTargetToShow(id)}),$$.updateLegendItemWidth(maxWidth),$$.updateLegendItemHeight(maxHeight),$$.updateLegendStep(step),$$.updateSizes(),$$.updateScales(),$$.updateSvgSize(),$$.transformAll(withTransitionForTransform,transitions),$$.legendHasRendered=!0},ChartInternal.prototype.initRegion=function(){this.region=this.main.append("g").attr("clip-path",this.clipPath).attr("class",CLASS.regions)},ChartInternal.prototype.updateRegion=function(duration){var $$=this,g=$$.config;$$.region.style("visibility",$$.hasArcType()?"hidden":"visible");var mainRegion=$$.main.select("."+CLASS.regions).selectAll("."+CLASS.region).data(g.regions),g=mainRegion.enter().append("g");g.append("rect").attr("x",$$.regionX.bind($$)).attr("y",$$.regionY.bind($$)).attr("width",$$.regionWidth.bind($$)).attr("height",$$.regionHeight.bind($$)).style("fill-opacity",function(d){return isValue(d.opacity)?d.opacity:.1}),g.append("text").text($$.labelRegion.bind($$)),$$.mainRegion=g.merge(mainRegion).attr("class",$$.classRegion.bind($$)),mainRegion.exit().transition().duration(duration).style("opacity",0).remove()},ChartInternal.prototype.redrawRegion=function(withTransition,transition){var $$=this,regions=$$.mainRegion,regionLabels=$$.mainRegion.selectAll("text");return[(withTransition?regions.transition(transition):regions).attr("x",$$.regionX.bind($$)).attr("y",$$.regionY.bind($$)).attr("width",$$.regionWidth.bind($$)).attr("height",$$.regionHeight.bind($$)).style("fill-opacity",function(d){return isValue(d.opacity)?d.opacity:.1}),(withTransition?regionLabels.transition(transition):regionLabels).attr("x",$$.labelOffsetX.bind($$)).attr("y",$$.labelOffsetY.bind($$)).attr("transform",$$.labelTransform.bind($$)).attr("style","text-anchor: left;")]},ChartInternal.prototype.regionX=function(xPos){var $$=this,config=$$.config,yScale="y"===xPos.axis?$$.y:$$.y2,xPos="y"===xPos.axis||"y2"===xPos.axis?config.axis_rotated&&"start"in xPos?yScale(xPos.start):0:!config.axis_rotated&&"start"in xPos?$$.x($$.isTimeSeries()?$$.parseDate(xPos.start):xPos.start):0;return xPos},ChartInternal.prototype.regionY=function(yPos){var $$=this,config=$$.config,yScale="y"===yPos.axis?$$.y:$$.y2,yPos="y"===yPos.axis||"y2"===yPos.axis?!config.axis_rotated&&"end"in yPos?yScale(yPos.end):0:config.axis_rotated&&"start"in yPos?$$.x($$.isTimeSeries()?$$.parseDate(yPos.start):yPos.start):0;return yPos},ChartInternal.prototype.regionWidth=function(d){var end=this,config=end.config,start=end.regionX(d),yScale="y"===d.axis?end.y:end.y2,end="y"===d.axis||"y2"===d.axis?config.axis_rotated&&"end"in d?yScale(d.end):end.width:!config.axis_rotated&&"end"in d?end.x(end.isTimeSeries()?end.parseDate(d.end):d.end):end.width;return end<start?0:end-start},ChartInternal.prototype.regionHeight=function(d){var end=this,config=end.config,start=this.regionY(d),yScale="y"===d.axis?end.y:end.y2,end="y"===d.axis||"y2"===d.axis?!config.axis_rotated&&"start"in d?yScale(d.start):end.height:config.axis_rotated&&"end"in d?end.x(end.isTimeSeries()?end.parseDate(d.end):d.end):end.height;return end<start?0:end-start},ChartInternal.prototype.isRegionOnX=function(d){return!d.axis||"x"===d.axis},ChartInternal.prototype.labelRegion=function(d){return"label"in d?d.label:""},ChartInternal.prototype.labelTransform=function(d){return"vertical"in d&&d.vertical?"rotate(90)":""},ChartInternal.prototype.labelOffsetX=function(d){var paddingX="paddingX"in d?d.paddingX:3,paddingY="paddingY"in d?d.paddingY:3;return"vertical"in d&&d.vertical?this.regionY(d)+paddingY:this.regionX(d)+paddingX},ChartInternal.prototype.labelOffsetY=function(d){var paddingX="paddingX"in d?d.paddingX:3,paddingY="paddingY"in d?d.paddingY:3;return"vertical"in d&&d.vertical?-(this.regionX(d)+paddingX):this.regionY(d)+10+paddingY},ChartInternal.prototype.getScale=function(min,max,forTimeseries){return(forTimeseries?this.d3.scaleTime():this.d3.scaleLinear()).range([min,max])},ChartInternal.prototype.getX=function(min,max,domain,offset){var key,scale=this.getScale(min,max,this.isTimeSeries()),_scale=domain?scale.domain(domain):scale,scale=this.isCategorized()?(offset=offset||function(){return 0},function scale(v,raw){v=_scale(v)+offset(v);return raw?v:Math.ceil(v)}):function scale(v,raw){v=_scale(v);return raw?v:Math.ceil(v)};for(key in _scale)scale[key]=_scale[key];return scale.orgDomain=function(){return _scale.domain()},this.isCategorized()&&(scale.domain=function(domain){return arguments.length?(_scale.domain(domain),scale):[(domain=this.orgDomain())[0],domain[1]+1]}),scale},ChartInternal.prototype.getY=function(type,domain,range){var scale;if("timeseries"===type||"time"===type)scale=this.d3.scaleTime();else if("log"===type)scale=c3LogScale(this.d3);else{if("linear"!==type&&void 0!==type)throw new Error('Invalid Y axis type: "'.concat(type,'"'));scale=this.d3.scaleLinear()}return domain&&scale.domain(domain),range&&scale.range(range),scale},ChartInternal.prototype.getYScale=function(id){return"y2"===this.axis.getId(id)?this.y2:this.y},ChartInternal.prototype.getSubYScale=function(id){return"y2"===this.axis.getId(id)?this.subY2:this.subY},ChartInternal.prototype.updateScales=function(){var $$=this,config=$$.config,forInit=!$$.x;$$.xMin=config.axis_rotated?1:0,$$.xMax=config.axis_rotated?$$.height:$$.width,$$.yMin=config.axis_rotated?0:$$.height,$$.yMax=config.axis_rotated?$$.width:1,$$.subXMin=$$.xMin,$$.subXMax=$$.xMax,$$.subYMin=config.axis_rotated?0:$$.height2,$$.subYMax=config.axis_rotated?$$.width2:1,$$.x=$$.getX($$.xMin,$$.xMax,forInit?void 0:$$.x.orgDomain(),function(){return $$.xAxis.tickOffset()}),$$.y=$$.getY(config.axis_y_type,forInit?config.axis_y_default:$$.y.domain(),[$$.yMin,$$.yMax]),$$.y2=$$.getY(config.axis_y2_type,forInit?config.axis_y2_default:$$.y2.domain(),[$$.yMin,$$.yMax]),$$.subX=$$.getX($$.xMin,$$.xMax,$$.orgXDomain,function(d){return d%1?0:$$.subXAxis.tickOffset()}),$$.subY=$$.getY(config.axis_y_type,forInit?config.axis_y_default:$$.subY.domain(),[$$.subYMin,$$.subYMax]),$$.subY2=$$.getY(config.axis_y2_type,forInit?config.axis_y2_default:$$.subY2.domain(),[$$.subYMin,$$.subYMax]),$$.xAxisTickFormat=$$.axis.getXAxisTickFormat(),$$.xAxisTickValues=$$.axis.getXAxisTickValues(),$$.yAxisTickValues=$$.axis.getYAxisTickValues(),$$.y2AxisTickValues=$$.axis.getY2AxisTickValues(),$$.xAxis=$$.axis.getXAxis($$.x,$$.xOrient,$$.xAxisTickFormat,$$.xAxisTickValues,config.axis_x_tick_outer),$$.subXAxis=$$.axis.getXAxis($$.subX,$$.subXOrient,$$.xAxisTickFormat,$$.xAxisTickValues,config.axis_x_tick_outer),$$.yAxis=$$.axis.getYAxis("y",$$.y,$$.yOrient,$$.yAxisTickValues,config.axis_y_tick_outer),$$.y2Axis=$$.axis.getYAxis("y2",$$.y2,$$.y2Orient,$$.y2AxisTickValues,config.axis_y2_tick_outer),forInit||$$.brush&&$$.brush.updateScale($$.subX),$$.updateArc&&$$.updateArc()},ChartInternal.prototype.selectPoint=function(target,d,i){var $$=this,config=$$.config,cx=(config.axis_rotated?$$.circleY:$$.circleX).bind($$),cy=(config.axis_rotated?$$.circleX:$$.circleY).bind($$),r=$$.pointSelectR.bind($$);config.data_onselected.call($$.api,d,target.node()),$$.main.select("."+CLASS.selectedCircles+$$.getTargetSelectorSuffix(d.id)).selectAll("."+CLASS.selectedCircle+"-"+i).data([d]).enter().append("circle").attr("class",function(){return $$.generateClass(CLASS.selectedCircle,i)}).attr("cx",cx).attr("cy",cy).attr("stroke",function(){return $$.color(d)}).attr("r",function(d){return 1.4*$$.pointSelectR(d)}).transition().duration(100).attr("r",r)},ChartInternal.prototype.unselectPoint=function(target,d,i){this.config.data_onunselected.call(this.api,d,target.node()),this.main.select("."+CLASS.selectedCircles+this.getTargetSelectorSuffix(d.id)).selectAll("."+CLASS.selectedCircle+"-"+i).transition().duration(100).attr("r",0).remove()},ChartInternal.prototype.togglePoint=function(selected,target,d,i){selected?this.selectPoint(target,d,i):this.unselectPoint(target,d,i)},ChartInternal.prototype.selectPath=function(target,d){var $$=this;$$.config.data_onselected.call($$,d,target.node()),$$.config.interaction_brighten&&target.transition().duration(100).style("fill",function(){return $$.d3.rgb($$.color(d)).brighter(.75)})},ChartInternal.prototype.unselectPath=function(target,d){var $$=this;$$.config.data_onunselected.call($$,d,target.node()),$$.config.interaction_brighten&&target.transition().duration(100).style("fill",function(){return $$.color(d)})},ChartInternal.prototype.togglePath=function(selected,target,d,i){selected?this.selectPath(target,d,i):this.unselectPath(target,d,i)},ChartInternal.prototype.getToggle=function(that,d){var toggle;return"circle"===that.nodeName?toggle=this.isStepType(d)?function toggle(){}:this.togglePoint:"path"===that.nodeName&&(toggle=this.togglePath),toggle},ChartInternal.prototype.toggleShape=function(that,d,i){var $$=this,d3=$$.d3,config=$$.config,shape=d3.select(that),isSelected=shape.classed(CLASS.SELECTED),toggle=$$.getToggle(that,d).bind($$);config.data_selection_enabled&&config.data_selection_isselectable(d)&&(config.data_selection_multiple||$$.main.selectAll("."+CLASS.shapes+(config.data_selection_grouped?$$.getTargetSelectorSuffix(d.id):"")).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this);shape.classed(CLASS.SELECTED)&&toggle(!1,shape.classed(CLASS.SELECTED,!1),d,i)}),shape.classed(CLASS.SELECTED,!isSelected),toggle(!isSelected,shape,d,i))},ChartInternal.prototype.initBar=function(){this.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBars)},ChartInternal.prototype.updateTargetsForBar=function(targets){var $$=this,config=$$.config,classChartBar=$$.classChartBar.bind($$),classBars=$$.classBars.bind($$),classFocus=$$.classFocus.bind($$);$$.main.select("."+CLASS.chartBars).selectAll("."+CLASS.chartBar).data(targets).attr("class",function(d){return classChartBar(d)+classFocus(d)}).enter().append("g").attr("class",classChartBar).style("pointer-events","none").append("g").attr("class",classBars).style("cursor",function(d){return config.data_selection_isselectable(d)?"pointer":null})},ChartInternal.prototype.updateBar=function(durationForExit){var $$=this,mainBar=$$.barData.bind($$),classBar=$$.classBar.bind($$),initialOpacity=$$.initialOpacity.bind($$),mainBarEnter=function color(d){return $$.color(d.id)},mainBar=$$.main.selectAll("."+CLASS.bars).selectAll("."+CLASS.bar).data(mainBar),mainBarEnter=mainBar.enter().append("path").attr("class",classBar).style("stroke",mainBarEnter).style("fill",mainBarEnter);$$.mainBar=mainBarEnter.merge(mainBar).style("opacity",initialOpacity),mainBar.exit().transition().duration(durationForExit).style("opacity",0)},ChartInternal.prototype.redrawBar=function(drawBar,withTransition,transition){var $$=this;return[(withTransition?this.mainBar.transition(transition):this.mainBar).attr("d",drawBar).style("stroke",this.color).style("fill",this.color).style("opacity",function(d){return $$.isTargetToShow(d.id)?1:0})]},ChartInternal.prototype.getBarW=function(axis,w){var config=this.config,w="number"==typeof config.bar_width?config.bar_width:w?axis.tickInterval()*config.bar_width_ratio/w:0;return config.bar_width_max&&w>config.bar_width_max?config.bar_width_max:w},ChartInternal.prototype.getBars=function(i,id){return(id?this.main.selectAll("."+CLASS.bars+this.getTargetSelectorSuffix(id)):this.main).selectAll("."+CLASS.bar+(isValue(i)?"-"+i:""))},ChartInternal.prototype.expandBars=function(i,id,reset){reset&&this.unexpandBars(),this.getBars(i,id).classed(CLASS.EXPANDED,!0)},ChartInternal.prototype.unexpandBars=function(i){this.getBars(i).classed(CLASS.EXPANDED,!1)},ChartInternal.prototype.generateDrawBar=function(barIndices,isSub){var config=this.config,getPoints=this.generateGetBarPoints(barIndices,isSub);return function(indexX,indexY){var points=getPoints(indexX,indexY),indexX=config.axis_rotated?1:0,indexY=config.axis_rotated?0:1;return"M "+points[0][indexX]+","+points[0][indexY]+" L"+points[1][indexX]+","+points[1][indexY]+" L"+points[2][indexX]+","+points[2][indexY]+" L"+points[3][indexX]+","+points[3][indexY]+" z"}},ChartInternal.prototype.generateGetBarPoints=function(barIndices,isSub){var $$=this,axis=isSub?$$.subXAxis:$$.xAxis,barTargetsNum=barIndices.__max__+1,barW=$$.getBarW(axis,barTargetsNum),barX=$$.getShapeX(barW,barTargetsNum,barIndices,!!isSub),barY=$$.getShapeY(!!isSub),barOffset=$$.getShapeOffset($$.isBarType,barIndices,!!isSub),barSpaceOffset=barW*($$.config.bar_space/2),yScale=isSub?$$.getSubYScale:$$.getYScale;return function(d,posY){var y0=yScale.call($$,d.id)(0),offset=barOffset(d,posY)||y0,posX=barX(d),posY=barY(d);return $$.config.axis_rotated&&(0<d.value&&posY<y0||d.value<0&&y0<posY)&&(posY=y0),[[posX+barSpaceOffset,offset],[posX+barSpaceOffset,posY-=y0-offset],[posX+barW-barSpaceOffset,posY],[posX+barW-barSpaceOffset,offset]]}},ChartInternal.prototype.isWithinBar=function(mouse,barShape){return isWithinBox(mouse,getBBox(barShape),2)},ChartInternal.prototype.getShapeIndices=function(typeFilter){var j,k,config=this.config,indices={},i=0;return this.filterTargetsToShow(this.data.targets.filter(typeFilter,this)).forEach(function(d){for(j=0;j<config.data_groups.length;j++)if(!(config.data_groups[j].indexOf(d.id)<0))for(k=0;k<config.data_groups[j].length;k++)if(config.data_groups[j][k]in indices){indices[d.id]=indices[config.data_groups[j][k]];break}isUndefined(indices[d.id])&&(indices[d.id]=i++)}),indices.__max__=i-1,indices},ChartInternal.prototype.getShapeX=function(offset,targetsNum,indices,isSub){var scale=isSub?this.subX:this.x;return function(d){var index=d.id in indices?indices[d.id]:0;return d.x||0===d.x?scale(d.x)-offset*(targetsNum/2-index):0}},ChartInternal.prototype.getShapeY=function(isSub){var $$=this;return function(d){return(isSub?$$.getSubYScale(d.id):$$.getYScale(d.id))($$.isTargetNormalized(d.id)?$$.getRatio("index",d,!0):d.value)}},ChartInternal.prototype.getShapeOffset=function(typeFilter,indices,isSub){var $$=this,targets=$$.orderTargets($$.filterTargetsToShow($$.data.targets.filter(typeFilter,$$))),targetIds=targets.map(function(t){return t.id});return function(d,i){var scale=isSub?$$.getSubYScale(d.id):$$.getYScale(d.id),y0=scale(0),offset=y0;return targets.forEach(function(t){var rowValues=$$.isStepType(d)?$$.convertValuesToStep(t.values):t.values,isTargetNormalized=$$.isTargetNormalized(d.id),values=rowValues.map(function(v){return isTargetNormalized?$$.getRatio("index",v,!0):v.value});t.id!==d.id&&indices[t.id]===indices[d.id]&&targetIds.indexOf(t.id)<targetIds.indexOf(d.id)&&(!isUndefined(rowValues[i])&&+rowValues[i].x==+d.x||(i=-1,rowValues.forEach(function(v,j){(v.x.constructor===Date?+v.x:v.x)===(d.x.constructor===Date?+d.x:d.x)&&(i=j)})),i in rowValues&&0<=rowValues[i].value*d.value&&(offset+=scale(values[i])-y0))}),offset}},ChartInternal.prototype.isWithinShape=function(that,d){var isWithin,$$=this,shape=$$.d3.select(that);return $$.isTargetToShow(d.id)?"circle"===that.nodeName?isWithin=$$.isStepType(d)?$$.isWithinStep(that,$$.getYScale(d.id)(d.value)):$$.isWithinCircle(that,1.5*$$.pointSelectR(d)):"path"===that.nodeName&&(isWithin=!shape.classed(CLASS.bar)||$$.isWithinBar($$.d3.mouse(that),that)):isWithin=!1,isWithin},ChartInternal.prototype.getInterpolate=function(d){var $$=this,type=$$.d3,type={linear:type.curveLinear,"linear-closed":type.curveLinearClosed,basis:type.curveBasis,"basis-open":type.curveBasisOpen,"basis-closed":type.curveBasisClosed,bundle:type.curveBundle,cardinal:type.curveCardinal,"cardinal-open":type.curveCardinalOpen,"cardinal-closed":type.curveCardinalClosed,monotone:type.curveMonotoneX,step:type.curveStep,"step-before":type.curveStepBefore,"step-after":type.curveStepAfter},type=$$.isSplineType(d)?type[$$.config.spline_interpolation_type]||type.cardinal:$$.isStepType(d)?type[$$.config.line_step_type]:type.linear;return type},ChartInternal.prototype.initLine=function(){this.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLines)},ChartInternal.prototype.updateTargetsForLine=function(targets){var $$=this,config=$$.config,classChartLine=$$.classChartLine.bind($$),classLines=$$.classLines.bind($$),classAreas=$$.classAreas.bind($$),classCircles=$$.classCircles.bind($$),classFocus=$$.classFocus.bind($$),mainLineEnter=$$.main.select("."+CLASS.chartLines).selectAll("."+CLASS.chartLine).data(targets).attr("class",function(d){return classChartLine(d)+classFocus(d)}).enter().append("g").attr("class",classChartLine).style("opacity",0).style("pointer-events","none");mainLineEnter.append("g").attr("class",classLines),mainLineEnter.append("g").attr("class",classAreas),mainLineEnter.append("g").attr("class",function(d){return $$.generateClass(CLASS.selectedCircles,d.id)}),mainLineEnter.append("g").attr("class",classCircles).style("cursor",function(d){return config.data_selection_isselectable(d)?"pointer":null}),targets.forEach(function(t){$$.main.selectAll("."+CLASS.selectedCircles+$$.getTargetSelectorSuffix(t.id)).selectAll("."+CLASS.selectedCircle).each(function(d){d.value=t.values[d.index].value})})},ChartInternal.prototype.updateLine=function(durationForExit){var $$=this,mainLine=$$.main.selectAll("."+CLASS.lines).selectAll("."+CLASS.line).data($$.lineData.bind($$)),mainLineEnter=mainLine.enter().append("path").attr("class",$$.classLine.bind($$)).style("stroke",$$.color);$$.mainLine=mainLineEnter.merge(mainLine).style("opacity",$$.initialOpacity.bind($$)).style("shape-rendering",function(d){return $$.isStepType(d)?"crispEdges":""}).attr("transform",null),mainLine.exit().transition().duration(durationForExit).style("opacity",0)},ChartInternal.prototype.redrawLine=function(drawLine,withTransition,transition){return[(withTransition?this.mainLine.transition(transition):this.mainLine).attr("d",drawLine).style("stroke",this.color).style("opacity",1)]},ChartInternal.prototype.generateDrawLine=function(yValue,isSub){function xValue(d){return(isSub?$$.subxx:$$.xx).call($$,d)}var $$=this,config=$$.config,line=$$.d3.line(),getPoints=$$.generateGetLinePoints(yValue,isSub),yScaleGetter=isSub?$$.getSubYScale:$$.getYScale,yValue=function yValue(d,i){return 0<config.data_groups.length?getPoints(d,i)[0][1]:yScaleGetter.call($$,d.id)(d.value)},line=config.axis_rotated?line.x(yValue).y(xValue):line.x(xValue).y(yValue);return config.line_connectNull||(line=line.defined(function(d){return null!=d.value})),function(d){var values=config.line_connectNull?$$.filterRemoveNull(d.values):d.values,x=isSub?$$.subX:$$.x,y=yScaleGetter.call($$,d.id),x0=0,path=0,path=$$.isLineType(d)?config.data_regions[d.id]?$$.lineWithRegions(values,x,y,config.data_regions[d.id]):($$.isStepType(d)&&(values=$$.convertValuesToStep(values)),line.curve($$.getInterpolate(d))(values)):(values[0]&&(x0=x(values[0].x),path=y(values[0].value)),config.axis_rotated?"M "+path+" "+x0:"M "+x0+" "+path);return path||"M 0 0"}},ChartInternal.prototype.generateGetLinePoints=function(lineIndices,isSub){var $$=this,config=$$.config,lineTargetsNum=lineIndices.__max__+1,x=$$.getShapeX(0,lineTargetsNum,lineIndices,!!isSub),y=$$.getShapeY(!!isSub),lineOffset=$$.getShapeOffset($$.isLineType,lineIndices,!!isSub),yScale=isSub?$$.getSubYScale:$$.getYScale;return function(d,posY){var y0=yScale.call($$,d.id)(0),offset=lineOffset(d,posY)||y0,posX=x(d),posY=y(d);return[[posX,(posY=config.axis_rotated&&(0<d.value&&posY<y0||d.value<0&&y0<posY)?y0:posY)-(y0-offset)],[posX,posY-(y0-offset)],[posX,posY-(y0-offset)],[posX,posY-(y0-offset)]]}},ChartInternal.prototype.lineWithRegions=function(d,x,y,_regions){var i,j,sWithRegion,xp,yp,dx,dy,diff,diffx2,xValue,yValue,$$=this,config=$$.config,s="M",xOffset=$$.isCategorized()?.5:0,regions=[];if(isDefined(_regions))for(i=0;i<_regions.length;i++)regions[i]={},isUndefined(_regions[i].start)?regions[i].start=d[0].x:regions[i].start=$$.isTimeSeries()?$$.parseDate(_regions[i].start):_regions[i].start,isUndefined(_regions[i].end)?regions[i].end=d[d.length-1].x:regions[i].end=$$.isTimeSeries()?$$.parseDate(_regions[i].end):_regions[i].end;function generateM(points){return"M"+points[0][0]+" "+points[0][1]+" "+points[1][0]+" "+points[1][1]}for(xValue=config.axis_rotated?function(d){return y(d.value)}:function(d){return x(d.x)},yValue=config.axis_rotated?function(d){return x(d.x)}:function(d){return y(d.value)},sWithRegion=$$.isTimeSeries()?function sWithRegion(xv0,xv1,j,points){var x0=xv0.x.getTime(),xv1=xv1.x-xv0.x,xv0=new Date(x0+xv1*j),xv1=new Date(x0+xv1*(j+points)),points=config.axis_rotated?[[y(yp(j)),x(xv0)],[y(yp(j+points)),x(xv1)]]:[[x(xv0),y(yp(j))],[x(xv1),y(yp(j+points))]];return generateM(points)}:function sWithRegion(d0,d1,j,points){points=config.axis_rotated?[[y(yp(j),!0),x(xp(j))],[y(yp(j+points),!0),x(xp(j+points))]]:[[x(xp(j),!0),y(yp(j))],[x(xp(j+points),!0),y(yp(j+points))]];return generateM(points)},i=0;i<d.length;i++){if(isUndefined(regions)||!function isWithinRegions(x,regions){for(var i=0;i<regions.length;i++)if(regions[i].start<x&&x<=regions[i].end)return 1}(d[i].x,regions))s+=" "+xValue(d[i])+" "+yValue(d[i]);else for(xp=$$.getScale(d[i-1].x+xOffset,d[i].x+xOffset,$$.isTimeSeries()),yp=$$.getScale(d[i-1].value,d[i].value),dx=x(d[i].x)-x(d[i-1].x),dy=y(d[i].value)-y(d[i-1].value),diffx2=2*(diff=2/Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2))),j=diff;j<=1;j+=diffx2)s+=sWithRegion(d[i-1],d[i],j,diff);d[i].x}return s},ChartInternal.prototype.updateArea=function(durationForExit){var $$=this,d3=$$.d3,mainArea=$$.main.selectAll("."+CLASS.areas).selectAll("."+CLASS.area).data($$.lineData.bind($$)),mainAreaEnter=mainArea.enter().append("path").attr("class",$$.classArea.bind($$)).style("fill",$$.color).style("opacity",function(){return $$.orgAreaOpacity=+d3.select(this).style("opacity"),0});$$.mainArea=mainAreaEnter.merge(mainArea).style("opacity",$$.orgAreaOpacity),mainArea.exit().transition().duration(durationForExit).style("opacity",0)},ChartInternal.prototype.redrawArea=function(drawArea,withTransition,transition){return[(withTransition?this.mainArea.transition(transition):this.mainArea).attr("d",drawArea).style("fill",this.color).style("opacity",this.orgAreaOpacity)]},ChartInternal.prototype.generateDrawArea=function(value1,isSub){function xValue(d){return(isSub?$$.subxx:$$.xx).call($$,d)}function value0(d,i){return 0<config.data_groups.length?getPoints(d,i)[0][1]:yScaleGetter.call($$,d.id)($$.getAreaBaseValue(d.id))}var $$=this,config=$$.config,area=$$.d3.area(),getPoints=$$.generateGetAreaPoints(value1,isSub),yScaleGetter=isSub?$$.getSubYScale:$$.getYScale,value1=function value1(d,i){return 0<config.data_groups.length?getPoints(d,i)[1][1]:yScaleGetter.call($$,d.id)(d.value)},area=config.axis_rotated?area.x0(value0).x1(value1).y(xValue):area.x(xValue).y0(config.area_above?0:value0).y1(value1);return config.line_connectNull||(area=area.defined(function(d){return null!==d.value})),function(d){var values=config.line_connectNull?$$.filterRemoveNull(d.values):d.values,x0=0,path=0,path=$$.isAreaType(d)?($$.isStepType(d)&&(values=$$.convertValuesToStep(values)),area.curve($$.getInterpolate(d))(values)):(values[0]&&(x0=$$.x(values[0].x),path=$$.getYScale(d.id)(values[0].value)),config.axis_rotated?"M "+path+" "+x0:"M "+x0+" "+path);return path||"M 0 0"}},ChartInternal.prototype.getAreaBaseValue=function(){return 0},ChartInternal.prototype.generateGetAreaPoints=function(areaIndices,isSub){var $$=this,config=$$.config,areaTargetsNum=areaIndices.__max__+1,x=$$.getShapeX(0,areaTargetsNum,areaIndices,!!isSub),y=$$.getShapeY(!!isSub),areaOffset=$$.getShapeOffset($$.isAreaType,areaIndices,!!isSub),yScale=isSub?$$.getSubYScale:$$.getYScale;return function(d,posY){var y0=yScale.call($$,d.id)(0),offset=areaOffset(d,posY)||y0,posX=x(d),posY=y(d);return[[posX,offset],[posX,(posY=config.axis_rotated&&(0<d.value&&posY<y0||d.value<0&&y0<posY)?y0:posY)-(y0-offset)],[posX,posY-(y0-offset)],[posX,offset]]}},ChartInternal.prototype.updateCircle=function(cx,mainCircleEnter){var $$=this,mainCircle=$$.main.selectAll("."+CLASS.circles).selectAll("."+CLASS.circle).data($$.lineOrScatterOrStanfordData.bind($$)),mainCircleEnter=mainCircle.enter().append("circle").attr("shape-rendering",$$.isStanfordGraphType()?"crispEdges":"").attr("class",$$.classCircle.bind($$)).attr("cx",cx).attr("cy",mainCircleEnter).attr("r",$$.pointR.bind($$)).style("color",$$.isStanfordGraphType()?$$.getStanfordPointColor.bind($$):$$.color);$$.mainCircle=mainCircleEnter.merge(mainCircle).style("opacity",$$.isStanfordGraphType()?1:$$.initialOpacityForCircle.bind($$)),mainCircle.exit().style("opacity",0)},ChartInternal.prototype.redrawCircle=function(cx,cy,withTransition,transition){var $$=this,selectedCircles=$$.main.selectAll("."+CLASS.selectedCircle);return[(withTransition?$$.mainCircle.transition(transition):$$.mainCircle).style("opacity",this.opacityForCircle.bind($$)).style("color",$$.isStanfordGraphType()?$$.getStanfordPointColor.bind($$):$$.color).attr("cx",cx).attr("cy",cy),(withTransition?selectedCircles.transition(transition):selectedCircles).attr("cx",cx).attr("cy",cy)]},ChartInternal.prototype.circleX=function(d){return d.x||0===d.x?this.x(d.x):null},ChartInternal.prototype.updateCircleY=function(){var lineIndices,getPoints,$$=this;0<$$.config.data_groups.length?(lineIndices=$$.getShapeIndices($$.isLineType),getPoints=$$.generateGetLinePoints(lineIndices),$$.circleY=function(d,i){return getPoints(d,i)[0][1]}):$$.circleY=function(d){return $$.getYScale(d.id)(d.value)}},ChartInternal.prototype.getCircles=function(i,id){return(id?this.main.selectAll("."+CLASS.circles+this.getTargetSelectorSuffix(id)):this.main).selectAll("."+CLASS.circle+(isValue(i)?"-"+i:""))},ChartInternal.prototype.expandCircles=function(i,id,reset){var r=this.pointExpandedR.bind(this);reset&&this.unexpandCircles(),this.getCircles(i,id).classed(CLASS.EXPANDED,!0).attr("r",r)},ChartInternal.prototype.unexpandCircles=function(i){var $$=this,r=$$.pointR.bind($$);$$.getCircles(i).filter(function(){return $$.d3.select(this).classed(CLASS.EXPANDED)}).classed(CLASS.EXPANDED,!1).attr("r",r)},ChartInternal.prototype.pointR=function(d){var config=this.config;return this.isStepType(d)?0:isFunction(config.point_r)?config.point_r(d):config.point_r},ChartInternal.prototype.pointExpandedR=function(d){var config=this.config;return config.point_focus_expand_enabled?isFunction(config.point_focus_expand_r)?config.point_focus_expand_r(d):config.point_focus_expand_r||1.75*this.pointR(d):this.pointR(d)},ChartInternal.prototype.pointSelectR=function(d){var config=this.config;return isFunction(config.point_select_r)?config.point_select_r(d):config.point_select_r||4*this.pointR(d)},ChartInternal.prototype.isWithinCircle=function(cx,r){var cy=this.d3,mouse=cy.mouse(cx),cy=cy.select(cx),cx=+cy.attr("cx"),cy=+cy.attr("cy");return Math.sqrt(Math.pow(cx-mouse[0],2)+Math.pow(cy-mouse[1],2))<r},ChartInternal.prototype.isWithinStep=function(that,y){return Math.abs(y-this.d3.mouse(that)[1])<30},ChartInternal.prototype.getCurrentWidth=function(){var config=this.config;return config.size_width||this.getParentWidth()},ChartInternal.prototype.getCurrentHeight=function(){var config=this.config,h=config.size_height||this.getParentHeight();return 0<h?h:320/(this.hasType("gauge")&&!config.gauge_fullCircle?2:1)},ChartInternal.prototype.getCurrentPaddingTop=function(){var padding=this.config,padding=isValue(padding.padding_top)?padding.padding_top:0;return this.title&&this.title.node()&&(padding+=this.getTitlePadding()),padding},ChartInternal.prototype.getCurrentPaddingBottom=function(){var config=this.config;return isValue(config.padding_bottom)?config.padding_bottom:0},ChartInternal.prototype.getCurrentPaddingLeft=function(withoutRecompute){var config=this.config;return isValue(config.padding_left)?config.padding_left:config.axis_rotated?!config.axis_x_show||config.axis_x_inner?1:Math.max(ceil10(this.getAxisWidthByAxisId("x",withoutRecompute)),40):!config.axis_y_show||config.axis_y_inner?this.axis.getYAxisLabelPosition().isOuter?30:1:ceil10(this.getAxisWidthByAxisId("y",withoutRecompute))},ChartInternal.prototype.getCurrentPaddingRight=function(){var $$=this,config=$$.config,padding=0,legendWidthOnRight=$$.isLegendRight?$$.getLegendWidth()+20:0,padding=isValue(config.padding_right)?config.padding_right+1:config.axis_rotated?10+legendWidthOnRight:!config.axis_y2_show||config.axis_y2_inner?2+legendWidthOnRight+($$.axis.getY2AxisLabelPosition().isOuter?20:0):ceil10($$.getAxisWidthByAxisId("y2"))+legendWidthOnRight;return $$.colorScale&&$$.colorScale.node()&&(padding+=$$.getColorScalePadding()),padding},ChartInternal.prototype.getParentRectValue=function(key){for(var v,parent=this.selectChart.node();parent&&"BODY"!==parent.tagName;){try{v=parent.getBoundingClientRect()[key]}catch(e){"width"===key&&(v=parent.offsetWidth)}if(v)break;parent=parent.parentNode}return v},ChartInternal.prototype.getParentWidth=function(){return this.getParentRectValue("width")},ChartInternal.prototype.getParentHeight=function(){var h=this.selectChart.style("height");return 0<h.indexOf("px")?+h.replace("px",""):0},ChartInternal.prototype.getSvgLeft=function(svgLeft){var $$=this,hasArc=$$.config,chartRect=hasArc.axis_rotated||!hasArc.axis_rotated&&!hasArc.axis_y_inner,svgRect=hasArc.axis_rotated?CLASS.axisX:CLASS.axisY,hasArc=$$.main.select("."+svgRect).node(),svgRect=hasArc&&chartRect?hasArc.getBoundingClientRect():{right:0},chartRect=$$.selectChart.node().getBoundingClientRect(),hasArc=$$.hasArcType(),svgLeft=svgRect.right-chartRect.left-(hasArc?0:$$.getCurrentPaddingLeft(svgLeft));return 0<svgLeft?svgLeft:0},ChartInternal.prototype.getAxisWidthByAxisId=function(id,withoutRecompute){var position=this.axis.getLabelPositionById(id);return this.axis.getMaxTickWidth(id,withoutRecompute)+(position.isInner?20:40)},ChartInternal.prototype.getHorizontalAxisHeight=function(axisId){var $$=this,config=$$.config,h=30;return"x"!==axisId||config.axis_x_show?"x"===axisId&&config.axis_x_height?config.axis_x_height:"y"!==axisId||config.axis_y_show?"y2"!==axisId||config.axis_y2_show?("x"===axisId&&!config.axis_rotated&&config.axis_x_tick_rotate&&(h=30+$$.axis.getMaxTickWidth(axisId)*Math.cos(Math.PI*(90-Math.abs(config.axis_x_tick_rotate))/180)),(h="y"===axisId&&config.axis_rotated&&config.axis_y_tick_rotate?30+$$.axis.getMaxTickWidth(axisId)*Math.cos(Math.PI*(90-Math.abs(config.axis_y_tick_rotate))/180):h)+($$.axis.getLabelPositionById(axisId).isInner?0:10)+("y2"===axisId?-10:0)):$$.rotated_padding_top:!config.legend_show||$$.isLegendRight||$$.isLegendInset?1:10:8},ChartInternal.prototype.initBrush=function(scale){var $$=this,d3=$$.d3;return $$.brush=($$.config.axis_rotated?d3.brushY():d3.brushX()).on("brush",function(){var event=d3.event.sourceEvent;event&&"zoom"===event.type||$$.redrawForBrush()}).on("end",function(){var event=d3.event.sourceEvent;event&&"zoom"===event.type||$$.brush.empty()&&event&&"end"!==event.type&&$$.brush.clear()}),$$.brush.updateExtent=function(){var extent=this.scale.range(),extent=$$.config.axis_rotated?[[0,extent[0]],[$$.width2,extent[1]]]:[[extent[0],0],[extent[1],$$.height2]];return this.extent(extent),this},$$.brush.updateScale=function(scale){return this.scale=scale,this},$$.brush.update=function(scale){this.updateScale(scale||$$.subX).updateExtent(),$$.context.select("."+CLASS.brush).call(this)},$$.brush.clear=function(){$$.context.select("."+CLASS.brush).call($$.brush.move,null)},$$.brush.selection=function(){return d3.brushSelection($$.context.select("."+CLASS.brush).node())},$$.brush.selectionAsValue=function(brush,withTransition){var selection;return brush?($$.context&&(selection=[this.scale(brush[0]),this.scale(brush[1])],brush=$$.context.select("."+CLASS.brush),withTransition&&(brush=brush.transition()),$$.brush.move(brush,selection)),[]):(selection=$$.brush.selection()||[0,0],[this.scale.invert(selection[0]),this.scale.invert(selection[1])])},$$.brush.empty=function(){var selection=$$.brush.selection();return!selection||selection[0]===selection[1]},$$.brush.updateScale(scale)},ChartInternal.prototype.initSubchart=function(){var $$=this,config=$$.config,context=$$.context=$$.svg.append("g").attr("transform",$$.getTranslate("context")),visibility=config.subchart_show?"visible":"hidden";context.style("visibility",visibility),context.append("g").attr("clip-path",$$.clipPathForSubchart).attr("class",CLASS.chart),context.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBars),context.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLines),context.append("g").attr("clip-path",$$.clipPath).attr("class",CLASS.brush),$$.axes.subx=context.append("g").attr("class",CLASS.axisX).attr("transform",$$.getTranslate("subx")).attr("clip-path",config.axis_rotated?"":$$.clipPathForXAxis)},ChartInternal.prototype.initSubchartBrush=function(){this.initBrush(this.subX).updateExtent(),this.context.select("."+CLASS.brush).call(this.brush)},ChartInternal.prototype.updateTargetsForSubchart=function(contextLineEnter){var contextBarEnter,contextBar,$$=this,context=$$.context,config=$$.config,classChartBar=$$.classChartBar.bind($$),contextLine=$$.classBars.bind($$),classChartLine=$$.classChartLine.bind($$),classLines=$$.classLines.bind($$),classAreas=$$.classAreas.bind($$);config.subchart_show&&((contextBarEnter=(contextBar=context.select("."+CLASS.chartBars).selectAll("."+CLASS.chartBar).data(contextLineEnter)).enter().append("g").style("opacity",0)).merge(contextBar).attr("class",classChartBar),contextBarEnter.append("g").attr("class",contextLine),(contextLineEnter=(contextLine=context.select("."+CLASS.chartLines).selectAll("."+CLASS.chartLine).data(contextLineEnter)).enter().append("g").style("opacity",0)).merge(contextLine).attr("class",classChartLine),contextLineEnter.append("g").attr("class",classLines),contextLineEnter.append("g").attr("class",classAreas),context.selectAll("."+CLASS.brush+" rect").attr(config.axis_rotated?"width":"height",config.axis_rotated?$$.width2:$$.height2))},ChartInternal.prototype.updateBarForSubchart=function(durationForExit){var $$=this,contextBar=$$.context.selectAll("."+CLASS.bars).selectAll("."+CLASS.bar).data($$.barData.bind($$)),contextBarEnter=contextBar.enter().append("path").attr("class",$$.classBar.bind($$)).style("stroke","none").style("fill",$$.color);contextBar.exit().transition().duration(durationForExit).style("opacity",0).remove(),$$.contextBar=contextBarEnter.merge(contextBar).style("opacity",$$.initialOpacity.bind($$))},ChartInternal.prototype.redrawBarForSubchart=function(drawBarOnSub,withTransition,duration){(withTransition?this.contextBar.transition(Math.random().toString()).duration(duration):this.contextBar).attr("d",drawBarOnSub).style("opacity",1)},ChartInternal.prototype.updateLineForSubchart=function(durationForExit){var $$=this,contextLine=$$.context.selectAll("."+CLASS.lines).selectAll("."+CLASS.line).data($$.lineData.bind($$)),contextLineEnter=contextLine.enter().append("path").attr("class",$$.classLine.bind($$)).style("stroke",$$.color);contextLine.exit().transition().duration(durationForExit).style("opacity",0).remove(),$$.contextLine=contextLineEnter.merge(contextLine).style("opacity",$$.initialOpacity.bind($$))},ChartInternal.prototype.redrawLineForSubchart=function(drawLineOnSub,withTransition,duration){(withTransition?this.contextLine.transition(Math.random().toString()).duration(duration):this.contextLine).attr("d",drawLineOnSub).style("opacity",1)},ChartInternal.prototype.updateAreaForSubchart=function(durationForExit){var $$=this,d3=$$.d3,contextArea=$$.context.selectAll("."+CLASS.areas).selectAll("."+CLASS.area).data($$.lineData.bind($$)),contextAreaEnter=contextArea.enter().append("path").attr("class",$$.classArea.bind($$)).style("fill",$$.color).style("opacity",function(){return $$.orgAreaOpacity=+d3.select(this).style("opacity"),0});contextArea.exit().transition().duration(durationForExit).style("opacity",0).remove(),$$.contextArea=contextAreaEnter.merge(contextArea).style("opacity",0)},ChartInternal.prototype.redrawAreaForSubchart=function(drawAreaOnSub,withTransition,duration){(withTransition?this.contextArea.transition(Math.random().toString()).duration(duration):this.contextArea).attr("d",drawAreaOnSub).style("fill",this.color).style("opacity",this.orgAreaOpacity)},ChartInternal.prototype.redrawSubchart=function(withSubchart,transitions,duration,durationForExit,drawAreaOnSub,drawBarOnSub,drawLineOnSub){var $$=this,d3=$$.d3,config=$$.config;$$.context.style("visibility",config.subchart_show?"visible":"hidden"),config.subchart_show&&(d3.event&&"zoom"===d3.event.type&&$$.brush.selectionAsValue($$.x.orgDomain()),withSubchart&&($$.brush.empty()||$$.brush.selectionAsValue($$.x.orgDomain()),drawAreaOnSub=$$.generateDrawArea(drawAreaOnSub,!0),drawBarOnSub=$$.generateDrawBar(drawBarOnSub,!0),drawLineOnSub=$$.generateDrawLine(drawLineOnSub,!0),$$.updateBarForSubchart(duration),$$.updateLineForSubchart(duration),$$.updateAreaForSubchart(duration),$$.redrawBarForSubchart(drawBarOnSub,duration,duration),$$.redrawLineForSubchart(drawLineOnSub,duration,duration),$$.redrawAreaForSubchart(drawAreaOnSub,duration,duration)))},ChartInternal.prototype.redrawForBrush=function(){var s,$$=this,x=$$.x,d3=$$.d3;$$.redraw({withTransition:!1,withY:$$.config.zoom_rescale,withSubchart:!1,withUpdateXDomain:!0,withEventRect:!1,withDimension:!1}),s=d3.event.selection||$$.brush.scale.range(),$$.main.select("."+CLASS.eventRect).call($$.zoom.transform,d3.zoomIdentity.scale($$.width/(s[1]-s[0])).translate(-s[0],0)),$$.config.subchart_onbrush.call($$.api,x.orgDomain())},ChartInternal.prototype.transformContext=function(withTransition,transitions){var subXAxis;transitions&&transitions.axisSubX?subXAxis=transitions.axisSubX:(subXAxis=this.context.select("."+CLASS.axisX),withTransition&&(subXAxis=subXAxis.transition())),this.context.attr("transform",this.getTranslate("context")),subXAxis.attr("transform",this.getTranslate("subx"))},ChartInternal.prototype.getDefaultSelection=function(){var $$=this,selection=$$.config,selection=isFunction(selection.axis_x_selection)?selection.axis_x_selection($$.getXDomain($$.data.targets)):selection.axis_x_selection;return selection=$$.isTimeSeries()?[$$.parseDate(selection[0]),$$.parseDate(selection[1])]:selection},ChartInternal.prototype.initText=function(){this.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartTexts),this.mainText=this.d3.selectAll([])},ChartInternal.prototype.updateTargetsForText=function(mainTextEnter){var mainText=this,classChartText=mainText.classChartText.bind(mainText),classTexts=mainText.classTexts.bind(mainText),classFocus=mainText.classFocus.bind(mainText),mainText=mainText.main.select("."+CLASS.chartTexts).selectAll("."+CLASS.chartText).data(mainTextEnter),mainTextEnter=mainText.enter().append("g").attr("class",classChartText).style("opacity",0).style("pointer-events","none");mainTextEnter.append("g").attr("class",classTexts),mainTextEnter.merge(mainText).attr("class",function(d){return classChartText(d)+classFocus(d)})},ChartInternal.prototype.updateText=function(xForText,mainTextEnter,durationForExit){var $$=this,config=$$.config,mainText=$$.barOrLineData.bind($$),classText=$$.classText.bind($$),mainText=$$.main.selectAll("."+CLASS.texts).selectAll("."+CLASS.text).data(mainText),mainTextEnter=mainText.enter().append("text").attr("class",classText).attr("text-anchor",function(d){return config.axis_rotated?d.value<0?"end":"start":"middle"}).style("stroke","none").attr("x",xForText).attr("y",mainTextEnter).style("fill",function(d){return $$.color(d)}).style("fill-opacity",0);$$.mainText=mainTextEnter.merge(mainText).text(function(d,i,j){return $$.dataLabelFormat(d.id)(d.value,d.id,i,j)}),mainText.exit().transition().duration(durationForExit).style("fill-opacity",0).remove()},ChartInternal.prototype.redrawText=function(xForText,yForText,forFlow,withTransition,transition){return[(withTransition?this.mainText.transition(transition):this.mainText).attr("x",xForText).attr("y",yForText).style("fill",this.color).style("fill-opacity",forFlow?0:this.opacityForText.bind(this))]},ChartInternal.prototype.getTextRect=function(text,cls,font){var rect,dummy=this.d3.select("body").append("div").classed("c3",!0),svg=dummy.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),font=this.d3.select(font).style("font");return svg.selectAll(".dummy").data([text]).enter().append("text").classed(cls||"",!0).style("font",font).text(text).each(function(){rect=getBBox(this)}),dummy.remove(),rect},ChartInternal.prototype.generateXYForText=function(areaIndices,barIndices,lineIndices,forX){var $$=this,getAreaPoints=$$.generateGetAreaPoints(areaIndices,!1),getBarPoints=$$.generateGetBarPoints(barIndices,!1),getLinePoints=$$.generateGetLinePoints(lineIndices,!1),getter=forX?$$.getXForText:$$.getYForText;return function(d,i){var getPoints=$$.isAreaType(d)?getAreaPoints:$$.isBarType(d)?getBarPoints:getLinePoints;return getter.call($$,getPoints(d,i),d,this)}},ChartInternal.prototype.getXForText=function(xPos,d,padding){var $$=this,box=getBBox(padding),xPos=$$.config.axis_rotated?(padding=$$.isBarType(d)?4:6,xPos[2][1]+padding*(d.value<0?-1:1)):$$.hasType("bar")?(xPos[2][0]+xPos[0][0])/2:xPos[0][0];return null===d.value&&(xPos>$$.width?xPos=$$.width-box.width:xPos<0&&(xPos=4)),xPos},ChartInternal.prototype.getYForText=function(points,d,box){var yPos,$$=this,box=getBBox(box);return $$.config.axis_rotated?yPos=(points[0][0]+points[2][0]+.6*box.height)/2:(yPos=points[2][1],d.value<0||0===d.value&&!$$.hasPositiveValue?(yPos+=box.height,$$.isBarType(d)&&$$.isSafari()?yPos-=3:!$$.isBarType(d)&&$$.isChrome()&&(yPos+=3)):yPos+=$$.isBarType(d)?-3:-6),null!==d.value||$$.config.axis_rotated||(yPos<box.height?yPos=box.height:yPos>this.height&&(yPos=this.height-4)),yPos},ChartInternal.prototype.initTitle=function(){this.title=this.svg.append("text").text(this.config.title_text).attr("class",this.CLASS.title)},ChartInternal.prototype.redrawTitle=function(){var $$=this;$$.title.attr("x",$$.xForTitle.bind($$)).attr("y",$$.yForTitle.bind($$))},ChartInternal.prototype.xForTitle=function(){var $$=this,x=$$.config,position=x.title_position||"left",x=0<=position.indexOf("right")?$$.currentWidth-$$.getTextRect($$.title.node().textContent,$$.CLASS.title,$$.title.node()).width-x.title_padding.right:0<=position.indexOf("center")?Math.max(($$.currentWidth-$$.getTextRect($$.title.node().textContent,$$.CLASS.title,$$.title.node()).width)/2,0):x.title_padding.left;return x},ChartInternal.prototype.yForTitle=function(){var $$=this;return $$.config.title_padding.top+$$.getTextRect($$.title.node().textContent,$$.CLASS.title,$$.title.node()).height},ChartInternal.prototype.getTitlePadding=function(){return this.yForTitle()+this.config.title_padding.bottom},ChartInternal.prototype.drawColorScale=function(){var axis,inverseScale,height,$$=this,d3=$$.d3,config=$$.config,target=$$.data.targets[0],barWidth=isNaN(config.stanford_scaleWidth)?20:config.stanford_scaleWidth;if(barWidth<0)throw Error("Colorscale's barheight and barwidth must be greater than 0.");height=$$.height-config.stanford_padding.bottom-config.stanford_padding.top,axis=d3.range(config.stanford_padding.bottom,height,5),inverseScale=d3.scaleSequential(target.colors).domain([axis[axis.length-1],axis[0]]),$$.colorScale&&$$.colorScale.remove(),$$.colorScale=$$.svg.append("g").attr("width",50).attr("height",height).attr("class",CLASS.colorScale),$$.colorScale.append("g").attr("transform","translate(0, ".concat(config.stanford_padding.top,")")).selectAll("bars").data(axis).enter().append("rect").attr("y",function(d,i){return 5*i}).attr("x",0).attr("width",barWidth).attr("height",5).attr("fill",function(d){return inverseScale(d)}),axis=d3.scaleLog().domain([target.minEpochs,target.maxEpochs]).range([axis[0]+config.stanford_padding.top+axis[axis.length-1]+5-1,axis[0]+config.stanford_padding.top]),axis=d3.axisRight(axis),"pow10"===config.stanford_scaleFormat?axis.tickValues([1,10,100,1e3,1e4,1e5,1e6,1e7]):isFunction(config.stanford_scaleFormat)?axis.tickFormat(config.stanford_scaleFormat):axis.tickFormat(d3.format("d")),isFunction(config.stanford_scaleValues)&&axis.tickValues(config.stanford_scaleValues(target.minEpochs,target.maxEpochs)),axis=$$.colorScale.append("g").attr("class","legend axis").attr("transform","translate(".concat(barWidth,",0)")).call(axis),"pow10"===config.stanford_scaleFormat&&axis.selectAll(".tick text").text(null).filter(powerOfTen).text(10).append("tspan").attr("dy","-.7em").text(function(d){return Math.round(Math.log(d)/Math.LN10)}),$$.colorScale.attr("transform","translate(".concat($$.currentWidth-$$.xForColorScale(),", 0)"))},ChartInternal.prototype.xForColorScale=function(){return this.config.stanford_padding.right+getBBox(this.colorScale.node()).width},ChartInternal.prototype.getColorScalePadding=function(){return this.xForColorScale()+this.config.stanford_padding.left+20},ChartInternal.prototype.isStanfordGraphType=function(){return"stanford"===this.config.data_type},ChartInternal.prototype.initStanfordData=function(){var maxEpochs,minEpochs,d3=this.d3,config=this.config,target=this.data.targets[0];if(target.values.sort(compareEpochs),maxEpochs=target.values.map(function(a){return a.epochs}),minEpochs=isNaN(config.stanford_scaleMin)?d3.min(maxEpochs):config.stanford_scaleMin,(maxEpochs=isNaN(config.stanford_scaleMax)?d3.max(maxEpochs):config.stanford_scaleMax)<minEpochs)throw Error("Number of minEpochs has to be smaller than maxEpochs");target.colors=isFunction(config.stanford_colors)?config.stanford_colors:d3.interpolateHslLong(d3.hsl(250,1,.5),d3.hsl(0,1,.5)),target.colorscale=d3.scaleSequentialLog(target.colors).domain([minEpochs,maxEpochs]),target.minEpochs=minEpochs,target.maxEpochs=maxEpochs},ChartInternal.prototype.getStanfordPointColor=function(d){return this.data.targets[0].colorscale(d.epochs)},ChartInternal.prototype.getCentroid=function(points){for(var f,point1,point2,area=getRegionArea(points),x=0,y=0,i=0,j=points.length-1;i<points.length;j=i,i+=1)point1=points[i],point2=points[j],f=point1.x*point2.y-point2.x*point1.y,x+=(point1.x+point2.x)*f,y+=(point1.y+point2.y)*f;return{x:x/(f=6*area),y:y/f}},ChartInternal.prototype.getStanfordTooltipTitle=function(d){var labelX=this.axis.getLabelText("x"),labelY=this.axis.getLabelText("y");return"\n      <tr><th>".concat(labelX?sanitise(labelX):"x","</th><th class='value'>").concat(d.x,"</th></tr>\n      <tr><th>").concat(labelY?sanitise(labelY):"y","</th><th class='value'>").concat(d.value,"</th></tr>\n    ")},ChartInternal.prototype.countEpochsInRegion=function(region){var count=this.data.targets[0],total=count.values.reduce(function(accumulator,currentValue){return accumulator+Number(currentValue.epochs)},0),count=count.values.reduce(function(accumulator,currentValue){return pointInRegion(currentValue,region)?accumulator+Number(currentValue.epochs):accumulator},0);return{value:count,percentage:0!==count?(count/total*100).toFixed(1):0}};var getRegionArea=function getRegionArea(points){for(var point1,point2,area=0,i=0,j=points.length-1;i<points.length;j=i,i+=1)point1=points[i],point2=points[j],area+=point1.x*point2.y,area-=point1.y*point2.x;return area/=2},pointInRegion=function pointInRegion(point,region){for(var xi,yi,yj,xj,x=point.x,y=point.value,inside=!1,i=0,j=region.length-1;i<region.length;j=i++)xi=region[i].x,yi=region[i].y,xj=region[j].x,y<yi!=y<(yj=region[j].y)&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(inside=!inside);return inside},compareEpochs=function compareEpochs(a,b){return a.epochs<b.epochs?-1:a.epochs>b.epochs?1:0};return ChartInternal.prototype.initStanfordElements=function(){var $$=this;$$.stanfordElements=$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.stanfordElements),$$.stanfordElements.append("g").attr("class",CLASS.stanfordLines),$$.stanfordElements.append("g").attr("class",CLASS.stanfordTexts),$$.stanfordElements.append("g").attr("class",CLASS.stanfordRegions)},ChartInternal.prototype.updateStanfordElements=function(duration){var $$=this,stanfordRegionEnter=$$.main,config=$$.config,xvCustom=$$.xvCustom.bind($$),yvCustom=$$.yvCustom.bind($$),countPointsInRegion=$$.countEpochsInRegion.bind($$),stanfordTextEnter=stanfordRegionEnter.select("."+CLASS.stanfordLines).style("shape-rendering","geometricprecision").selectAll("."+CLASS.stanfordLine).data(config.stanford_lines),stanfordRegion=stanfordTextEnter.enter().append("g").attr("class",function(d){return CLASS.stanfordLine+(d.class?" "+d.class:"")});stanfordRegion.append("line").attr("x1",function(d){return config.axis_rotated?yvCustom(d,"value_y1"):xvCustom(d,"value_x1")}).attr("x2",function(d){return config.axis_rotated?yvCustom(d,"value_y2"):xvCustom(d,"value_x2")}).attr("y1",function(d){return config.axis_rotated?xvCustom(d,"value_x1"):yvCustom(d,"value_y1")}).attr("y2",function(d){return config.axis_rotated?xvCustom(d,"value_x2"):yvCustom(d,"value_y2")}).style("opacity",0),$$.stanfordLines=stanfordRegion.merge(stanfordTextEnter),$$.stanfordLines.select("line").transition().duration(duration).attr("x1",function(d){return config.axis_rotated?yvCustom(d,"value_y1"):xvCustom(d,"value_x1")}).attr("x2",function(d){return config.axis_rotated?yvCustom(d,"value_y2"):xvCustom(d,"value_x2")}).attr("y1",function(d){return config.axis_rotated?xvCustom(d,"value_x1"):yvCustom(d,"value_y1")}).attr("y2",function(d){return config.axis_rotated?xvCustom(d,"value_x2"):yvCustom(d,"value_y2")}).style("opacity",1),stanfordTextEnter.exit().transition().duration(duration).style("opacity",0).remove(),(stanfordTextEnter=(stanfordRegion=stanfordRegionEnter.select("."+CLASS.stanfordTexts).selectAll("."+CLASS.stanfordText).data(config.stanford_texts)).enter().append("g").attr("class",function(d){return CLASS.stanfordText+(d.class?" "+d.class:"")})).append("text").attr("x",function(d){return config.axis_rotated?yvCustom(d,"y"):xvCustom(d,"x")}).attr("y",function(d){return config.axis_rotated?xvCustom(d,"x"):yvCustom(d,"y")}).style("opacity",0),$$.stanfordTexts=stanfordTextEnter.merge(stanfordRegion),$$.stanfordTexts.select("text").transition().duration(duration).attr("x",function(d){return config.axis_rotated?yvCustom(d,"y"):xvCustom(d,"x")}).attr("y",function(d){return config.axis_rotated?xvCustom(d,"x"):yvCustom(d,"y")}).text(function(d){return d.content}).style("opacity",1),stanfordRegion.exit().transition().duration(duration).style("opacity",0).remove(),(stanfordRegionEnter=(stanfordRegion=stanfordRegionEnter.select("."+CLASS.stanfordRegions).selectAll("."+CLASS.stanfordRegion).data(config.stanford_regions)).enter().append("g").attr("class",function(d){return CLASS.stanfordRegion+(d.class?" "+d.class:"")})).append("polygon").attr("points",function(d){return d.points.map(function(value){return[config.axis_rotated?yvCustom(value,"y"):xvCustom(value,"x"),config.axis_rotated?xvCustom(value,"x"):yvCustom(value,"y")].join(",")}).join(" ")}).style("opacity",0),stanfordRegionEnter.append("text").attr("x",function(d){return $$.getCentroid(d.points).x}).attr("y",function(d){return $$.getCentroid(d.points).y}).style("opacity",0),$$.stanfordRegions=stanfordRegionEnter.merge(stanfordRegion),$$.stanfordRegions.select("polygon").transition().duration(duration).attr("points",function(d){return d.points.map(function(value){return[config.axis_rotated?yvCustom(value,"y"):xvCustom(value,"x"),config.axis_rotated?xvCustom(value,"x"):yvCustom(value,"y")].join(",")}).join(" ")}).style("opacity",function(d){return d.opacity||.2}),$$.stanfordRegions.select("text").transition().duration(duration).attr("x",function(d){return config.axis_rotated?yvCustom($$.getCentroid(d.points),"y"):xvCustom($$.getCentroid(d.points),"x")}).attr("y",function(d){return config.axis_rotated?xvCustom($$.getCentroid(d.points),"x"):yvCustom($$.getCentroid(d.points),"y")}).text(function(d){var value,percentage;return d.text?($$.isStanfordGraphType()&&(value=(percentage=countPointsInRegion(d.points)).value,percentage=percentage.percentage),d.text(value,percentage)):""}).attr("text-anchor","middle").attr("dominant-baseline","middle").style("opacity",1),stanfordRegion.exit().transition().duration(duration).style("opacity",0).remove()},ChartInternal.prototype.initTooltip=function(){var i,$$=this,config=$$.config;if($$.tooltip=$$.selectChart.style("position","relative").append("div").attr("class",CLASS.tooltipContainer).style("position","absolute").style("pointer-events","none").style("display","none"),config.tooltip_init_show){if($$.isTimeSeries()&&isString(config.tooltip_init_x)){for(config.tooltip_init_x=$$.parseDate(config.tooltip_init_x),i=0;i<$$.data.targets[0].values.length&&$$.data.targets[0].values[i].x-config.tooltip_init_x!=0;i++);config.tooltip_init_x=i}$$.tooltip.html(config.tooltip_contents.call($$,$$.data.targets.map(function(d){return $$.addName(d.values[config.tooltip_init_x])}),$$.axis.getXAxisTickFormat(),$$.getYFormat($$.hasArcType()),$$.color)),$$.tooltip.style("top",config.tooltip_init_position.top).style("left",config.tooltip_init_position.left).style("display","block")}},ChartInternal.prototype.getTooltipSortFunction=function(){var $$=this,config=$$.config;if(0===config.data_groups.length||void 0!==config.tooltip_order){var order=config.tooltip_order;void 0===order&&(order=config.data_order);var valueOf=function valueOf(obj){return obj?obj.value:null};if(isString(order)&&"asc"===order.toLowerCase())return function(a,b){return valueOf(a)-valueOf(b)};if(isString(order)&&"desc"===order.toLowerCase())return function(a,b){return valueOf(b)-valueOf(a)};if(isFunction(order))return void 0===config.tooltip_order?function sortFunction(a,b){return order(a?{id:a.id,values:[a]}:null,b?{id:b.id,values:[b]}:null)}:order;return isArray(order)?function(a,b){return order.indexOf(a.id)-order.indexOf(b.id)}:void 0}var ids=$$.orderTargets($$.data.targets).map(function(i){return i.id});return($$.isOrderAsc()||$$.isOrderDesc())&&(ids=ids.reverse()),function(a,b){return ids.indexOf(a.id)-ids.indexOf(b.id)}},ChartInternal.prototype.getTooltipContent=function(d,defaultTitleFormat,tooltipSortFunction,color){var text,i,title,value,name,bgcolor,$$=this,config=$$.config,titleFormat=config.tooltip_format_title||defaultTitleFormat,nameFormat=config.tooltip_format_name||function(name){return name},valueFormat=(valueFormat=config.tooltip_format_value)||($$.isTargetNormalized(d.id)?function(v,ratio){return"".concat((100*ratio).toFixed(2),"%")}:tooltipSortFunction),tooltipSortFunction=this.getTooltipSortFunction();for(tooltipSortFunction&&d.sort(tooltipSortFunction),i=0;i<d.length;i++)if(d[i]&&(d[i].value||0===d[i].value)){if($$.isStanfordGraphType())text||(title=$$.getStanfordTooltipTitle(d[i]),text="<table class='"+$$.CLASS.tooltip+"'>"+title),bgcolor=$$.getStanfordPointColor(d[i]),name=sanitise(config.data_epochs),value=d[i].epochs;else if(text||(title=sanitise(titleFormat?titleFormat(d[i].x,d[i].index):d[i].x),text="<table class='"+$$.CLASS.tooltip+"'>"+(title||0===title?"<tr><th colspan='2'>"+title+"</th></tr>":"")),void 0!==(value=sanitise(valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index,d)))){if(null===d[i].name)continue;name=sanitise(nameFormat(d[i].name,d[i].ratio,d[i].id,d[i].index)),bgcolor=$$.levelColor?$$.levelColor(d[i].value):color(d[i].id)}void 0!==value&&(text+="<tr class='"+$$.CLASS.tooltipName+"-"+$$.getTargetSelectorSuffix(d[i].id)+"'>",text+="<td class='name'><span style='background-color:"+bgcolor+"'></span>"+name+"</td>",text+="<td class='value'>"+value+"</td>",text+="</tr>")}return text+"</table>"},ChartInternal.prototype.tooltipPosition=function(dataToShow,tWidth,tHeight,mouse){var tooltipLeft,tooltipRight,tooltipTop,chartRight,$$=this,config=$$.config,d3=$$.d3,svgLeft=$$.hasArcType(),mouse=d3.mouse(mouse);return svgLeft?(tooltipLeft=($$.width-($$.isLegendRight?$$.getLegendWidth():0))/2+mouse[0],tooltipTop=($$.hasType("gauge")?$$.height:$$.height/2)+mouse[1]+20):(svgLeft=$$.getSvgLeft(!0),tooltipTop=config.axis_rotated?(tooltipRight=(tooltipLeft=svgLeft+mouse[0]+100)+tWidth,chartRight=$$.currentWidth-$$.getCurrentPaddingRight(),$$.x(dataToShow[0].x)+20):(tooltipRight=(tooltipLeft=svgLeft+$$.getCurrentPaddingLeft(!0)+$$.x(dataToShow[0].x)+20)+tWidth,chartRight=svgLeft+$$.currentWidth-$$.getCurrentPaddingRight(),mouse[1]+15),chartRight<tooltipRight&&(tooltipLeft-=tooltipRight-chartRight+20),tooltipTop+tHeight>$$.currentHeight&&(tooltipTop-=tHeight+30)),{top:tooltipTop=tooltipTop<0?0:tooltipTop,left:tooltipLeft}},ChartInternal.prototype.showTooltip=function(tWidth,position){var $$=this,config=$$.config,tHeight=$$.hasArcType(),dataToShow=tWidth.filter(function(d){return d&&isValue(d.value)}),positionFunction=config.tooltip_position||ChartInternal.prototype.tooltipPosition;0!==dataToShow.length&&config.tooltip_show&&($$.tooltip.html(config.tooltip_contents.call($$,tWidth,$$.axis.getXAxisTickFormat(),$$.getYFormat(tHeight),$$.color)).style("display","block"),tWidth=$$.tooltip.property("offsetWidth"),tHeight=$$.tooltip.property("offsetHeight"),position=positionFunction.call(this,dataToShow,tWidth,tHeight,position),$$.tooltip.style("top",position.top+"px").style("left",position.left+"px"))},ChartInternal.prototype.hideTooltip=function(){this.tooltip.style("display","none")},ChartInternal.prototype.setTargetType=function(targetIds,type){var $$=this,config=$$.config;$$.mapToTargetIds(targetIds).forEach(function(id){$$.withoutFadeIn[id]=type===config.data_types[id],config.data_types[id]=type}),targetIds||(config.data_type=type)},ChartInternal.prototype.hasType=function(type,targets){var types=this.config.data_types,has=!1;return(targets=targets||this.data.targets)&&targets.length?targets.forEach(function(t){t=types[t.id];(t&&0<=t.indexOf(type)||!t&&"line"===type)&&(has=!0)}):Object.keys(types).length?Object.keys(types).forEach(function(id){types[id]===type&&(has=!0)}):has=this.config.data_type===type,has},ChartInternal.prototype.hasArcType=function(targets){return this.hasType("pie",targets)||this.hasType("donut",targets)||this.hasType("gauge",targets)},ChartInternal.prototype.isLineType=function(id){var config=this.config,id=isString(id)?id:id.id;return!config.data_types[id]||0<=["line","spline","area","area-spline","step","area-step"].indexOf(config.data_types[id])},ChartInternal.prototype.isStepType=function(id){id=isString(id)?id:id.id;return 0<=["step","area-step"].indexOf(this.config.data_types[id])},ChartInternal.prototype.isSplineType=function(id){id=isString(id)?id:id.id;return 0<=["spline","area-spline"].indexOf(this.config.data_types[id])},ChartInternal.prototype.isAreaType=function(id){id=isString(id)?id:id.id;return 0<=["area","area-spline","area-step"].indexOf(this.config.data_types[id])},ChartInternal.prototype.isBarType=function(id){id=isString(id)?id:id.id;return"bar"===this.config.data_types[id]},ChartInternal.prototype.isScatterType=function(id){id=isString(id)?id:id.id;return"scatter"===this.config.data_types[id]},ChartInternal.prototype.isStanfordType=function(id){id=isString(id)?id:id.id;return"stanford"===this.config.data_types[id]},ChartInternal.prototype.isPieType=function(id){id=isString(id)?id:id.id;return"pie"===this.config.data_types[id]},ChartInternal.prototype.isGaugeType=function(id){id=isString(id)?id:id.id;return"gauge"===this.config.data_types[id]},ChartInternal.prototype.isDonutType=function(id){id=isString(id)?id:id.id;return"donut"===this.config.data_types[id]},ChartInternal.prototype.isArcType=function(d){return this.isPieType(d)||this.isDonutType(d)||this.isGaugeType(d)},ChartInternal.prototype.lineData=function(d){return this.isLineType(d)?[d]:[]},ChartInternal.prototype.arcData=function(d){return this.isArcType(d.data)?[d]:[]},ChartInternal.prototype.barData=function(d){return this.isBarType(d)?d.values:[]},ChartInternal.prototype.lineOrScatterOrStanfordData=function(d){return this.isLineType(d)||this.isScatterType(d)||this.isStanfordType(d)?d.values:[]},ChartInternal.prototype.barOrLineData=function(d){return this.isBarType(d)||this.isLineType(d)?d.values:[]},ChartInternal.prototype.isSafari=function(){var ua=window.navigator.userAgent;return 0<=ua.indexOf("Safari")&&ua.indexOf("Chrome")<0},ChartInternal.prototype.isChrome=function(){return 0<=window.navigator.userAgent.indexOf("Chrome")},ChartInternal.prototype.initZoom=function(){var startEvent,$$=this,d3=$$.d3,config=$$.config;return $$.zoom=d3.zoom().on("start",function(){var e;"scroll"===config.zoom_type&&((e=d3.event.sourceEvent)&&"brush"===e.type||(startEvent=e,config.zoom_onzoomstart.call($$.api,e)))}).on("zoom",function(){var e;"scroll"===config.zoom_type&&((e=d3.event.sourceEvent)&&"brush"===e.type||($$.redrawForZoom(),config.zoom_onzoom.call($$.api,$$.x.orgDomain())))}).on("end",function(){var e;"scroll"===config.zoom_type&&((e=d3.event.sourceEvent)&&"brush"===e.type||e&&startEvent.clientX===e.clientX&&startEvent.clientY===e.clientY||config.zoom_onzoomend.call($$.api,$$.x.orgDomain()))}),$$.zoom.updateDomain=function(){return d3.event&&d3.event.transform&&$$.x.domain(d3.event.transform.rescaleX($$.subX).domain()),this},$$.zoom.updateExtent=function(){return this.scaleExtent([1,1/0]).translateExtent([[0,0],[$$.width,$$.height]]).extent([[0,0],[$$.width,$$.height]]),this},$$.zoom.update=function(){return this.updateExtent().updateDomain()},$$.zoom.updateExtent()},ChartInternal.prototype.zoomTransform=function(s){s=[this.x(s[0]),this.x(s[1])];return this.d3.zoomIdentity.scale(this.width/(s[1]-s[0])).translate(-s[0],0)},ChartInternal.prototype.initDragZoom=function(){var getZoomedDomain,brush,$$=this,d3=$$.d3,config=$$.config,context=$$.context=$$.svg,brushXPos=$$.margin.left+20.5,brushYPos=$$.margin.top+.5;"drag"===config.zoom_type&&config.zoom_enabled&&(getZoomedDomain=function getZoomedDomain(selection){return selection&&selection.map(function(x){return $$.x.invert(x)})},brush=$$.dragZoomBrush=d3.brushX().on("start",function(){$$.api.unzoom(),$$.svg.select("."+CLASS.dragZoom).classed("disabled",!1),config.zoom_onzoomstart.call($$.api,d3.event.sourceEvent)}).on("brush",function(){config.zoom_onzoom.call($$.api,getZoomedDomain(d3.event.selection))}).on("end",function(){var zoomedDomain;null!=d3.event.selection&&(zoomedDomain=getZoomedDomain(d3.event.selection),config.zoom_disableDefaultBehavior||$$.api.zoom(zoomedDomain),$$.svg.select("."+CLASS.dragZoom).classed("disabled",!0),config.zoom_onzoomend.call($$.api,zoomedDomain))}),context.append("g").classed(CLASS.dragZoom,!0).attr("clip-path",$$.clipPath).attr("transform","translate("+brushXPos+","+brushYPos+")").call(brush))},ChartInternal.prototype.getZoomDomain=function(){var config=this.config,d3=this.d3;return[d3.min([this.orgXDomain[0],config.zoom_x_min]),d3.max([this.orgXDomain[1],config.zoom_x_max])]},ChartInternal.prototype.redrawForZoom=function(){var $$=this,d3=$$.d3,config=$$.config,zoom=$$.zoom,x=$$.x;config.zoom_enabled&&0!==$$.filterTargetsToShow($$.data.targets).length&&(zoom.update(),config.zoom_disableDefaultBehavior||($$.isCategorized()&&x.orgDomain()[0]===$$.orgXDomain[0]&&x.domain([$$.orgXDomain[0]-1e-10,x.orgDomain()[1]]),$$.redraw({withTransition:!1,withY:config.zoom_rescale,withSubchart:!1,withEventRect:!1,withDimension:!1}),d3.event.sourceEvent&&"mousemove"===d3.event.sourceEvent.type&&($$.cancelClick=!0)))},c3}),function s(r,a,l){function u(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}i=a[e]={exports:{}};r[e][0].call(i.exports,function(t){return u(r[e][1][t]||t)},i,i.exports,s,r,a,l)}return a[e].exports}for(var h="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(t,e,o){var s=t("./svg-utilities");e.exports={enable:function(t){var e=t.svg.querySelector("defs");e||(e=document.createElementNS(s.svgNS,"defs"),t.svg.appendChild(e)),e.querySelector("style#svg-pan-zoom-controls-styles")||((n=document.createElementNS(s.svgNS,"style")).setAttribute("id","svg-pan-zoom-controls-styles"),n.setAttribute("type","text/css"),n.textContent=".svg-pan-zoom-control { cursor: pointer; fill: black; fill-opacity: 0.333; } .svg-pan-zoom-control:hover { fill-opacity: 0.8; } .svg-pan-zoom-control-background { fill: white; fill-opacity: 0.5; } .svg-pan-zoom-control-background { fill-opacity: 0.8; }",e.appendChild(n));var n=document.createElementNS(s.svgNS,"g");n.setAttribute("id","svg-pan-zoom-controls"),n.setAttribute("transform","translate("+(t.width-70)+" "+(t.height-76)+") scale(0.75)"),n.setAttribute("class","svg-pan-zoom-control"),n.appendChild(this._createZoomIn(t)),n.appendChild(this._createZoomReset(t)),n.appendChild(this._createZoomOut(t)),t.svg.appendChild(n),t.controlIcons=n},_createZoomIn:function(t){var e=document.createElementNS(s.svgNS,"g");e.setAttribute("id","svg-pan-zoom-zoom-in"),e.setAttribute("transform","translate(30.5 5) scale(0.015)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().zoomIn()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().zoomIn()},!1);var n=document.createElementNS(s.svgNS,"rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","1500"),n.setAttribute("height","1400"),n.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(n);n=document.createElementNS(s.svgNS,"path");return n.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-320v320q0 26 -19 45t-45 19h-128q-26 0 -45 -19t-19 -45v-320h-320q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h320v-320q0 -26 19 -45t45 -19h128q26 0 45 19t19 45v320h320q26 0 45 19t19 45zM1536 1120v-960 q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5t84.5 -203.5z"),n.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(n),e},_createZoomReset:function(t){var e=document.createElementNS(s.svgNS,"g");e.setAttribute("id","svg-pan-zoom-reset-pan-zoom"),e.setAttribute("transform","translate(5 35) scale(0.4)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().reset()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().reset()},!1);var i=document.createElementNS(s.svgNS,"rect");i.setAttribute("x","2"),i.setAttribute("y","2"),i.setAttribute("width","182"),i.setAttribute("height","58"),i.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(i);i=document.createElementNS(s.svgNS,"path");i.setAttribute("d","M33.051,20.632c-0.742-0.406-1.854-0.609-3.338-0.609h-7.969v9.281h7.769c1.543,0,2.701-0.188,3.473-0.562c1.365-0.656,2.048-1.953,2.048-3.891C35.032,22.757,34.372,21.351,33.051,20.632z"),i.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(i);i=document.createElementNS(s.svgNS,"path");return i.setAttribute("d","M170.231,0.5H15.847C7.102,0.5,0.5,5.708,0.5,11.84v38.861C0.5,56.833,7.102,61.5,15.847,61.5h154.384c8.745,0,15.269-4.667,15.269-10.798V11.84C185.5,5.708,178.976,0.5,170.231,0.5z M42.837,48.569h-7.969c-0.219-0.766-0.375-1.383-0.469-1.852c-0.188-0.969-0.289-1.961-0.305-2.977l-0.047-3.211c-0.03-2.203-0.41-3.672-1.142-4.406c-0.732-0.734-2.103-1.102-4.113-1.102h-7.05v13.547h-7.055V14.022h16.524c2.361,0.047,4.178,0.344,5.45,0.891c1.272,0.547,2.351,1.352,3.234,2.414c0.731,0.875,1.31,1.844,1.737,2.906s0.64,2.273,0.64,3.633c0,1.641-0.414,3.254-1.242,4.84s-2.195,2.707-4.102,3.363c1.594,0.641,2.723,1.551,3.387,2.73s0.996,2.98,0.996,5.402v2.32c0,1.578,0.063,2.648,0.19,3.211c0.19,0.891,0.635,1.547,1.333,1.969V48.569z M75.579,48.569h-26.18V14.022h25.336v6.117H56.454v7.336h16.781v6H56.454v8.883h19.125V48.569z M104.497,46.331c-2.44,2.086-5.887,3.129-10.34,3.129c-4.548,0-8.125-1.027-10.731-3.082s-3.909-4.879-3.909-8.473h6.891c0.224,1.578,0.662,2.758,1.316,3.539c1.196,1.422,3.246,2.133,6.15,2.133c1.739,0,3.151-0.188,4.236-0.562c2.058-0.719,3.087-2.055,3.087-4.008c0-1.141-0.504-2.023-1.512-2.648c-1.008-0.609-2.607-1.148-4.796-1.617l-3.74-0.82c-3.676-0.812-6.201-1.695-7.576-2.648c-2.328-1.594-3.492-4.086-3.492-7.477c0-3.094,1.139-5.664,3.417-7.711s5.623-3.07,10.036-3.07c3.685,0,6.829,0.965,9.431,2.895c2.602,1.93,3.966,4.73,4.093,8.402h-6.938c-0.128-2.078-1.057-3.555-2.787-4.43c-1.154-0.578-2.587-0.867-4.301-0.867c-1.907,0-3.428,0.375-4.565,1.125c-1.138,0.75-1.706,1.797-1.706,3.141c0,1.234,0.561,2.156,1.682,2.766c0.721,0.406,2.25,0.883,4.589,1.43l6.063,1.43c2.657,0.625,4.648,1.461,5.975,2.508c2.059,1.625,3.089,3.977,3.089,7.055C108.157,41.624,106.937,44.245,104.497,46.331z M139.61,48.569h-26.18V14.022h25.336v6.117h-18.281v7.336h16.781v6h-16.781v8.883h19.125V48.569z M170.337,20.14h-10.336v28.43h-7.266V20.14h-10.383v-6.117h27.984V20.14z"),i.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(i),e},_createZoomOut:function(t){var e=document.createElementNS(s.svgNS,"g");e.setAttribute("id","svg-pan-zoom-zoom-out"),e.setAttribute("transform","translate(30.5 70) scale(0.015)"),e.setAttribute("class","svg-pan-zoom-control"),e.addEventListener("click",function(){t.getPublicInstance().zoomOut()},!1),e.addEventListener("touchstart",function(){t.getPublicInstance().zoomOut()},!1);var n=document.createElementNS(s.svgNS,"rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","1500"),n.setAttribute("height","1400"),n.setAttribute("class","svg-pan-zoom-control-background"),e.appendChild(n);n=document.createElementNS(s.svgNS,"path");return n.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-896q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h896q26 0 45 19t19 45zM1536 1120v-960q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5 t84.5 -203.5z"),n.setAttribute("class","svg-pan-zoom-control-element"),e.appendChild(n),e},disable:function(t){t.controlIcons&&(t.controlIcons.parentNode.removeChild(t.controlIcons),t.controlIcons=null)}}},{"./svg-utilities":5}],2:[function(t,e,o){function n(t,e){this.init(t,e)}var i=t("./svg-utilities"),r=t("./utilities");n.prototype.init=function(t,o){this.viewport=t,this.options=o,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=r.proxy(this.updateCTM,this),this.requestAnimationFrame=r.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();o=this.processCTM();this.setCTM(o),this.updateCTM()},n.prototype.cacheViewBox=function(){var o=this.options.svg.getAttribute("viewBox");o?(o=o.split(/[\s\,]/).filter(function(t){return t}).map(parseFloat),this.viewBox.x=o[0],this.viewBox.y=o[1],this.viewBox.width=o[2],this.viewBox.height=o[3],o=Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),this.activeState.zoom=o,this.activeState.x=(this.options.width-this.viewBox.width*o)/2,this.activeState.y=(this.options.height-this.viewBox.height*o)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")):this.simpleViewBoxCache()},n.prototype.simpleViewBoxCache=function(){var t=this.viewport.getBBox();this.viewBox.x=t.x,this.viewBox.y=t.y,this.viewBox.width=t.width,this.viewBox.height=t.height},n.prototype.getViewBox=function(){return r.extend({},this.viewBox)},n.prototype.processCTM=function(){var o,n,e=this.getCTM();return(this.options.fit||this.options.contain)&&(n=this.options.fit?Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):Math.max(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),e.a=n,e.d=n,e.e=-this.viewBox.x*n,e.f=-this.viewBox.y*n),this.options.center&&(o=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*e.a),n=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*e.a),e.e=o,e.f=n),this.originalState.zoom=e.a,this.originalState.x=e.e,this.originalState.y=e.f,e},n.prototype.getOriginalState=function(){return r.extend({},this.originalState)},n.prototype.getState=function(){return r.extend({},this.activeState)},n.prototype.getZoom=function(){return this.activeState.zoom},n.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},n.prototype.computeRelativeZoom=function(t){return t/this.originalState.zoom},n.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},n.prototype.getCTM=function(){var t=this.options.svg.createSVGMatrix();return t.a=this.activeState.zoom,t.b=0,t.c=0,t.d=this.activeState.zoom,t.e=this.activeState.x,t.f=this.activeState.y,t},n.prototype.setCTM=function(t){var n,i,s,e=this.isZoomDifferent(t),o=this.isPanDifferent(t);(e||o)&&(e&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(t.a))?(t.a=t.d=this.activeState.zoom,e=!1):(this.updateCache(t),this.options.onZoom(this.getRelativeZoom()))),o&&((s=i=!1)===(n=this.options.beforePan(this.getPan(),{x:t.e,y:t.f}))?(t.e=this.getPan().x,t.f=this.getPan().y,i=s=!0):r.isObject(n)&&(!1===n.x?(t.e=this.getPan().x,i=!0):r.isNumber(n.x)&&(t.e=n.x),!1===n.y?(t.f=this.getPan().y,s=!0):r.isNumber(n.y)&&(t.f=n.y)),i&&s||!this.isPanDifferent(t)?o=!1:(this.updateCache(t),this.options.onPan(this.getPan()))),(e||o)&&this.updateCTMOnNextFrame())},n.prototype.isZoomDifferent=function(t){return this.activeState.zoom!==t.a},n.prototype.isPanDifferent=function(t){return this.activeState.x!==t.e||this.activeState.y!==t.f},n.prototype.updateCache=function(t){this.activeState.zoom=t.a,this.activeState.x=t.e,this.activeState.y=t.f},n.prototype.pendingUpdate=!1,n.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},n.prototype.updateCTM=function(){var t=this.getCTM();i.setCTM(this.viewport,t,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(t)},e.exports=function(t,e){return new n(t,e)}},{"./svg-utilities":5,"./utilities":7}],3:[function(n,e,o){var i=n("./svg-pan-zoom.js"),n=window;document,"function"==typeof define&&define.amd?define("svg-pan-zoom",[],function(){return i}):void 0!==e&&e.exports&&(e.exports=i,n.svgPanZoom=i)},{"./svg-pan-zoom.js":4}],4:[function(t,e,o){function i(t,e){this.init(t,e)}var n=t("./uniwheel"),s=t("./control-icons"),r=t("./utilities"),a=t("./svg-utilities"),l=t("./shadow-viewport"),u={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null},h={passive:!0};i.prototype.init=function(i,e){var o=this;this.svg=i,this.defs=i.querySelector("defs"),a.setupSvgAttributes(this.svg),this.options=r.extend(r.extend({},u),e),this.state="none";i=a.getBoundingClientRectNormalized(i);this.width=i.width,this.height=i.height,this.viewport=l(a.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(t,e){if(o.viewport&&o.options.beforeZoom)return o.options.beforeZoom(t,e)},onZoom:function(t){if(o.viewport&&o.options.onZoom)return o.options.onZoom(t)},beforePan:function(t,e){if(o.viewport&&o.options.beforePan)return o.options.beforePan(t,e)},onPan:function(t){if(o.viewport&&o.options.onPan)return o.options.onPan(t)},onUpdatedCTM:function(t){if(o.viewport&&o.options.onUpdatedCTM)return o.options.onUpdatedCTM(t)}});i=this.getPublicInstance();i.setBeforeZoom(this.options.beforeZoom),i.setOnZoom(this.options.onZoom),i.setBeforePan(this.options.beforePan),i.setOnPan(this.options.onPan),i.setOnUpdatedCTM(this.options.onUpdatedCTM),this.options.controlIconsEnabled&&s.enable(this),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},i.prototype.setupHandlers=function(){var i,o=this,n=null;if(this.eventListeners={mousedown:function(t){var e=o.handleMouseDown(t,n);return n=t,e},touchstart:function(t){var e=o.handleMouseDown(t,n);return n=t,e},mouseup:function(t){return o.handleMouseUp(t)},touchend:function(t){return o.handleMouseUp(t)},mousemove:function(t){return o.handleMouseMove(t)},touchmove:function(t){return o.handleMouseMove(t)},mouseleave:function(t){return o.handleMouseUp(t)},touchleave:function(t){return o.handleMouseUp(t)},touchcancel:function(t){return o.handleMouseUp(t)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var t=this.options.customEventsHandler.haltEventListeners;if(t&&t.length)for(var e=t.length-1;0<=e;e--)this.eventListeners.hasOwnProperty(t[e])&&delete this.eventListeners[t[e]]}for(i in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(i,this.eventListeners[i],!this.options.preventMouseEventsDefault&&h);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},i.prototype.enableMouseWheelZoom=function(){var e,t;this.options.mouseWheelZoomEnabled||((e=this).wheelListener=function(t){return e.handleMouseWheel(t)},t=!this.options.preventMouseEventsDefault,n.on(this.options.eventsListenerElement||this.svg,this.wheelListener,t),this.options.mouseWheelZoomEnabled=!0)},i.prototype.disableMouseWheelZoom=function(){var t;this.options.mouseWheelZoomEnabled&&(t=!this.options.preventMouseEventsDefault,n.off(this.options.eventsListenerElement||this.svg,this.wheelListener,t),this.options.mouseWheelZoomEnabled=!1)},i.prototype.handleMouseWheel=function(t){var s,r;this.options.zoomEnabled&&"none"===this.state&&(this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),r=t.deltaY||1,s=Date.now()-this.lastMouseWheelEventTime,s=3+Math.max(0,30-s),this.lastMouseWheelEventTime=Date.now(),r=-.3<(r="deltaMode"in t&&0===t.deltaMode&&t.wheelDelta?0===t.deltaY?0:Math.abs(t.wheelDelta)/t.deltaY:r)&&r<.3?r:(0<r?1:-1)*Math.log(Math.abs(r)+10)/s,s=this.svg.getScreenCTM().inverse(),s=a.getEventPoint(t,this.svg).matrixTransform(s),r=Math.pow(1+this.options.zoomScaleSensitivity,-1*r),this.zoomAtPoint(r,s))},i.prototype.zoomAtPoint=function(t,a,o){var i=this.viewport.getOriginalState();o?(t=Math.max(this.options.minZoom*i.zoom,Math.min(this.options.maxZoom*i.zoom,t)),t/=this.getZoom()):this.getZoom()*t<this.options.minZoom*i.zoom?t=this.options.minZoom*i.zoom/this.getZoom():this.getZoom()*t>this.options.maxZoom*i.zoom&&(t=this.options.maxZoom*i.zoom/this.getZoom());i=this.viewport.getCTM(),a=a.matrixTransform(i.inverse()),a=this.svg.createSVGMatrix().translate(a.x,a.y).scale(t).translate(-a.x,-a.y),a=i.multiply(a);a.a!==i.a&&this.viewport.setCTM(a)},i.prototype.zoom=function(t,e){this.zoomAtPoint(t,a.getSvgCenterPoint(this.svg,this.width,this.height),e)},i.prototype.publicZoom=function(t,e){e&&(t=this.computeFromRelativeZoom(t)),this.zoom(t,e)},i.prototype.publicZoomAtPoint=function(t,e,o){if(o&&(t=this.computeFromRelativeZoom(t)),"SVGPoint"!==r.getType(e)){if(!("x"in e&&"y"in e))throw new Error("Given point is invalid");e=a.createSVGPoint(this.svg,e.x,e.y)}this.zoomAtPoint(t,e,o)},i.prototype.getZoom=function(){return this.viewport.getZoom()},i.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},i.prototype.computeFromRelativeZoom=function(t){return t*this.viewport.getOriginalState().zoom},i.prototype.resetZoom=function(){var t=this.viewport.getOriginalState();this.zoom(t.zoom,!0)},i.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},i.prototype.reset=function(){this.resetZoom(),this.resetPan()},i.prototype.handleDblClick=function(o){if(this.options.preventMouseEventsDefault&&(o.preventDefault?o.preventDefault():o.returnValue=!1),this.options.controlIconsEnabled&&-1<(o.target.getAttribute("class")||"").indexOf("svg-pan-zoom-control"))return!1;var e=o.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity),o=a.getEventPoint(o,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(e,o)},i.prototype.handleMouseDown=function(t,e){this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),r.mouseAndTouchNormalize(t,this.svg),this.options.dblClickZoomEnabled&&r.isDblClick(t,e)?this.handleDblClick(t):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=a.getEventPoint(t,this.svg).matrixTransform(this.firstEventCTM.inverse()))},i.prototype.handleMouseMove=function(o){this.options.preventMouseEventsDefault&&(o.preventDefault?o.preventDefault():o.returnValue=!1),"pan"===this.state&&this.options.panEnabled&&(o=a.getEventPoint(o,this.svg).matrixTransform(this.firstEventCTM.inverse()),o=this.firstEventCTM.translate(o.x-this.stateOrigin.x,o.y-this.stateOrigin.y),this.viewport.setCTM(o))},i.prototype.handleMouseUp=function(t){this.options.preventMouseEventsDefault&&(t.preventDefault?t.preventDefault():t.returnValue=!1),"pan"===this.state&&(this.state="none")},i.prototype.fit=function(){var e=this.viewport.getViewBox(),e=Math.min(this.width/e.width,this.height/e.height);this.zoom(e,!0)},i.prototype.contain=function(){var e=this.viewport.getViewBox(),e=Math.max(this.width/e.width,this.height/e.height);this.zoom(e,!0)},i.prototype.center=function(){var o=this.viewport.getViewBox(),e=.5*(this.width-(o.width+2*o.x)*this.getZoom()),o=.5*(this.height-(o.height+2*o.y)*this.getZoom());this.getPublicInstance().pan({x:e,y:o})},i.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},i.prototype.pan=function(t){var e=this.viewport.getCTM();e.e=t.x,e.f=t.y,this.viewport.setCTM(e)},i.prototype.panBy=function(t){var e=this.viewport.getCTM();e.e+=t.x,e.f+=t.y,this.viewport.setCTM(e)},i.prototype.getPan=function(){var t=this.viewport.getState();return{x:t.x,y:t.y}},i.prototype.resize=function(){var e=a.getBoundingClientRectNormalized(this.svg);this.width=e.width,this.height=e.height;e=this.viewport;e.options.width=this.width,e.options.height=this.height,e.processCTM(),this.options.controlIconsEnabled&&(this.getPublicInstance().disableControlIcons(),this.getPublicInstance().enableControlIcons())},i.prototype.destroy=function(){var t,e=this;for(t in this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,(this.onUpdatedCTM=null)!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()}),this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(t,this.eventListeners[t],!this.options.preventMouseEventsDefault&&h);this.disableMouseWheelZoom(),this.getPublicInstance().disableControlIcons(),this.reset(),c=c.filter(function(t){return t.svg!==e.svg}),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},i.prototype.getPublicInstance=function(){var o=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return o.options.panEnabled=!0,o.pi},disablePan:function(){return o.options.panEnabled=!1,o.pi},isPanEnabled:function(){return!!o.options.panEnabled},pan:function(t){return o.pan(t),o.pi},panBy:function(t){return o.panBy(t),o.pi},getPan:function(){return o.getPan()},setBeforePan:function(t){return o.options.beforePan=null===t?null:r.proxy(t,o.publicInstance),o.pi},setOnPan:function(t){return o.options.onPan=null===t?null:r.proxy(t,o.publicInstance),o.pi},enableZoom:function(){return o.options.zoomEnabled=!0,o.pi},disableZoom:function(){return o.options.zoomEnabled=!1,o.pi},isZoomEnabled:function(){return!!o.options.zoomEnabled},enableControlIcons:function(){return o.options.controlIconsEnabled||(o.options.controlIconsEnabled=!0,s.enable(o)),o.pi},disableControlIcons:function(){return o.options.controlIconsEnabled&&(o.options.controlIconsEnabled=!1,s.disable(o)),o.pi},isControlIconsEnabled:function(){return!!o.options.controlIconsEnabled},enableDblClickZoom:function(){return o.options.dblClickZoomEnabled=!0,o.pi},disableDblClickZoom:function(){return o.options.dblClickZoomEnabled=!1,o.pi},isDblClickZoomEnabled:function(){return!!o.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return o.enableMouseWheelZoom(),o.pi},disableMouseWheelZoom:function(){return o.disableMouseWheelZoom(),o.pi},isMouseWheelZoomEnabled:function(){return!!o.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(t){return o.options.zoomScaleSensitivity=t,o.pi},setMinZoom:function(t){return o.options.minZoom=t,o.pi},setMaxZoom:function(t){return o.options.maxZoom=t,o.pi},setBeforeZoom:function(t){return o.options.beforeZoom=null===t?null:r.proxy(t,o.publicInstance),o.pi},setOnZoom:function(t){return o.options.onZoom=null===t?null:r.proxy(t,o.publicInstance),o.pi},zoom:function(t){return o.publicZoom(t,!0),o.pi},zoomBy:function(t){return o.publicZoom(t,!1),o.pi},zoomAtPoint:function(t,e){return o.publicZoomAtPoint(t,e,!0),o.pi},zoomAtPointBy:function(t,e){return o.publicZoomAtPoint(t,e,!1),o.pi},zoomIn:function(){return this.zoomBy(1+o.options.zoomScaleSensitivity),o.pi},zoomOut:function(){return this.zoomBy(1/(1+o.options.zoomScaleSensitivity)),o.pi},getZoom:function(){return o.getRelativeZoom()},setOnUpdatedCTM:function(t){return o.options.onUpdatedCTM=null===t?null:r.proxy(t,o.publicInstance),o.pi},resetZoom:function(){return o.resetZoom(),o.pi},resetPan:function(){return o.resetPan(),o.pi},reset:function(){return o.reset(),o.pi},fit:function(){return o.fit(),o.pi},contain:function(){return o.contain(),o.pi},center:function(){return o.center(),o.pi},updateBBox:function(){return o.updateBBox(),o.pi},resize:function(){return o.resize(),o.pi},getSizes:function(){return{width:o.width,height:o.height,realZoom:o.getZoom(),viewBox:o.viewport.getViewBox()}},destroy:function(){return o.destroy(),o.pi}}),this.publicInstance};var c=[];e.exports=function(t,e){var o=r.getSvg(t);if(null===o)return null;for(var n=c.length-1;0<=n;n--)if(c[n].svg===o)return c[n].instance.getPublicInstance();return c.push({svg:o,instance:new i(o,e)}),c[c.length-1].instance.getPublicInstance()}},{"./control-icons":1,"./shadow-viewport":2,"./svg-utilities":5,"./uniwheel":6,"./utilities":7}],5:[function(t,e,o){var l=t("./utilities"),s="unknown";document.documentMode&&(s="ie"),e.exports={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(t){if(t.clientWidth&&t.clientHeight)return{width:t.clientWidth,height:t.clientHeight};if(t.getBoundingClientRect())return t.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(a,e){var o=null;if((o=l.isElement(e)?e:a.querySelector(e))||1===(i=Array.prototype.slice.call(a.childNodes||a.children).filter(function(t){return"defs"!==t.nodeName&&"#text"!==t.nodeName})).length&&"g"===i[0].nodeName&&null===i[0].getAttribute("transform")&&(o=i[0]),!o){var i="viewport-"+(new Date).toISOString().replace(/\D/g,"");(o=document.createElementNS(this.svgNS,"g")).setAttribute("id",i);var s=a.childNodes||a.children;if(s&&0<s.length)for(var r=s.length;0<r;r--)"defs"!==s[s.length-r].nodeName&&o.appendChild(s[s.length-r]);a.appendChild(o)}a=[];return~(a=o.getAttribute("class")?o.getAttribute("class").split(" "):a).indexOf("svg-pan-zoom_viewport")||(a.push("svg-pan-zoom_viewport"),o.setAttribute("class",a.join(" "))),o},setupSvgAttributes:function(t){var e;t.setAttribute("xmlns",this.svgNS),t.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),t.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==t.parentNode&&-1===(e=t.getAttribute("style")||"").toLowerCase().indexOf("overflow")&&t.setAttribute("style","overflow: hidden; "+e)},internetExplorerRedisplayInterval:300,refreshDefsGlobal:l.throttle(function(){for(var t=document.querySelectorAll("defs"),e=t.length,o=0;o<e;o++){var n=t[o];n.parentNode.insertBefore(n,n)}},this?this.internetExplorerRedisplayInterval:null),setCTM:function(t,i,o){var n=this,i="matrix("+i.a+","+i.b+","+i.c+","+i.d+","+i.e+","+i.f+")";t.setAttributeNS(null,"transform",i),"transform"in t.style?t.style.transform=i:"-ms-transform"in t.style?t.style["-ms-transform"]=i:"-webkit-transform"in t.style&&(t.style["-webkit-transform"]=i),"ie"===s&&o&&(o.parentNode.insertBefore(o,o),window.setTimeout(function(){n.refreshDefsGlobal()},n.internetExplorerRedisplayInterval))},getEventPoint:function(t,e){var o=e.createSVGPoint();return l.mouseAndTouchNormalize(t,e),o.x=t.clientX,o.y=t.clientY,o},getSvgCenterPoint:function(t,e,o){return this.createSVGPoint(t,e/2,o/2)},createSVGPoint:function(n,e,o){n=n.createSVGPoint();return n.x=e,n.y=o,n}}},{"./utilities":7}],6:[function(t,e,o){function n(t,e,i,n){i="wheel"==a?i:function(t,o){function e(t){var e={originalEvent:t=t||window.event,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==a?(e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX)):e.deltaY=t.detail,o(e)}return u.push({element:t,fn:e}),e}(t,i);t[s](l+e,i,!!n&&h)}function i(t,e,i,n){i="wheel"==a?i:function(t){for(var e=0;e<u.length;e++)if(u[e].element===t)return u[e].fn;return function(){}}(t);t[r](l+e,i,!!n&&h),function(t){for(var e=0;e<u.length;e++)if(u[e].element===t)return u.splice(e,1)}(t)}var s,r,a,l,u,h;e.exports=(u=[],h={passive:!(l="")},window.addEventListener?(s="addEventListener",r="removeEventListener"):(s="attachEvent",r="detachEvent",l="on"),a="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",{on:function(t,e,o){n(t,a,e,o),"DOMMouseScroll"==a&&n(t,"MozMousePixelScroll",e,o)},off:function(t,e,o){i(t,a,e,o),"DOMMouseScroll"==a&&i(t,"MozMousePixelScroll",e,o)}})},{}],7:[function(t,e,o){function n(e){return function(t){window.setTimeout(t,e)}}e.exports={extend:function(t,e){for(var o in t=t||{},e)this.isObject(e[o])?t[o]=this.extend(t[o],e[o]):t[o]=e[o];return t},isElement:function(t){return t instanceof HTMLElement||t instanceof SVGElement||t instanceof SVGSVGElement||t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},getSvg:function(t){var e,o;if(this.isElement(t))e=t;else{if(!("string"==typeof t||t instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(!(e=document.querySelector(t)))throw new Error("Provided selector did not find any elements. Selector: "+t)}if("svg"===e.tagName.toLowerCase())o=e;else if("object"===e.tagName.toLowerCase())o=e.contentDocument.documentElement;else{if("embed"!==e.tagName.toLowerCase())throw"img"===e.tagName.toLowerCase()?new Error('Cannot script an SVG in an "img" element. Please use an "object" element or an in-line SVG.'):new Error("Cannot get SVG.");o=e.getSVGDocument().documentElement}return o},proxy:function(t,e){return function(){return t.apply(e,arguments)}},getType:function(t){return Object.prototype.toString.apply(t).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(t,o){void 0!==t.clientX&&null!==t.clientX||(t.clientX=0,void(t.clientY=0)!==t.touches&&t.touches.length?void 0!==t.touches[0].clientX?(t.clientX=t.touches[0].clientX,t.clientY=t.touches[0].clientY):void 0!==t.touches[0].pageX&&(o=o.getBoundingClientRect(),t.clientX=t.touches[0].pageX-o.left,t.clientY=t.touches[0].pageY-o.top):void 0!==t.originalEvent&&void 0!==t.originalEvent.clientX&&(t.clientX=t.originalEvent.clientX,t.clientY=t.originalEvent.clientY))},isDblClick:function(t,n){if(2===t.detail)return!0;if(null==n)return!1;var o=t.timeStamp-n.timeStamp,n=Math.sqrt(Math.pow(t.clientX-n.clientX,2)+Math.pow(t.clientY-n.clientY,2));return o<250&&n<10},now:Date.now||function(){return(new Date).getTime()},throttle:function(o,n,i){var s,r,a,l=this,u=null,h=0;function c(){h=!1===i.leading?0:l.now(),u=null,a=o.apply(s,r),u||(s=r=null)}return i=i||{},function(){var t=l.now();h||!1!==i.leading||(h=t);var e=n-(t-h);return s=this,r=arguments,e<=0||n<e?(clearTimeout(u),u=null,h=t,a=o.apply(s,r),u||(s=r=null)):u||!1===i.trailing||(u=setTimeout(c,e)),a}},createRequestAnimationFrame:function(t){var e=null;return null===(e="auto"!==t&&t<60&&1<t?Math.floor(1e3/t):e)?window.requestAnimationFrame||n(33):n(e)}}},{}]},{},[3]),define("jswish",["jquery","config","preferences","history","modal","backend","chat","splitter","bootstrap","pane","tabbed","notebook","navbar","search","editor","query","runner","term","laconic","login","chatroom","version","d3","c3","svg-pan-zoom"],function($,config,preferences,history,modal,backend){return preferences.setDefault("semantic-highlighting",!0),preferences.setDefault("emacs-keybinding",!1),preferences.setDefault("new-tab",!0),preferences.setDefault("preserve-state",!0),preferences.setDefault("auto-binding-layout",!0),preferences.setInform("preserve-state",".unloadable"),function($){function glyph(name,func){return func.glyph=name,func}var defaults={menu:{File:{"Save ...":glyph("cloud-upload",function(){menuBroadcast("save","as")}),"Info & history ...":glyph("info-sign",function(){menuBroadcast("fileInfo")}),Reload:glyph("refresh",function(){menuBroadcast("reload")}),"Open recent":{type:"submenu",glyph:"paperclip",action:function(ev){history.openRecent(ev,$(this).data("document"))},update:history.updateRecentUL},Share:"--","Follow ...":config.http.locations.follow_file_options?glyph("eye-open",function(){menuBroadcast("follow-file")}):void 0,"Start TogetherJS ...":function icon(name,func){return func.typeIcon=name,func}("togetherjs",function(){$("body").swish("collaborate")}),Export:"--",Download:glyph("floppy-save",function(){menuBroadcast("download")}),"Print ...":glyph("print",function(){menuBroadcast("print")})},Edit:{"Clear messages":function(){menuBroadcast("clearMessages")},Changes:"--","View changes":function(){menuBroadcast("diff")},Edit:"--","Find (Ctrl-F)":function(){menuBroadcast("edit-command","find")},"Find and replace (Shift-Ctrl-F)":function(){menuBroadcast("edit-command","replace")},"Jump to line (Alt-G)":function(){menuBroadcast("edit-command","jumpToLine")},Options:"--","Semantic highlighting":{preference:"semantic-highlighting",type:"checkbox"},"Emacs Keybinding":{preference:"emacs-keybinding",type:"checkbox",value:"false"},"Smart binding layout":{preference:"auto-binding-layout",type:"checkbox",value:"true"},"Open document in new tab":{preference:"new-tab",type:"checkbox",value:"true"},"Preserve state in browser":{preference:"preserve-state",type:"checkbox",value:"true"}},Examples:function(navbar,dropdown){$("body").swish("populateExamples",navbar,dropdown)},Help:function(navbar,dropdown){$("body").swish("populateHelp",navbar,dropdown)}}},methods={_init:function(options){return function swishLogo(){$(".swish-logo").append($.el.b($.el.span({style:"color:darkblue"},"SWI"),$.el.span({style:"color:maroon"},"SH"))).css("margin-left","30px").css("font-size","24px").addClass("navbar-brand")}(),function setupModal(){0==$("#modal").length&&($("body").append($.el.div({id:"modal"})),$("#modal").swishModal())}(),function setupPanes(){$(".tile").tile(),$(window).resize(function(){$(".tile").tile("resize")}),$(".tabbed").tabbed()}(),function setupResize(){$(window).resize(function(){$(".reactive-size").trigger("reactive-resize")})}(),function setupUnload(){$(window).bind("beforeunload",function(ev){var rc;return $(".unloadable").each(function(){var r={};$(this).trigger("unload",r),rc=rc||r.rc}),rc})}(),$("#search").search(),options=options||{},this.addClass("swish"),this.each(function(){var elem=$(this),data={};$("#navbar").navbar(defaults.menu),$("#login").login();var editor=$(".prolog-editor").prologEditor({save:!0});data.runner=$(".prolog-runners").prologRunners(),data.query=$(".prolog-query").queryEditor({source:function(){return elem.swish("prologSource")},sourceID:function(){return editor.prologEditor("getSourceID")},examples:elem.swish("examples"),runner:data.runner,editor:editor[0]}),elem.data("swish",data),data.restoring=!0,$(".notebook").notebook(),!options.show_beware||swish.option&&0==swish.option.show_beware||menuBroadcast("help",{file:"beware.html",notagain:"beware"}),0<window.location.href.indexOf("&togetherjs=")&&elem.swish("collaborate"),$("#chat").chat(""),$("#broadcast-bell").chatbell({empty_title:"Click to open chat"}),$("#chat-menu").on("click","a",function(ev){switch($(ev.target).closest("a").data("action")){case"chat-shared":$("body").swish("playFile",{file:config.swish.hangout,chat:"large"});break;case"chat-about-file":menuBroadcast("chat-about-file")}}),config.swish.redis&&(showBackends=function(){backend.selectBackend()},showBackends.glyph="flash",showBackends.after="Open recent",$("#navbar").navbar("populateDropdown","File",{"Backends ...":showBackends})),setInterval(function(){$(".each-minute").trigger("minute")},6e4),elem.swish("preserve_state")&&$(".unloadable").trigger("restore"),delete data.restoring,elem.swish("runDelayedRestore"),$().version("checkForUpdates"),elem.trigger("post-config")})},preserve_state:function(){return 0!=swish.option.preserve_state&&(0!=preferences.getVal("preserve-state")&&"false"!=function getQueryVariable(variable){for(var vars=window.location.search.substring(1).split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(decodeURIComponent(pair[0])==variable)return decodeURIComponent(pair[1])}}("restore"))},afterRestore:function(f){var data=this.data("swish");return data.after_restore?data.after_restore.push(f):data.after_restore=[f],this},runDelayedRestore:function(){var f,data=this.data("swish");if(data.after_restore)for(;f=data.after_restore.pop();)f.call(this);return this},trigger:function(name,data){return menuBroadcast(name,data),this},playFile:function(options){var elem=this;"string"==typeof options&&(options={file:options});var existing=this.find(".storage").storage("match",options);if(existing&&existing.storage("expose","Already open"))return this;var url=config.http.locations.web_storage+options.file;return backend.ajax({url:url,type:"GET",data:{format:"json"},success:function(reply){reply.url=url,reply.st_type="gitty",function copyAttrs(names){for(var i=0;i<names.length;i++){var name=names[i];options[name]&&(reply[name]=options[name])}}(["line","regex","showAllMatches","newTab","noHistory","prompt","chat"]),elem.swish("setSource",reply)},error:function(jqXHR){modal.ajaxError(jqXHR)}}),this},playURL:function(options){var elem=this,existing=this.find(".storage").storage("match",options);if(existing&&existing.storage("expose","Already open"))return this;backend.ajax({url:options.url,type:"GET",data:{format:"json"},success:function(source){var msg;if("string"==typeof source)msg={data:source,st_type:"external"};else{if("object"!=typeof source||"string"!=typeof source.data)return void alert("Invalid data");(msg=source).st_type="filesys"}msg.url=options.url,function copyAttrs(names){for(var i=0;i<names.length;i++){var name=names[i];options[name]&&(msg[name]=options[name])}}(["line","regex","showAllMatches","newTab","noHistory","prompt"]),elem.swish("setSource",msg)},error:function(jqXHR){modal.ajaxError(jqXHR)}})},setSource:function(src){var st=this.swish("isFullscreen");return st&&st.storage("setSource",src)||(st&&this.swish("exitFullscreen"),this.find(".tabbed").tabbed("tabFromSource",src)),this},openExampleFunction:function(ex){var swish=this;return"divider"==ex.type?"--":"store"==ex.type?function(){methods.playFile.call(swish,ex.file)}:function(){methods.playURL.call(swish,{url:ex.href})}},populateExamples:function(navbar,dropdown){var that=this;return that.off("examples-changed").on("examples-changed",function(){$("#navbar").navbar("clearDropdown",dropdown),that.swish("populateExamples",navbar,dropdown)}),backend.ajax({url:config.http.locations.swish_examples,dataType:"json",success:function(data){for(var i=0;i<data.length;i++){var name,title,options,ex=data[i];"--"==ex||"divider"==ex.type?options=title="--":(name=ex.file||ex.href,title=ex.title,options=that.swish("openExampleFunction",ex),name&&(options.typeIcon=name.split(".").pop())),$("#navbar").navbar("extendDropdown",dropdown,title,options)}},error:function(jqXHR){modal.ajaxError(jqXHR)}}),this},populateHelp:function(navbar,dropdown){return backend.ajax({url:config.http.locations.swish_help_index,dataType:"json",success:function(data){for(var i=0;i<data.length;i++){var title,options=data[i];options="--"==options||"divider"==options.type?title="--":(options.file,title=options.title,function openHelpFunction(help){return function(){menuBroadcast("help",{file:help.file})}}(options)),$("#navbar").navbar("extendDropdown",dropdown,title,options)}},error:function(jqXHR){modal.ajaxError(jqXHR)}}),this},prologSource:function(){var src,list=[];return(src=$(".prolog-editor").prologEditor("getSource","source"))&&list.push(src),(src=$(".background.prolog.source").text())&&list.push(src),list.join("\n\n")},breakpoints:function(pengineID){return this.find(".prolog-editor").prologEditor("getBreakpoints",pengineID)||[]},tabData:function(options){return((options=options||{}).active?this.find(".tab-pane.active .storage"):this.find(".storage")).storage("getData",options)},examples:function(onlyglobal){var text=$(".examples.prolog").text();return text?$().prologEditor("getExamples",text,!1):1!=onlyglobal?function(){return $(".prolog-editor").prologEditor("getExamples")}:void 0},fullscreen:function(node,main,hide_navbar){var data,swish=this,content=this.find(".container.tile-top");return this.data("swish").restoring?this.swish("afterRestore",function(){swish.swish("fullscreen",node,main,hide_navbar)}):content.hasClass("fullscreen")||((1==hide_navbar||config.swish.fullscreen&&1==config.swish.fullscreen.hide_navbar)&&this.swish("showNavbar",!1),(data=this.data("fullscreen"))||(data={},this.data("fullscreen",data)),content.addClass("fullscreen"),(main=main||node).addClass("fullscreen hamburger"),data.fullscreen_origin=node.parent()[0],data.fullscreen_main=main[0],$(content.children()[0]).hide(),content.append(node),main.trigger("fullscreen",!0)),this},exitFullscreen:function(){var content=this.find(".container.tile-top");if(content.hasClass("fullscreen")){var data=this.data("fullscreen"),node=$(content.children()[1]),main=data.fullscreen_main;return this.swish("showNavbar",!0),content.removeClass("fullscreen"),$(data.fullscreen_main).removeClass("fullscreen hamburger"),$(data.fullscreen_origin).append(node),data.fullscreen_origin=null,data.fullscreen_main=null,$(content.children()[0]).show(),$(main).trigger("fullscreen",!1),!0}return!1},isFullscreen:function(){var st=this.find(".container.tile-top");if(st.hasClass("fullscreen")){st=st.find(".storage");if(0!=st.length)return st}},showNavbar:function(show){show?$("nav.navbar").attr("style","display:block !important"):$("nav.navbar").attr("style","display:none !important")},collaborate:function(){var elem=this;return $(this).attr("data-end-togetherjs-html","End collaboration"),require(["https://togetherjs.com/togetherjs-min.js"],function(){TogetherJS(elem)}),this},showUpdates:function(options){modal.show({title:options.title||"Recent SWISH updates",body:function(){this.version(options)}})}};function menuBroadcast(event,data){$(".swish-event-receiver").trigger(event,data)}$.fn.swish=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.swish"):methods._init.apply(this,arguments)},$.fn.swish.methods=methods}(jQuery),{swish:$("body"),trigger:function(name,data){this.swish.swish("trigger",name,data)}}}),define("plugin",["jquery","config","utils"],function($,config,utils){function to_array(x){return void 0!==x?$.isArray(x)?x:[x]:[]}return{load:function(){var jsdeps=[];if($.isArray(config.plugins))for(var i=0;i<config.plugins.length;i++)$.merge(jsdeps,function load_plugin(plugin){return to_array(plugin.css).forEach(utils.loadCSS),to_array(plugin.js)}(config.plugins[i]));return jsdeps}}}),require.config({urlArgs:"ts="+(new Date).getTime(),waitSeconds:60,paths:{jquery:"../node_modules/jquery/dist/jquery.min","jquery-ui":"../node_modules/jquery-ui/jquery-ui.min",laconic:"../node_modules/laconic/laconic",bootstrap:"../node_modules/bootstrap/dist/js/bootstrap.min",bloodhound:"../node_modules/typeahead.js/dist/bloodhound",typeahead:"../node_modules/typeahead.js/dist/typeahead.jquery",splitter:"../node_modules/jquery.splitter/js/jquery.splitter-0.15.0",tagmanager:"../node_modules/tagmanager/tagmanager",sha1:"../node_modules/js-sha1/src/sha1",c3:"../node_modules/c3/c3",d3:"../node_modules/d3/d3",printThis:"../node_modules/printthis/printThis","svg-pan-zoom":"../node_modules/svg-pan-zoom/dist/svg-pan-zoom.min",sparkline:"../node_modules/sparkline/dist/jquery.sparkline","cm/mode/prolog":"codemirror/mode/prolog","cm/addon/hover/prolog-hover":"codemirror/addon/hover/prolog-hover","cm/addon/hover/text-hover":"codemirror/addon/hover/text-hover","cm/addon/hint/templates-hint":"codemirror/addon/hint/templates-hint","cm/addon/hint/show-context-info":"codemirror/addon/hint/show-context-info",cm:"../node_modules/codemirror"},shim:{bootstrap:{deps:["jquery"]},typeahead:{deps:["jquery"],init:function($){return require.s.contexts._.registry["typeahead.js"].factory($)}},bloodhound:{deps:["jquery"]},splitter:{deps:["jquery"]},laconic:{deps:["jquery"]},tagmanager:{deps:["jquery"]}}}),require(["jquery","config","jswish","plugin"],function($,config,swish,deps){deps=deps.load();deps.push(config.http.locations.pengines+"/pengines.js"),require(deps,function(){$(function(){$("body").swish(config.swish||{})})})}),define("swish",function(){});